<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>02 Kubeadm离线部署1.14 - AGou's Blog-2</title><meta name=Description content="关于 LoveIt 主题"><meta property="og:title" content="02 Kubeadm离线部署1.14"><meta property="og:description" content="写在前面 本章是kubernetes系列教程第二篇，要深入学习kubernetes，首先需要有一个k8s环境，然而，受制硬件环境，网络环境等因"><meta property="og:type" content="article"><meta property="og:url" content="http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"><meta property="og:image" content="https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/tuoer.jpg"><meta property="article:published_time" content="2019-08-04T10:36:47+08:00"><meta property="article:modified_time" content="2019-08-04T10:36:47+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/tuoer.jpg"><meta name=twitter:title content="02 Kubeadm离线部署1.14"><meta name=twitter:description content="写在前面 本章是kubernetes系列教程第二篇，要深入学习kubernetes，首先需要有一个k8s环境，然而，受制硬件环境，网络环境等因"><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/><link rel=prev href=http://x.agou-ops.top/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/><link rel=next href=http://x.agou-ops.top/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"02 Kubeadm离线部署1.14","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/x.agou-ops.top\/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4\/"},"image":["https:\/\/agou-images.oss-cn-qingdao.aliyuncs.com\/BaseIMG\/tuoer.jpg"],"genre":"posts","keywords":"kubernetes, tutorial","wordcount":5651,"url":"http:\/\/x.agou-ops.top\/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4\/","datePublished":"2019-08-04T10:36:47+08:00","dateModified":"2019-08-04T10:36:47+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"AGou-ops","logo":"https:\/\/agou-images.oss-cn-qingdao.aliyuncs.com\/BaseIMG\/tuoer.jpg"},"author":{"@type":"Person","name":"AGou-ops"},"description":""}</script></head><body header-desktop=auto header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="AGou's Blog-2"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>AGou-ops</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/anime/>Anime </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/AGou-ops title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ selected>简体中文</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="AGou's Blog-2"><span class=header-title-pre><i class="far fa-kiss-wink-heart fa-fw"></i></span>AGou-ops</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/>所有文章</a><a class=menu-item href=/tags/>标签</a><a class=menu-item href=/categories/>分类</a><a class=menu-item href=/anime/>Anime</a><a class=menu-item href=/about/>关于</a><a class=menu-item href=https://github.com/AGou-ops title=GitHub rel="noopener noreffer" target=_blank><i class="fab fa-github fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title=选择语言>简体中文<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">02 Kubeadm离线部署1.14</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>AGou-ops</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E8%BD%AC%E8%BD%BD/><i class="far fa-folder fa-fw"></i>转载</a>&nbsp;<a href=/categories/kubernetes/><i class="far fa-folder fa-fw"></i>kubernetes</a>&nbsp;<a href=/categories/%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/><i class="far fa-folder fa-fw"></i>基础教程</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2019-08-04>2019-08-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 5651 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 12 分钟&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#11-安装概述>1.1 安装概述</a></li><li><a href=#12-minikube在线环境>1.2 MiniKube在线环境</a></li></ul><ul><li><a href=#21-环境说明和准备>2.1 环境说明和准备</a></li><li><a href=#22-安装docker环境>2.2 安装Docker环境</a></li><li><a href=#23-安装kubeadm组件>2.3 安装kubeadm组件</a></li><li><a href=#24-导入kubernetes镜像>2.4 导入kubernetes镜像</a></li><li><a href=#25-kubeadm初始化集群>2.5 kubeadm初始化集群</a></li><li><a href=#26-验证kubernetes组件><strong>2.6 验证kubernetes组件</strong></a></li><li><a href=#27-配置kubectl命令补全>2.7 配置kubectl命令补全</a></li></ul></nav></div></div><div class=content id=content><h1 id=写在前面>写在前面</h1><p>本章是<a href rel>kubernetes系列教程</a>第二篇，要深入学习kubernetes，首先需要有一个k8s环境，然而，受制硬件环境，网络环境等因素，要搭建一个环境有一定的困难，让很多初学者望而却步，本章主要介绍通过kubeadm安装工具部署kubernetes集群，考虑到国内网络限制，已将安装镜像通过跳板机下载到本地，方便大家离线安装。</p><h1 id=1-minikube快速部署环境>1. MiniKube快速部署环境</h1><h2 id=11-安装概述>1.1 安装概述</h2><p>要学习kubernetes，首先需要有一个kubernetes集群，社区为了满足不同场景下，提供了不同的安装方法以适应各种场景需求，常见方法有：</p><ul><li>MiniKube，是一个将kubernetes单节点安装在本地虚拟化工具，<a href=https://kubernetes.io/docs/setup/learning-environment/minikube/ target=_blank rel="noopener noreffer">MiniKube安装文档</a></li><li>二进制安装，通过已编译好的二进制文件安装，需设置参数，可定制化强，安装难度大</li><li>Kubeadm，一个自动化安装工具，以镜像的方式部署，使用简单，镜像在谷歌仓库，下载易失败</li></ul><p>对于学习环境，Katacoda提供了一个在线的MiniKube环境，只需在控制台启用即可使用，当然也可以将MiniKube下载到本地使用。对于生产环境，推荐使用二进制安装或者Kubeadm，新版kubeadm目前已将kubernetes管理组件以pod的形式部署在集群中，不管用哪种方式，受限于GFW，大部分镜像下载，大家自行补脑和解决，本文以离线的方式安装部署，根据安装版本下载对应的安装镜像倒入系统即可。</p><ul><li><a href=https://happylau-k8s-1251956900.cos.ap-chengdu.myqcloud.com/kubernetes/v1.14.1.tar.gz target=_blank rel="noopener noreffer">1.14.1安装镜像下载链接</a></li><li><a href=https://happylau-k8s-1251956900.cos.ap-chengdu.myqcloud.com/kubernetes/v1.17.0.tar.gz target=_blank rel="noopener noreffer">v1.17.0安装镜像下载链接</a></li></ul><h2 id=12-minikube在线环境>1.2 MiniKube在线环境</h2><p>Katacoda使用MiniKube提供了一个在线部署kubernetres环境，当然也可以基于MiniKube本地安装，如果是初学者想初探一下kubernetes的功能，可以使用Katacoda提供的线上环境，达到快速入门学习的目的。参考文档，直接在<a href=https://kubernetes.io/docs/tutorials/hello-minikube/ target=_blank rel="noopener noreffer">Hello MiniKube</a>文档中点击Open terminal即可自动创建一个kubernetes环境，其会自动拉取镜像并部署所需环境。</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/1%20-%20ze6fcsx8gv.gif data-srcset="https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/1%20-%20ze6fcsx8gv.gif, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/1%20-%20ze6fcsx8gv.gif 1.5x, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/1%20-%20ze6fcsx8gv.gif 2x" data-sizes=auto alt=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/1%20-%20ze6fcsx8gv.gif title=MiniKube在线安装环境></p><p>如上图所示，MiniKube的提供的优点如下：</p><ul><li>快捷，自动部署环境</li><li>无需占用本地资源</li><li>适用于学习环境</li></ul><h1 id=2-kubeadm部署k8s集群>2 kubeadm部署k8s集群</h1><p><img class=lazyload src=/svg/loading.min.svg data-src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/2%20-%201620.jpg data-srcset="https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/2%20-%201620.jpg, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/2%20-%201620.jpg 1.5x, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/2%20-%201620.jpg 2x" data-sizes=auto alt=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/2%20-%201620.jpg title=kubeadm安装部署集群></p><h2 id=21-环境说明和准备>2.1 环境说明和准备</h2><p><strong>【软件版本】</strong></p><table><thead><tr><th align=left>软件名</th><th align=left>软件版本</th></tr></thead><tbody><tr><td align=left>OS</td><td align=left>CentOS Linux release 7.6.1810 (Core)</td></tr><tr><td align=left>Docker</td><td align=left>docker-ce-18.03.1.ce-1.el7</td></tr><tr><td align=left>Kubernetes</td><td align=left>1.14.1</td></tr><tr><td align=left>Kubeadm</td><td align=left>kubeadm-1.14.1-0.x86_64</td></tr><tr><td align=left>etcd</td><td align=left>3.3.10</td></tr><tr><td align=left>flannel</td><td align=left>v0.11.0</td></tr></tbody></table><p><strong>【环境说明】</strong></p><p>三台机器均为腾讯云上购买的<a href=# rel>CVM</a>（Cloud Virtual Machine），机器配置是2vcpu+4G memory+50G disk</p><table><thead><tr><th align=left>主机名</th><th align=left>角色</th><th align=left>IP地址</th><th align=center>软件</th></tr></thead><tbody><tr><td align=left>node-1</td><td align=left>master</td><td align=left>10.254.100.101</td><td align=center>docker,kubelet,etcd,kube-apiserver,kube-controller-manager,kube-scheduler</td></tr><tr><td align=left>node-2</td><td align=left>worker</td><td align=left>10.254.100.102</td><td align=center>docker,kubelet,kube-proxy,flannel</td></tr><tr><td align=left>node-3</td><td align=left>worker</td><td align=left>10.254.100.103</td><td align=center>docker,kubelet,kube-proxy,flannel</td></tr></tbody></table><p><strong>【环境准备】</strong></p><p>1、设置主机名，其他两个节点类似设置</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=nx>root</span><span class=err>@</span><span class=nx>VM_100_101_centos</span> <span class=o>~</span><span class=err>#</span> <span class=nx>hostnamectl</span> <span class=nx>set</span><span class=o>-</span><span class=nx>hostname</span> <span class=nx>node</span><span class=o>-</span><span class=mi>1</span>
<span class=nx>root</span><span class=err>@</span><span class=nx>VM_100_101_centos</span> <span class=o>~</span><span class=err>#</span> <span class=nx>hostname</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>1</span>
</code></pre></td></tr></table></div></div><p>2、设置hosts文件，其他两个节点设置相同内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=err>#</span> <span class=nx>vim</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>hosts</span>
<span class=mf>127.0.0.1</span> <span class=nx>localhost</span> <span class=nx>localhost</span><span class=p>.</span><span class=nx>localdomain</span> 
<span class=mf>10.254.100.101</span> <span class=nx>node</span><span class=o>-</span><span class=mi>1</span>
<span class=mf>10.254.100.102</span> <span class=nx>node</span><span class=o>-</span><span class=mi>2</span>
<span class=mf>10.254.100.103</span> <span class=nx>node</span><span class=o>-</span><span class=mi>3</span>
</code></pre></td></tr></table></div></div><p>3、设置SSH无密码登录，并通过ssh-copy-id将公钥拷贝到对端</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=err>#</span><span class=nx>生成密钥对</span>
<span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=p>.</span><span class=nx>ssh</span><span class=err>#</span> <span class=nx>ssh</span><span class=o>-</span><span class=nx>keygen</span> <span class=o>-</span><span class=nx>P</span> <span class=s1>&#39;&#39;</span>
<span class=nx>Generating</span> <span class=kr>public</span><span class=o>/</span><span class=kr>private</span> <span class=nx>rsa</span> <span class=nx>key</span> <span class=nx>pair</span><span class=p>.</span>
<span class=nx>Enter</span> <span class=nx>file</span> <span class=k>in</span> <span class=nx>which</span> <span class=nx>to</span> <span class=nx>save</span> <span class=nx>the</span> <span class=nx>key</span> <span class=p>(</span><span class=sr>/root/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_rsa</span><span class=p>)</span><span class=o>:</span> 
<span class=nx>Your</span> <span class=nx>identification</span> <span class=nx>has</span> <span class=nx>been</span> <span class=nx>saved</span> <span class=k>in</span> <span class=sr>/root/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_rsa</span><span class=p>.</span>
<span class=nx>Your</span> <span class=kr>public</span> <span class=nx>key</span> <span class=nx>has</span> <span class=nx>been</span> <span class=nx>saved</span> <span class=k>in</span> <span class=sr>/root/</span><span class=p>.</span><span class=nx>ssh</span><span class=o>/</span><span class=nx>id_rsa</span><span class=p>.</span><span class=nx>pub</span><span class=p>.</span>
<span class=nx>The</span> <span class=nx>key</span> <span class=nx>fingerprint</span> <span class=nx>is</span><span class=o>:</span>
<span class=nx>SHA256</span><span class=o>:</span><span class=nx>zultDMEL8bZmpbUjQahVjthVAcEkN929w5EkUmPkOrU</span> <span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span>
<span class=nx>The</span> <span class=nx>key</span><span class=s1>&#39;s randomart image is:
</span><span class=s1>+---RSA 2048----+
</span><span class=s1>|      .=O=+=o.. |
</span><span class=s1>|     o+o..+.o+  |
</span><span class=s1>|    .oo=.   o. o |
</span><span class=s1>|    . . * oo .+  |
</span><span class=s1>|       oSOo.E  . |
</span><span class=s1>|       oO.o.     |
</span><span class=s1>|       o++ .     |
</span><span class=s1>|       . .o      |
</span><span class=s1>|        ...      |
</span><span class=s1>+----SHA256-----+
</span><span class=s1>
</span><span class=s1>#拷贝公钥到node-2和node-3节点
</span><span class=s1>root@node-1 .ssh# ssh-copy-id -i /root/.ssh/id_rsa.pub node-2:
</span><span class=s1>/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &#34;/root/.ssh/id_rsa.pub&#34;
</span><span class=s1>The authenticity of host &#39;</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=p>(</span><span class=mf>10.254.100.101</span><span class=p>)</span><span class=s1>&#39; can&#39;</span><span class=nx>t</span> <span class=nx>be</span> <span class=nx>established</span><span class=p>.</span>
<span class=nx>ECDSA</span> <span class=nx>key</span> <span class=nx>fingerprint</span> <span class=nx>is</span> <span class=nx>SHA256</span><span class=o>:</span><span class=nx>jLUH0exgyJdsy0frw9R</span><span class=o>+</span><span class=nx>FiWy</span><span class=o>+</span><span class=mo>0o54</span><span class=nx>LgB6dgVdfc6SEE</span><span class=p>.</span>
<span class=nx>ECDSA</span> <span class=nx>key</span> <span class=nx>fingerprint</span> <span class=nx>is</span> <span class=nx>MD5</span><span class=o>:</span><span class=nx>f4</span><span class=o>:</span><span class=mi>86</span><span class=o>:</span><span class=nx>a8</span><span class=o>:</span><span class=mi>0</span><span class=nx>e</span><span class=o>:</span><span class=nx>a6</span><span class=o>:</span><span class=mi>03</span><span class=o>:</span><span class=nx>fc</span><span class=o>:</span><span class=nx>a6</span><span class=o>:</span><span class=mi>04</span><span class=o>:</span><span class=nx>df</span><span class=o>:</span><span class=mi>91</span><span class=o>:</span><span class=nx>d8</span><span class=o>:</span><span class=mi>7</span><span class=nx>a</span><span class=o>:</span><span class=nx>a7</span><span class=o>:</span><span class=mi>0</span><span class=nx>d</span><span class=o>:</span><span class=mi>9</span><span class=nx>e</span><span class=p>.</span>
<span class=nx>Are</span> <span class=nx>you</span> <span class=nx>sure</span> <span class=nx>you</span> <span class=nx>want</span> <span class=nx>to</span> <span class=k>continue</span> <span class=nx>connecting</span> <span class=p>(</span><span class=nx>yes</span><span class=o>/</span><span class=nx>no</span><span class=p>)</span><span class=o>?</span> <span class=nx>yes</span>
<span class=err>/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span>
<span class=err>/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span>
<span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;s password: 
</span><span class=s1>Number of key(s) added: 1
</span><span class=s1>Now try logging into the machine, with:   &#34;ssh &#39;</span><span class=nx>node</span><span class=o>-</span><span class=mi>2</span><span class=err>&#39;&#34;</span>
<span class=nx>and</span> <span class=nx>check</span> <span class=nx>to</span> <span class=nx>make</span> <span class=nx>sure</span> <span class=nx>that</span> <span class=nx>only</span> <span class=nx>the</span> <span class=nx>key</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span> <span class=nx>you</span> <span class=nx>wanted</span> <span class=nx>were</span> <span class=nx>added</span><span class=p>.</span>
</code></pre></td></tr></table></div></div><p>4、关闭防火墙和SElinux</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>stop</span> <span class=nx>firewalld</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>disable</span> <span class=nx>firewalld</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>sed</span> <span class=o>-</span><span class=nx>i</span> <span class=s1>&#39;/^SELINUX=/ s/enforcing/disabled/g&#39;</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>selinux</span><span class=o>/</span><span class=nx>config</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>setenforce</span> <span class=mi>0</span>
</code></pre></td></tr></table></div></div><h2 id=22-安装docker环境>2.2 安装Docker环境</h2><p>1、下载docker的yum源</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>cd</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>yum</span><span class=p>.</span><span class=nx>repos</span><span class=p>.</span><span class=nx>d</span><span class=o>/</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>wget</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//download.docker.com/linux/centos/docker-ce.repo
</span></code></pre></td></tr></table></div></div><p>2、设置cgroup driver类型为systemd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=o>&gt;</span> <span class=err>/etc/docker/daemon.json &lt;&lt;EOF</span>
<span class=o>&gt;</span> <span class=p>{</span>
<span class=o>&gt;</span>  <span class=s2>&#34;exec-opts&#34;</span><span class=o>:</span> <span class=p>[</span><span class=s2>&#34;native.cgroupdriver=systemd&#34;</span><span class=p>],</span>
<span class=o>&gt;</span>  <span class=s2>&#34;log-driver&#34;</span><span class=o>:</span> <span class=s2>&#34;json-file&#34;</span><span class=p>,</span>
<span class=o>&gt;</span>  <span class=s2>&#34;log-opts&#34;</span><span class=o>:</span> <span class=p>{</span>
<span class=o>&gt;</span>  <span class=s2>&#34;max-size&#34;</span><span class=o>:</span> <span class=s2>&#34;100m&#34;</span>
<span class=o>&gt;</span>  <span class=p>},</span>
<span class=o>&gt;</span>  <span class=s2>&#34;storage-driver&#34;</span><span class=o>:</span> <span class=s2>&#34;overlay2&#34;</span><span class=p>,</span>
<span class=o>&gt;</span>  <span class=s2>&#34;storage-opts&#34;</span><span class=o>:</span> <span class=p>[</span>
<span class=o>&gt;</span>  <span class=s2>&#34;overlay2.override_kernel_check=true&#34;</span>
<span class=o>&gt;</span>  <span class=p>]</span>
<span class=o>&gt;</span> <span class=p>}</span>
<span class=o>&gt;</span> <span class=nx>EOF</span>
</code></pre></td></tr></table></div></div><p>3、启动docker服务并验证，可以通过docker info查看docker安装的版本等信息</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>restart</span> <span class=nx>docker</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>enable</span> <span class=nx>docker</span>
</code></pre></td></tr></table></div></div><p>备注：如果机器不具备上网条件，或者访问docker的yum源仓库很慢，我已将docker相关rpm包依赖包下载到腾讯云cos中，<a href=https://happylau-k8s-1251956900.cos.ap-chengdu.myqcloud.com/kubernetes/docker_19.03.tar.gz target=_blank rel="noopener noreffer">下载链接</a>，可以下载到本地，然后解压缩然后运行yum localinstall进行安装。</p><h2 id=23-安装kubeadm组件>2.3 安装kubeadm组件</h2><p>1、安装kubernetes源，国内可以使用阿里的kubernetes源，速度会快一点</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span><span class=nx>cat</span> <span class=o>&lt;&lt;</span><span class=nx>EOF</span> <span class=o>&gt;</span> <span class=sr>/etc/yum</span><span class=p>.</span><span class=nx>repos</span><span class=p>.</span><span class=nx>d</span><span class=o>/</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>repo</span>
<span class=p>[</span><span class=nx>kubernetes</span><span class=p>]</span>
<span class=nx>name</span><span class=o>=</span><span class=nx>Kubernetes</span>
<span class=nx>baseurl</span><span class=o>=</span><span class=nx>https</span><span class=o>:</span><span class=c1>//mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span><span class=c1></span><span class=nx>enabled</span><span class=o>=</span><span class=mi>1</span>
<span class=nx>gpgcheck</span><span class=o>=</span><span class=mi>1</span>
<span class=nx>repo_gpgcheck</span><span class=o>=</span><span class=mi>1</span>
<span class=nx>gpgkey</span><span class=o>=</span><span class=nx>https</span><span class=o>:</span><span class=c1>//mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span><span class=c1></span><span class=nx>EOF</span>
</code></pre></td></tr></table></div></div><p>2、安装kubeadm，kubelet，kubectl，会自动安装几个重要依赖包：socat，cri-tools，cni等包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>yum</span> <span class=nx>install</span> <span class=nx>kubeadm</span><span class=o>-</span><span class=mf>1.14.1</span><span class=o>-</span><span class=mi>0</span> <span class=nx>kubectl</span><span class=o>-</span><span class=mf>1.14.1</span><span class=o>-</span><span class=mi>0</span> <span class=nx>kubelet</span><span class=o>-</span><span class=mf>1.14.1</span><span class=o>-</span><span class=mi>0</span> <span class=o>--</span><span class=nx>disableexcludes</span><span class=o>=</span><span class=nx>kubernetes</span> <span class=o>-</span><span class=nx>y</span>
</code></pre></td></tr></table></div></div><p>3、设置iptables网桥参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=o>&lt;&lt;</span><span class=nx>EOF</span> <span class=o>&gt;</span>  <span class=err>/etc/sysctl.d/k8s.conf</span>
<span class=o>&gt;</span> <span class=nx>net</span><span class=p>.</span><span class=nx>bridge</span><span class=p>.</span><span class=nx>bridge</span><span class=o>-</span><span class=nx>nf</span><span class=o>-</span><span class=nx>call</span><span class=o>-</span><span class=nx>ip6tables</span> <span class=o>=</span> <span class=mi>1</span>
<span class=o>&gt;</span> <span class=nx>net</span><span class=p>.</span><span class=nx>bridge</span><span class=p>.</span><span class=nx>bridge</span><span class=o>-</span><span class=nx>nf</span><span class=o>-</span><span class=nx>call</span><span class=o>-</span><span class=nx>iptables</span> <span class=o>=</span> <span class=mi>1</span>
<span class=o>&gt;</span> <span class=nx>EOF</span>

<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>sysctl</span> <span class=o>--</span><span class=nx>system</span><span class=p>,</span><span class=nx>然后使用sysctl</span> <span class=o>-</span><span class=nx>a</span><span class=o>|</span><span class=nx>grep</span> <span class=nx>参数的方式验证是否生效</span>
</code></pre></td></tr></table></div></div><p>4、重新启动kubelet服务，使配置生效</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>restart</span> <span class=nx>kubelet</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>systemctl</span> <span class=nx>enable</span> <span class=nx>kubelet</span>
</code></pre></td></tr></table></div></div><p>备注：如果本地下载很慢或者无法下载kubernetes中yum源rpm包，可以通过离线方式下载，<a href=https://happylau-k8s-1251956900.cos.ap-chengdu.myqcloud.com/kubernetes/kubernetes_rpms.tar.gz target=_blank rel="noopener noreffer">下载路径</a></p><h2 id=24-导入kubernetes镜像>2.4 导入kubernetes镜像</h2><p>1、从cos中下载kubernetes安装镜像，并通过docker load命令将镜像导入到环境中</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>etcd</span><span class=o>:</span><span class=mf>3.3.10</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>pause</span><span class=o>:</span><span class=mf>3.1</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>coredns</span><span class=o>:</span><span class=mf>1.3.1</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>flannel</span><span class=o>:</span><span class=nx>v0</span><span class=mf>.11.0</span><span class=o>-</span><span class=nx>amd64</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span><span class=o>:</span><span class=nx>v1</span><span class=mf>.14.1</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=o>:</span><span class=nx>v1</span><span class=mf>.14.1</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span><span class=o>:</span><span class=nx>v1</span><span class=mf>.14.1</span><span class=p>.</span><span class=nx>tar</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>load</span> <span class=o>-</span><span class=nx>i</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span><span class=o>:</span><span class=nx>v1</span><span class=mf>.14.1</span><span class=p>.</span><span class=nx>tar</span> 
</code></pre></td></tr></table></div></div><p>2、检查镜像列表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>v1</span><span class=mf>.14.1</span><span class=p>]</span><span class=err>#</span> <span class=nx>docker</span> <span class=nx>image</span> <span class=nx>list</span>
<span class=nx>REPOSITORY</span>                           <span class=nx>TAG</span>                 <span class=nx>IMAGE</span> <span class=nx>ID</span>            <span class=nx>CREATED</span>             <span class=nx>SIZE</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span>                <span class=nx>v1</span><span class=mf>.14.1</span>             <span class=mi>20</span><span class=nx>a2d7035165</span>        <span class=mi>3</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mf>82.1</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span>            <span class=nx>v1</span><span class=mf>.14.1</span>             <span class=nx>cfaa4ad74c37</span>        <span class=mi>3</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mi>210</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span>            <span class=nx>v1</span><span class=mf>.14.1</span>             <span class=mi>8931473</span><span class=nx>d5bdb</span>        <span class=mi>3</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mf>81.6</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span>   <span class=nx>v1</span><span class=mf>.14.1</span>             <span class=nx>efb3887b411d</span>        <span class=mi>3</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mi>158</span><span class=nx>MB</span>
<span class=nx>quay</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>coreos</span><span class=o>/</span><span class=nx>flannel</span>               <span class=nx>v0</span><span class=mf>.11.0</span><span class=o>-</span><span class=nx>amd64</span>       <span class=nx>ff281650a721</span>        <span class=mi>6</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mf>52.6</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>coredns</span>                   <span class=mf>1.3.1</span>               <span class=nx>eb516548c180</span>        <span class=mi>6</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mf>40.3</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>etcd</span>                      <span class=mf>3.3.10</span>              <span class=mi>2</span><span class=nx>c4adeb21b4f</span>        <span class=mi>8</span> <span class=nx>months</span> <span class=nx>ago</span>        <span class=mi>258</span><span class=nx>MB</span>
<span class=nx>k8s</span><span class=p>.</span><span class=nx>gcr</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>pause</span>                     <span class=mf>3.1</span>                 <span class=nx>da86e6ba6ca1</span>        <span class=mi>19</span> <span class=nx>months</span> <span class=nx>ago</span>       <span class=mi>742</span><span class=nx>kB</span>
</code></pre></td></tr></table></div></div><h2 id=25-kubeadm初始化集群>2.5 kubeadm初始化集群</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/3%20-%201620.jpg data-srcset="https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/3%20-%201620.jpg, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/3%20-%201620.jpg 1.5x, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/3%20-%201620.jpg 2x" data-sizes=auto alt=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/3%20-%201620.jpg title=kubeadm初始化集群></p><p>1、 kubeadm初始化集群，需要设置初始参数</p><ul><li>&ndash;pod-network-cidr指定pod使用的网段，设置值根据不同的网络plugin选择，本文以flannel为例设置值为10.244.0.0/16</li><li>container runtime可以通过&ndash;cri-socket指定socket文件所属路径</li><li>如果有多个网卡可以通过&ndash;apiserver-advertise-address指定master地址，默认会选择访问外网的ip</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubeadm</span> <span class=nx>init</span> <span class=o>--</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>advertise</span><span class=o>-</span><span class=nx>address</span> <span class=mf>10.254.100.101</span> <span class=o>--</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>bind</span><span class=o>-</span><span class=nx>port</span> <span class=mi>6443</span> <span class=o>--</span><span class=nx>kubernetes</span><span class=o>-</span><span class=nx>version</span> <span class=mf>1.14.1</span> <span class=o>--</span><span class=nx>pod</span><span class=o>-</span><span class=nx>network</span><span class=o>-</span><span class=nx>cidr</span> <span class=mf>10.244.0.0</span><span class=o>/</span><span class=mi>16</span>
<span class=p>[</span><span class=nx>init</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>Kubernetes</span> <span class=nx>version</span><span class=o>:</span> <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Running</span> <span class=nx>pre</span><span class=o>-</span><span class=nx>flight</span> <span class=nx>checks</span>
 <span class=p>[</span><span class=nx>WARNING</span> <span class=nx>SystemVerification</span><span class=p>]</span><span class=o>:</span> <span class=k>this</span> <span class=nx>Docker</span> <span class=nx>version</span> <span class=nx>is</span> <span class=nx>not</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>list</span> <span class=k>of</span> <span class=nx>validated</span> <span class=nx>versions</span><span class=o>:</span> <span class=mf>18.03.1</span><span class=o>-</span><span class=nx>ce</span><span class=p>.</span> <span class=nx>Latest</span> <span class=nx>validated</span> <span class=nx>version</span><span class=o>:</span> <span class=mf>18.09</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Pulling</span> <span class=nx>images</span> <span class=nx>required</span> <span class=k>for</span> <span class=nx>setting</span> <span class=nx>up</span> <span class=nx>a</span> <span class=nx>Kubernetes</span> <span class=nx>cluster</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>This</span> <span class=nx>might</span> <span class=nx>take</span> <span class=nx>a</span> <span class=nx>minute</span> <span class=nx>or</span> <span class=nx>two</span><span class=p>,</span> <span class=nx>depending</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>speed</span> <span class=k>of</span> <span class=nx>your</span> <span class=nx>internet</span> <span class=nx>connection</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>You</span> <span class=nx>can</span> <span class=nx>also</span> <span class=nx>perform</span> <span class=k>this</span> <span class=nx>action</span> <span class=k>in</span> <span class=nx>beforehand</span> <span class=nx>using</span> <span class=s1>&#39;kubeadm config images pull&#39;</span><span class=err>#</span><span class=nx>下载镜像</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>environment</span> <span class=nx>file</span> <span class=kd>with</span> <span class=nx>flags</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s2>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>configuration</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s2>&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Activating</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>service</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>certificateDir</span> <span class=nx>folder</span> <span class=s2>&#34;/etc/kubernetes/pki&#34;</span><span class=err>#</span><span class=nx>生成CA等证书</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;ca&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;apiserver&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>apiserver</span> <span class=nx>serving</span> <span class=nx>cert</span> <span class=nx>is</span> <span class=nx>signed</span> <span class=k>for</span> <span class=nx>DNS</span> <span class=nx>names</span> <span class=p>[</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>kubernetes</span> <span class=nx>kubernetes</span><span class=p>.</span><span class=k>default</span> <span class=nx>kubernetes</span><span class=p>.</span><span class=k>default</span><span class=p>.</span><span class=nx>svc</span> <span class=nx>kubernetes</span><span class=p>.</span><span class=k>default</span><span class=p>.</span><span class=nx>svc</span><span class=p>.</span><span class=nx>cluster</span><span class=p>.</span><span class=nx>local</span><span class=p>]</span> <span class=nx>and</span> <span class=nx>IPs</span> <span class=p>[</span><span class=mf>10.96.0.1</span> <span class=mf>10.254.100.101</span><span class=p>]</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;apiserver-kubelet-client&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;etcd/ca&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;etcd/server&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>etcd</span><span class=o>/</span><span class=nx>server</span> <span class=nx>serving</span> <span class=nx>cert</span> <span class=nx>is</span> <span class=nx>signed</span> <span class=k>for</span> <span class=nx>DNS</span> <span class=nx>names</span> <span class=p>[</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>localhost</span><span class=p>]</span> <span class=nx>and</span> <span class=nx>IPs</span> <span class=p>[</span><span class=mf>10.254.100.101</span> <span class=mf>127.0.0.1</span> <span class=o>::</span><span class=mi>1</span><span class=p>]</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;apiserver-etcd-client&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;etcd/peer&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>etcd</span><span class=o>/</span><span class=nx>peer</span> <span class=nx>serving</span> <span class=nx>cert</span> <span class=nx>is</span> <span class=nx>signed</span> <span class=k>for</span> <span class=nx>DNS</span> <span class=nx>names</span> <span class=p>[</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>localhost</span><span class=p>]</span> <span class=nx>and</span> <span class=nx>IPs</span> <span class=p>[</span><span class=mf>10.254.100.101</span> <span class=mf>127.0.0.1</span> <span class=o>::</span><span class=mi>1</span><span class=p>]</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;etcd/healthcheck-client&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;front-proxy-ca&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;front-proxy-client&#34;</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Generating</span> <span class=s2>&#34;sa&#34;</span> <span class=nx>key</span> <span class=nx>and</span> <span class=kr>public</span> <span class=nx>key</span>
<span class=p>[</span><span class=nx>kubeconfig</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>kubeconfig</span> <span class=nx>folder</span> <span class=s2>&#34;/etc/kubernetes&#34;</span>
<span class=p>[</span><span class=nx>kubeconfig</span><span class=p>]</span> <span class=nx>Writing</span> <span class=s2>&#34;admin.conf&#34;</span> <span class=nx>kubeconfig</span> <span class=nx>file</span>
<span class=p>[</span><span class=nx>kubeconfig</span><span class=p>]</span> <span class=nx>Writing</span> <span class=s2>&#34;kubelet.conf&#34;</span> <span class=nx>kubeconfig</span> <span class=nx>file</span>
<span class=p>[</span><span class=nx>kubeconfig</span><span class=p>]</span> <span class=nx>Writing</span> <span class=s2>&#34;controller-manager.conf&#34;</span> <span class=nx>kubeconfig</span> <span class=nx>file</span>
<span class=p>[</span><span class=nx>kubeconfig</span><span class=p>]</span> <span class=nx>Writing</span> <span class=s2>&#34;scheduler.conf&#34;</span> <span class=nx>kubeconfig</span> <span class=nx>file</span>
<span class=p>[</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>manifest</span> <span class=nx>folder</span> <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span><span class=err>#</span><span class=nx>生成master节点静态pod配置文件</span>
<span class=p>[</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Creating</span> <span class=kr>static</span> <span class=nx>Pod</span> <span class=nx>manifest</span> <span class=k>for</span> <span class=s2>&#34;kube-apiserver&#34;</span>
<span class=p>[</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Creating</span> <span class=kr>static</span> <span class=nx>Pod</span> <span class=nx>manifest</span> <span class=k>for</span> <span class=s2>&#34;kube-controller-manager&#34;</span>
<span class=p>[</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Creating</span> <span class=kr>static</span> <span class=nx>Pod</span> <span class=nx>manifest</span> <span class=k>for</span> <span class=s2>&#34;kube-scheduler&#34;</span>
<span class=p>[</span><span class=nx>etcd</span><span class=p>]</span> <span class=nx>Creating</span> <span class=kr>static</span> <span class=nx>Pod</span> <span class=nx>manifest</span> <span class=k>for</span> <span class=nx>local</span> <span class=nx>etcd</span> <span class=k>in</span> <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span>
<span class=p>[</span><span class=nx>wait</span><span class=o>-</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>boot</span> <span class=nx>up</span> <span class=nx>the</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>as</span> <span class=kr>static</span> <span class=nx>Pods</span> <span class=nx>from</span> <span class=nx>directory</span> <span class=s2>&#34;/etc/kubernetes/manifests&#34;</span><span class=p>.</span> <span class=nx>This</span> <span class=nx>can</span> <span class=nx>take</span> <span class=nx>up</span> <span class=nx>to</span> <span class=mi>4</span><span class=nx>m0s</span>
<span class=p>[</span><span class=nx>apiclient</span><span class=p>]</span> <span class=nx>All</span> <span class=nx>control</span> <span class=nx>plane</span> <span class=nx>components</span> <span class=nx>are</span> <span class=nx>healthy</span> <span class=nx>after</span> <span class=mf>18.012370</span> <span class=nx>seconds</span>
<span class=p>[</span><span class=nx>upload</span><span class=o>-</span><span class=nx>config</span><span class=p>]</span> <span class=nx>storing</span> <span class=nx>the</span> <span class=nx>configuration</span> <span class=nx>used</span> <span class=k>in</span> <span class=nx>ConfigMap</span> <span class=s2>&#34;kubeadm-config&#34;</span> <span class=k>in</span> <span class=nx>the</span> <span class=s2>&#34;kube-system&#34;</span> <span class=nx>Namespace</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=p>]</span> <span class=nx>Creating</span> <span class=nx>a</span> <span class=nx>ConfigMap</span> <span class=s2>&#34;kubelet-config-1.14&#34;</span> <span class=k>in</span> <span class=nx>namespace</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> <span class=kd>with</span> <span class=nx>the</span> <span class=nx>configuration</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelets</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>cluster</span>
<span class=p>[</span><span class=nx>upload</span><span class=o>-</span><span class=nx>certs</span><span class=p>]</span> <span class=nx>Skipping</span> <span class=nx>phase</span><span class=p>.</span> <span class=nx>Please</span> <span class=nx>see</span> <span class=o>--</span><span class=nx>experimental</span><span class=o>-</span><span class=nx>upload</span><span class=o>-</span><span class=nx>certs</span>
<span class=p>[</span><span class=nx>mark</span><span class=o>-</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Marking</span> <span class=nx>the</span> <span class=nx>node</span> <span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>as</span> <span class=nx>control</span><span class=o>-</span><span class=nx>plane</span> <span class=nx>by</span> <span class=nx>adding</span> <span class=nx>the</span> <span class=nx>label</span> <span class=s2>&#34;node-role.kubernetes.io/master=&#39;&#39;&#34;</span>
<span class=p>[</span><span class=nx>mark</span><span class=o>-</span><span class=nx>control</span><span class=o>-</span><span class=nx>plane</span><span class=p>]</span> <span class=nx>Marking</span> <span class=nx>the</span> <span class=nx>node</span> <span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=nx>as</span> <span class=nx>control</span><span class=o>-</span><span class=nx>plane</span> <span class=nx>by</span> <span class=nx>adding</span> <span class=nx>the</span> <span class=nx>taints</span> <span class=p>[</span><span class=nx>node</span><span class=o>-</span><span class=nx>role</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>master</span><span class=o>:</span><span class=nx>NoSchedule</span><span class=p>]</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>token</span><span class=o>:</span> <span class=nx>r8n5f2</span><span class=mf>.9</span><span class=nx>mic7opmrwjakled</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>Configuring</span> <span class=nx>bootstrap</span> <span class=nx>tokens</span><span class=p>,</span> <span class=nx>cluster</span><span class=o>-</span><span class=nx>info</span> <span class=nx>ConfigMap</span><span class=p>,</span> <span class=nx>RBAC</span> <span class=nx>Roles</span><span class=err>#</span><span class=nx>配置RBAC授权</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>configured</span> <span class=nx>RBAC</span> <span class=nx>rules</span> <span class=nx>to</span> <span class=nx>allow</span> <span class=nx>Node</span> <span class=nx>Bootstrap</span> <span class=nx>tokens</span> <span class=nx>to</span> <span class=nx>post</span> <span class=nx>CSRs</span> <span class=k>in</span> <span class=nx>order</span> <span class=k>for</span> <span class=nx>nodes</span> <span class=nx>to</span> <span class=nx>get</span> <span class=kr>long</span> <span class=nx>term</span> <span class=nx>certificate</span> <span class=nx>credentials</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>configured</span> <span class=nx>RBAC</span> <span class=nx>rules</span> <span class=nx>to</span> <span class=nx>allow</span> <span class=nx>the</span> <span class=nx>csrapprover</span> <span class=nx>controller</span> <span class=nx>automatically</span> <span class=nx>approve</span> <span class=nx>CSRs</span> <span class=nx>from</span> <span class=nx>a</span> <span class=nx>Node</span> <span class=nx>Bootstrap</span> <span class=nx>Token</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>configured</span> <span class=nx>RBAC</span> <span class=nx>rules</span> <span class=nx>to</span> <span class=nx>allow</span> <span class=nx>certificate</span> <span class=nx>rotation</span> <span class=k>for</span> <span class=nx>all</span> <span class=nx>node</span> <span class=nx>client</span> <span class=nx>certificates</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>cluster</span>
<span class=p>[</span><span class=nx>bootstrap</span><span class=o>-</span><span class=nx>token</span><span class=p>]</span> <span class=nx>creating</span> <span class=nx>the</span> <span class=s2>&#34;cluster-info&#34;</span> <span class=nx>ConfigMap</span> <span class=k>in</span> <span class=nx>the</span> <span class=s2>&#34;kube-public&#34;</span> <span class=nx>namespace</span>
<span class=p>[</span><span class=nx>addons</span><span class=p>]</span> <span class=nx>Applied</span> <span class=nx>essential</span> <span class=nx>addon</span><span class=o>:</span> <span class=nx>CoreDNS</span>
<span class=p>[</span><span class=nx>addons</span><span class=p>]</span> <span class=nx>Applied</span> <span class=nx>essential</span> <span class=nx>addon</span><span class=o>:</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span>
<span class=nx>Your</span> <span class=nx>Kubernetes</span> <span class=nx>control</span><span class=o>-</span><span class=nx>plane</span> <span class=nx>has</span> <span class=nx>initialized</span> <span class=nx>successfully</span><span class=o>!</span>
<span class=nx>To</span> <span class=nx>start</span> <span class=nx>using</span> <span class=nx>your</span> <span class=nx>cluster</span><span class=p>,</span> <span class=nx>you</span> <span class=nx>need</span> <span class=nx>to</span> <span class=nx>run</span> <span class=nx>the</span> <span class=nx>following</span> <span class=nx>as</span> <span class=nx>a</span> <span class=nx>regular</span> <span class=nx>user</span><span class=o>:</span>
 <span class=nx>mkdir</span> <span class=o>-</span><span class=nx>p</span> <span class=nx>$HOME</span><span class=o>/</span><span class=p>.</span><span class=nx>kube</span> <span class=err>#</span><span class=nx>配置环境变量配置文件</span>
 <span class=nx>sudo</span> <span class=nx>cp</span> <span class=o>-</span><span class=nx>i</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>kubernetes</span><span class=o>/</span><span class=nx>admin</span><span class=p>.</span><span class=nx>conf</span> <span class=nx>$HOME</span><span class=o>/</span><span class=p>.</span><span class=nx>kube</span><span class=o>/</span><span class=nx>config</span>
 <span class=nx>sudo</span> <span class=nx>chown</span> <span class=nx>$</span><span class=p>(</span><span class=nx>id</span> <span class=o>-</span><span class=nx>u</span><span class=p>)</span><span class=o>:</span><span class=nx>$</span><span class=p>(</span><span class=nx>id</span> <span class=o>-</span><span class=nx>g</span><span class=p>)</span> <span class=nx>$HOME</span><span class=o>/</span><span class=p>.</span><span class=nx>kube</span><span class=o>/</span><span class=nx>config</span>
<span class=nx>You</span> <span class=nx>should</span> <span class=nx>now</span> <span class=nx>deploy</span> <span class=nx>a</span> <span class=nx>pod</span> <span class=nx>network</span> <span class=nx>to</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=p>.</span>
<span class=nx>Run</span> <span class=s2>&#34;kubectl apply -f [podnetwork].yaml&#34;</span> <span class=kd>with</span> <span class=nx>one</span> <span class=k>of</span> <span class=nx>the</span> <span class=nx>options</span> <span class=nx>listed</span> <span class=nx>at</span><span class=o>:</span> <span class=err>#</span><span class=nx>安装网络插件</span>
 <span class=nx>https</span><span class=o>:</span><span class=c1>//kubernetes.io/docs/concepts/cluster-administration/addons/
</span><span class=c1></span><span class=nx>Then</span> <span class=nx>you</span> <span class=nx>can</span> <span class=nx>join</span> <span class=nx>any</span> <span class=nx>number</span> <span class=k>of</span> <span class=nx>worker</span> <span class=nx>nodes</span> <span class=nx>by</span> <span class=nx>running</span> <span class=nx>the</span> <span class=nx>following</span> <span class=nx>on</span> <span class=nx>each</span> <span class=nx>as</span> <span class=nx>root</span><span class=o>:</span>
<span class=nx>kubeadm</span> <span class=nx>join</span> <span class=mf>10.254.100.101</span><span class=o>:</span><span class=mi>6443</span> <span class=o>--</span><span class=nx>token</span> <span class=nx>r8n5f2</span><span class=mf>.9</span><span class=nx>mic7opmrwjakled</span> <span class=err>\</span> <span class=err>#</span><span class=nx>添加节点命令</span><span class=err>，</span><span class=nx>优先记录下来</span>
 <span class=o>--</span><span class=nx>discovery</span><span class=o>-</span><span class=nx>token</span><span class=o>-</span><span class=nx>ca</span><span class=o>-</span><span class=nx>cert</span><span class=o>-</span><span class=nx>hash</span> <span class=nx>sha256</span><span class=o>:</span><span class=mi>16</span><span class=nx>e383c8abff6233021331944080087f0514ddd15d96c65d19443b0af02d64ab</span> 
</code></pre></td></tr></table></div></div><p>通过kubeadm init &ndash;apiserver-advertise-address 10.254.100.101 &ndash;apiserver-bind-port 6443 &ndash;kubernetes-version 1.14.1 &ndash;pod-network-cidr 10.244.0.0/16安装命令，显示了kubeadm安装过程中的一些重要步骤：下载镜像，生成证书，生成配置文件，配置RBAC授权认证，配置环境变量，安装网络插件指引，添加node指引配置文件。</p><p>2、生成kubectl环境配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>mkdir</span> <span class=o>/</span><span class=nx>root</span><span class=o>/</span><span class=p>.</span><span class=nx>kube</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>cp</span> <span class=o>-</span><span class=nx>i</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>kubernetes</span><span class=o>/</span><span class=nx>admin</span><span class=p>.</span><span class=nx>conf</span> <span class=o>/</span><span class=nx>root</span><span class=o>/</span><span class=p>.</span><span class=nx>kube</span><span class=o>/</span><span class=nx>config</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>nodes</span>
<span class=nx>NAME</span>  <span class=nx>STATUS</span>  <span class=nx>ROLES</span> <span class=nx>AGE</span>  <span class=nx>VERSION</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>1</span>  <span class=nx>NotReady</span>  <span class=nx>master</span>  <span class=mi>6</span><span class=nx>m29s</span>  <span class=nx>v1</span><span class=mf>.14.1</span>
</code></pre></td></tr></table></div></div><p>3、添加node节点，将另外两个节点加入到集群中，复制上述的添加节点命令到指定节点添加即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>3</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubeadm</span> <span class=nx>join</span> <span class=mf>10.254.100.101</span><span class=o>:</span><span class=mi>6443</span> <span class=o>--</span><span class=nx>token</span> <span class=nx>r8n5f2</span><span class=mf>.9</span><span class=nx>mic7opmrwjakled</span> <span class=o>\</span>
<span class=o>&gt;</span>     <span class=o>--</span><span class=nx>discovery</span><span class=o>-</span><span class=nx>token</span><span class=o>-</span><span class=nx>ca</span><span class=o>-</span><span class=nx>cert</span><span class=o>-</span><span class=nx>hash</span> <span class=nx>sha256</span><span class=o>:</span><span class=mi>16</span><span class=nx>e383c8abff6233021331944080087f0514ddd15d96c65d19443b0af02d64ab</span> 
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Running</span> <span class=nx>pre</span><span class=o>-</span><span class=nx>flight</span> <span class=nx>checks</span>
	<span class=p>[</span><span class=nx>WARNING</span> <span class=nx>SystemVerification</span><span class=p>]</span><span class=o>:</span> <span class=k>this</span> <span class=nx>Docker</span> <span class=nx>version</span> <span class=nx>is</span> <span class=nx>not</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>list</span> <span class=k>of</span> <span class=nx>validated</span> <span class=nx>versions</span><span class=o>:</span> <span class=mf>18.03.1</span><span class=o>-</span><span class=nx>ce</span><span class=p>.</span> <span class=nx>Latest</span> <span class=nx>validated</span> <span class=nx>version</span><span class=o>:</span> <span class=mf>18.09</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>Reading</span> <span class=nx>configuration</span> <span class=nx>from</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=p>...</span>
<span class=p>[</span><span class=nx>preflight</span><span class=p>]</span> <span class=nx>FYI</span><span class=o>:</span> <span class=nx>You</span> <span class=nx>can</span> <span class=nx>look</span> <span class=nx>at</span> <span class=k>this</span> <span class=nx>config</span> <span class=nx>file</span> <span class=kd>with</span> <span class=s1>&#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Downloading</span> <span class=nx>configuration</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>from</span> <span class=nx>the</span> <span class=s2>&#34;kubelet-config-1.14&#34;</span> <span class=nx>ConfigMap</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> <span class=nx>namespace</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>configuration</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s2>&#34;/var/lib/kubelet/config.yaml&#34;</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Writing</span> <span class=nx>kubelet</span> <span class=nx>environment</span> <span class=nx>file</span> <span class=kd>with</span> <span class=nx>flags</span> <span class=nx>to</span> <span class=nx>file</span> <span class=s2>&#34;/var/lib/kubelet/kubeadm-flags.env&#34;</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Activating</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>service</span>
<span class=p>[</span><span class=nx>kubelet</span><span class=o>-</span><span class=nx>start</span><span class=p>]</span> <span class=nx>Waiting</span> <span class=k>for</span> <span class=nx>the</span> <span class=nx>kubelet</span> <span class=nx>to</span> <span class=nx>perform</span> <span class=nx>the</span> <span class=nx>TLS</span> <span class=nx>Bootstrap</span><span class=p>...</span>

<span class=nx>This</span> <span class=nx>node</span> <span class=nx>has</span> <span class=nx>joined</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=o>:</span>
<span class=o>*</span> <span class=nx>Certificate</span> <span class=nx>signing</span> <span class=nx>request</span> <span class=nx>was</span> <span class=nx>sent</span> <span class=nx>to</span> <span class=nx>apiserver</span> <span class=nx>and</span> <span class=nx>a</span> <span class=nx>response</span> <span class=nx>was</span> <span class=nx>received</span><span class=p>.</span>
<span class=o>*</span> <span class=nx>The</span> <span class=nx>Kubelet</span> <span class=nx>was</span> <span class=nx>informed</span> <span class=k>of</span> <span class=nx>the</span> <span class=k>new</span> <span class=nx>secure</span> <span class=nx>connection</span> <span class=nx>details</span><span class=p>.</span>

<span class=nx>Run</span> <span class=s1>&#39;kubectl get nodes&#39;</span> <span class=nx>on</span> <span class=nx>the</span> <span class=nx>control</span><span class=o>-</span><span class=nx>plane</span> <span class=nx>to</span> <span class=nx>see</span> <span class=k>this</span> <span class=nx>node</span> <span class=nx>join</span> <span class=nx>the</span> <span class=nx>cluster</span><span class=p>.</span>

<span class=nx>以此类推到node</span><span class=o>-</span><span class=mi>2</span><span class=nx>节点添加即可</span><span class=err>，</span><span class=nx>添加完之后通过kubectl</span> <span class=nx>get</span> <span class=nx>nodes验证</span><span class=err>，</span><span class=nx>此时由于还没有安装网络plugin</span><span class=err>，</span>
<span class=nx>所有的node节点均显示NotReady状态</span><span class=err>：</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>nodes</span>
<span class=nx>NAME</span>     <span class=nx>STATUS</span>     <span class=nx>ROLES</span>    <span class=nx>AGE</span>     <span class=nx>VERSION</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>1</span>   <span class=nx>NotReady</span>   <span class=nx>master</span>   <span class=mi>16</span><span class=nx>m</span>     <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>2</span>   <span class=nx>NotReady</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>4</span><span class=nx>m34s</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>3</span>   <span class=nx>NotReady</span>   <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>2</span><span class=nx>m10s</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/4%20-%201620.jpg data-srcset="https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/4%20-%201620.jpg, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/4%20-%201620.jpg 1.5x, https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/4%20-%201620.jpg 2x" data-sizes=auto alt=https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/k8s%E5%9F%BA%E7%A1%80/kubernetes%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B%EF%BC%88%E4%BA%8C%EF%BC%89kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/4%20-%201620.jpg title="kubeadm join添加节点"></p><p>4、安装网络plugin，kubernetes支持多种类型网络插件，要求网络支持CNI插件即可，CNI是Container Network Interface，要求kubernetes的中pod网络访问方式：</p><ul><li>node和node之间网络互通</li><li>pod和pod之间网络互通</li><li>node和pod之间网络互通</li></ul><p>不同的CNI plugin支持的特性有所差别。kubernetes支持多种开源的网络CNI插件，常见的有flannel、calico、canal、weave等，flannel是一种overlay的网络模型，通过vxlan隧道方式构建tunnel网络，实现k8s中网络的互联，后续在做介绍，如下是安装过程：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>apply</span> <span class=o>-</span><span class=nx>f</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//raw.githubusercontent.com/coreos/flannel/62e44c867a2846fefb68bd5f178daf4da3095ccb/Documentation/kube-flannel.yml
</span><span class=c1></span><span class=nx>podsecuritypolicy</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>psp</span><span class=p>.</span><span class=nx>flannel</span><span class=p>.</span><span class=nx>unprivileged</span> <span class=nx>created</span>
<span class=nx>clusterrole</span><span class=p>.</span><span class=nx>rbac</span><span class=p>.</span><span class=nx>authorization</span><span class=p>.</span><span class=nx>k8s</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>flannel</span> <span class=nx>created</span>
<span class=nx>clusterrolebinding</span><span class=p>.</span><span class=nx>rbac</span><span class=p>.</span><span class=nx>authorization</span><span class=p>.</span><span class=nx>k8s</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>flannel</span> <span class=nx>created</span>
<span class=nx>serviceaccount</span><span class=o>/</span><span class=nx>flannel</span> <span class=nx>created</span>
<span class=nx>configmap</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>cfg</span> <span class=nx>created</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>amd64</span> <span class=nx>created</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm64</span> <span class=nx>created</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm</span> <span class=nx>created</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>ppc64le</span> <span class=nx>created</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span><span class=o>/</span><span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>s390x</span> <span class=nx>created</span>
</code></pre></td></tr></table></div></div><p>5、通过上述输出可知道，部署flannel 需要RBAC授权，配置configmap和daemonset，其中Daemonset能够适配各种类型的CPU架构，默认安装了多个，一般是adm64即可，可以将上述的url下载编辑，保留kube-flannel-ds-amd64这个daemonset即可，或者将其删除</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=err>#</span><span class=nx>查看flannel安装的daemonsets</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>daemonsets</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> 
<span class=nx>NAME</span>                      <span class=nx>DESIRED</span>   <span class=nx>CURRENT</span>   <span class=nx>READY</span>   <span class=nx>UP</span><span class=o>-</span><span class=nx>TO</span><span class=o>-</span><span class=nx>DATE</span>   <span class=nx>AVAILABLE</span>   <span class=nx>NODE</span> <span class=nx>SELECTOR</span>                     <span class=nx>AGE</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>amd64</span>     <span class=mi>3</span>         <span class=mi>3</span>         <span class=mi>3</span>       <span class=mi>3</span>            <span class=mi>3</span>           <span class=nx>beta</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>arch</span><span class=o>=</span><span class=nx>amd64</span>     <span class=mi>2</span><span class=nx>m34s</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm</span>       <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>0</span>            <span class=mi>0</span>           <span class=nx>beta</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>arch</span><span class=o>=</span><span class=nx>arm</span>       <span class=mi>2</span><span class=nx>m34s</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm64</span>     <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>0</span>            <span class=mi>0</span>           <span class=nx>beta</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>arch</span><span class=o>=</span><span class=nx>arm64</span>     <span class=mi>2</span><span class=nx>m34s</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>ppc64le</span>   <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>0</span>            <span class=mi>0</span>           <span class=nx>beta</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>arch</span><span class=o>=</span><span class=nx>ppc64le</span>   <span class=mi>2</span><span class=nx>m34s</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>s390x</span>     <span class=mi>0</span>         <span class=mi>0</span>         <span class=mi>0</span>       <span class=mi>0</span>            <span class=mi>0</span>           <span class=nx>beta</span><span class=p>.</span><span class=nx>kubernetes</span><span class=p>.</span><span class=nx>io</span><span class=o>/</span><span class=nx>arch</span><span class=o>=</span><span class=nx>s390x</span>     <span class=mi>2</span><span class=nx>m34s</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span>                <span class=mi>3</span>         <span class=mi>3</span>         <span class=mi>3</span>       <span class=mi>3</span>            <span class=mi>3</span>           <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>                            <span class=mi>30</span><span class=nx>m</span>

<span class=err>#</span><span class=nx>删除不需要的damonsets</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=k>delete</span> <span class=nx>daemonsets</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>arm64</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>ppc64le</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>flannel</span><span class=o>-</span><span class=nx>ds</span><span class=o>-</span><span class=nx>s390x</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span> <span class=s2>&#34;kube-flannel-ds-arm&#34;</span> <span class=nx>deleted</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span> <span class=s2>&#34;kube-flannel-ds-arm64&#34;</span> <span class=nx>deleted</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span> <span class=s2>&#34;kube-flannel-ds-ppc64le&#34;</span> <span class=nx>deleted</span>
<span class=nx>daemonset</span><span class=p>.</span><span class=nx>extensions</span> <span class=s2>&#34;kube-flannel-ds-s390x&#34;</span> <span class=nx>deleted</span>
</code></pre></td></tr></table></div></div><p>6、此时再验证node的安装情况,所有节点均已显示为Ready状态，安装完毕！</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>nodes</span>
<span class=nx>NAME</span>     <span class=nx>STATUS</span>   <span class=nx>ROLES</span>    <span class=nx>AGE</span>   <span class=nx>VERSION</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>1</span>   <span class=nx>Ready</span>    <span class=nx>master</span>   <span class=mi>29</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>2</span>   <span class=nx>Ready</span>    <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>17</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>3</span>   <span class=nx>Ready</span>    <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>15</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
</code></pre></td></tr></table></div></div><h2 id=26-验证kubernetes组件><strong>2.6 验证kubernetes组件</strong></h2><p>1、验证node状态，获取当前安装节点，可以查看到状态， 角色，启动市场，版本，</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>nodes</span> 
<span class=nx>NAME</span>     <span class=nx>STATUS</span>   <span class=nx>ROLES</span>    <span class=nx>AGE</span>   <span class=nx>VERSION</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>1</span>   <span class=nx>Ready</span>    <span class=nx>master</span>   <span class=mi>46</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>2</span>   <span class=nx>Ready</span>    <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>34</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
<span class=nx>node</span><span class=o>-</span><span class=mi>3</span>   <span class=nx>Ready</span>    <span class=o>&lt;</span><span class=nx>none</span><span class=o>&gt;</span>   <span class=mi>32</span><span class=nx>m</span>   <span class=nx>v1</span><span class=mf>.14.1</span>
</code></pre></td></tr></table></div></div><p>2、查看kubernetse服务组件状态,包括scheduler，controller-manager，etcd</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>componentstatuses</span> 
<span class=nx>NAME</span>  <span class=nx>STATUS</span> <span class=nx>MESSAGE</span>  <span class=nx>ERROR</span>
<span class=nx>scheduler</span> <span class=nx>Healthy</span>  <span class=nx>ok</span>  
<span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span>  <span class=nx>Healthy</span>  <span class=nx>ok</span>  
<span class=nx>etcd</span><span class=o>-</span><span class=mi>0</span>  <span class=nx>Healthy</span>  <span class=p>{</span><span class=s2>&#34;health&#34;</span><span class=o>:</span><span class=s2>&#34;true&#34;</span><span class=p>}</span>  
</code></pre></td></tr></table></div></div><p>3、查看pod的情况,master中的角色包括kube-apiserver，kube-scheduler，kube-controller-manager，etcd，coredns以pods形式部署在集群中，worker节点的kube-proxy也以pod的形式部署。实际上pod是以其他控制器如daemonset的形式控制的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>pods</span> <span class=o>-</span><span class=nx>n</span> <span class=nx>kube</span><span class=o>-</span><span class=nx>system</span> 
<span class=nx>NAME</span>  <span class=nx>READY</span>  <span class=nx>STATUS</span> <span class=nx>RESTARTS</span>  <span class=nx>AGE</span>
<span class=nx>coredns</span><span class=o>-</span><span class=nx>fb8b8dccf</span><span class=o>-</span><span class=nx>hrqm8</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>50</span><span class=nx>m</span>
<span class=nx>coredns</span><span class=o>-</span><span class=nx>fb8b8dccf</span><span class=o>-</span><span class=nx>qwwks</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>50</span><span class=nx>m</span>
<span class=nx>etcd</span><span class=o>-</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>48</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>apiserver</span><span class=o>-</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>49</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>controller</span><span class=o>-</span><span class=nx>manager</span><span class=o>-</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span>  <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>49</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span><span class=o>-</span><span class=nx>lfckv</span>  <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>38</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span><span class=o>-</span><span class=nx>x5t6r</span>  <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>50</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>proxy</span><span class=o>-</span><span class=nx>x8zqh</span>  <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>36</span><span class=nx>m</span>
<span class=nx>kube</span><span class=o>-</span><span class=nx>scheduler</span><span class=o>-</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span>  <span class=nx>Running</span>  <span class=mi>0</span> <span class=mi>49</span><span class=nx>m</span>
</code></pre></td></tr></table></div></div><h2 id=27-配置kubectl命令补全>2.7 配置kubectl命令补全</h2><p>使用kubectl和kubernetes交互时候可以使用缩写模式也可以使用完整模式，如kubectl get nodes和kubectl get no能实现一样的效果，为了提高工作效率，可以使用命令补全的方式加快工作效率。</p><p>1、生成kubectl bash命令行补全shell</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>completion</span> <span class=nx>bash</span> <span class=o>&gt;</span><span class=err>/etc/kubernetes/kubectl.sh</span>
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>echo</span> <span class=s2>&#34;source /etc/kubernetes/kubectl.sh&#34;</span> <span class=o>&gt;&gt;</span><span class=sr>/root/</span><span class=p>.</span><span class=nx>bashrc</span> 
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>cat</span> <span class=o>/</span><span class=nx>root</span><span class=o>/</span><span class=p>.</span><span class=nx>bashrc</span> 
<span class=err>#</span> <span class=p>.</span><span class=nx>bashrc</span>

<span class=err>#</span> <span class=nx>User</span> <span class=nx>specific</span> <span class=nx>aliases</span> <span class=nx>and</span> <span class=nx>functions</span>

<span class=nx>alias</span> <span class=nx>rm</span><span class=o>=</span><span class=s1>&#39;rm -i&#39;</span>
<span class=nx>alias</span> <span class=nx>cp</span><span class=o>=</span><span class=s1>&#39;cp -i&#39;</span>
<span class=nx>alias</span> <span class=nx>mv</span><span class=o>=</span><span class=s1>&#39;mv -i&#39;</span>

<span class=err>#</span> <span class=nx>Source</span> <span class=nx>global</span> <span class=nx>definitions</span>
<span class=k>if</span> <span class=p>[</span> <span class=o>-</span><span class=nx>f</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>bashrc</span> <span class=p>];</span> <span class=nx>then</span>
	<span class=p>.</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>bashrc</span>
<span class=nx>fi</span>
<span class=nx>source</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>kubernetes</span><span class=o>/</span><span class=nx>kubectl</span><span class=p>.</span><span class=nx>sh</span> <span class=err>#</span><span class=nx>添加环境变量配置</span>
</code></pre></td></tr></table></div></div><p>2、加载shell环境变量，使配置生效</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span> <span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>source</span> <span class=o>/</span><span class=nx>etc</span><span class=o>/</span><span class=nx>kubernetes</span><span class=o>/</span><span class=nx>kubectl</span><span class=p>.</span><span class=nx>sh</span> 
</code></pre></td></tr></table></div></div><p>3、校验命令行补全，命令行中输入kubectl get co再按TAB键就能自动补全了</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-js data-lang=js><span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span><span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>co</span> <span class=nx>componentstatuses</span> <span class=nx>configmaps</span>  <span class=nx>controllerrevisions</span><span class=p>.</span><span class=nx>apps</span>   
<span class=p>[</span><span class=nx>root</span><span class=err>@</span><span class=nx>node</span><span class=o>-</span><span class=mi>1</span><span class=o>~</span><span class=p>]</span><span class=err>#</span> <span class=nx>kubectl</span> <span class=nx>get</span> <span class=nx>componentstatuses</span> 
</code></pre></td></tr></table></div></div><p>除了支持命令行补全之外，kubectl还支持命令简写，如下是一些常见的命令行检测操作,更多通过kubectl api-resources命令获取，SHORTNAMES显示的是子命令中的简短用法。</p><ul><li>kubectl get componentstatuses，简写kubectl get cs获取组件状态</li><li>kubectl get nodes，简写kubectl get no获取node节点列表</li><li>kubectl get services，简写kubectl get svc获取服务列表</li><li>kubectl get deployments,简写kubectl get deploy获取deployment列表</li><li>kubectl get statefulsets,简写kubectl get sts获取有状态服务列表</li></ul><h1 id=参考文档>参考文档</h1><ol><li>Container Runtime安装文档：https://kubernetes.io/docs/setup/production-environment/container-runtimes/</li><li>kubeadm安装：https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/</li><li>初始化kubeadm集群：https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network</li></ol><blockquote><p>『 转载 』该文章来源于网络，侵删。</p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2019-08-04</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ data-title="02 Kubeadm离线部署1.14" data-hashtags=kubernetes,tutorial><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ data-hashtag=kubernetes><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ data-title="02 Kubeadm离线部署1.14"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ data-title="02 Kubeadm离线部署1.14"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@2.14.0/icons/line.svg></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=http://x.agou-ops.top/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/ data-title="02 Kubeadm离线部署1.14" data-ralateuid=AGou-ops><i class="fab fa-weibo fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/kubernetes/>kubernetes</a>,&nbsp;<a href=/tags/tutorial/>tutorial</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/ class=prev rel=prev title="03 Kubernetes快速入门"><i class="fas fa-angle-left fa-fw"></i>03 Kubernetes快速入门</a>
<a href=/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/ class=next rel=next title="01 初探kubernetes功能与组件">01 初探kubernetes功能与组件<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.69.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>AGou-ops</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br><span class=icp>鲁ICP备19050296号-2</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":10},"comment":{},"search":{"algoliaAppID":"5M8VQRD7W9","algoliaIndex":"blog-2","algoliaSearchKey":"2fcdbd0ce638664e7a28cc64939603b9","highlightTag":"em","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"algolia"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>