[{"categories":[],"content":"TL;DR githubä»“åº“ï¼š:point_right: https://github.com/AGou-ops/dotfiles :point_left: NeovimåŠå…¶æ’ä»¶ç®€å•è§†é¢‘ä»‹ç»ï¼šhttps://www.bilibili.com/video/BV1am4y197bR/ ä¿å§†çº§å®‰è£…upä¸»åŒæ¬¾Neovimï¼šhttps://www.bilibili.com/video/BV1YF411i72t/ è§†é¢‘è®²çš„ä¸€èˆ¬ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢çš„ä»‹ç»ï¼š ","date":"2022-01-13","objectID":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/:1:0","tags":[],"title":"Neovimè‡ªç”¨Golangå¼€å‘","uri":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/"},{"categories":[],"content":"ä¸»æµä¸‰ç§é…ç½®ç»“æ„å¯¹æ¯” çº¯vim-scriptï¼šå±€é™æ€§è¾ƒé«˜ï¼Œå¯é…ç½®é¡¹å°‘ï¼Œé€‚åˆè½»åº¦ç©å®¶ï¼› çº¯luaï¼šä½¿ç”¨packeræ¥è¿›è¡Œæ’ä»¶ç®¡ç†ï¼Œå¯é…ç½®é¡¹å¤šï¼Œååˆ†çµæ´»ï¼Œä½†æ²¡ç‚¹luaåŸºç¡€çš„äººç”¨èµ·æ¥æœ‰ç‚¹æ‡µï¼Œæ¯”å¦‚æˆ‘ï¼Œé€‚åˆé«˜ç«¯ç©å®¶ï¼› vim-script + luaï¼šæˆ‘ä¸ªäººæ¨èä½¿ç”¨è¿™ç§é…ç½®æ–¹å¼ï¼Œä½¿ç”¨vim-plugæ¥è¿›è¡Œæ’ä»¶ç®¡ç†ï¼Œå‡ ä¹æ‰€æœ‰çš„neovimæ’ä»¶éƒ½å¯ä»¥ç”¨vim-plugæ¥å®‰è£…ï¼Œè€Œä¸”æ’ä»¶åˆ—è¡¨å†…å®¹è¦æ¯”packeræ›´åŠ ç®€æ´å®¢è§‚ï¼Œç»“åˆäº†luaï¼Œå¯é…ç½®é¡¹åˆå¤§å¤§æå‡ï¼Œç”¨èµ·æ¥å¾ˆæ˜¯æ–¹ä¾¿ï¼› ä¸€ä¸ªæ–‡ä»¶å®Œäº‹çš„ç©å®¶ï¼švim-scripté‡Œç›´æ¥ä½¿ç”¨æ ‡ç­¾æ¥è¿è¡Œluaç›¸å…³é…ç½®ï¼Œä¸æ¨èï¼Œluaæ’ä»¶å¤šçš„è¯ä¼šè®©ä½ çš„é…ç½®æ–‡ä»¶å˜å¾—å¤æ‚ï¼Œä¸å¥½ç»´æŠ¤ã€‚ ","date":"2022-01-13","objectID":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/:2:0","tags":[],"title":"Neovimè‡ªç”¨Golangå¼€å‘","uri":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/"},{"categories":[],"content":"æ–‡ä»¶ç›®å½•ç»“æ„åŠè¯´æ˜ ç›®å½•ç»“æ„åŠè¯´æ˜ï¼š \u003e tree . â”œâ”€â”€ custom.vim # è‡ªå®šä¹‰çš„ä¸€äº›vim-scripté…ç½® â”œâ”€â”€ debug-template # vim-vimspectoræ’ä»¶æ¨¡æ¿ç›®å½•ï¼ˆç”¨äºdebugï¼‰ â”‚Â â””â”€â”€ go-template # debug golangçš„æ¨¡æ¿ â”œâ”€â”€ general.vim # ä¸€èˆ¬è®¾ç½® â”œâ”€â”€ init.vim # åˆå§‹åŒ–é…ç½®æ–‡ä»¶ï¼ˆä¸»è¦ï¼‰ â”œâ”€â”€ keymaps.vim # é”®ç›˜æ˜ å°„é…ç½®æ–‡ä»¶ï¼Œå¤§éƒ¨åˆ†æ˜¯é€šç”¨çš„é”®ç›˜æ˜ å°„é…ç½®ï¼Œä¸åŒ…å«æ’ä»¶çš„é”®ç›˜æ˜ å°„ â”œâ”€â”€ lua # -- luaé…ç½® --- â”‚Â â””â”€â”€ AGou # é…ç½®æ–‡ä»¶å‘½åç©ºé—´ï¼Œåœ¨init.vimä¸­å¼•è¿› â”‚Â â”œâ”€â”€ init.lua # å‘½åç©ºé—´luaé…ç½®ä¸»å…¥å£æ–‡ä»¶ â”‚Â â”œâ”€â”€ lsp.lua â”‚Â â”œâ”€â”€ nvim-autopairs.lua â”‚Â â”œâ”€â”€ nvim-bufferline.lua â”‚Â â”œâ”€â”€ nvim-cmp.lua â”‚Â â”œâ”€â”€ nvim-diffview.lua â”‚Â â”œâ”€â”€ nvim-gitsigns.lua â”‚Â â”œâ”€â”€ nvim-lsp-installer.lua â”‚Â â”œâ”€â”€ nvim-lspsaga.lua â”‚Â â”œâ”€â”€ nvim-lualine.lua â”‚Â â”œâ”€â”€ nvim-neoscroll.lua â”‚Â â”œâ”€â”€ nvim-session-manager.lua â”‚Â â”œâ”€â”€ nvim-signature.lua â”‚Â â”œâ”€â”€ nvim-telescope.lua â”‚Â â”œâ”€â”€ nvim-todo-comments.lua â”‚Â â”œâ”€â”€ nvim-toggleterm.lua â”‚Â â”œâ”€â”€ nvim-transparent.lua â”‚Â â”œâ”€â”€ nvim-tree.lua â”‚Â â”œâ”€â”€ nvim-treesitter.lua â”‚Â â””â”€â”€ nvim-whichkey.lua â”œâ”€â”€ push.sh â”œâ”€â”€ push2GitHub.sh # pushåˆ°githubçš„è„šæœ¬ â”œâ”€â”€ sessions # ä¼šè¯ç®¡ç†å™¨çš„æ•°æ®å­˜æ”¾ç›®å½• â”‚Â â””â”€â”€ %usr%share%dict.vim â””â”€â”€ shpy-autoheader.vim # è‡ªåŠ¨æ–‡ä»¶å¤´éƒ¨çš„vim-script ","date":"2022-01-13","objectID":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/:3:0","tags":[],"title":"Neovimè‡ªç”¨Golangå¼€å‘","uri":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/"},{"categories":[],"content":"æˆªå›¾éƒ¨åˆ† åªä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ï¼ˆå®é™…ä¸æ­¢è¿™äº›ï¼‰ï¼š åˆ†å±ï¼Œä¸¤ä¸ªå‚ç›´åˆ†å±ï¼Œä¸€ä¸ªæ°´å¹³åˆ†å±ï¼Œå·¦è¾¹nvim-treeï¼Œä¸‹é¢çŠ¶æ€æ åˆ†åˆ«ä¸ºlualineå’Œtmuxçš„menu bar æ‚¬æµ®ç»ˆç«¯ï¼Œå¯ç›´æ¥åœ¨neovimä¸­å¼¹å‡ºç»ˆç«¯è¿›è¡Œä½¿ç”¨ï¼Œæ— éœ€å…³é—­æˆ–æŒ‚èµ·neovimï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œæ¨¡å¼è¿è¡Œï¼Œéå¸¸æ–¹ä¾¿ æ‚¬æµ®lazygitï¼Œå¾ˆå¥½ç”¨çš„ä¸€ä¸ªç»ˆç«¯gitå·¥å…·ï¼Œtuiå¯è§†åŒ–å¯è¿›è¡Œå¿«é€Ÿæäº¤æ¨é€æ‹‰å–ç­‰ç­‰æ“ä½œ Golang lspæ™ºèƒ½æç¤ºï¼Œå¯æ˜¾ç¤ºå‡½æ•°ç­¾åä»¥åŠä¸€äº›ç›¸å…³çš„æ³¨é‡Šä¿¡æ¯ å¿«é€Ÿé‡å‘½åå‡½æ•°ï¼Œæ”¹å˜ä¸€å¤„å‡½æ•°åç§°ï¼Œå¯ä»¥è‡ªåŠ¨æ”¹å˜å…¶ç›¸å…³åœ°æ–¹çš„åç§° æ–‡ä»¶å†…å¿«é€ŸæŸ¥æ‰¾ï¼Œå¿«é€ŸæŸ¥æ‰¾å½“å‰å…‰æ ‡ä¸‹æ‰€å‡ºç°çš„è¯ æ‚¬æµ®å‡½æ•°å®šä¹‰ï¼Œå¼¹å‡ºæ‚¬æµ®çª—æ¥æ˜¾ç¤ºå½“å‰å…‰æ ‡ä¸‹çš„å‡½æ•°å®šä¹‰ï¼Œä½¿ç”¨gdå‘½ä»¤å¯ä»¥ç›´æ¥è·³è½¬åˆ°å‡½æ•°çš„å®šä¹‰æ–‡ä»¶ä¸­ lspï¼Œè‡ªåŠ¨å°†æŠ¥é”™ä¿¡æ¯æ‰“å°åˆ°è¡Œå°¾ï¼Œå³è¾¹ä¸ºtagbarï¼Œå¯ä»¥æ˜¾ç¤ºå‡½æ•°å’Œå˜é‡ç­‰ç›®å½•æ ‘ ","date":"2022-01-13","objectID":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/:4:0","tags":[],"title":"Neovimè‡ªç”¨Golangå¼€å‘","uri":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/"},{"categories":[],"content":"å†™åœ¨æœ€å https://github.com/AGou-ops/dotfiles å¦‚æœå¤§å®¶è§‰å¾—ä¸é”™çš„è¯ï¼Œå¯ä»¥ç‚¹ä¸ªstar:star:åˆ†äº«ç»™æ›´å¤šäºº. Done. ","date":"2022-01-13","objectID":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/:5:0","tags":[],"title":"Neovimè‡ªç”¨Golangå¼€å‘","uri":"/myBlog-2/post/neovim%E8%87%AA%E7%94%A8golang%E5%BC%80%E5%8F%91/"},{"categories":["Golang"],"content":"æœ€è¿‘éœ€è¦åšä¸€ä¸ªé’‰é’‰ç¾¤èŠæœºå™¨äººï¼Œéœ€æ±‚æ˜¯ï¼šè‰¾ç‰¹è¯¥æœºå™¨äººå¹¶å‘é€ç›¸åº”å…³é”®å­—ï¼Œæœºå™¨äººä¼šè¿›è¡Œç›¸åº”çš„è‡ªåŠ¨å›å¤ã€‚ é€šè¿‡é’‰é’‰å¼€æ”¾å¹³å°Â·é’‰é’‰æœºå™¨äººçš„ä¼ä¸šè‡ªå»ºæœºå™¨äººå®˜æ–¹æ–‡æ¡£ä»¥åŠç½‘ç»œä¸Šå…¶ä»–è¯­è¨€ï¼ˆJavaï¼ŒPythonç­‰ï¼‰çš„é’‰é’‰æœºå™¨äººçš„å®ç°ï¼Œè‡ªå·±çç¼–å†™å‡ºæ¥äº†ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬çš„å°æœºå™¨äººã€‚ å¥‡æ€ªçš„æ˜¯ç”¨Golangæ¥å†™çš„äººå¾ˆå°‘ï¼Œå¯èƒ½æ˜¯å®˜æ–¹çš„ç¤ºä¾‹ä¸­æ²¡æœ‰Golangå§ï¼Œè™½ç„¶ä¼šä¸€äº›Pythonï¼Œä½†æ˜¯ç°åœ¨è½¬å­¦Golangäº†ï¼Œæ•…å€Ÿæ­¤æœºä¼šæ¥å·©å›ºä¸€ä¸‹æœ€è¿‘æ‰€å­¦çš„ä¸€äº›ä¸œè¥¿:smile: ã€‚ DingTalk_robotç¾¤èŠæœºå™¨äººå¤„ç†æµç¨‹å›¾ï¼š ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:0:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"é¢„å…ˆå‡†å¤‡ é¦–å…ˆéœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªæµ‹è¯•å…¬å¸ï¼ˆå¦‚è‹¥ä½ æ˜¯é’‰é’‰ä¼ä¸šç®¡ç†å‘˜çš„è¯ï¼Œå¯å¿½ç•¥è¯¥æ­¥éª¤ï¼‰ï¼Œåˆ›å»ºæµç¨‹å¾ˆç®€å•ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†èµ˜è¿°ï¼Œè¯¦æƒ…å‚è€ƒï¼šé’‰é’‰åˆ›å»ºä¼ä¸š/ç»„ç»‡/å›¢é˜Ÿ. æ¥ä¸‹æ¥è¿›å…¥é’‰é’‰å¼€æ”¾å¹³å°ï¼Œç™»å½•å¹¶é€‰æ‹©è‡ªå·±ä¸Šé¢åˆ›å»ºçš„æµ‹è¯•å…¬å¸ä¹‹åï¼Œç‚¹å‡»å³ä¸Šè§’çš„å¼€å‘è€…æ§åˆ¶å°ï¼Œè¿›å…¥å¦‚ä¸‹é¡µé¢ï¼š ä¾æ¬¡ç‚¹å‡»ï¼Œåˆ›å»ºä¸€ä¸ªå±äºè‡ªå·±çš„æœºå™¨äººğŸ¤–ï¼Œé‡Œé¢çš„åº”ç”¨åç§°ã€åº”ç”¨æè¿°å’Œåº”ç”¨å›¾æ ‡éšä¾¿å¡«ã€‚ åˆ›å»ºå®Œæˆä¹‹åï¼Œè®°å½•ä¸‹AppSecretï¼ˆåé¢è®¡ç®—signæ ¡éªŒä¼šç”¨åˆ°ï¼‰ï¼Œç„¶å:warning:é‡ç‚¹æ¥åˆ°å¼€æ”¾ç®¡ç†é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç›¸å…³è§£é‡Šï¼š æœåŠ¡å™¨å‡ºå£IPï¼šç›¸å½“äºç™½åå•ï¼Œä¹Ÿå°±æ˜¯å…è®¸é‚£äº›ç½‘æ®µæˆ–è€…IPçš„äººä½¿ç”¨è¯¥æœºå™¨äººï¼Œå¯ä»¥é™å®šä¸ºå…¬å¸è¿è¥å•†çš„å…¬ç½‘IPèŒƒå›´ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆè®¾ç½®äº†å‡ºå£IPå’Œæ²¡è®¾ç½®å‡ºå£IPè¿˜æœ‰éšä¾¿ä¹±è®¾ç½®å‡ºå£IPéƒ½å¯ä»¥ä½¿ç”¨ï¼‰ï¼› è¾“å…¥è°ƒç”¨é’‰é’‰æœåŠ¡ç«¯APIæ—¶ä½¿ç”¨çš„IPå³ä¼ä¸šæœåŠ¡å™¨çš„å…¬ç½‘IPï¼Œå¤šä¸ªIPè¯·ä»¥è‹±æ–‡é€—å·\",â€œéš”å¼€ï¼Œæ”¯æŒå¸¦ä¸€ä¸ª*å·é€šé…ç¬¦çš„IPæ ¼å¼; æ¶ˆæ¯æ¥æ”¶åœ°å€ï¼šé’‰é’‰æœºå™¨äººæœåŠ¡å™¨outgoingå›è°ƒç»™å¼€å‘è€…æœåŠ¡å™¨çš„ä¸€ä¸ªåœ°å€ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ”¹åœ°å€éœ€è¦å…¬ç½‘IPåœ°å€ï¼Œå½“ç„¶æ­¤å¤„å¡«å†™åŸŸåURLä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ æƒé™ç®¡ç†,è¿™ä¸ªè‡ªå·±çœ‹çœ‹éœ€è¦ä»€ä¹ˆæƒé™å°±åŠ é‚£äº›å§ï¼Œæœ¬ç€æœ€å°æƒé™çš„è§„åˆ™è¿›è¡Œé€‰æ‹©ã€‚ å®Œæˆä¸Šé¢æ‰€æœ‰æ“ä½œä¹‹åï¼Œåœ¨ä¸Šé¢çš„ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒé¡µé¢å¯¹è‡ªå·±åˆ›å»ºçš„æœºå™¨äººè¿›è¡Œè°ƒè¯•æˆ–è€…å‘å¸ƒï¼Œé€‰æ‹©è°ƒè¯•çš„è¯ä¼šç»™ä½ ä¸ªäºŒç»´ç ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨ç§»åŠ¨ç«¯é’‰é’‰æ‰«ç åŠ å¦‚é’‰é’‰æœºå™¨äººæµ‹è¯•ç¾¤ï¼Œé€‰æ‹©å‘å¸ƒçš„è¯ï¼Œå°±å¯ä»¥åœ¨è‡ªå·±çš„æµ‹è¯•å…¬å¸æ·»åŠ æœºå™¨äººï¼Œè¯¦æƒ…å‚è€ƒï¼šé’‰é’‰æ·»åŠ æœºå™¨äººåˆ°é’‰é’‰ç¾¤ ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:1:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"æœ¬åœ°æµ‹è¯• åœ¨æœåŠ¡å™¨ä¸Šå¼€å‘è°ƒè¯•å¯ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œæœ¬åœ°å†™å¥½æ¨é€åˆ°æœåŠ¡å™¨ï¼Œå¦‚æœé¢‘ç¹è°ƒè¯•çš„è¯ï¼Œä¹Ÿæ˜¯éå¸¸çš„éº»çƒ¦ã€‚ æ‰€ä»¥æˆ‘æ¨èä½¿ç”¨å†…ç½‘ç©¿é€ï¼Œæœ¬åœ°å°±å¯ä»¥ç›´æ¥è¿›è¡Œå¼€å‘å’Œè°ƒè¯•ï¼Œå†…ç½‘ç©¿é€çš„æ•™ç¨‹å‚è€ƒæˆ‘ä¹‹å‰å†™çš„ä¸€ç¯‡åšå®¢ï¼Œå†…ç½‘ç©¿é€å·¥å…·â€¦ ç›´æ¥è´´ä¸€ä¸‹æˆ‘çš„fprså’Œfrpcçš„é…ç½®æ–‡ä»¶å¥½äº†ï¼š # frps.ini æ–‡ä»¶å†…å®¹ [common] bind_port = 5000 token = jSUSpHdC dashboard_port = 5500 dashboard_user = admin dashboard_pwd = admin # frpc.ini æ–‡ä»¶å†…å®¹ [common] server_addr = 121.36.1.255 server_port = 5000 token = jSUSpHdC [dingtalk_robot] type = tcp local_ip = 127.0.0.1 local_port = 8080 remote_port = 9999 ä½¿ç”¨ngrokçš„è¯ï¼Œä¸€æ¡å‘½ä»¤ngrok http 9999ç›´æ¥å¯åŠ¨ï¼Œç„¶åå°†ç”Ÿæˆçš„URLå¡«å…¥ä¸Šé¢çš„æ¶ˆæ¯æ¥æ”¶åœ°å€ã€‚ ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:2:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"ä»£ç ç¼–å†™ ä»£ç å°±æ²¡å¿…è¦åœ¨è¿™é‡Œå¤§ç¯‡å¹…è®²äº†ï¼Œäº†è§£å¤§æ¦‚æµç¨‹å°±å¯ï¼Œè™½ç„¶ä»£ç éƒ½æ˜¯ä¹±å†™çš„ï¼Œä½†æ˜¯æˆ‘æ˜¯ä¸€ä¸ªè®²ç©¶ä»£ç è§„èŒƒçš„äºº:joy: ï¼Œä»£ç é‡Œé¢éƒ½æœ‰å¾ˆè¯¦ç»†çš„æ³¨é‡Šï¼Œçœ‹ä¸æ‡‚çš„å¯ä»¥æä¸ªissueã€‚ æ‰€æœ‰ä»£ç ä»¥åŠReleasesåŒ…å·²æ”¾åˆ°GitHubä¸Šï¼Œ:point_right:ç‚¹å‡»æ­¤å¤„è¿›è¡Œè®¿é—®ã€‚ ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:3:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"æ•ˆæœç¤ºä¾‹ ç¨‹åºå‰å°å¯åŠ¨ç•Œé¢ï¼š æ—¥å¿—æ–‡ä»¶å†™åˆ°äº†/var/log/dingtalk_robot.logï¼Œæ³¨æ„ç”¨æˆ·æƒé™ã€‚ æ—¥å¿—æ–‡ä»¶åˆæ­¥å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼ˆåˆ†å±å·¦è¾¹:point_left:ï¼‰ï¼š é’‰é’‰ç¾¤èŠæœºå™¨äººè‡ªåŠ¨å›å¤ç•Œé¢ï¼š ipå…³é”®å­—ï¼ˆæ¶ˆæ¯ç±»å‹Markdownï¼‰ï¼š helpå…³é”®å­—ï¼ˆï¼ˆæ¶ˆæ¯ç±»å‹Markdownï¼‰ï¼š aboutå…³é”®å­—ï¼ˆæ¶ˆæ¯ç±»å‹ActionCardï¼‰ï¼š æ— å…³é”®å­—ï¼ˆæ¶ˆæ¯ç±»å‹Markdownï¼‰ï¼š ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:4:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"æ€»ç»“ ç›®å‰è™½åªæœ‰è·å–å…¬å¸å…¬ç½‘IPv4è¿™ä¸ªåŠŸèƒ½ï¼Œä½†å¤©å­é©¾äºŒå·²æˆï¼Œæœªæ¥ä¸æ˜¯æƒ³æ‹‰ä»€ä¹ˆè´§å°±æ‹‰ï¼Ÿxd. :joy: ï¼Œåç»­å¦‚æœæœ‰å…¶ä»–éœ€è¦çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ ã€‚ Done. ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:5:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["Golang"],"content":"å‚è€ƒæ–‡æ¡£ é’‰é’‰ä¼ä¸šè‡ªå»ºæœºå™¨äººï¼šhttps://open.dingtalk.com/document/robots/enterprise-created-chatbot?spm=ding_open_doc.document.0.0.3d6d24cb7j00JN#topic-2097982 æ¶ˆæ¯ç±»å‹å’Œæ•°æ®æ ¼å¼ï¼šhttps://open.dingtalk.com/document/robots/message-types-and-data-format?spm=ding_open_doc.document.0.0.eaef2ccbpoeEEg#topic-2098229 ","date":"2021-12-09","objectID":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/:6:0","tags":["é’‰é’‰æœºå™¨äºº","Golang"],"title":"é’‰é’‰ç¾¤èŠæœºå™¨äººsample","uri":"/myBlog-2/post/%E9%92%89%E9%92%89%E7%BE%A4%E8%81%8A%E6%9C%BA%E5%99%A8%E4%BA%BAsample/"},{"categories":["VPS","GFW"],"content":"å‰ä¸¤å¤©å…¥æ‰‹äº†RackNerdçš„ä¸€å°VPSï¼Œé€‰çš„åŒºåŸŸæ˜¯åç››é¡¿è¥¿é›…å›¾ï¼Œæ­å»ºå¥½magicä¸Šç½‘ä¹‹åï¼Œè®¿é—®Googleè€æ˜¯è·³äººæœºéªŒè¯ï¼Œéå¸¸é¢‘ç¹ï¼Œç”¨èµ·æ¥ç‰¹åˆ«çƒ¦äººï¼ˆé—®tgç¾¤é‡Œå¤§å“¥è¯´å¥½åƒé™¤äº†æ´›æ‰çŸ¶åŒºåŸŸå¤–åŸºæœ¬éƒ½è·³GoogleäººæœºéªŒè¯ï¼‰ï¼Œéƒ½æœ‰ç§æƒ³æ¢æœç´¢å¼•æ“çš„å†²åŠ¨ã€‚ä½†æ˜¯æœ¬ç€è¦è§£å†³é—®é¢˜å’Œçˆ±æŠ˜è…¾çš„æ€åº¦ï¼Œè¿˜æ˜¯å°è¯•è§£å†³ä¸€ä¸‹å§ã€‚ :warning: ä»¥ä¸‹éƒ¨åˆ†å†…å®¹æ¥æºäºç½‘ç»œï¼Œä»…åšä¸ªäººå¤‡ä»½å­¦ä¹ ä½¿ç”¨ã€‚ ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:0:0","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["VPS","GFW"],"content":"è§£å†³æ–¹æ¡ˆ ç½‘ä¸Šæœé›†çš„è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ç§ï¼š æ›´æ¢IPï¼šé¢‘ç¹è·³GoogleéªŒè¯æ„å‘³ç€ä½ çš„IPè¢«Googleå¢™äº†ï¼Œè¢«è¯†åˆ«ä¸ºæ¶æ„IPï¼Œæ¢äº†IPä¹Ÿä¸ä¸€å®šç®¡ç”¨ï¼Œåˆ°å¤´æ¥æŠ˜äº†IPåˆæŸäº†moneyï¼Œäºåˆ°è£¤è¡©éƒ½æ²¡äº†ï¼› ä½¿ç”¨IPv6ï¼šé…ç½®IPv6æ¥è®¿é—®Googleï¼Œæˆ‘è¿™åå‡ åˆ€/yrçš„VPSå°±åˆ«æƒ³IPv6äº†ï¼Œxdï¼› ä½¿ç”¨IPv6éš§é“ï¼šåŒä¸Šï¼Œä¸åŒä¹‹å¤„å°±æ˜¯å€Ÿç”¨äº†IPv6éš§é“ï¼Œä½¿åŸæ¥ä»…æœ‰IPv4çš„æœºå­æ‹¥æœ‰IPv6çš„èƒ½åŠ›ï¼Œæˆ–è®¸è¿™æ˜¯ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå€¼å¾—å°è¯•ï¼Œäº‹å®ä¸Šè¿™ä¹Ÿè§£å†³äº†æˆ‘çš„é—®é¢˜ï¼› ã€é™„åŠ ã€‘ï¼šå¬tgç¾¤å‹è¯´å¥—warp VPNä¹Ÿå¯ä»¥è§£å†³ï¼Œä½†æ˜¯æ²¡è¯•è¿‡ï¼Œå…·ä½“å‚è€ƒç”¨ Cloudflare Warp å½»åº•è§£å†³ Google IP å®šä½ä¸­å›½çš„é—®é¢˜ï¼› ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:1:0","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["VPS","GFW"],"content":"ç”³è¯·å…è´¹çš„IPv6éš§é“ é¦–å…ˆç”³è¯·ä¸€ä¸ªå…è´¹çš„IPv6éš§é“ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯Tunnelbrokerï¼Œå…è´¹ç®€å•å¥½ç”¨ã€‚ ç”³è¯·è´¦å·çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼Œè¾“å…¥ä¸€äº›è™šæ‹Ÿçš„ä¸ªäººä¿¡æ¯å°±è¡Œï¼Œç›´æ¥èƒ¡ç¼–ä¹±å¡«å°±è¡Œäº†ï¼Œæˆ–è€…åœ¨è™šæ‹Ÿå¤–å›½èº«ä»½ç«™ç‚¹ä¸Šéšæœºä¸€ä¸ªèº«ä»½ä¿¡æ¯ï¼Œå¡«å¥½é‚®ç®±æ¥å—é‚®ç®±éªŒè¯å°±å®Œäº‹äº†ã€‚ ç”³è¯·å®Œè´¦å·ä¹‹åç™»å½•ï¼Œç‚¹å‡»å·¦è¾¹çš„è¿™ä¸ªCreate Regular Tunnelåˆ›å»ºä¸€èˆ¬éš§é“ï¼Œè¾“å…¥ä½ çš„IPv4å…¬ç½‘IPï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„éš§é“æœåŠ¡å™¨èŠ‚ç‚¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©å’Œä½ åŒºåŸŸç›¸å½“çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥é»˜è®¤å°±å¯ä»¥ï¼Œç„¶åç›´æ¥ç‚¹å‡»ä¸‹æ–¹çš„Create Tunelå³å¯. åˆ›å»ºå®Œæˆä¹‹åï¼Œç‚¹å‡»éš§é“è¯¦æƒ…ï¼Œå°±å¯ä»¥çœ‹åˆ°ç”³è¯·å¥½çš„IPv6åœ°å€ï¼š è¦ä½¿ç”¨çš„æ˜¯ä¸Šå›¾çº¢æ¡†ä¸­çš„IPv6å®¢æˆ·ç«¯åœ°å€. ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:2:0","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["VPS","GFW"],"content":"é…ç½®æœåŠ¡å™¨ä½¿ç”¨IPv6éš§é“ åœ¨Tunnelbrokerçš„éš§é“è¯¦æƒ…é¡µä¸­ç‚¹å‡»Example Configurationsç¤ºä¾‹é…ç½®ï¼Œæ‰¾åˆ°åŒ¹é…è‡ªå·±VPSç³»ç»Ÿçš„é…ç½®ç‰‡æ®µï¼Œè¿™é‡Œæˆ‘ä»¥æˆ‘çš„Ubuntu 20.04ä¸ºä¾‹ï¼ˆå…¶ä»–å‘è¡Œç‰ˆç±»ä¼¼ï¼‰ï¼š éœ€è¦è¾“çš„å‘½ä»¤æŒºå¤šçš„ï¼Œè¿™é‡Œæˆ‘æ•´ç†ä¸ºè„šæœ¬ï¼Œä¸€æ¡å‘½ä»¤å‚»ç“œå¼è¿è¡Œå³å¯ï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨rootç”¨æˆ·è¿è¡Œï¼Œçœäº‹ï¼š :question:ä¸æƒ³çœ‹è„šæœ¬ï¼Ÿè¯·ç›´æ¥è·³åˆ°:smile: è¿è¡Œåœ¨çº¿çš„jioæœ¬ #!/usr/bin/env bash set -euo pipefail # #************************************************** # Author: AGou-ops * # E-mail: agou-ops@foxmail.com * # Date: 2021-12-02 * # Description: * # Copyright 2021 by AGou-ops.All Rights Reserved * #************************************************** # ---------------- echoColor(){ echo -e \"\\033[36m$1\\033[0m\" } # å¯ç”¨ipv6 cat \u003c\u003c EOF \u003e\u003e /etc/sysctl.conf net.ipv6.conf.all.disable_ipv6 = 0 net.ipv6.conf.default.disable_ipv6 = 0 net.ipv6.conf.lo.disable_ipv6 = 0 EOF sysctl -p echoColor \"====== å¯ç”¨ipv6 ======\\n\" # ï¼ï¼ï¼ï¼ï¼é‡è¦ï¼ï¼ï¼ï¼ï¼ # å°†ä¸‹é¢çš„é‡å®šå‘å†…å®¹æ›¿æ¢ä¸ºä¸Šé¢ç¤ºä¾‹çš„é…ç½®ç‰‡æ®µå†…å®¹ cat \u003c\u003c EOF \u003e\u003e /etc/network/interfaces auto he-ipv6 iface he-ipv6 inet6 v4tunnel address xxxx:xxx:a:10d::2 netmask 64 endpoint 216.xx.xx.xx local 23.xx.x.xx ttl 255 gateway 2001:xx:a:10d::1 EOF echoColor \"====== ä¿®æ”¹ç½‘ç»œé…ç½®æ–‡ä»¶æˆåŠŸ ======\\n\" apt update -y 2\u003e\u00261 \u003e /dev/null apt install ifupdown dnsutils -y 2\u003e\u00261 \u003e /dev/null echoColor \"====== å®‰è£…å¿…è¦åŒ…å®Œæˆï¼Œå›¾ä¸ªæ–¹ä¾¿ï¼Œä¸ä¸ºå•¥ ======\\n\" sleep 1 # å¯åŠ¨ipv6ç½‘ç»œæ¥å£ï¼Œå¦‚æœæ²¡ç”Ÿæ•ˆå¯ä»¥å°è¯•é‡å¯ç½‘ç»œ ifup he-ipv6 echoColor \"====== æ¥å£å†…å®¹ä¿¡æ¯å¦‚ä¸‹ ======\\n\" ip a show dev he-ipv6 echoColor \"========================\\n\" # å¤‡ä»½åŸæ¥çš„dns cp -a /etc/resolv.conf{,.bak} cat \u003c\u003c EOF \u003e\u003e /etc/resolv.conf nameserver 8.8.8.8 nameserver 8.8.4.4 EOF echoColor \"====== ä¿®æ”¹dnså®Œæˆ ======\\n\" # è¿™é‡Œç”¨pingæŸ¥çœ‹ipv6åœ°å€ä¹Ÿå¯ä»¥ï¼Œè¿™é‡Œæˆ‘å›¾æ–¹ä¾¿ä½¿ç”¨digå¥½äº† google_ipv6=$(dig www.google.com AAAA | grep -E \"^www\" | awk '{print $5}') echo \"$google_ipv6www.google.com\" \u003e /etc/hosts echoColor \"====== ä¿®æ”¹hostsæ–‡ä»¶å®Œæˆ ======\\n\" # é»˜è®¤è®¿é—®æ—¶ä¼šä½¿ç”¨IPv6çº¿è·¯è¿›è¡Œè®¿é—®ï¼Œè€ƒè™‘åˆ°é€Ÿåº¦é—®é¢˜ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨IPv4 sed -i 's@#precedence ::ffff:0:0/96 100@precedence ::ffff:0:0/96 100@g' /etc/gai.conf echoColor \"====== é…ç½®ä¼˜å…ˆIPv4å®Œæˆ ======\\n\" echoColor \"\\n\\nDone.\" ä½¿ç”¨rootç”¨æˆ·è¿è¡Œä»¥ä¸Šjioæœ¬ï¼š chmod +x install_ipv6_tunnel.sh ./install_ipv6_tunnel.sh # ç­‰å¾…å®‰è£…å®Œæˆå³å¯ ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:3:0","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["VPS","GFW"],"content":":smile: è¿è¡Œåœ¨çº¿çš„jioæœ¬ ç›´æ¥åœ¨çº¿è¿è¡Œä¸Šé¢çš„è„šæœ¬ï¼Œä¸ç”¨æ‰‹åŠ¨å¤åˆ¶ç„¶åæ‰§è¡Œäº†ï¼Œä¸€æ¡å‘½ä»¤å®Œäº‹: wget -P /root -N --no-check-certificate \"https://gist.githubusercontent.com/AGou-ops/d0c65269da6c77e49a410c6dbe9ce244/raw/cb3ecd53a69c89d6c0e5933d0b838d97b83407e3/install_ipv6_tunnel.sh\" \u0026\u0026 chmod +x /root/install_ipv6_tunnel.sh \u0026\u0026 /root/install_ipv6_tunnel.sh ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:3:1","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["VPS","GFW"],"content":"æ£€æŸ¥VPSçš„IPv6åœ°å€ æ£€æŸ¥VPSçš„IPv6åœ°å€æ˜¯å¦ç”Ÿæ•ˆï¼Œä»¥åŠVPSçš„ç½‘ç»œæ˜¯å¦IPv4ä¼˜å…ˆï¼š # æŸ¥è¯¢æœ¬æœºå¤–ç½‘IPv6åœ°å€ curl 6.ipw.cn # å¤‡ç”¨æŸ¥è¯¢åœ°å€ curl ipv6.ip.sb # æµ‹è¯•ç½‘ç»œæ˜¯IPv4è¿˜æ˜¯IPv6è®¿é—®ä¼˜å…ˆ(è®¿é—®IPv4/IPv6åŒæ ˆç«™ç‚¹ï¼Œå¦‚æœè¿”å›IPv6åœ°å€ï¼Œåˆ™IPv6è®¿é—®ä¼˜å…ˆ) curl test.ipw.cn ä¹Ÿå¯ä»¥æµè§ˆå™¨ç›´æ¥è®¿é—®https://ipw.cn/è¿›è¡ŒæŸ¥çœ‹. Done. ","date":"2021-12-02","objectID":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/:4:0","tags":["VPS"],"title":"è§£å†³VPSé¢‘ç¹GoogleäººæœºéªŒè¯ï¼ˆIPè¢«banï¼‰","uri":"/myBlog-2/post/%E8%A7%A3%E5%86%B3vps%E9%A2%91%E7%B9%81google%E4%BA%BA%E6%9C%BA%E9%AA%8C%E8%AF%81ip%E8%A2%AB%E5%A2%99/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":":triangular_flag_on_post:è¯¥æ–‡ç« å°†æŒç»­æ›´æ–°ã€‚ åˆ†äº«å’Œè®°å½•ä¸ªäººæ—¥å¸¸å’Œå·¥ä½œä¸­ï¼Œå­¦ä¹ å’Œå®é™…ç”¨åˆ°çš„shellç‰‡æ®µä»¥åŠä¸€äº›å°æŠ€å·§ã€‚ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:0:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"shell å‰ä¸¤è¡Œ #!/usr/bin/env bashå’Œ#!/bin/bashåŒºåˆ« å‰è€…æ— éœ€åœ¨æ„æ‰€è¿è¡Œçš„è§£é‡Šå™¨åœ¨ä½•å¤„(bash), åªè¦å­˜åœ¨äºä½ çš„`$PATH`ç¯å¢ƒå˜é‡ä¸­å³å¯, æ ¹æ®ä½ çš„ç¯å¢ƒå¯»æ‰¾å¹¶è¿è¡Œé»˜è®¤çš„ç‰ˆæœ¬ï¼Œå…·æœ‰çµæ´»æ€§. Shell setå¸¸ç”¨å‚æ•°ï¼š -x: ç”¨äºè°ƒè¯•(debug)ï¼› -u: å¦‚æœé‡åˆ°ä¸å­˜åœ¨çš„å˜é‡ï¼ŒBash é»˜è®¤å¿½ç•¥å®ƒã€‚ ä½¿ç”¨-ué€‰é¡¹æ¥é¿å…è¿™ç§æƒ…å†µã€‚ å³é‡åˆ°æœªå®šä¹‰çš„å˜é‡ã€‚ åˆ™å¼‚å¸¸é€€å‡ºè„šæœ¬. ç­‰ä»·äºset -o nounsetå‘½ä»¤ï¼› -e: è„šæœ¬åªè¦å‘ç”Ÿé”™è¯¯ï¼Œå°±ç»ˆæ­¢æ‰§è¡Œã€‚ set -eæœ‰ä¸€ä¸ªä¾‹å¤–æƒ…å†µï¼Œå°±æ˜¯ä¸é€‚ç”¨äºç®¡é“å‘½ä»¤ã€‚ç­‰ä»·äºset -o errexitå‘½ä»¤ï¼› -o pipefailï¼šç”¨äºè§£å†³-eé€‰é¡¹æ— æ³•å¤„ç†ç®¡é“å‘½ä»¤é”™è¯¯çš„é—®é¢˜ï¼Œåªè¦ä¸€ä¸ªå­å‘½ä»¤å¤±è´¥ï¼Œæ•´ä¸ªç®¡é“å‘½ä»¤å°±å¤±è´¥ï¼Œè„šæœ¬å°±ä¼šç»ˆæ­¢æ‰§è¡Œã€‚ ä½¿ç”¨åœºæ™¯ï¼š ä¸€èˆ¬shellè„šæœ¬å°†ä»¥ä¸‹å†…å®¹æ”¾ç½®åˆ°å‰å‡ è¡Œï¼š set -euxo pipefail set -o errexit ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:1:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":":star:æ‚é¡¹ï¼ˆå‘½ä»¤å°æŠ€å·§ï¼‰ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:2:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å‘½ä»¤ç›¸å…³ command -v \u003cCOMMAND\u003e: ç”¨äºéªŒè¯æŸä¸ªå‘½ä»¤æ˜¯å¦å­˜åœ¨ã€‚ ä¸å­˜åœ¨åˆ™è¿”å›ä¸€ä¸ªéé›¶å€¼ï¼Œå­˜åœ¨åˆ™ä¼šè¿”å›è¯¥å‘½ä»¤çš„ç»å¯¹è·¯å¾„ã€‚ ä½¿ç”¨åœºæ™¯: shellè„šæœ¬ä¸­åˆ¤æ–­ä¸€ä¸ªå‘½ä»¤æ˜¯å¦å­˜åœ¨ä¸”å¯æ‰§è¡Œã€‚ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š if [ -x \"$(command -v systemctl)\" ];then ... exec \u003e SOMEFILE: å°†è„šæœ¬è¾“å‡ºå†…å®¹å…¨éƒ¨è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ä¸­(é™¤éå•ç‹¬æŒ‡å®š) ä½¿ç”¨åœºæ™¯: # æŸ¥æ‰¾æŸç›®å½•ä¸­çš„å ç”¨ç©ºé—´æœ€å¤§çš„å‡ ä¸ªæ–‡ä»¶ du -S /home/suofeiya/mycharts/ | sort -rn | sed '{11,$D};=' | sed 'N; s/\\n/ /' | awk 'BEGIN {print \"åºå·\\tå¤§å°(k)\\tæ–‡ä»¶å¤¹\"}{printf $1 \":\" \"\\t\" $2 \"\\t\" $3 \"\\n\"}' # å°†è¾“å‡ºå­˜åˆ°æŒ‡å®šæ–‡ä»¶ exec \u003e result.txt exec: exec æ˜¯ bash çš„å†…ç½®å‘½ä»¤, ä¸å¯ç”¨æ–°çš„shellè¿›ç¨‹ã€‚å°±åƒsourceæˆ–è€….ä¸€æ ·, ç›¸åä½¿ç”¨bashæˆ–è€…shæ‰§è¡Œå‘½ä»¤æ—¶, ä¼šå¦èµ·ä¸€ä¸ªå­shell, å­shellä¼šç»§æ‰¿çˆ¶shellçš„ç¯å¢ƒå˜é‡, å­shellæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å½±å“çˆ¶shell. trap: æ•è·ä¿¡å·, é€šå¸¸ç”¨é€”æ˜¯åœ¨shellè„šæœ¬è¢«ä¸­æ–­æ—¶å®Œæˆæ¸…ç†å·¥ä½œ ä¿¡å·åç§° ä¿¡å·æ•° æè¿° SIGINT 2 ç¨‹åºç»ˆæ­¢(interrupt)ä¿¡å·, åœ¨ç”¨æˆ·é”®å…¥INTRå­—ç¬¦(é€šå¸¸æ˜¯Ctrl+C)æ—¶å‘å‡ºã€‚ SIGQUIT 3 å’ŒSIGINTç±»ä¼¼, ä½†ç”±QUITå­—ç¬¦(é€šå¸¸æ˜¯Ctrl /)æ¥æ§åˆ¶. è¿›ç¨‹åœ¨å› æ”¶åˆ°SIGQUITé€€å‡ºæ—¶ä¼šäº§ç”Ÿcoreæ–‡ä»¶, åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šç±»ä¼¼äºä¸€ä¸ªç¨‹åºé”™è¯¯ä¿¡å·ã€‚ SIGFPE 8 åœ¨å‘ç”Ÿè‡´å‘½çš„ç®—æœ¯è¿ç®—é”™è¯¯æ—¶å‘å‡º. ä¸ä»…åŒ…æ‹¬æµ®ç‚¹è¿ç®—é”™è¯¯, è¿˜åŒ…æ‹¬æº¢å‡ºåŠé™¤æ•°ä¸º0ç­‰å…¶å®ƒæ‰€æœ‰çš„ç®—æœ¯çš„é”™è¯¯ã€‚ SIGKILL 9 ç”¨æ¥ç«‹å³ç»“æŸç¨‹åºçš„è¿è¡Œ. æœ¬ä¿¡å·ä¸èƒ½è¢«é˜»å¡, å¤„ç†å’Œå¿½ç•¥ã€‚ SIGALRM 14 æ—¶é’Ÿå®šæ—¶ä¿¡å·, è®¡ç®—çš„æ˜¯å®é™…çš„æ—¶é—´æˆ–æ—¶é’Ÿæ—¶é—´. alarmå‡½æ•°ä½¿ç”¨è¯¥ä¿¡å·ã€‚ SIGTERM ä½¿ç”¨åœºæ™¯: è„šæœ¬é€€å‡ºå‰æ‰§è¡Œå‘½ä»¤ è„šæœ¬åœ¨æ‰§è¡Œæ—¶æŒ‰ä¸‹CTRL+cæ—¶ï¼Œå°†æ˜¾ç¤º\"program exitâ€¦â€œå¹¶é€€å‡º(CTRL+cçš„ä¿¡å·æ˜¯SIGINT) trap \"echo 'program exit...'; exit 2\" SIGINT å¿½ç•¥ä¿¡å· ä¾‹ï¼šè„šæœ¬è¿è¡Œæ—¶å¿½ç•¥ SIGINT SIGQUIT SIGFPEç­‰ä¿¡å· trap '' 2 3 8 IFSï¼šæ¢è¡Œç¬¦ ä½¿ç”¨åœºæ™¯ï¼š ä¿®æ”¹é»˜è®¤çš„ç©ºæ ¼æ¢è¡Œç¬¦ï¼Œå¤šç”¨äºè¯»å–æ–‡ä»¶å†…å®¹ï¼š IFS_old=$IFS # å°†åŸIFSå€¼ä¿å­˜ï¼Œä»¥ä¾¿ç”¨å®Œåæ¢å¤ IFS=$'\\n' # æŒ‡å®šå›è½¦ä¸ºåˆ†éš”ç¬¦ for LINE in $(cat test.file) do echo ${LINE} done # è¯»å–æ–‡ä»¶ï¼Œæˆ– cat test.file | while read line;do echo \"${line}\";done # è¯»å–æ–‡ä»¶ï¼Œå†æˆ– while read line do echo \"${line}\" done \u003c test.file IFS=$IFS_old # æ¢å¤åŸIFSå€¼ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:2:1","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"æ–‡ä»¶ç›¸å…³ /etc/os-releaseï¼šæŸ¥çœ‹ç³»ç»Ÿåç§°ã€ç‰ˆæœ¬ã€åŸºäºç‰ˆæœ¬ã€ç‰ˆæœ¬ä»£å·ã€å¸®åŠ©ä¿¡æ¯ã€ç³»ç»Ÿå®˜æ–¹ä¸»é¡µç­‰ï¼› ä½¿ç”¨åœºæ™¯ï¼š å¯¹ä¸åŒçš„ç³»ç»Ÿä½¿ç”¨ä¸åŒçš„å‘½ä»¤è¿›è¡Œå¤„ç†ï¼š # æ£€æŸ¥Â·sysctlÂ·å‘½ä»¤æ˜¯å¦å­˜åœ¨ä¸”å¯æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿›è¡Œä¸‹è½½å®‰è£…ã€‚ if ! [ -x \"$(command -v sysctl)\" ]; then echo 'sysctl not installed. Installing it...' distro=$(awk -F= '/^ID=/{print $2}' /etc/os-release | tr -d '\"') case $distro in ol | centos) yum install -y procps rm -rf /var/cache/yum;; ubuntu | debian) apt-get update -qq \u0026\u0026 apt-get install -y --no-install-recommends procps rm -rf /var/lib/apt/lists /var/cache/apt/archives;; esac fi ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:2:2","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å‘½ä»¤æˆåŠŸä¸å¦åˆ¤æ–­ command \u0026\u0026 echo \"succ\" || echo \"fail\" command || { echo \"command failed\"; exit 1; } if ! commandï¼› then echo \"command failed\"ï¼› exit 1ï¼› fi command if [ \"$?\" -ne 0 ]ï¼› then echo \"command failed\"ï¼› exit 1ï¼› fi ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:3:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å˜é‡/å­—ç¬¦ä¸²æ“ä½œå¤§å…¨ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:4:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å˜é‡æˆªå– å˜é‡é…ç½®æ–¹å¼ è¯´æ˜ ${å˜é‡#å…³é”®è¯} ${å˜é‡##å…³é”®è¯} è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤ è‹¥å˜é‡å†…å®¹ä»å¤´å¼€å§‹çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤ ${å˜é‡%å…³é”®è¯} ${å˜é‡%%å…³é”®è¯} è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€çŸ­æ•°æ®åˆ é™¤ è‹¥å˜é‡å†…å®¹ä»å°¾å‘å‰çš„æ•°æ®ç¬¦åˆã€å…³é”®è¯ã€ï¼Œåˆ™å°†ç¬¦åˆçš„æœ€é•¿æ•°æ®åˆ é™¤ ${å˜é‡/æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²} ${å˜é‡//æ—§å­—ç¬¦ä¸²/æ–°å­—ç¬¦ä¸²} è‹¥å˜é‡å†…å®¹ç¬¦åˆã€æ—§å­—ç¬¦ä¸²ã€åˆ™ã€ç¬¬ä¸€ä¸ªæ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²å–ä»£ã€ è‹¥å˜é‡å†…å®¹ç¬¦åˆã€æ—§å­—ç¬¦ä¸²ã€åˆ™ã€å…¨éƒ¨çš„æ—§å­—ç¬¦ä¸²ä¼šè¢«æ–°å­—ç¬¦ä¸²å–ä»£ã€ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:4:1","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å˜é‡é»˜è®¤å€¼ å˜é‡é…ç½®æ–¹å¼ str æ²¡æœ‰é…ç½® str ä¸ºç©ºå­—ç¬¦ä¸² str å·²é…ç½®éä¸ºç©ºå­—ç¬¦ä¸² var=${str-expr} var=expr var= var=$str var=${str:-expr} var=expr var=expr var=$str var=${str+expr} var= var=expr var=expr var=${str:+expr} var= var= var=expr var=${str=expr} str=expr var=expr str ä¸å˜ var= str ä¸å˜ var=$str var=${str:=expr} str=expr var=expr str=expr var=expr str ä¸å˜ var=$str var=${str?expr} expr è¾“å‡ºè‡³ stderr var= var=$str var=${str:?expr} expr è¾“å‡ºè‡³ stderr expr è¾“å‡ºè‡³ stderr var=$str ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:4:2","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«å­ä¸² # é€šè¿‡ ** åŒ¹é… if [[ \"${var}\" == *\"${sub_string}\"* ]]; then printf '%s\\n' \"sub_string is in var.\" fi # é€šè¿‡ bash å†…ç½®çš„ =~ åˆ¤æ–­ if [[ \"${sub_string}\" =~ \"${var}\" ]]; then printf '%s\\n' \"sub_string is in var.\" fi ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:4:3","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"shellå‚æ•°å¤„ç† $# ä¼ é€’åˆ°è„šæœ¬çš„å‚æ•°ä¸ªæ•° $* ä»¥ä¸€ä¸ªå•å­—ç¬¦ä¸²æ˜¾ç¤ºæ‰€æœ‰å‘è„šæœ¬ä¼ é€’çš„å‚æ•°ã€‚ å¦‚\"$*\"ç”¨ã€Œ\"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥\"$1 $2 â€¦ $n\"çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚ $$è„šæœ¬è¿è¡Œçš„å½“å‰è¿›ç¨‹IDå· $!åå°è¿è¡Œçš„æœ€åä¸€ä¸ªè¿›ç¨‹çš„IDå· $@ä¸$*ç›¸åŒï¼Œä½†æ˜¯ä½¿ç”¨æ—¶åŠ å¼•å·ï¼Œå¹¶åœ¨å¼•å·ä¸­è¿”å›æ¯ä¸ªå‚æ•°ã€‚ å¦‚\"$@\"ç”¨ã€Œ\"ã€æ‹¬èµ·æ¥çš„æƒ…å†µã€ä»¥\"$1\" \"$2\" â€¦ \"$n\" çš„å½¢å¼è¾“å‡ºæ‰€æœ‰å‚æ•°ã€‚ $- æ˜¾ç¤ºShellä½¿ç”¨çš„å½“å‰é€‰é¡¹ï¼Œä¸setå‘½ä»¤åŠŸèƒ½ç›¸åŒã€‚ $? æ˜¾ç¤ºæœ€åå‘½ä»¤çš„é€€å‡ºçŠ¶æ€ã€‚0è¡¨ç¤ºæ²¡æœ‰é”™è¯¯ï¼Œå…¶ä»–ä»»ä½•å€¼è¡¨æ˜æœ‰é”™è¯¯ã€‚ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:5:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"æ‰“å°å¤šè¡Œä¿¡æ¯ï¼ˆå¤šç”¨äºjioæœ¬å¸®åŠ©ä¿¡æ¯ï¼‰ cat \u003e\u00261 \u003c\u003c-EOF # æˆ–è€…ç›´æ¥ä½¿ç”¨cat \u003c\u003c EOF first line second line third line EOF # æˆ– cat \u003c\u003c EOF 111 222 EOF # æˆ– echo \"11 22 \" # æˆ–ï¼ˆæ¥æºäºStackOverflowï¼‰ __usage=\" Usage: $(basename $0)[OPTIONS] Options: -l, --level \u003cn\u003e Something something something level -n, --nnnnn \u003clevels\u003e Something something something n -h, --help Something something something help -v, --version Something something something version \" Then I can simply use it as echo \"$__usage\" ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:6:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"ä¼ é€’æ•°ç»„åˆ°å‡½æ•° function update() { declare -a apps_version=(\"${!1}\") echo \"${apps_version[@]}\" } APPS_VERSION=(\"aaa\" \"bbb\" \"ccc\") update APPS_VERSION[@] ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:7:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"è·å–é€‰é¡¹select case PS3=\"enter option: \" # ä½¿ç”¨selectæ—¶çš„æç¤ºç¬¦ select option in \"option1\" \"option2\" \"option3\" \"option4\" \"exit\" do case $option in \"exit\") break;; \"option1\") break;; ... *) ... esca done ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:8:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„æ–‡ä»¶å¥æŸ„ # ç”¨æˆ·çº§ find /proc/*/fd/* -type l -lname 'anon_inode:inotify' -print 2\u003e/dev/null | cut -d/ -f3 |xargs -I '{}' -- ps --no-headers -o '%U' -p '{}' | sort | uniq -c | sort -nr # ç»“æœ: ç¬¬ä¸€åˆ—è¡¨ç¤ºæ‰“å¼€çš„å¥æŸ„ï¼Œç¬¬äºŒåˆ—è¡¨ç¤ºç”¨æˆ· # è¿›ç¨‹çº§ find /proc/*/fd/* -type l -lname 'anon_inode:inotify' -print 2\u003e/dev/null | cut -d/ -f3 |xargs -I '{}' -- ps --no-headers -o '%U %p %c' -p '{}' | sort | uniq -c | sort -nr # ç»“æœ: ç¬¬ä¸€åˆ—è¡¨ç¤ºæ‰“å¼€çš„å¥æŸ„ï¼Œç¬¬äºŒåˆ—è¡¨ç¤ºç”¨æˆ·ï¼Œç¬¬ä¸‰åˆ—è¡¨ç¤ºç”¨æˆ·idï¼Œç¬¬å››åˆ—è¡¨ç¤ºè¿›ç¨‹ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:9:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"ä¿®æ”¹crontabå†…å®¹ (crontab -l 2\u003e/dev/null; echo '*/2 * * * * \u003cSOME_COMMAND or SOME_SCRIPT\u003e \u003e \u003cSOME_OUTPUT_FILE\u003e.$(date \"+\\%Y\\%m\\%d-\\%H\\%M\\%S\") 2\u003e\u00261') | crontab - ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:10:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"åŠ è½½kvé…ç½®å‹æ–‡ä»¶ cat xx key1=value1 key2=value2 cat xx.sh . xx # è¿™é‡Œç›´æ¥ä½¿ç”¨. xxå³å¯æŠŠxxæ–‡ä»¶é‡Œçš„key-valueå¼•å…¥,åç»­å¯ç›´æ¥ä½¿ç”¨k. echo $key1, $key2 #æ³¨æ„, é…ç½®æ–‡ä»¶åªèƒ½æ˜¯k=vçš„å½¢å¼(å¤šä¸ªk=vå¯ä»¥åœ¨ä¸€è¡Œ, ä½¿ç”¨ç©ºæ ¼éš”å¼€), å…¶å®ƒå½¢å¼ä¼šæŠ¥é”™ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:11:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å¾ªç¯æ‰“å°å¸¦ç©ºæ ¼çš„å­—ç¬¦ä¸²/æ•°ç»„ # éœ€æ±‚, æä¾›ä¸ªæ•°ç»„ï¼Œå¾ªç¯æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œ å¦‚æœå…ƒç´ å­˜åœ¨äºæŸä¸ªæ–‡ä»¶ä¸­ï¼Œåˆ™ä¸è¿½åŠ ï¼Œå¦‚æœä¸å­˜åœ¨,åˆ™è¿½åŠ  K8S_CLUSTER=(\"172.1.52.250 k8s-master-250\" \"172.1.52.50 k8s-master-50\") for x in \"${K8S_CLUSTER[@]}\"; do grep \"$x\" /etc/hosts \u003e /dev/null || echo \"$x\" \u003e\u003e /etc/hosts;done ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:12:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"Shell getopts Demoï¼ˆShell å‚æ•°ï¼‰ #!/bin/bash status=off # å®šä¹‰å˜é‡statusï¼Œåˆå§‹å€¼è®¾ç½®ä¸ºoff filename=\"\" # å®šä¹‰å˜é‡filenameï¼Œç”¨äºä¿å­˜é€‰é¡¹å‚æ•°ï¼ˆæ–‡ä»¶ï¼‰ output=\"\" # å®šä¹‰å˜é‡outputï¼Œç”¨äºä¿å­˜é€‰é¡¹å‚æ•°ï¼ˆç›®å½•ï¼‰ Usage () { # å®šä¹‰å‡½æ•°Usageï¼Œè¾“å‡ºè„šæœ¬ä½¿ç”¨æ–¹æ³• echo \"Usage\" echo \"myscript [-h] [-v] [-f \u003cfilename\u003e] [-o \u003cfilename\u003e]\" exit -1 } while getopts :hvf:o: varname # å‘Šè¯‰getoptsæ­¤è„šæœ¬æœ‰-hã€-vã€-fã€-oå››ä¸ªé€‰é¡¹ï¼Œ-få’Œ-oåé¢éœ€è¦è·Ÿå‚æ•°ï¼ˆæ²¡æœ‰é€‰é¡¹æ—¶ï¼Œgetoptsä¼šè®¾ç½®ä¸€ä¸ªé€€å‡ºçŠ¶æ€FALSEï¼Œé€€å‡ºå¾ªç¯ï¼‰ do case $varname in h) echo \"$varname\" Usage exit ;; v) echo \"$varname\" status=on echo \"$status\" exit ;; f) echo \"$varname\" echo \"$OPTARG\" filename=$OPTARG # å°†é€‰é¡¹çš„å‚æ•°èµ‹å€¼ç»™filename if [ ! -f $filename ];then # åˆ¤æ–­é€‰é¡¹æ‰€è·Ÿçš„å‚æ•°æ˜¯å¦å­˜åœ¨ä¸”æ˜¯æ–‡ä»¶ echo \"the source file $filenamenot exist!\" exit fi ;; o) echo \"$varname\" echo \"$OPTARG\" output=$OPTARG # å°†é€‰é¡¹å‚æ•°èµ‹å€¼ç»™output if [ ! -d $output ];then # åˆ¤æ–­é€‰é¡¹å‚æ•°æ˜¯å¦å­˜åœ¨ä¸”æ˜¯ç›®å½• echo \"the output path $outputnot exist\" exit fi ;; # å½“é€‰é¡¹åé¢æ²¡æœ‰å‚æ•°æ—¶ï¼Œvarnameçš„å€¼è¢«è®¾ç½®ä¸ºï¼ˆï¼šï¼‰ï¼ŒOPTARGçš„å€¼è¢«è®¾ç½®ä¸ºé€‰é¡¹æœ¬èº« :) echo \"$varname\" echo \"the option -$OPTARGrequire an arguement\" # æç¤ºç”¨æˆ·æ­¤é€‰é¡¹åé¢éœ€è¦ä¸€ä¸ªå‚æ•° exit 1 ;; ?) # å½“é€‰é¡¹ä¸åŒ¹é…æ—¶ï¼Œvarnameçš„å€¼è¢«è®¾ç½®ä¸ºï¼ˆï¼Ÿï¼‰ï¼ŒOPTARGçš„å€¼è¢«è®¾ç½®ä¸ºé€‰é¡¹æœ¬èº« echo \"$varname\" echo \"Invaild option: -$OPTARG\" # æç¤ºç”¨æˆ·æ­¤é€‰é¡¹æ— æ•ˆ Usage exit 2 ;; esac done ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:13:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":["tricks","æŒç»­æ›´æ–°"],"content":"å‚è€ƒé“¾æ¥ å¤§éƒ¨åˆ†éƒ½æ¥æºäºç½‘ç»œï¼Œéƒ½äº²æµ‹ä½¿ç”¨è¿‡æ²¡å•¥é—®é¢˜ï¼Œç”±äºæ¶‰åŠå†…å®¹å¤ªæ‚å¤ªå¤šäº†ï¼Œå°±ä¸ä¸€ä¸€æ ‡æ³¨äº†ã€‚ ","date":"2021-11-08","objectID":"/myBlog-2/post/shell-tricks/:14:0","tags":["Shell","tricks"],"title":"Shell Tricks","uri":"/myBlog-2/post/shell-tricks/"},{"categories":[],"content":"ä»ç®€å•p2pç½‘ç»œåˆ°k8så¤æ‚å‹ç½‘ç»œã€‚ ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:0:0","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":[],"content":"ç®€å•p2pç½‘ç»œæ¨¡å‹ :information_source:ç®€å•è¯´æ˜ï¼šåˆ›å»ºä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´clientå’Œserverï¼Œç„¶ååˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡å°†ä¸¤ç«¯çš„å‘½åç©ºé—´ç›¸è¿èµ·æ¥ï¼Œå°±å¥½åƒç›´æ¥ç›¸è¿çš„ç½‘çº¿ä¸€æ ·ï¼Œä¸­é—´æ²¡æœ‰é˜»æ‹¦ï¼Œåˆ›å»ºå®Œçš„è™šæ‹Ÿç½‘å¡å¯¹å­˜åœ¨äºé»˜è®¤çš„å‘½åç©ºé—´ä¸­ï¼Œæ¥ç€æˆ‘ä»¬å°†å…¶åˆ†åˆ«æ”¾å…¥clientå’Œserverå‘½åç©ºé—´ä¸­ï¼Œæœ€åä¸ºä¸¤ä¸ªè™šæ‹Ÿç½‘å¡å¯¹veth-clientå’Œveth-serveråˆ†é…IPåœ°å€å¹¶å¯ç”¨ç½‘å¡ã€‚ # æ­¥éª¤å…¨æµç¨‹ $ ip netns add client $ ip netns add server $ ip netns list server client $ ip link add veth-client type veth peer name veth-server $ ip link list | grep veth 4: veth-server@veth-client: \u003cBROADCAST,MULTICAST,M-DOWN\u003e mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 5: veth-client@veth-server: \u003cBROADCAST,MULTICAST,M-DOWN\u003e mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 $ ip link set veth-client netns client $ ip link set veth-server netns server # å°†è™šæ‹Ÿç½‘å¡ç§»åŠ¨è‡³ç›¸åº”çš„å‘½åç©ºé—´å»ï¼Œæ­¤æ—¶é»˜è®¤çš„ç½‘ç»œå‘½åç©ºé—´ä¸­å°†ä¸å¤å­˜åœ¨ $ ip netns exec client ip address add 10.0.0.11/24 dev veth-client $ ip netns exec client ip link set veth-client up $ ip netns exec server ip address add 10.0.0.12/24 dev veth-server $ ip netns exec server ip link set veth-server up $ ip netns exec client ip addr 1: lo: \u003cLOOPBACK\u003e mtu 65536 qdisc noop state DOWN group default qlen 1 # é»˜è®¤çš„loæš‚æ—¶ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥åœ¨æ­¤å°±ä¸å¯ç”¨äº† link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 5: veth-client@if4: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue `state UP` group default qlen 1000 # å¯ä»¥çœ‹åˆ°ç½‘å¡å·²è¢«æˆåŠŸå¯ç”¨ link/ether ca:e8:30:2e:f9:d2 brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet 10.0.0.11/24 scope global veth-client valid_lft forever preferred_lft forever inet6 fe80::c8e8:30ff:fe2e:f9d2/64 scope link valid_lft forever preferred_lft forever # åŒæ ·ï¼Œserverç½‘ç»œå‘½åç©ºé—´ï¼Œè¾“å‡ºç›¸ä¼¼ï¼Œç•¥ $ ip netns exec server ip addr ã€‚ã€‚ã€‚ # äº’pingæµ‹è¯• $ ip netns exec client ping 10.0.0.12 $ ip netns exec server ping 10.0.0.11 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:1:0","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":[],"content":"Dockerç½‘æ¡¥æ¨¡å‹ å¦‚æœè¦åˆ›å»ºæ›´ç½‘ç»œå‘½åç©ºé—´å¹¶äº’ç›¸è¿æ¥ï¼Œç”¨ veth å¯¹å°†è¿™äº›ç½‘ç»œå‘½åç©ºé—´è¿›è¡Œä¸¤ä¸¤è¿æ¥å°±å¾ˆéº»çƒ¦äº†ã€‚å¯ä»¥åˆ›å»ºåˆ›å»ºä¸€ä¸ª Linux ç½‘æ¡¥æ¥è¿æ¥è¿™äº›ç½‘ç»œå‘½åç©ºé—´ã€‚Docker å°±æ˜¯è¿™æ ·ä¸ºåŒä¸€ä¸»æœºå†…çš„å®¹å™¨è¿›è¡Œè¿æ¥çš„ã€‚ # æ­¥éª¤å…¨æµç¨‹ $ BR=bridge1 $ HOST_IP=192.168.0.116 $ ip link add client1-veth type veth peer name client1-veth-br # æ·»åŠ è™šæ‹Ÿç½‘å¡ä¸è™šæ‹Ÿç½‘æ¡¥å¯¹ $ ip link add server1-veth type veth peer name server1-veth-br $ ip link add $BR type bridge # æ·»åŠ ç½‘æ¡¥ $ ip netns add client1 $ ip netns add server1 $ ip link set client1-veth netns client1 $ ip link set server1-veth netns server1 $ ip link set client1-veth-br master $BR $ ip link set server1-veth-br master $BR $ ip link set $BR up $ ip link set client1-veth-br up $ ip link set server1-veth-br up $ ip netns exec client1 ip link set client1-veth up $ ip netns exec server1 ip link set server1-veth up $ ip netns exec client1 ip addr add 192.168.1.11/24 dev client1-veth $ ip netns exec server1 ip addr add 192.168.1.12/24 dev server1-veth $ ip addr add 192.168.1.1/24 dev $BR # ä¸ºç½‘æ¡¥åˆ†é…ipåœ°å€ $ ip netns exec client1 ping 192.168.1.12 -c 5 $ ip netns exec client1 ping 192.168.1.1 -c 5 å‘ç°æœ€åä¸€æ¡å‘½ä»¤æŠ¥é”™connect: Network is unreachableï¼ŒåŸå› è·¯ç”±ä¸é€šï¼ŒåŠ å…¥ä¸€æ¡ç¼ºçœè·¯ç”±å³å¯ï¼š $ ip netns exec client1 ip route add default via 192.168.1.1 $ ip netns exec server1 ip route add default via 192.168.1.1 å¤–éƒ¨æœåŠ¡å™¨è®¿é—®å†…éƒ¨(Dockerä¸ºä¾‹)ï¼š Docker åˆ›å»ºçš„ netns æ²¡æœ‰ä¿å­˜åœ¨ç¼ºçœä½ç½®ï¼Œæ‰€ä»¥ ip netns list æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªç½‘ç»œå‘½åç©ºé—´çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç¼ºçœä½ç½®åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼š $ container_id=web $ container_netns=$(docker inspect ${container_id} --format '{{ .NetworkSettings.SandboxKey }}') $ mkdir -p /var/run/netns $ rm -f /var/run/netns/${container_id} $ ln -sv ${container_netns} /var/run/netns/${container_id} '/var/run/netns/web' -\u003e '/var/run/docker/netns/c009f2a4be71' $ ip netns list web (id: 3) server1 (id: 1) client1 (id: 0) çœ‹çœ‹ web å‘½åç©ºé—´çš„ IP åœ°å€ï¼š $ ip netns exec web ip addr 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 11: eth0@if12: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.18.0.3/24 brd 172.18.0.255 scope global eth0 valid_lft forever preferred_lft forever ç„¶åçœ‹çœ‹å®¹å™¨é‡Œçš„ IP åœ°å€ï¼š $ WEB_IP=`docker inspect -f \"{{ .NetworkSettings.IPAddress }}\" web` $ echo $WEB_IP 172.18.0.3 åŠ å…¥ç«¯å£è½¬å‘è§„åˆ™ï¼Œå…¶å®ƒä¸»æœºå°±èƒ½è®¿é—®è¿™ä¸ª nginx äº†ï¼š $ iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination $WEB_IP:80 $ curl localhost:80 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:2:0","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":[],"content":"èŠ‚ç‚¹é—´ç½‘ç»œä¼ è¾“ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:2:1","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":[],"content":"k8sæœåŠ¡ç½‘ç»œ æŠ€æœ¯ç±»æ–‡ç« ç½‘ä¸Šä¸€æœä¸€å¤§ç‰‡ï¼Œè¿™é‡Œæˆ‘åˆ†äº«ä¸€ä¸ªä¹‹å‰YouTubeä¸Šçœ‹åˆ°çš„ä¸€ä¸ªè§†é¢‘ï¼Œç®€æ´æ˜äº†ã€‚ #dplayer-video-container { max-width: 800px; margin: 0 auto; margin-top: -1rem; } @media screen and (max-device-width: 400px) { #dplayer { width: 100%; } } const dp = new DPlayer({ container: document.getElementById('dplayer'), autoplay: false, theme: '#c05b4d', loop: false, lang: 'zh-cn', screenshot: false, hotkey: true, preload: 'auto', volume: 0.7, mutex: true, logo: 'https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/youtube.png', subtitle: { url: 'https:\\/\\/agou-resources.oss-cn-chengdu.aliyuncs.com\\/subtitles\\/Kubernetes%20Services%20networking%20-%20English.vtt', type: 'webvtt', fontSize: '20px', bottom: '3%', color: '#0000', }, video: { type: 'auto', url: 'https:\\/\\/agou-resources.oss-cn-chengdu.aliyuncs.com\\/video\\/Kubernetes%20Services%20networking.mp4', pic: '' }, contextmenu: [ { text: 'â¤ åšå®¢ä¸»é¡µ', link: 'https://agou-ops.github.io' }, { text: 'æ’­æ”¾å™¨ä¿¡æ¯', click: (player) = { console.log(player); } } ], highlight: [ { time: '0', text: 'ClusterIP', }, { time: '107', text: 'NodePort', }, { time: '108', text: 'ServiceIP with Calio', }, { time: '', text: '', }, { time: '', text: '', }, ], }); ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:3:0","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":[],"content":"å‚è€ƒé“¾æ¥ Life of a Packet in Kubernetes â€” Part 1: https://dramasamy.medium.com/life-of-a-packet-in-kubernetes-part-1-f9bc0909e051 kubernetes services network YouTube: https://www.youtube.com/watch?v=NFApeJRXos4 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/:4:0","tags":[],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0-copy/"},{"categories":["kubernetes"],"content":"ä»ç®€å•p2pç½‘ç»œåˆ°k8så¤æ‚å‹ç½‘ç»œã€‚ ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:0:0","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["kubernetes"],"content":"ç®€å•p2pç½‘ç»œæ¨¡å‹ :information_source:ç®€å•è¯´æ˜ï¼šåˆ›å»ºä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´clientå’Œserverï¼Œç„¶ååˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡å°†ä¸¤ç«¯çš„å‘½åç©ºé—´ç›¸è¿èµ·æ¥ï¼Œå°±å¥½åƒç›´æ¥ç›¸è¿çš„ç½‘çº¿ä¸€æ ·ï¼Œä¸­é—´æ²¡æœ‰é˜»æ‹¦ï¼Œåˆ›å»ºå®Œçš„è™šæ‹Ÿç½‘å¡å¯¹å­˜åœ¨äºé»˜è®¤çš„å‘½åç©ºé—´ä¸­ï¼Œæ¥ç€æˆ‘ä»¬å°†å…¶åˆ†åˆ«æ”¾å…¥clientå’Œserverå‘½åç©ºé—´ä¸­ï¼Œæœ€åä¸ºä¸¤ä¸ªè™šæ‹Ÿç½‘å¡å¯¹veth-clientå’Œveth-serveråˆ†é…IPåœ°å€å¹¶å¯ç”¨ç½‘å¡ã€‚ # æ­¥éª¤å…¨æµç¨‹ $ ip netns add client $ ip netns add server $ ip netns list server client $ ip link add veth-client type veth peer name veth-server $ ip link list | grep veth 4: veth-server@veth-client: \u003cBROADCAST,MULTICAST,M-DOWN\u003e mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 5: veth-client@veth-server: \u003cBROADCAST,MULTICAST,M-DOWN\u003e mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 $ ip link set veth-client netns client $ ip link set veth-server netns server # å°†è™šæ‹Ÿç½‘å¡ç§»åŠ¨è‡³ç›¸åº”çš„å‘½åç©ºé—´å»ï¼Œæ­¤æ—¶é»˜è®¤çš„ç½‘ç»œå‘½åç©ºé—´ä¸­å°†ä¸å¤å­˜åœ¨ $ ip netns exec client ip address add 10.0.0.11/24 dev veth-client $ ip netns exec client ip link set veth-client up $ ip netns exec server ip address add 10.0.0.12/24 dev veth-server $ ip netns exec server ip link set veth-server up $ ip netns exec client ip addr 1: lo: \u003cLOOPBACK\u003e mtu 65536 qdisc noop state DOWN group default qlen 1 # é»˜è®¤çš„loæš‚æ—¶ç”¨ä¸åˆ°ï¼Œæ‰€ä»¥åœ¨æ­¤å°±ä¸å¯ç”¨äº† link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 5: veth-client@if4: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue `state UP` group default qlen 1000 # å¯ä»¥çœ‹åˆ°ç½‘å¡å·²è¢«æˆåŠŸå¯ç”¨ link/ether ca:e8:30:2e:f9:d2 brd ff:ff:ff:ff:ff:ff link-netnsid 1 inet 10.0.0.11/24 scope global veth-client valid_lft forever preferred_lft forever inet6 fe80::c8e8:30ff:fe2e:f9d2/64 scope link valid_lft forever preferred_lft forever # åŒæ ·ï¼Œserverç½‘ç»œå‘½åç©ºé—´ï¼Œè¾“å‡ºç›¸ä¼¼ï¼Œç•¥ $ ip netns exec server ip addr ã€‚ã€‚ã€‚ # äº’pingæµ‹è¯• $ ip netns exec client ping 10.0.0.12 $ ip netns exec server ping 10.0.0.11 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:1:0","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["kubernetes"],"content":"Dockerç½‘æ¡¥æ¨¡å‹ å¦‚æœè¦åˆ›å»ºæ›´ç½‘ç»œå‘½åç©ºé—´å¹¶äº’ç›¸è¿æ¥ï¼Œç”¨ veth å¯¹å°†è¿™äº›ç½‘ç»œå‘½åç©ºé—´è¿›è¡Œä¸¤ä¸¤è¿æ¥å°±å¾ˆéº»çƒ¦äº†ã€‚å¯ä»¥åˆ›å»ºåˆ›å»ºä¸€ä¸ª Linux ç½‘æ¡¥æ¥è¿æ¥è¿™äº›ç½‘ç»œå‘½åç©ºé—´ã€‚Docker å°±æ˜¯è¿™æ ·ä¸ºåŒä¸€ä¸»æœºå†…çš„å®¹å™¨è¿›è¡Œè¿æ¥çš„ã€‚ # æ­¥éª¤å…¨æµç¨‹ $ BR=bridge1 $ HOST_IP=192.168.0.116 $ ip link add client1-veth type veth peer name client1-veth-br # æ·»åŠ è™šæ‹Ÿç½‘å¡ä¸è™šæ‹Ÿç½‘æ¡¥å¯¹ $ ip link add server1-veth type veth peer name server1-veth-br $ ip link add $BR type bridge # æ·»åŠ ç½‘æ¡¥ $ ip netns add client1 $ ip netns add server1 $ ip link set client1-veth netns client1 $ ip link set server1-veth netns server1 $ ip link set client1-veth-br master $BR $ ip link set server1-veth-br master $BR $ ip link set $BR up $ ip link set client1-veth-br up $ ip link set server1-veth-br up $ ip netns exec client1 ip link set client1-veth up $ ip netns exec server1 ip link set server1-veth up $ ip netns exec client1 ip addr add 192.168.1.11/24 dev client1-veth $ ip netns exec server1 ip addr add 192.168.1.12/24 dev server1-veth $ ip addr add 192.168.1.1/24 dev $BR # ä¸ºç½‘æ¡¥åˆ†é…ipåœ°å€ $ ip netns exec client1 ping 192.168.1.12 -c 5 $ ip netns exec client1 ping 192.168.1.1 -c 5 å‘ç°æœ€åä¸€æ¡å‘½ä»¤æŠ¥é”™connect: Network is unreachableï¼ŒåŸå› è·¯ç”±ä¸é€šï¼ŒåŠ å…¥ä¸€æ¡ç¼ºçœè·¯ç”±å³å¯ï¼š $ ip netns exec client1 ip route add default via 192.168.1.1 $ ip netns exec server1 ip route add default via 192.168.1.1 å¤–éƒ¨æœåŠ¡å™¨è®¿é—®å†…éƒ¨(Dockerä¸ºä¾‹)ï¼š Docker åˆ›å»ºçš„ netns æ²¡æœ‰ä¿å­˜åœ¨ç¼ºçœä½ç½®ï¼Œæ‰€ä»¥ ip netns list æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªç½‘ç»œå‘½åç©ºé—´çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç¼ºçœä½ç½®åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼š $ container_id=web $ container_netns=$(docker inspect ${container_id} --format '{{ .NetworkSettings.SandboxKey }}') $ mkdir -p /var/run/netns $ rm -f /var/run/netns/${container_id} $ ln -sv ${container_netns} /var/run/netns/${container_id} '/var/run/netns/web' -\u003e '/var/run/docker/netns/c009f2a4be71' $ ip netns list web (id: 3) server1 (id: 1) client1 (id: 0) çœ‹çœ‹ web å‘½åç©ºé—´çš„ IP åœ°å€ï¼š $ ip netns exec web ip addr 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 11: eth0@if12: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default link/ether 02:42:ac:12:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 172.18.0.3/24 brd 172.18.0.255 scope global eth0 valid_lft forever preferred_lft forever ç„¶åçœ‹çœ‹å®¹å™¨é‡Œçš„ IP åœ°å€ï¼š $ WEB_IP=`docker inspect -f \"{{ .NetworkSettings.IPAddress }}\" web` $ echo $WEB_IP 172.18.0.3 åŠ å…¥ç«¯å£è½¬å‘è§„åˆ™ï¼Œå…¶å®ƒä¸»æœºå°±èƒ½è®¿é—®è¿™ä¸ª nginx äº†ï¼š $ iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination $WEB_IP:80 $ curl localhost:80 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:2:0","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["kubernetes"],"content":"èŠ‚ç‚¹é—´ç½‘ç»œä¼ è¾“ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:2:1","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["kubernetes"],"content":"k8sæœåŠ¡ç½‘ç»œ æŠ€æœ¯ç±»æ–‡ç« ç½‘ä¸Šä¸€æœä¸€å¤§ç‰‡ï¼Œè¿™é‡Œæˆ‘åˆ†äº«ä¸€ä¸ªä¹‹å‰YouTubeä¸Šçœ‹åˆ°çš„ä¸€ä¸ªè§†é¢‘ï¼Œç®€æ´æ˜äº†ã€‚ #dplayer-video-container { max-width: 800px; margin: 0 auto; margin-top: -1rem; } @media screen and (max-device-width: 400px) { #dplayer { width: 100%; } } const dp = new DPlayer({ container: document.getElementById('dplayer'), autoplay: false, theme: '#c05b4d', loop: false, lang: 'zh-cn', screenshot: false, hotkey: true, preload: 'auto', volume: 0.7, mutex: true, logo: 'https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/youtube.png', subtitle: { url: '\\/subtitles\\/Kubernetes%20Services networking-English.vtt', type: 'webvtt', fontSize: '20px', bottom: '3%', color: '#0000', }, video: { type: 'auto', url: '\\/subtitles\\/Kubernetes%20Services%20networking.mp4', pic: '' }, contextmenu: [ { text: 'â¤ åšå®¢ä¸»é¡µ', link: 'https://agou-ops.github.io' }, { text: 'æ’­æ”¾å™¨ä¿¡æ¯', click: (player) = { console.log(player); } } ], highlight: [ { time: '0', text: 'ClusterIP', }, { time: '107', text: 'NodePort', }, { time: '108', text: 'ServiceIP with Calio', }, { time: '', text: '', }, { time: '', text: '', }, ], }); #dplayer-video-container { max-width: 800px; margin: 0 auto; margin-top: -1rem; } @media screen and (max-device-width: 400px) { #dplayer { width: 100%; } } const dp = new DPlayer({ container: document.getElementById('dplayer'), autoplay: false, theme: '#b7daff', loop: false, lang: 'zh-cn', screenshot: false, hotkey: true, preload: 'auto', volume: 0.7, mutex: true, logo: 'https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/youtube.png', video: { type: 'auto', url: '\\/subtitles\\/Kubernetes%20Services%20networking.mp4', pic: '' }, contextmenu: [ { text: 'â¤ åšå®¢ä¸»é¡µ', link: 'https://agou-ops.github.io' }, { text: 'æ’­æ”¾å™¨ä¿¡æ¯', click: (player) = { console.log(player); } } ], highlight: [ { time: '0', text: 'ClusterIP', }, { time: '107', text: 'NodePort', }, { time: '108', text: 'ServiceIP with Calio', }, { time: '', text: '', }, { time: '', text: '', }, ], }); -- ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:3:0","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["kubernetes"],"content":"å‚è€ƒé“¾æ¥ Life of a Packet in Kubernetes â€” Part 1: https://dramasamy.medium.com/life-of-a-packet-in-kubernetes-part-1-f9bc0909e051 kubernetes services network YouTube: https://www.youtube.com/watch?v=NFApeJRXos4 ","date":"2021-11-02","objectID":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/:4:0","tags":["network","kubernetes"],"title":"K8sç½‘ç»œå­¦ä¹ ","uri":"/myBlog-2/post/k8s%E7%BD%91%E7%BB%9C%E5%AD%A6%E4%B9%A0/"},{"categories":["Linux"],"content":"æ•´ç†ä¸‰æ¬¾æµè¡Œçš„å†…ç½‘ç©¿é€å·¥å…·ï¼Œfrpã€å¼€æºã€‘ï¼Œnpsã€å¼€æºã€‘ï¼Œngrokã€åŸºç¡€ç‰ˆå…è´¹ã€‘ï¼Œå‰ä¸¤æ¬¾å±äºå¼€æºäº§å“ï¼Œéœ€è¦è‡ªè¡Œæ­å»ºï¼Œngrokå±äºä»˜è´¹äº§å“ï¼Œä½†æ˜¯åŸºç¡€ç‰ˆï¼Œç™½å«–çš„è¶³å¤Ÿç”¨äº†.:smile: ","date":"2021-10-21","objectID":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/:0:0","tags":["å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€å·¥å…·","uri":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"categories":["Linux"],"content":"frp A fast reverse proxy to help you expose a local server behind a NAT or firewall to the internet. frp æ˜¯ä¸€ä¸ªä¸“æ³¨äºå†…ç½‘ç©¿é€çš„é«˜æ€§èƒ½çš„åå‘ä»£ç†åº”ç”¨ï¼Œæ”¯æŒ TCPã€UDPã€HTTPã€HTTPS ç­‰å¤šç§åè®®ã€‚å¯ä»¥å°†å†…ç½‘æœåŠ¡ä»¥å®‰å…¨ã€ä¾¿æ·çš„æ–¹å¼é€šè¿‡å…·æœ‰å…¬ç½‘ IP èŠ‚ç‚¹çš„ä¸­è½¬æš´éœ²åˆ°å…¬ç½‘ã€‚ frpæ¶æ„å›¾ï¼š :warning:frpå¦‚æœæƒ³å¤–ç½‘è®¿é—®ï¼Œéœ€è¦å¸¦æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨æ‰å¯ä»¥ï¼Œå¦å¤–éœ€è¦å®‰å…¨ç»„æ”¾è¡Œç›¸åº”çš„ç«¯å£ï¼Œè¦ä¸ç„¶å—å±æ²¡æ³•æ­£å¸¸è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨ï¼Œå»ºè®®ä½¿ç”¨ä¸‹é¢è¦ä»‹ç»çš„ngrokã€‚ åºŸè¯å°‘è¯´ï¼Œæƒ³è¦äº†è§£æ›´å¤šå¯ä»¥å»GayHubä»“åº“è¯¦ç»†äº†è§£ï¼Œä¸‹é¢å¼€å§‹å¿«é€Ÿå®‰è£…æ­¥éª¤ï¼š # frpå®˜æ–¹releaseä»“åº“ï¼šhttps://github.com/fatedier/frp/releases # æœåŠ¡ç«¯frpså®¢æˆ·ç«¯frpcäºŒè¿›åˆ¶åŒ…éƒ½åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥ä¸‹é¢çš„æ­¥éª¤åŸºæœ¬ä¸€æ · $ wget https://github.com/fatedier/frp/releases/download/v0.37.1/frp_0.37.1_linux_amd64.tar.gz $ tar xf frp_0.37.1_linux_amd64.tar.g \u0026\u0026 cd frp_0.37.1_linux_amd64 ä»¥ä¸‹åˆ—ä¸¾æˆ‘å¸¸ç”¨çš„æœåŠ¡å™¨ç«¯ä»¥åŠå®¢æˆ·ç«¯é…ç½®ã€ä»¥åæœ‰å¢åŠ ä¼šæ›´æ–°ã€‘ï¼š é€šè¿‡RDPè®¿é—®å†…ç½‘Windowsä¸»æœº # --- server # frps.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] bind_port = 7000 # ç»‘å®šçš„ç«¯å£ token = X56Fdsfx # ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹ï¼Œè¦ä¿è¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¸€è‡´ dashboard_port = 7500 # é¢æ¿ # dashboard ç”¨æˆ·åå¯†ç ï¼Œé»˜è®¤éƒ½ä¸º admin dashboard_user = admin dashboard_pwd = admin # --- client # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x # å…¬ç½‘IPåœ°å€ server_port = 7000 # ä¸æœåŠ¡å™¨ç«¯çš„`bind_port`åœ°å€ä¸€è‡´ token = X56Fdsfx # ç”¨äºèº«ä»½éªŒè¯ï¼Œè¯·è‡ªè¡Œä¿®æ”¹ï¼Œè¦ä¿è¯æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¸€è‡´ [rdp] # è¿™é‡Œé¢å¡«çš„æ—¶è¿æ¥åç§°ï¼Œå¯ä»¥åœ¨dashboardä¸­ç›´è§‚çš„åˆ†è¾¨å‡ºä½ æ‰€ç©¿é€çš„æœåŠ¡ type = tcp local_ip = 127.0.0.1 local_port = 3389 remote_port = 6000 :v: éªŒè¯RDPè¿œç¨‹è®¿é—®å†…ç½‘Windowsæœºå™¨ï¼šéšä¾¿æ‰¾ä¸ªRDPå®¢æˆ·ç«¯å·¥å…·ï¼Œä½¿ç”¨\u003cPUBLIC_IP\u003e:6000è¿æ¥å³å¯ã€‚ :information_source:å°æŠ€å·§ï¼š ' é’ˆå¯¹äºWindowsï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†frpæ·»åŠ ä¸ºå¼€æœºå¯åŠ¨é¡¹ï¼Œæˆ–è€…æ³¨å†Œä¸ºæœåŠ¡ã€‚ # æ·»åŠ ä¸ºå¼€æœºå¯åŠ¨é¡¹ ' æ–‡ä»¶åä¸ºï¼šstart_frpc.vbsï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š CreateObject(\"WScript.Shell\").Run \"\"\"D:\\frp_windows_amd64\\frpc.exe\"\"\" \u0026 \"-c\" \u0026 \"\"\"D:\\frp_windows_amd64\\frpc.ini\"\"\",0 ' å°†è¯¥æ–‡ä»¶æ”¾åˆ°ï¼šC:\\Users\\\u003cUSER_NAME\u003e\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startupæ–‡ä»¶å¤¹é‡Œé¢å³å¯ã€‚ # æ³¨å†Œä¸ºæœåŠ¡ ' ä¸‹è½½ä¸€ä¸ªnssmå·¥å…·å‚»ç“œå¼æ³¨å†ŒæœåŠ¡ï¼Œç„¶åå°†æœåŠ¡ç±»å‹æ”¹ä¸ºè‡ªå¯åŠ¨å³å¯ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘å°±ç•¥è¿‡ä¸è¯¦ç»†è®²äº†. é€šè¿‡SSHè®¿é—®å†…ç½‘æœºå™¨ï¼ˆå…¶å®å’ŒRDPå·®ä¸å¤šï¼Œå°±ä¸åšè§£é‡Šäº†ï¼‰ # --- server # frps.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] bind_port = 7000 # --- client # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x server_port = 7000 [ssh] type = tcp local_ip = 127.0.0.1 local_port = 22 remote_port = 6000 :v: éªŒè¯SSHè®¿é—®å†…ç½‘æœºå™¨ï¼š $ ssh -oPort=6000 \u003cUSER_NAME\u003e@\u003cPUBLIC_IP\u003e # å¦‚ssh -oPort=6000 agou-ops@69.42.6.43 frp ä¼šå°†è¯·æ±‚ \u003cPUBLIC_IP\u003e:6000 çš„æµé‡è½¬å‘åˆ°å†…ç½‘æœºå™¨çš„22ç«¯å£ã€‚ :warning:ä½¿ç”¨ä¸Šé¢çš„æœåŠ¡ç›´æ¥å°†SSHæš´éœ²äºå…¬ç½‘ä¹‹ä¸­çŠ¹å¦‚è£¸å¥”ï¼Œå®‰å…¨éšæ‚£æé«˜ï¼Œä½¿ç”¨ stcp(secret tcp) ç±»å‹çš„ä»£ç†å¯ä»¥é¿å…è®©ä»»ä½•äººéƒ½èƒ½è®¿é—®åˆ°è¦ç©¿é€çš„æœåŠ¡ï¼Œä½†æ˜¯è®¿é—®è€…ä¹Ÿéœ€è¦è¿è¡Œå¦å¤–ä¸€ä¸ª frpc å®¢æˆ·ç«¯ã€‚å…¶é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š # --- server # frps.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] bind_port = 7000 # --- client # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x server_port = 7000 [secret_ssh] type = stcp # åªæœ‰ sk ä¸€è‡´çš„ç”¨æˆ·æ‰èƒ½è®¿é—®åˆ°æ­¤æœåŠ¡ sk = abcdefg local_ip = 127.0.0.1 local_port = 22 # --- clientï¼Œæƒ³è¦è®¿é—®å†…ç½‘sshçš„å®¢æˆ·ç«¯ä¹Ÿéœ€è¦å¯åŠ¨frpc # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x server_port = 7000 [secret_ssh_visitor] type = stcp # stcp çš„è®¿é—®è€… role = visitor # è¦è®¿é—®çš„ stcp ä»£ç†çš„åå­— server_name = secret_ssh sk = abcdefg # ç»‘å®šæœ¬åœ°ç«¯å£ç”¨äºè®¿é—® SSH æœåŠ¡ bind_addr = 127.0.0.1 bind_port = 6000 :v:éªŒè¯ï¼šè®¿é—®æœ¬åœ°6000ç«¯å£å³å¯å†…ç½‘ç©¿é€åˆ°æˆ‘ä»¬æ‰€éœ€çš„å¦ä¸€å°å†…ç½‘å®¢æˆ·ç«¯æœºå™¨. ä½¿ç”¨ä»¥ä¸Šç±»å‹stcpçš„æµé‡ä¼šé€šè¿‡æœåŠ¡å™¨ï¼Œå¦‚æœå¸Œæœ›ä¼ è¾“å¤§é‡æ•°æ®ä¸”æµé‡ä¸ç»è¿‡æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ç‚¹å¯¹ç‚¹å†…ç½‘ç©¿é€xctpï¼Œè¿™é‡Œæˆ‘å°±ä¸è¿‡å¤šä»‹ç»ï¼Œæ„Ÿå…´è¶£æˆ–è€…æœ‰éœ€è¦çš„å¯ä»¥å»äº†è§£äº†è§£ã€‚ é€šè¿‡WEBè®¿é—®å†…ç½‘ç½‘ç«™æœåŠ¡ # --- server # frps.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] bind_port = 7000 vhost_http_port = 8080 # --- client # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x server_port = 7000 [web] type = http local_port = 80 custom_domains = agou-ops.cn [web2] type = http local_port = 8080 custom_domains = agou-ops.cn # ã€å¯é€‰ã€‘ä»¥ä¸‹ä¸ºå°†æœ¬åœ°httpæœåŠ¡è½¬æ¢ä¸ºhttpsæœåŠ¡å¹¶å¯¹å¤–æä¾›çš„æ’ä»¶é…ç½® # ----------------------------- plugin = https2http plugin_local_addr = 127.0.0.1:80 # HTTPS è¯ä¹¦ç›¸å…³çš„é…ç½® plugin_crt_path = ./server.crt plugin_key_path = ./server.key plugin_host_header_rewrite = 127.0.0.1 plugin_header_X-From-Where = frp # ----------------------------- :v: éªŒè¯å¤–ç½‘è®¿é—®å†…ç½‘WEBï¼š å°† agou-ops.cn å’Œ agou-ops.cn çš„åŸŸå A è®°å½•è§£æåˆ° IP x.x.x.xï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»æœ‰å¯¹åº”çš„åŸŸåï¼Œä¹Ÿå¯ä»¥å°† CNAME è®°å½•è§£æåˆ°æœåŠ¡å™¨åŸå…ˆçš„åŸŸåã€‚æˆ–è€…å¯ä»¥é€šè¿‡ä¿®æ”¹ HTTP è¯·æ±‚çš„ Host å­—æ®µæ¥å®ç°åŒæ ·çš„æ•ˆæœã€‚ é€šè¿‡æµè§ˆå™¨è®¿é—® http://agou-ops.cn:8080 å³å¯è®¿é—®åˆ°å¤„äºå†…ç½‘æœºå™¨ä¸Š 80 ç«¯å£çš„æœåŠ¡ï¼Œè®¿é—® http://agou-ops.cn:8080 åˆ™è®¿é—®åˆ°å†…ç½‘æœºå™¨ä¸Š 8080 ç«¯å£çš„æœåŠ¡ã€‚ å¤–ç½‘è®¿é—®å†…ç½‘æ–‡ä»¶ # --- server # frps.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] bind_port = 7000 # --- client # frpc.iniæ–‡ä»¶å†…å®¹å¦‚ä¸‹ [common] server_addr = x.x.x.x server_port = 7000 [test_static_file] type = tcp remote_port = 6000 plugin = static_file # è¦å¯¹å¤–æš´éœ²çš„æ–‡ä»¶ç›®å½• plugin_local_path = /tmp/file # ç”¨æˆ·è®¿é—® URL ä¸­ä¼šè¢«å»é™¤çš„å‰ç¼€ï¼Œä¿ç•™çš„å†…å®¹å³ä¸ºè¦è®¿é—®çš„æ–‡ä»¶è·¯å¾„ plugin_strip_prefix = static plugin_http_user = abc plugin_http_passwd = abc :v: éªŒè¯å¤–ç½‘è®¿é—®å†…ç½‘æŒ‡å®šç›®å½•ï¼šé€šè¿‡æµè§ˆå™¨è®¿é—® http://x.x.x.x:6000/static/ æ¥æŸ¥çœ‹ä½äº/tmp/fileç›®å½•ä¸‹","date":"2021-10-21","objectID":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/:1:0","tags":["å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€å·¥å…·","uri":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"categories":["Linux"],"content":"nps npsæ˜¯ä¸€æ¬¾è½»é‡çº§ã€é«˜æ€§èƒ½ã€åŠŸèƒ½å¼ºå¤§çš„å†…ç½‘ç©¿é€ä»£ç†æœåŠ¡å™¨ã€‚ç›®å‰æ”¯æŒtcpã€udpæµé‡è½¬å‘ï¼Œå¯æ”¯æŒä»»ä½•tcpã€udpä¸Šå±‚åè®®ï¼ˆè®¿é—®å†…ç½‘ç½‘ç«™ã€æœ¬åœ°æ”¯ä»˜æ¥å£è°ƒè¯•ã€sshè®¿é—®ã€è¿œç¨‹æ¡Œé¢ï¼Œå†…ç½‘dnsè§£æç­‰ç­‰â€¦â€¦ï¼‰ï¼Œæ­¤å¤–è¿˜æ”¯æŒå†…ç½‘httpä»£ç†ã€å†…ç½‘socks5ä»£ç†ã€p2pç­‰ï¼Œå¹¶å¸¦æœ‰åŠŸèƒ½å¼ºå¤§çš„webç®¡ç†ç«¯ã€‚ åŒæ ·ï¼Œç›´æ¥å¿«é€Ÿå¼€å§‹ï¼Œä¸è¿‡å¤šä»‹ç»ï¼š # npsçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯åˆ†ç¦»å¼€çš„ï¼Œéœ€è¦åˆ†åˆ«å•ç‹¬ä¸‹è½½ # æœåŠ¡ç«¯ $ wget https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_server.tar.gz $ tar xf linux_amd64_server.tar.gz $ sudo mv nps /usr/local/bin # è‡ªå·±åšè½¯è¿æ¥ä¹Ÿå¯ä»¥ # å®¢æˆ·ç«¯ $ wget https://github.com/ehang-io/nps/releases/download/v0.26.10/linux_amd64_client.tar.gz $ tar xf linux_amd64_client.tar.gz $ sudo mv npc /usr/local/bin å®‰è£…ä¸å¯åŠ¨æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥æœåŠ¡ç«¯ï¼š # æœåŠ¡ç«¯ $ nps install # å®‰è£…ï¼Œè¯¥å‘½ä»¤å®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªconfç›®å½•å’Œä¸€ä¸ªwebç›®å½•ï¼Œæ–‡ä»¶ç”¨é€”æ˜¾è€Œæ˜“è§ # æœåŠ¡ç«¯é…ç½®æ–‡ä»¶éœ€è¦ä¿®æ”¹çš„ä¸œè¥¿å¾ˆå°‘ï¼ŒæŒ‰éœ€è¿›è¡Œè°ƒæ•´å³å¯ï¼Œç»ˆç«¯è·å–å…¬ç½‘ipå¯ä»¥ä½¿ç”¨curl ifconfig.meæˆ–è€…curl ip.cip.ccç­‰æ¥å£è·å–ã€‚ $ sed -i 's/web_host=.*/web_host=\u003cYOUR_PUBLIC_IP\u003e/' nps.conf $ nps start # å¯åŠ¨ # å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯ $ npc -server=\u003cYOUR_PUBLIC_IP\u003e:8024 -vkey=\u003cå®¢æˆ·ç«¯çš„å¯†é’¥\u003e # è¿™ä¸ª8024ç«¯å£å¯¹åº”serverç«¯`nps.conf`ä¸­çš„bridge_portå‚æ•° åœæ­¢å’Œé‡å¯å¯ç”¨ï¼Œstopå’Œrestart å¦‚æœå‘ç°æ²¡æœ‰å¯åŠ¨æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨nps(.exe) stopï¼Œç„¶åè¿è¡Œnps.(exe)è¿è¡Œè°ƒè¯•ï¼Œæˆ–æŸ¥çœ‹æ—¥å¿—(Windowsæ—¥å¿—æ–‡ä»¶ä½äºå½“å‰è¿è¡Œç›®å½•ä¸‹ï¼Œlinuxå’Œdarwinä½äº/var/log/nps.log) è®¿é—®æœåŠ¡ç«¯ip:webæœåŠ¡ç«¯å£ï¼ˆé»˜è®¤ä¸º8080ï¼‰ ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»é™†ï¼ˆé»˜è®¤admin/123ï¼Œæ­£å¼ä½¿ç”¨ä¸€å®šè¦æ›´æ”¹ï¼‰ åˆ›å»ºå®¢æˆ·ç«¯ å®¢æˆ·ç«¯å¯†é’¥å¯ä»¥ä»webé¡µé¢ä¸­è·å–ï¼š ä¸Šå›¾ä¹Ÿæ˜¯æ–°å»ºå®¢æˆ·ç«¯çš„æ­¥éª¤ï¼ˆè¯´æ˜¯æ­¥éª¤ï¼ŒåŸºæœ¬æ˜¯æ²¡æœ‰ï¼Œxdï¼‰ã€‚ æ–°å»ºå®Œå®¢æˆ·ç«¯ä¹‹åå°±å¯ä»¥å»ºç«‹éš§é“è¿æ¥äº†ï¼Œè¿™é‡Œä»¥HTTPæœåŠ¡ä¸ºä¾‹ï¼š å‚»ç“œå¼é…ç½®ï¼Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œå®¢æˆ·ç«¯IDå³ä¸ºä½ ä¸Šé¢åˆ›å»ºçš„é‚£ä¸ªï¼Œå¯ä»¥å»å®¢æˆ·ç«¯é¡µé¢ä¸­è¿›è¡ŒæŸ¥çœ‹ã€‚ :v:éªŒè¯ï¼šè®¿é—®å…¬ç½‘çš„9090ç«¯å£ï¼Œå³è®¿é—®çš„æ˜¯å†…ç½‘æŒ‡å®šIPå’Œç«¯å£çš„åº”ç”¨ã€‚ é™„ï¼šnps.confé…ç½®æ–‡ä»¶åç§°åŠå«ä¹‰ï¼ˆæ¥è‡ªå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š åç§° å«ä¹‰ web_port webç®¡ç†ç«¯å£ web_password webç•Œé¢ç®¡ç†å¯†ç  web_username webç•Œé¢ç®¡ç†è´¦å· web_base_url webç®¡ç†ä¸»è·¯å¾„,ç”¨äºå°†webç®¡ç†ç½®äºä»£ç†å­è·¯å¾„åé¢ bridge_port æœåŠ¡ç«¯å®¢æˆ·ç«¯é€šä¿¡ç«¯å£ https_proxy_port åŸŸåä»£ç†httpsä»£ç†ç›‘å¬ç«¯å£ http_proxy_port åŸŸåä»£ç†httpä»£ç†ç›‘å¬ç«¯å£ auth_key web apiå¯†é’¥ bridge_type å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥æ–¹å¼kcpæˆ–tcp public_vkey å®¢æˆ·ç«¯ä»¥é…ç½®æ–‡ä»¶æ¨¡å¼å¯åŠ¨æ—¶çš„å¯†é’¥ï¼Œè®¾ç½®ä¸ºç©ºè¡¨ç¤ºå…³é—­å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶è¿æ¥æ¨¡å¼ ip_limit æ˜¯å¦é™åˆ¶ipè®¿é—®ï¼Œtrueæˆ–falseæˆ–å¿½ç•¥ flow_store_interval æœåŠ¡ç«¯æµé‡æ•°æ®æŒä¹…åŒ–é—´éš”ï¼Œå•ä½åˆ†é’Ÿï¼Œå¿½ç•¥è¡¨ç¤ºä¸æŒä¹…åŒ– log_level æ—¥å¿—è¾“å‡ºçº§åˆ« auth_crypt_key è·å–æœåŠ¡ç«¯authKeyæ—¶çš„aesåŠ å¯†å¯†é’¥ï¼Œ16ä½ p2p_ip æœåŠ¡ç«¯Ipï¼Œä½¿ç”¨p2pæ¨¡å¼å¿…å¡« p2p_port p2pæ¨¡å¼å¼€å¯çš„udpç«¯å£ pprof_ip debug pprof æœåŠ¡ç«¯ip pprof_port debug pprof ç«¯å£ disconnect_timeout å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶ï¼Œå•ä½ 5sï¼Œé»˜è®¤å€¼ 60ï¼Œå³ 300s = 5mins ","date":"2021-10-21","objectID":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/:2:0","tags":["å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€å·¥å…·","uri":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"categories":["Linux"],"content":"ngrok é¦–å…ˆæ³¨å†Œä¸€ä¸ªngrokè´¦å·ï¼Œå®˜ç½‘åœ°å€ï¼Œæ³¨å†Œç™»å½•ä¹‹åä¼šè·³è½¬ä¸€ä¸ªå¿«é€Ÿå¼€å§‹é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå®‰è£…å¯¹åº”æ“ä½œç³»ç»ŸåŠæ¶æ„çš„äºŒè¿›åˆ¶åŒ…å³å¯ä½¿ç”¨ï¼š å®˜ç½‘è®²çš„å¾ˆè¯¦ç»†ï¼Œè¿™é‡Œæˆ‘å°±ç®€å•çš„æŠŠè¦ä½¿ç”¨çš„å‘½ä»¤ç½—åˆ—å‡ºæ¥ï¼Œæ–¹ä¾¿ä½¿ç”¨ï¼š # è¿™é‡Œä»¥linuxç³»ç»Ÿä¸ºä¾‹ $ wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip $ unzip ngrok-stable-linux-amd64.zip $ sudo mv ngrok /usr/local/bin # éªŒè¯ngrokæ˜¯å¦æˆåŠŸå®‰è£… $ ngrok version ngrok version 2.3.40 # è·å–ä½ çš„tokenï¼Œhttps://dashboard.ngrok.com/get-started/your-authtoken $ ngrok authtoken \u003cYOUR_TOKEN_HERE\u003e # è¯¥å‘½ä»¤æ‰§è¡Œä¹‹åä¼šåœ¨ç”¨æˆ·å®¶ç›®å½•ç”Ÿæˆä¸€ä¸ªtokenæ–‡ä»¶ï¼Œè·¯å¾„ä¸º~/.ngrok2/ngrok.yml è¿™é‡Œæˆ‘éšä¾¿èµ·ä¸ªwebæœåŠ¡ï¼Œä»¥æˆ‘çš„åšå®¢hugoä¸ºä¾‹ï¼š $ cd myWeb/myBlog \u0026\u0026 hugo server # hugoé»˜è®¤ä¼šç›‘å¬åœ¨æœ¬åœ°localhost:1313ç«¯å£ # å¯ç”¨ä¸€ä¸ªhttpéš§é“æ¥å¤–ç½‘è¿œç¨‹è®¿é—®æœ¬åœ°åšå®¢ $ ngrok http 1313 å¯ä»¥çœ‹åˆ°ngrokæœåŠ¡å·²ç»æ­£å¸¸è¿è¡Œï¼Œè€Œä¸”ç»™å‡ºäº†è¿œç¨‹è®¿é—®çš„httpåœ°å€å’Œhttpsåœ°å€ï¼Œå¤åˆ¶åˆ°æµè§ˆå™¨å³å¯å¤–ç½‘è¿œç¨‹è®¿é—®æœ¬åœ°webæœåŠ¡. æ­¤å¤–ï¼Œngrokè¿˜å†…ç½®äº†ä¸€ä¸ªwebæ¥å£ï¼Œå³å›¾ä¸Šçš„Web Interfaceï¼Œé»˜è®¤åœ°å€æ˜¯http://127.0.0.1:4040 å¯ä»¥çœ‹åˆ°ngrokçš„ä¸€äº›çŠ¶æ€ä»¥åŠä¸€äº›å¯¹èµ„æºçš„åˆ†æå†…å®¹ã€‚ æ€»ä¹‹ï¼Œngrokéå¸¸çš„æ–¹ä¾¿æ˜“ç”¨ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯æ— éœ€è‡ªå¤‡æœåŠ¡å™¨ï¼Œå¼€ç®±å³ç”¨ï¼Œngrokè¿˜æä¾›æœ‰å…¶ä»–å¢å¼ºå‹åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªå®šä¹‰åŸŸåã€IPé»‘ç™½åå•ã€éš§é“å®¢æˆ·ç«¯ã€TLSã€IPè§„åˆ™ç­‰ç­‰ï¼Œä½†è¿™äº›éƒ½æ˜¯ä»˜è´¹å†…å®¹ï¼Œæƒ³ç™½å«–çš„å°±åˆ«æƒ³äº†. :laughing: ","date":"2021-10-21","objectID":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/:3:0","tags":["å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€å·¥å…·","uri":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"categories":["Linux"],"content":"å‚è€ƒé“¾æ¥ frp GitHub repo: https://github.com/fatedier/frp nps GitHub repo: https://github.com/ehang-io/nps ngrok Offical website: https://ngrok.com/ ","date":"2021-10-21","objectID":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/:4:0","tags":["å†…ç½‘ç©¿é€"],"title":"å†…ç½‘ç©¿é€å·¥å…·","uri":"/myBlog-2/post/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"},{"categories":["vim","Ubuntu"],"content":"é»˜è®¤ç›´æ¥é€šè¿‡aptæˆ–è€…apt-getå®‰è£…çš„vimåŠŸèƒ½ä¸å…¨ï¼Œç¼ºå°‘clipboardåŠŸèƒ½ï¼ŒåŸå› æ˜¯debianå®˜æ–¹ä¸ºäº†å…¼å®¹æ€§æ‰å¦‚æ­¤è€ƒè™‘ï¼Œä½†debianå®˜æ–¹ä¹ŸåŒæ ·æä¾›äº†ä»¥ä¸‹å‡ ä¸ªåŒ…æ¥æ»¡è¶³GUIéœ€æ±‚ï¼š vim-athena Vi IMproved - enhanced vi editor - with Athena GUI vim-gtk Vi IMproved - enhanced vi editor - with GTK2 GUI vim-gtk3 Vi IMproved - enhanced vi editor - with GTK3 GUI å¯ä»¥ç›´æ¥é€šè¿‡apt install \u003cPackage_name\u003eæ¥å®‰è£…ä»¥ä¸ŠåŒ…æ¥ç›´æ¥ä½¿ç”¨ã€‚ ä½†æ˜¯æˆ‘æ„Ÿè§‰åŠŸèƒ½è¿˜æ˜¯ä¸å¤Ÿå…¨é¢ï¼Œå› æ­¤ä¸‹é¢æˆ‘ç®€å•ä»‹ç»é€šè¿‡ç¼–è¯‘æ¥å®‰è£…å¸¦æœ‰X-Window Clipboardæ¨¡å—çš„vimï¼š ","date":"2021-08-17","objectID":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/:0:0","tags":["vim","ç¼–è¯‘","clipboard"],"title":"æ‰‹åŠ¨ç¼–è¯‘vimå¢åŠ X Windows ClipboardåŠŸèƒ½æ¨¡å—","uri":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/"},{"categories":["vim","Ubuntu"],"content":"ç¼–è¯‘ç¯å¢ƒ å®‰è£…ç¼–è¯‘ç¯å¢ƒï¼š $ sudo apt install -y build-essential # å®‰è£…ç¼–è¯‘åŒ…ç»„ # å…¶ä»–å¿…è¦è½¯ä»¶åŒ… $ sudo apt install -y libxt-dev libgtk-3-dev \\ libpython3-dev \\ # å¦‚æœè¦æ·»åŠ python3æ”¯æŒï¼Œéœ€è¦é¢å¤–å®‰è£…æ­¤åŒ… libtool libtool-bin \\ # ç¼–è¯‘æ—¶å¯èƒ½å› æ²¡æœ‰libtoolè€ŒæŠ¥é”™ libncurses5-dev libgnome2-dev libgnomeui-dev libgtk2.0-dev libatk1.0-dev libbonoboui2-dev libcairo2-dev libx11-dev libxpm-dev libxt-dev # å…¶ä»–é¢å¤–å¯èƒ½ç”¨åˆ°çš„åŒ… ","date":"2021-08-17","objectID":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/:1:0","tags":["vim","ç¼–è¯‘","clipboard"],"title":"æ‰‹åŠ¨ç¼–è¯‘vimå¢åŠ X Windows ClipboardåŠŸèƒ½æ¨¡å—","uri":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/"},{"categories":["vim","Ubuntu"],"content":"ç¼–è¯‘å®‰è£…vim æ‹‰å–ä»“åº“æœ€æ–°æºç åŒ…ï¼š $ git clone https://github.com/vim/vim.git è¿›å…¥ç›¸å…³ç›®å½•ï¼šcd vim/src åœ¨ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š $ ./configure \\ --enable-cscope \\ --with-features=huge \\ --with-x \\ --with-compiledby=\"AGou-ops\u003cAGou-ops@foxmail.com\u003e\" å…¶ä»–è¯¦ç»†ç¼–è¯‘é€‰é¡¹åŠè¯´æ˜å‚è€ƒï¼šVIM INSTALL file ç¼–è¯‘ç›´æ¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š $ make -j4 # -jè¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œçœ‹ä¸ªäººCPUæ ¸å¿ƒæ•°è€Œå®š ç¼–è¯‘å®Œæˆä¹‹åä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆç›¸å…³äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ­¤æ—¶æ£€æŸ¥vimç¼–è¯‘çš„å„é¡¹å‚æ•°ï¼š $ ./vim --version VIM - Vi IMproved 8.2 (2019 Dec 12, compiled Aug 17 2021 14:03:35) Included patches: 1-3356 Compiled by AGou-ops\u003cAGou-ops@foxmail.com\u003e Huge version with GTK3 GUI. Features included (+) or not (-): +acl +file_in_path +mouse_urxvt -tag_any_white +arabic +find_in_path +mouse_xterm -tcl +autocmd +float +multi_byte +termguicolors +autochdir +folding +multi_lang +terminal -autoservername -footer -mzscheme +terminfo +balloon_eval +fork() +netbeans_intg +termresponse +balloon_eval_term -gettext +num64 +textobjects +browse -hangul_input +packages +textprop ++builtin_terms +iconv +path_extra +timers +byte_offset +insert_expand -perl +title +channel +ipv6 +persistent_undo +toolbar +cindent +job +popupwin +user_commands +clientserver +jumplist +postscript +vartabs +clipboard +keymap +printer +vertsplit +cmdline_compl +lambda +profile +virtualedit +cmdline_hist +langmap -python +visual +cmdline_info +libcall -python3 +visualextra +comments +linebreak +quickfix +viminfo +conceal +lispindent +reltime +vreplace +cryptv +listcmds +rightleft +wildignore +cscope +localmap -ruby +wildmenu +cursorbind -lua +scrollbind +windows +cursorshape +menu +signs +writebackup +dialog_con_gui +mksession +smartindent +X11 +diff +modify_fname -sodium -xfontset +digraphs +mouse -sound +xim +dnd +mouseshape +spell -xpm -ebcdic +mouse_dec +startuptime +xsmp_interact +emacs_tags -mouse_gpm +statusline +xterm_clipboard +eval -mouse_jsbterm -sun_workshop -xterm_save +ex_extra +mouse_netterm +syntax +extra_search +mouse_sgr +tag_binary -farsi -mouse_sysmouse -tag_old_static system vimrc file: \"$VIM/vimrc\" user vimrc file: \"$HOME/.vimrc\" 2nd user vimrc file: \"~/.vim/vimrc\" user exrc file: \"$HOME/.exrc\" system gvimrc file: \"$VIM/gvimrc\" user gvimrc file: \"$HOME/.gvimrc\" 2nd user gvimrc file: \"~/.vim/gvimrc\" defaults file: \"$VIMRUNTIME/defaults.vim\" system menu file: \"$VIMRUNTIME/menu.vim\" fall-back for $VIM: \"/usr/local/share/vim\" Compilation: gcc -c -I. -Iproto -DHAVE_CONFIG_H -DFEAT_GUI_GTK -pthread -I/usr/include/gtk-3.0 -I/usr/include/at-spi2-atk/2.0 -I/usr/include/at-spi-2.0 -I/usr/include/dbus-1.0 -I/usr/lib/x86_64-linux-gnu/dbus-1.0/include -I/usr/include/gtk-3.0 -I/usr/include/gio-unix-2.0 -I/usr/include/cairo -I/usr/include/pango-1.0 -I/usr/include/fribidi -I/usr/include/harfbuzz -I/usr/include/atk-1.0 -I/usr/include/cairo -I/usr/include/pixman-1 -I/usr/include/uuid -I/usr/include/freetype2 -I/usr/include/libpng16 -I/usr/include/gdk-pixbuf-2.0 -I/usr/include/libmount -I/usr/include/blkid -I/usr/include/glib-2.0 -I/usr/lib/x86_64-linux-gnu/glib-2.0/include -g -O2 -U_FORTIFY_SOURCE -D_FORTIFY_SOURCE=1 Linking: gcc -L/usr/local/lib -Wl,--as-needed -o vim -lgtk-3 -lgdk-3 -lpangocairo-1.0 -lpango-1.0 -lharfbuzz -latk-1.0 -lcairo-gobject -lcairo -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lglib-2.0 -lSM -lICE -lXt -lX11 -lXdmcp -lSM -lICE -lm -ltinfo -lselinux -ldl å˜¶~æœ‰ç‚¹å¤š:joy: ï¼Œæˆ‘ä»¬åªçœ‹æˆ‘ä»¬æƒ³è¦çš„clipboardæ¨¡å—ï¼š $ ./vim --version | grep clipboard +clipboard +keymap +printer +vertsplit +emacs_tags -mouse_gpm +statusline +xterm_clipboard ä¸»è¦çœ‹+clipboardå’Œ+xterm_clipboard å‰é¢æ˜¯å¦æœ‰+ï¼Œé»˜è®¤aptç›´æ¥å®‰è£…çš„vimæ˜¾ç¤ºçš„æ˜¯-ï¼Œå³è¡¨ç¤ºæœªç¼–è¯‘å®‰è£…æ­¤æ¨¡å—ã€‚ é£’ï¼Œæ‰§è¡Œæœ€åçš„å®‰è£…æ­¥éª¤ï¼š $ sudo make install æ‰§è¡Œå®Œè¯¥å‘½ä»¤ä¹‹åï¼Œç›´æ¥åœ¨ç»ˆç«¯ä½¿ç”¨vimå‘½ä»¤å³å¯ä½“éªŒæ–°ç‰¹æ€§åŠè‡ªå·±ç¼–è¯‘å®‰è£…å¥½çš„X-Window Clipboardæ¨¡å—ï¼Œyeahï¼ ","date":"2021-08-17","objectID":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/:2:0","tags":["vim","ç¼–è¯‘","clipboard"],"title":"æ‰‹åŠ¨ç¼–è¯‘vimå¢åŠ X Windows ClipboardåŠŸèƒ½æ¨¡å—","uri":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/"},{"categories":["vim","Ubuntu"],"content":"æœ€å ç¼–è¯‘å®‰è£…vimå‰ï¼Œå»ºè®®å…ˆå¸è½½æ‰åŸæ¥ç‰ˆæœ¬çš„vimå†è¿›è¡Œç¼–è¯‘å®‰è£…ï¼ˆsudo apt remove vim -yï¼‰ï¼Œå¦‚æœä½ æ²¡æœ‰æå‰å¸è½½æ‰åŸæ¥çš„vimï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ¥ç”¨æ–°ç‰ˆæœ¬vimæ›¿æ¢æ—§ç‰ˆæœ¬vimï¼š sudo update-alternatives --install \"/usr/bin/vim\" \"vim\" \"/usr/local/bin/vim\" 1 sudo update-alternatives --install \"/usr/bin/vi\" \"vi\" \"/usr/local/bin/vim\" 1 sudo update-alternatives --config vim sudo update-alternatives --config vi sudo update-alternatives --config gvim ä½¿ç”¨ls -lah /usr/bin/vimæ¥æ£€æŸ¥æ–°vimæ˜¯å¦ç”Ÿæ•ˆã€‚ ","date":"2021-08-17","objectID":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/:3:0","tags":["vim","ç¼–è¯‘","clipboard"],"title":"æ‰‹åŠ¨ç¼–è¯‘vimå¢åŠ X Windows ClipboardåŠŸèƒ½æ¨¡å—","uri":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/"},{"categories":["vim","Ubuntu"],"content":"å‚è€ƒé“¾æ¥ Github gist: https://gist.github.com/lirenlin/63453cda5181028b2565 why-is-vim-for-debian-compiled-without-clipboard: https://vi.stackexchange.com/questions/13564/why-is-vim-for-debian-compiled-without-clipboard How to Copy Text to Clipboard in Vim: https://linoxide.com/copy-text-to-clipboard-in-vim/ ","date":"2021-08-17","objectID":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/:4:0","tags":["vim","ç¼–è¯‘","clipboard"],"title":"æ‰‹åŠ¨ç¼–è¯‘vimå¢åŠ X Windows ClipboardåŠŸèƒ½æ¨¡å—","uri":"/myBlog-2/post/%E6%89%8B%E5%8A%A8%E7%BC%96%E8%AF%91vim%E5%A2%9E%E5%8A%A0x-windows-clipboard%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97/"},{"categories":["Shell"],"content":"éœ€æ±‚ï¼šæ ¹æ®excelä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå°†excelè¿›è¡Œç®€å•å¤„ç†æˆcsvæ ¼å¼ï¼Œä½¿ç”¨sedã€awkç­‰ç»“åˆæ­£åˆ™å¯¹å›¾ç‰‡æ–‡ä»¶æŒ‰ç…§å¹´æœˆçš„æ ¼å¼æ¥è¿›è¡Œé‡æ–°å½’æ¡£å¹¶è¾“å‡ºç›¸å…³æ—¥å¿—ã€‚ ä»£ç å¦‚ä¸‹ï¼š ","date":"2021-08-11","objectID":"/myBlog-2/post/%E6%A0%B9%E6%8D%AEcsv%E9%87%8D%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6/:0:0","tags":["Shell"],"title":"æ ¹æ®csvé‡å½’æ¡£æ–‡ä»¶","uri":"/myBlog-2/post/%E6%A0%B9%E6%8D%AEcsv%E9%87%8D%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6/"},{"categories":["æ•…éšœ","æ¡Œé¢è¿ç»´"],"content":"ä»Šå¤©ç™½å¤©åŒäº‹é’‰é’‰ä¸Šè”ç³»æˆ‘ï¼Œè¯´ç”µè„‘æ— æ³•æ­£å¸¸å¼€æœºï¼Œçº¦å®šå¥½æ—¶é—´ä¹‹åï¼Œæˆ‘å»åˆ°è¯¥åŒäº‹å·¥ä½çœ‹äº†çœ‹ã€‚å…¶ç¡®åˆ‡æ•…éšœæ˜¯ç”µè„‘æŒ‰ä¸‹å¼€æœºé”®ä¹‹åæ— ä»»ä½•ååº”ï¼Œæ˜¾ç¤ºå™¨ä¸Šè¿å“ç‰Œlogoéƒ½ä¸æ˜¾ç¤ºã€‚æˆ‘çš„åˆæ­¥åˆ¤æ–­æ˜¯ï¼š æ˜¾ç¤ºå±æ˜¯å¦æœ‰é—®é¢˜ï¼Œæˆ–è€…æ˜¯ä¸æ˜¯HDMIçº¿æ¥è§¦ä¸è‰¯ï¼Ÿ ä¸»æ¿ä¸Šæ˜¾å¡æ˜¯ä¸æ˜¯æ¥è§¦ä¸è‰¯ï¼Ÿ é—®åŒäº‹å’Œè‡ªå·±äº²æ‰‹æ£€æŸ¥çº¿ä¹‹åæ’é™¤æ˜¾ç¤ºå±çš„é—®é¢˜ï¼Œéšåæ‹†æœºçœ‹äº†çœ‹æ˜¾å¡ï¼Œæ˜¾å¡æ˜¯å†…åµŒåœ¨ä¸»æ¿ä¸Šçš„ï¼Œæ²¡æœ‰ç‹¬ç«‹æ˜¾å¡ï¼Œæ‰€ä»¥å…ˆæš‚æ—¶æ’é™¤æ˜¾å¡çš„é—®é¢˜ã€‚æ¥ä¸‹æ¥å°†æ³¨æ„åŠ›è½¬ç§»åˆ°å†…å­˜æ¡ä¸Šé¢æ¥ï¼Œå¼ºåˆ¶å…³é—­ç”µè„‘å¹¶æ–­ç”µä¹‹åï¼Œé‡æ–°æ‹”æ’äº†å†…å­˜æ¡ç„¶åå¼€æœºï¼ŒæŒ‰ä¸‹ç”µæºé”®çŸ­æš‚æ˜¾ç¤ºlogoä¹‹åå°±æ²¡ååº”äº†ï¼Œå¼ºåˆ¶é‡å¯ä¹‹ålogoä¸æ˜¾ç¤ºï¼Œå°è¯•å°†å†…å­˜æ¡åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªæ’æ§½ä¹‹åï¼Œè¿˜æ˜¯ç›¸åŒçš„æ•…éšœã€‚ é€šè¿‡ç½‘ç«™æŸ¥è¯¢æ•…éšœä»¥åŠè”ç³»æˆ´å°”å”®åæŠ€æœ¯æ”¯æŒï¼Œæœ€ç»ˆè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ç”µè„‘å®Œå…¨æ–­ç”µå…³æœºä¹‹åï¼Œæ‹”æ‰ä¸‹å›¾ä¸­çš„è“è‰²JUMPè·³çº¿å¸½ï¼Œç„¶åæ¥ä¸Šç”µæºå¼€æœºï¼› å¼€æœºä¼šè‡ªåŠ¨è¿›å…¥BIOSè‡ªæ£€ï¼Œä¼šæç¤ºä¸€ä¸ªè­¦å‘Šä¿¡æ¯ï¼Œå†…å®¹ä¸ºè­¦å‘Šï¼Œä¸Šæ¬¡å¯åŠ¨æ—¶æœªæ£€æµ‹åˆ°å†…å­˜ï¼Œå®é™…æ„æ€å¤§æ¦‚å°±æ˜¯å†…å­˜æœ‰å˜åŠ¨ï¼Œä¸ç”¨ç®¡è¿™ä¸ªè­¦å‘Šï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥continueå³å¯ï¼› å¦‚è‹¥æœªæ’è·³çº¿å¸½ï¼Œæ¯æ¬¡å¼€æœºä¼šæç¤ºä»¥ä¸‹ä¿¡æ¯ï¼Œæ„æ€å¾ˆç®€å•ï¼Œå°±ä¸ç¿»è¯‘äº†ï¼› ç”µè„‘æ­£å¸¸å¼€æœºä¹‹åï¼Œå…³æœºå®Œå…¨æ–­ç”µï¼Œç„¶åå°†JUMPè“è‰²è·³çº¿å¸½æ¥å›åŸæ¥ä½ç½®ï¼Œåˆå¥½æœºç®±ï¼Œæ­£å¸¸å¼€æœºå³å¯ã€‚ ","date":"2021-07-26","objectID":"/myBlog-2/post/dell_unable_startup/:0:0","tags":["æ•…éšœ","ç¡¬ä»¶"],"title":"è®°æˆ´å°”å“ç‰Œæœºå¼€æœºé»‘å±æ— logoæ•…éšœ","uri":"/myBlog-2/post/dell_unable_startup/"},{"categories":["æ•…éšœ","æ¡Œé¢è¿ç»´"],"content":"æ€»ç»“ æ•…éšœå¤„ç†å¾ˆç®€å•ï¼ŒåŸå› å¯èƒ½æ˜¯å†…å­˜æ¡é‡‘æ‰‹æŒ‡æ¥è§¦ä¸è‰¯åŸå› å¯¼è‡´ï¼Œå­¦äº†ä¸€æ‰‹æ’æ‹”è·³çº¿å¸½æ“ä½œï¼Œé’ˆä¸æˆ³ã€‚ ","date":"2021-07-26","objectID":"/myBlog-2/post/dell_unable_startup/:1:0","tags":["æ•…éšœ","ç¡¬ä»¶"],"title":"è®°æˆ´å°”å“ç‰Œæœºå¼€æœºé»‘å±æ— logoæ•…éšœ","uri":"/myBlog-2/post/dell_unable_startup/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"å•Šï¼Œå¤šæƒ³å†ç»§ç»­å½“ä¸€åå­¦ç”Ÿï¼Œä½†æ˜¯å·²ç»ä¸å¯ä»¥äº†ã€‚ æ­¤æ¬¡ç¦»åˆ«ï¼Œä¸çŸ¥ä½•æ—¶å†è§ã€‚ function password() { var testV = 3; var pass1 = prompt('è¾“å…¥å¯†ç ä»¥å®Œæ•´è®¿é—®:', 'Type here...'); while (testV 0) { if (!pass1) history.go(-1); if (pass1 == \"agou-ops\") { alert('å¯†ç æ­£ç¡®!'); break; } var pass1 = prompt('å¯†ç é”™è¯¯ï¼ä½ è¿˜æœ‰'+testV+'æ¬¡æœºä¼š.'); testV += -1; } if (pass1 != \"agou-ops\" \u0026 testV == 0) window.alert(\"è®¿å®¢éª‚éª‚å’§å’§çš„èµ°å‡ºäº†ç°åœºã€‚\"); top.location.href=\"/\" return \" \"; } document.write(password()); æœ‹å‹ å·¦1æµ©å“¥ï¼Œå·¦2é¾™å°‘ï¼Œå³ä»£æŸ èˆå‹ å·¦1å§šå…„ï¼Œå·¦2æ½‡å¸…ï¼Œå·¦3æ¡€æ¡€ï¼Œä¸­ä¹æ€»ï¼Œå³1è¿é•¿ï¼Œå³2ä»£æŸ èˆå‹ å·¦1ä¹æ€»ï¼Œå·¦2æ½‡å¸…ï¼Œå·¦3å§šå…„ï¼Œå³1æ¡€æ¡€ï¼Œå³2è¿é•¿ï¼Œå³3ä»£æŸ åŒå­¦ å…¨ä½“åŒå­¦ ä»¥æ­¤çºªå¿µã€‚ ","date":"2021-06-28","objectID":"/myBlog-2/post/%E5%A4%A7%E5%AD%A6%E6%AF%95%E4%B8%9A/:0:1","tags":["æ—¥è®°"],"title":"å¤§å­¦æ¯•ä¸šã€‚","uri":"/myBlog-2/post/%E5%A4%A7%E5%AD%A6%E6%AF%95%E4%B8%9A/"},{"categories":["æµæ§"],"content":"tc é«˜çº§æµé‡æ§åˆ¶","date":"2020-12-16","objectID":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/","tags":["tc","æµæ§"],"title":"TC é«˜çº§æµæ§","uri":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/"},{"categories":["æµæ§"],"content":"TC ç®€ä»‹åŠåŸç† tc æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œå…¨åä¸ºtraffic controlï¼ˆæµé‡æ§åˆ¶ï¼‰, ä¸»è¦æ˜¯é€šè¿‡åœ¨è¾“å‡ºç«¯å£å¤„å»ºç«‹ä¸€ä¸ªé˜Ÿåˆ—æ¥å®ç°æµé‡æ§åˆ¶ã€‚tc å¯ä»¥ç”¨æ¥æ§åˆ¶ netem çš„å·¥ä½œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæƒ³è¦ä½¿ç”¨ netem ï¼Œåˆ™éœ€è¦å†…æ ¸å¼€å¯äº† netemï¼Œè€Œä¸”å®‰è£…äº† tcå·¥å…·ã€‚ tc æ§åˆ¶çš„æ˜¯å‘åŒ…åŠ¨ä½œï¼Œä¸èƒ½æ§åˆ¶æ”¶åŒ…åŠ¨ä½œã€‚å®ƒç›´æ¥å¯¹ç‰©ç†æ¥å£ç”Ÿæ•ˆï¼Œå¦‚æœæ§åˆ¶äº†ç‰©ç†çš„eth0ï¼Œé‚£ä¹ˆé€»è¾‘ç½‘å¡ï¼ˆæ¯”å¦‚eth0:1ï¼‰ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œåä¹‹åˆ™ä¸è¡Œï¼Œæ§åˆ¶é€»è¾‘ç½‘å¡æ˜¯æ— æ•ˆçš„ã€‚ æ¥æ”¶åŒ…ä»è¾“å…¥æ¥å£ï¼ˆInput Interfaceï¼‰è¿›æ¥åï¼Œç»è¿‡æµé‡é™åˆ¶ï¼ˆIngress Policingï¼‰ä¸¢å¼ƒä¸ç¬¦åˆè§„å®šçš„æ•°æ®åŒ…ï¼Œç”±è¾“å…¥å¤šè·¯åˆ†é…å™¨ï¼ˆInput De-Multiplexingï¼‰è¿›è¡Œåˆ¤æ–­é€‰æ‹©ï¼šå¦‚æœæ¥æ”¶åŒ…çš„ç›®çš„æ˜¯æœ¬ä¸»æœºï¼Œé‚£ä¹ˆå°†è¯¥åŒ…é€ç»™ä¸Šå±‚å¤„ç†ï¼›å¦åˆ™éœ€è¦è¿›è¡Œè½¬å‘ï¼Œå°†æ¥æ”¶åŒ…äº¤åˆ°è½¬å‘å—ï¼ˆForwarding Blockï¼‰å¤„ç†ã€‚è½¬å‘å—åŒæ—¶ä¹Ÿæ¥æ”¶æœ¬ä¸»æœºä¸Šå±‚ï¼ˆTCPã€UDPç­‰ï¼‰äº§ç”Ÿçš„åŒ…ã€‚è½¬å‘å—é€šè¿‡æŸ¥çœ‹è·¯ç”±è¡¨ï¼Œå†³å®šæ‰€å¤„ç†åŒ…çš„ä¸‹ä¸€è·³ã€‚ç„¶åï¼Œå¯¹åŒ…è¿›è¡Œæ’åˆ—ä»¥ä¾¿å°†å®ƒä»¬ä¼ é€åˆ°è¾“å‡ºæ¥å£ï¼ˆOutput Interfaceï¼‰ã€‚ä¸€èˆ¬æˆ‘ä»¬åªèƒ½é™åˆ¶ç½‘å¡å‘é€çš„æ•°æ®åŒ…ï¼Œä¸èƒ½é™åˆ¶ç½‘å¡æ¥æ”¶çš„æ•°æ®åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜å‘é€æ¬¡åºæ¥æ§åˆ¶ä¼ è¾“é€Ÿç‡ã€‚Linuxæµé‡æ§åˆ¶ä¸»è¦æ˜¯åœ¨è¾“å‡ºæ¥å£æ’åˆ—æ—¶è¿›è¡Œå¤„ç†å’Œå®ç°çš„ã€‚ ","date":"2020-12-16","objectID":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/:1:0","tags":["tc","æµæ§"],"title":"TC é«˜çº§æµæ§","uri":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/"},{"categories":["æµæ§"],"content":"TC åŸºç¡€ä½¿ç”¨ æ¨¡æ‹Ÿå»¶è¿Ÿä¼ è¾“ï¼štc qdisc add dev eth0 root netem delay 100ms, å¯ä»¥é€šè¿‡pingçš„æ–¹å¼éªŒè¯æ˜¯å¦å¢åŠ æ•ˆæœæˆåŠŸ æ¨¡æ‹Ÿå»¶è¿Ÿæ³¢åŠ¨ï¼štc qdisc add dev eth0 root netem delay 100ms 10ms å»¶è¿Ÿæ³¢åŠ¨éšæœºæ€§ï¼štc qdisc add dev eth0 root netem delay 100ms 10ms 30% æ¨¡æ‹Ÿç½‘ç»œä¸¢åŒ…ï¼štc qdisc add dev eth0 root netem loss 1% ç½‘ç»œä¸¢åŒ…æˆåŠŸç‡ï¼štc qdisc add dev eth0 root netem loss 1% 30% åˆ é™¤ç›¸å…³é…ç½®ï¼štc qdisc del dev eth0 root netem delay 100ms æ¨¡æ‹ŸåŒ…é‡å¤ï¼štc qdisc add dev eth0 root netem duplicate 1% æ¨¡æ‹ŸåŒ…æŸåï¼štc qdisc add dev eth0 root netem corrupt 0.2% æŸ¥çœ‹ç½‘å¡é…ç½®ï¼štc qdisc show dev eth0 æŸ¥çœ‹ä¸¢åŒ…ç‡ï¼štc -s qdisc show dev eth0 ","date":"2020-12-16","objectID":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/:2:0","tags":["tc","æµæ§"],"title":"TC é«˜çº§æµæ§","uri":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/"},{"categories":["æµæ§"],"content":"é’ˆå¯¹ipæ®µä¸‹è½½é€Ÿç‡æ§åˆ¶ tc qdisc del dev eth0 root handle 1: # åˆ é™¤æ§åˆ¶1: tc qdisc add dev eth0 root handle 1: htb r2q 1 # æ·»åŠ æ§åˆ¶1: tc class add dev eth0 parent 1: classid 1:1 htb rate 12mbit ceil 15mbit # è®¾ç½®é€Ÿç‡ tc filter add dev eth0 parent 1: protocol ip prio 16 u32 match ip dst 10.10.10.1/24 flowid 1:1 # æŒ‡å®šipæ®µæ§åˆ¶è§„åˆ™ # æ£€æŸ¥å‘½ä»¤ tc -s -d qdisc show dev eth0 tc class show dev eth0 tc filter show dev eth0ä¸º ","date":"2020-12-16","objectID":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/:3:0","tags":["tc","æµæ§"],"title":"TC é«˜çº§æµæ§","uri":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/"},{"categories":["æµæ§"],"content":"é™åˆ¶ä¸Šä¼ ä¸‹è½½ tc qdisc del dev tun0 root tc qdisc add dev tun0 root handle 2:0 htb tc class add dev tun0 parent 2:1 classid 2:10 htb rate 30kbps tc class add dev tun0 parent 2:2 classid 2:11 htb rate 30kbps tc qdisc add dev tun0 parent 2:10 handle 1: sfq perturb 1 tc filter add dev tun0 protocol ip parent 2:0 u32 match ip dst 10.18.0.0/24 flowid 2:10 tc filter add dev tun0 parent ffff: protocol ip u32 match ip src 10.18.0.0/24 police rate 30kbps burst 10k drop flowid 2:11 tc qdisc del dev tun0 root # åˆ é™¤åŸæœ‰ç­–ç•¥ tc qdisc add dev tun0 root handle 2:0 htb # å®šä¹‰æœ€é¡¶å±‚(æ ¹)é˜Ÿåˆ—è§„åˆ™ï¼Œå¹¶æŒ‡å®š default ç±»åˆ«ç¼–å·ï¼Œä¸ºç½‘ç»œæ¥å£ eth1 ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œç±»å‹ä¸º htbï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ª handle å¥æŸ„ 2:0 ç”¨äºæ ‡è¯†å®ƒä¸‹é¢çš„å­ç±» tc class add dev tun0 parent 2:1 classid 2:10 htb rate 30kbps # è®¾ç½®ä¸€ä¸ªè§„åˆ™é€Ÿåº¦æ˜¯30kbps tc class add dev tun0 parent 2:2 classid 2:11 htb rate 30kbps tc qdisc add dev tun0 parent 2:10 handle 1: sfq perturb 1 # è°ƒç”¨éšæœºå…¬å¹³ç®—æ³• tc filter add dev tun0 protocol ip parent 2:0 u32 match ip dst 10.18.0.0/24 flowid 2:10 # è§„åˆ™2:10åº”ç”¨åœ¨ç›®æ ‡åœ°å€ä¸Šï¼Œå³ä¸‹è½½ tc filter add dev tun0 parent ffff: protocol ip u32 match ip src 10.18.0.0/24 police rate 30kbps burst 10k drop flowid 2:11 # ä¸Šä¼ é™é€Ÿ è¯¥æ–‡ç« å†…å®¹æ”¶é›†äºç½‘ç»œã€‚ ","date":"2020-12-16","objectID":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/:4:0","tags":["tc","æµæ§"],"title":"TC é«˜çº§æµæ§","uri":"/myBlog-2/post/tc-%E9%AB%98%E7%BA%A7%E6%B5%81%E6%8E%A7/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":" è¯¥æ–‡ç« ç”¨äºè®°å½•ä¸ªäººåœ¨ä½¿ç”¨vimæœŸé—´å¸¸ç”¨çš„æŠ€å·§å’Œå¿«æ·é”®ã€‚ 2021-08-20 15:27:56ï¼šåˆå§‹åŒ–ï¼› 2021å¹´08æœˆ20æ—¥15:27:18 ï¼š æ›´æ–°vimåˆ†å±å¿«æ·é”®ä»¥åŠNERDTreeå¿«æ·é”®ï¼› 2021å¹´09æœˆ18æ—¥09:53:28ï¼š æ›´æ–°æ’ä»¶å¿«æ·é”®ï¼› ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:0:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"é€šç”¨æŠ€å·§ æ™®é€šæ¨¡å¼å¿«æ·é”®/æ“ä½œç¬¦(ç›´æ¥ä½¿ç”¨, æ— éœ€ä½¿ç”¨:) # :h operator æ¥æŸ¥é˜…å®Œæ•´çš„åˆ—è¡¨ \u003eG ä¸‹ä¸€è¡Œåˆ°æœ«è¡Œç¼©è¿›, ä½¿ç”¨`\u003e+ENTER`èƒ½è¾¾åˆ°ç›¸åŒæ•ˆæœ \u003e\u003e ä»…ç¼©è¿›å½“å‰è¡Œ . é‡å¤æ‰§è¡Œä¸Šä¸€æ¬¡å‘½ä»¤ A åœ¨å½“å‰è¡Œå°¾æ’å…¥å†…å®¹ï¼Œç›¸å½“äº`$a` J å°†å½“å‰è¡Œä¸ä¸‹ä¸€è¡Œè¿æ¥åˆ°ä¸€èµ· f/t(F/T) å‘åå‘å‰æŸ¥æ‰¾å­—ç¬¦, ä½¿ç”¨`;`è¿›è¡Œä¸‹ä¸€ä¸ªæŸ¥æ‰¾, ä½¿ç”¨`,`è¿›è¡Œåå‘æŸ¥æ‰¾ s åˆ é™¤å½“å‰å­—ç¬¦å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ o æ·»åŠ æ–°è¡Œå¹¶è¿›å…¥æ’å…¥æ¨¡å¼ * é«˜äº®æ–‡æœ¬ä¸­æ‰€æœ‰ä¸å…‰æ ‡å¤„ç›¸åŒçš„å•è¯, ä½¿ç”¨`n\\N`è¿›è¡Œä¸‹ä¸€ä¸ª db åå‘åˆ é™¤å¤šä¸ªå­—ç¬¦ç›´è‡³ç©ºæ ¼æˆ–è€…å¼€å¤´ dw åˆ†å¤šé’Ÿæƒ…å†µ: 1. å½“å…‰æ ‡ä½äºå•è¯å¼€å¤´æ—¶, åˆ é™¤æ•´ä¸ªå•è¯, ç›´è‡³é‡åˆ°ä»»æ„ç¬¦å·æˆ–è€…ç©ºæ ¼å­—ç¬¦ 2. å½“å…‰æ ‡å¤„äºå•è¯éå¼€å¤´ç»“å°¾æ—¶, åˆ é™¤å¤šä¸ªå­—ç¬¦, ç›´è‡³é‡åˆ°ä»»æ„ç¬¦å·æˆ–è€…ç©ºæ ¼å­—ç¬¦ 3. å½“å…‰æ ‡ä½äºéå•è¯æœ«å°¾å­—æ¯æ—¶, åå‘åˆ é™¤ä¸€ä¸ªå­—ç¬¦ d2w åˆ é™¤è¿ç»­ä¸¤ä¸ªå•è¯, ä½¿ç”¨`2dw`æˆ–è€…`dw.`æˆ–è€…`c2w`èƒ½è¾¾åˆ°ç›¸åŒæ•ˆæœ cw åˆ é™¤å…‰æ ‡ç›´åˆ°å•è¯æœ«å°¾, å¹¶è¿›å…¥`æ’å…¥`æ¨¡å¼ C åˆ é™¤å…‰æ ‡ç›´åˆ°è¡Œå°¾ daw `delete a word` åˆ é™¤æ•´ä¸ªå•è¯, æ— è®ºå…‰æ ‡å¤„äºä½•å¤„, å¹¶åˆ é™¤å•è¯ä¹‹å‰çš„ç©ºæ ¼(å¦‚æœæœ‰çš„è¯) dap åˆ é™¤æ•´ä¸ªæ®µè½, è¡Œå‰è¡Œåéƒ½æœ‰ç©ºæ ¼çš„é‚£ç§æ‰å«æ®µè½ b/B åå‘å®šä½åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´æˆ–è€…å•è¯ç»“å°¾(å¦‚æœå•è¯åé¢éæ¢è¡Œçš„ç¬¦å·çš„è¯) # å¤åˆ¶ä¸ç²˜è´´ yyp å¤åˆ¶æ•´è¡Œåˆ°ä¸‹ä¸€è¡Œ yap å¤åˆ¶æ•´æ®µå†…å®¹åˆ°å¯„å­˜å™¨ gp ç²˜è´´æ•´æ®µå†…å®¹åˆ°å…‰æ ‡ä¹‹å, å¹¶å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‰€ç²˜è´´å†…å®¹ä¸‹æ–¹, è¿™ä¸€ç‚¹ä¸ç›´æ¥ä½¿ç”¨`p`å…‰æ ‡ä½ç½®ä¸å˜æ‰€ä¸åŒ yiw å¤åˆ¶å½“å‰å•è¯åˆ°æ— åå¯„å­˜å™¨ \"0p å¤åˆ¶ä¸“ç”¨å¯„å­˜å™¨`0` \"ayiw å¤åˆ¶å½“å‰å•è¯åˆ°åä¸º`a`çš„å¯„å­˜å™¨ \"ap ç²˜è´´å¯„å­˜å™¨åä¸º`a`çš„å†…å®¹ \"_dd å¯„å­˜å™¨ \"+p å°†å¤–éƒ¨å‰ªåˆ‡æ¿å†…å®¹ç²˜è´´åˆ°å…‰æ ‡ä¹‹å, æˆ–è€…åœ¨æ’å…¥æ¨¡å¼ä¸‹ä½¿ç”¨å¿«æ·é”®`\u003cC-r\u003e+` dl åˆ é™¤ä¸€ä¸ªå­—ç¬¦, ç­‰åŒäº`x` gU å°†å­—ç¬¦å…¨éƒ¨è½¬æ¢ä¸ºå¤§å†™, ç›¸å¯¹çš„, `gu`å°†å­—ç¬¦è½¬æ¢ä¸ºå°å†™, `g~`ç”¨äºç¿»è½¬å¤§å°å†™, å¯è§†åŒ–é€‰æ‹©ä¸­å¯ç”¨, å¸¸ç”¨ç»„åˆ`gUaw` gv é‡é€‰ä¸Šæ¬¡é«˜äº®åŒºåŸŸ # å…‰æ ‡ç§»åŠ¨æ“ä½œ \u003cC-e\u003e å‘ä¸‹ç¿»é¡µ \u003cC-y\u003e å‘ä¸Šç¿»é¡µ \u003cESC-.\u003e æ–°å¢ç©ºè¡Œ 0/^ ç§»åŠ¨åˆ°å®é™…è¡Œé¦–/ç§»åŠ¨åˆ°éç©ºç™½å­—ç¬¦è¡Œé¦– $/g$ç§»åŠ¨åˆ°å®é™…è¡Œå°¾/ç§»åŠ¨åˆ°å±å¹•è¡Œå°¾ w/e æ­£å‘ç§»åŠ¨åˆ°å•è¯å¼€å¤´/ç»“å°¾ b/ge åå‘ç§»åŠ¨åˆ°å½“å‰å•è¯æˆ–è€…ä¸Šä¸€ä¸ªå•è¯å¼€å¤´/ç»“å°¾ mm/`m æ ‡è®°å…‰æ ‡å½“å‰ä½ç½®ä»¥åŠè·³è½¬åˆ°æ ‡è®°ä½ç½® `` æ¥å›è·³è½¬ä¸Šæ¬¡æ ‡è®°ä½ç½® `. ä¸Šæ¬¡ä¿®æ”¹çš„ä½ç½® `^ ä¸Šæ¬¡æ’å…¥çš„ä½ç½® `\u003c ä¸Šæ¬¡é«˜äº®é€‰åŒºçš„èµ·å§‹ä½ç½® `\u003e ä¸Šæ¬¡é«˜äº®é€‰å–çš„æœ«å°¾ä½ç½® % åœ¨æˆå¯¹ç¬¦å·é—´è¿›è¡Œè·³è½¬ \u003cLINE_NUMBER\u003eG è·³è½¬åˆ°æŒ‡å®šè¡Œ (/) è·³è½¬åˆ°ä¸Šä¸€å¥/ä¸‹ä¸€å¥å¼€å¤´ {/} è·³è½¬åˆ°ä¸Šä¸€æ®µ/ä¸‹ä¸€æ®µçš„å¼€å¤´ :changes æŸ¥çœ‹ä¿®æ”¹ \u003cC-p\u003eæˆ–è€…\u003cC-n\u003e è§¦å‘è‡ªåŠ¨è¡¥å…¨ \u003cC-x\u003e\u003cC-k\u003e è§¦å‘å­—å…¸è‡ªåŠ¨è¡¥å…¨, å‰ææ˜¯å¼€å¯æ‹¼å†™æ£€æŸ¥`:set spell` \u003cC-x\u003e\u003cC-l\u003e è§¦å‘è¡Œæ¨¡å¼è‡ªåŠ¨è¡¥å…¨, æ³¨æ„: åªé€‚ç”¨äºæ•´è¡Œè¡¥å…¨ \u003cC-x\u003e\u003cC-p\u003e è§¦å‘å•è¯è‡ªåŠ¨è¡¥å…¨ \u003cC-x\u003e\u003cC-f\u003e è§¦å‘æ–‡ä»¶åè‡ªåŠ¨è¡¥å…¨, linux/Macä¸‹`/home/agou-ops/\u003cC-x\u003e\u003cC-f\u003e`, windowsä¸‹`x:\\\u003cC-x\u003e\u003cC-f\u003e` \u003cC-x\u003e\u003cC-o\u003e æ ¹æ®ä¸Šä¸‹æ–‡è¿›è¡Œè‡ªåŠ¨è¡¥å…¨, å¤šç”¨äºç¼–ç¨‹è¯­è¨€ \u003cC-x\u003es åœ¨æ’å…¥æ¨¡å¼ä¸‹ä½¿ç”¨è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½, ä½œç”¨å’Œæ™®é€šæ¨¡å¼ä¸‹çš„`\u003cC-x\u003e\u003cC-k\u003e`ç›¸åŒ æ’å…¥æ¨¡å¼ä¸‹ \u003cC-h\u003e åˆ é™¤, ç›¸å½“äºdeleteé”® \u003cC-w\u003e åˆ é™¤å‰ä¸€ä¸ªå•è¯ \u003cC-u\u003e åˆ é™¤å­—ç¬¦ç›´åˆ°è¡Œé¦– \u003cC--o\u003e æ’å…¥-æ™®é€šæ¨¡å¼æ˜¯æ™®é€šæ¨¡å¼çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå®ƒèƒ½è®©æˆ‘ä»¬æ‰§è¡Œä¸€æ¬¡æ™®é€šæ¨¡å¼å‘½ä»¤ \u003cC-r\u003e=`\u003cç®—æ•°å¼å­\u003e` å¿«é€Ÿè®¡ç®—, ä¹Ÿå¯ä»¥ç”¨äºèµ‹å€¼, æ¯”å¦‚`let i=0`ä¸­å®šä¹‰äº†å˜é‡`i`å€¼ä¸º`0`, ä½¿ç”¨`\u003cC-r\u003e=i`å³å¯å°†å˜é‡içš„å†…å®¹æ’å…¥åˆ°å½“å‰å…‰æ ‡å¤„ c ç¤ºä¾‹æ–‡æœ¬: '\u003ca href=\"{url}\"\u003e{title}\u003c/a\u003e' è¯­å¥ ç»“æœ ci\" #\u003cEsc\u003e '\u003ca href=\"#\"\u003e{title}\u003c/a\u003e' citclick here\u003cEsc\u003e '\u003ca href=\"#\"\u003eclick here\u003c/a\u003e' # ciå‘½ä»¤å¯ä»¥ç†è§£ä¸ºä¿®æ”¹åŒå¼•å·å†…å®¹, citå¯ä»¥ç†è§£ä¸ºä¿®æ”¹æ ‡ç­¾é‡Œé¢çš„å†…å®¹ åŒç†ä½¿ç”¨`yit`æˆ–è€…`dit`å¯ä»¥å¿«é€Ÿæ‹·è´æˆ–è€…åˆ é™¤æ ‡ç­¾é‡Œé¢çš„å†…å®¹ caw åˆ é™¤æ•´ä¸ªå•è¯ å¯è§†åŒ–æ¨¡å¼ä¸‹ o/O å¿«é€Ÿè·³è½¬åˆ°å¯è§†åŒ–åŒºåŸŸçš„é¦–æ®µå’Œæœ«ç«¯ e/b ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªå•è¯å¼€å¤´æœ«å°¾ U/u å°†æ‰€é€‰åŒºåŸŸå­—æ¯è½¬æ¢ä¸ºå¤§å†™æˆ–è€…å°å†™ r\u003cå­—ç¬¦\u003e å°†æ‰€é€‰åŒºåŸŸçš„å†…å®¹å…¨éƒ¨æ›¿æ¢ä¸º\u003cå­—ç¬¦\u003eå†…å®¹ \u003cS-i\u003e åˆ—æ’å…¥ $ åˆ—é€‰æ‹©, é€‰æ‹©ç»“å°¾, ä½¿ç”¨åœºæ™¯: ä¸ºé€‰ä¸­åŒºåŸŸçš„è¡Œå°¾æ·»åŠ æŒ‡å®šç¬¦å· viw å¿«é€Ÿé€‰ä¸­å½“å‰å•è¯ ve å¿«é€Ÿé€‰ä¸­å½“å‰å­—ç¬¦åˆ°å•è¯ç»“å°¾ Ex å‘½ä»¤ :copy å¤åˆ¶å½“å‰è¡Œ, åŒä¹‰å‘½ä»¤`:co`æˆ–è€…`:t` :reg \"0 æŸ¥çœ‹å¯„å­˜å™¨å†…å®¹ :3t. å°†ç¬¬ä¸‰è¡Œå†…å®¹å¤åˆ¶åˆ°å½“å‰è¡Œ :t3 æŠŠå½“å‰è¡Œå¤åˆ¶åˆ°ç¬¬ä¸‰è¡Œ :t. å¤åˆ¶å½“å‰è¡Œ, ç›¸å½“äº`yyp` :'\u003c,'\u003et0 æŠŠé«˜äº®é€‰ä¸­åŒºåŸŸå¤åˆ¶åˆ°æ–‡ä»¶å¼€å¤´ :m ç§»åŠ¨å½“å‰è¡Œ, ä½¿ç”¨æ–¹æ³•å’Œ`:copy`ç›¸å…³ç”¨æ³•ä¸€è‡´ :read ! \u003cshelll command\u003e ä»shellå‘½ä»¤ä¸­è¯»å–è¾“å‡ºå†…å®¹åˆ°å½“å‰å…‰æ ‡å¤„ :'\u003c,'\u003enormal A; åœ¨å¯è§†åŒ–æ¨¡å¼ä¸‹æ‰¹é‡ä½¿ç”¨æ™®é€šæ¨¡å¼å‘½ä»¤, å³åœ¨æ¯è¡Œæœ«å°¾æ·»åŠ ä¸€ä¸ªåˆ†å· :'\u003c,'\u003enormal i// åœ¨å¯è§†åŒ–è¡Œé€‰æ‹©æ¨¡å¼ä¸‹, æ‰¹é‡ä¸ºæ¯è¡Œå¼€å¤´æ·»åŠ æ³¨é‡Šç¬¦ :w | !echo hello æ‰§è¡Œå¤šæ¡å‘½ä»¤ @: é‡å¤ä¸Šæ¬¡exå‘½ä»¤ q: è°ƒå‡ºå†å²å‘½ä»¤çª—å£ q/ æ‰“å¼€æŸ¥æ‰¾å†å²å‘½ä»¤çª—å£ :shell è¿›å…¥shell :r !ls å°†shellä¸­çš„å†…å®¹è¯»å…¥åˆ°æ–‡ä»¶, æˆ–è€…ä»å°†å¤–éƒ¨æ–‡ä»¶å†…å®¹è¯»å…¥åˆ°å½“å‰æ–‡ä»¶ :2,$!sort -t',' -k2 å°†ç¬¬äºŒåˆ—å†…å®¹æŒ‰ç…§å­—æ¯é¡ºåºè¿›è¡Œé‡æ’åº å¤šæ–‡ä»¶ç¼–è¾‘ :ls æŸ¥çœ‹å½“å‰ç¼“å†²åŒº, è¾“å…¥æ•°å­—è¿›å…¥æŒ‡å®š :bn/bp è¿›å…¥ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªç¼“å†²åŒº, åˆ†åˆ«ä¸º`bnext`å’Œ`bprevious`ç®€å†™ :buffer \u003cFILE_NAME\u003e æ ¹æ®æ–‡ä»¶åè·³è½¬åˆ°æŒ‡å®šç¼“å†²åŒº, ä½¿ç”¨`TAB`é”®å¯ä»¥è¡¥å…¨ :bufdo åœ¨æ‰€æœ‰ç¼“å†²åŒºæ‰§è¡ŒExå‘½ä»¤ :bdelete \u003cFILE_NAME1\u003e \u003cFILE_NAME2\u003e åˆ é™¤æŒ‡å®šç¼“å†²åŒº :e! æ‘’å¼ƒå½“å‰ç¼“å†²åŒºä¿®æ”¹, å¼ºåˆ¶ä»æ–‡ä»¶ä¸­é‡æ–°è¯»å–æ–‡ä»¶å†…å®¹, é€š`:edit!`, ç”¨äº`å›æ»šæ“ä½œ` :qall! æ‘’å¼ƒæ‰€æœ‰ç¼“å†²åŒºä¿®æ”¹, å¼ºåˆ¶é€€å‡º :wall ä¿å­˜æ‰€æœ‰ç¼“å­˜åŒºä¿®æ”¹ :sp[lit] {file} åŒ`\u003cC-w\u003es`, æ°´å¹³åˆ‡åˆ†å½“å‰çª—å£ï¼Œå¹¶åœ¨æ–°çª—å£ä¸­è½½å…¥{file} :vsp[lit] {file} åŒ`\u003cC-w\u003ev`, å‚ç›´åˆ‡åˆ†å½“å‰çª—å£ï¼Œå¹¶åœ¨æ–°çª—å£ä¸­è½½å…¥{file} \u003cC-w\u003e\u003c`ä¸Šä¸‹å·¦å³`æ–¹å‘é”®æˆ–è€…`HJKL`é”®æˆ–è€…`w`é”®\u003e åˆ‡æ¢å½“å‰çª—å£, `w`ä¸ºå¾ªç¯åˆ‡æ¢ \u003cC-w\u003eHã€Jã€Kã€L å·¦ä¸Šå³ä¸‹ç§»åŠ¨å½“å‰çª—å£ä½ç½® :clo[se] åŒ`\u003cC-w\u003ec`, å…³é—­æ´»åŠ¨çª—å£ :on[ly] åŒ`\u003cC-w\u003eo`, åªä¿ç•™æ´»åŠ¨çª—å£, å…³é—­å…¶ä»–æ‰€æœ‰çª—å£ # çª—å£å¤§å°è°ƒæ•´ \u003cC-w\u003e= ä½¿æ‰€æœ‰çª—å£ç­‰å®½ã€ç­‰é«˜ \u003cC-w\u003e_ æœ€å¤§åŒ–æ´»åŠ¨çª—å£çš„é«˜åº¦ \u003cC-w\u003eï½œ æœ€å¤§åŒ–æ´»åŠ¨çª—å£çš„å®½åº¦ \u003cC-w\u003e\u003e çª—å£å³ç§» \u003cC-w\u003e\u003e çª—å£å·¦ç§» \u003cC-w\u003eH å°†å½“å‰çª—å£ç§»åˆ°æœ€å·¦è¾¹ \u003cC-w\u003eJ å°†å½“å‰çª—å£ç§»åˆ°æœ€ä¸Šé¢ \u003cC-w\u003eK å°†å½“å‰çª—å£ç§»åˆ°æœ€ä¸‹é¢ \u003cC-w\u003eL å°†å½“å‰çª—å£ç§»åˆ°æœ€å³è¾¹ [N]\u003cC-w\u003e_ æŠŠæ´»åŠ¨çª—å£çš„é«˜åº¦è®¾ä¸º[N]è¡Œ [N]\u003cC-w\u003eï½œ æŠŠæ´»åŠ¨çª—å£çš„å®½åº¦è®¾ä¸º[N]åˆ— \u003cC-w\u003eT æŠŠå½“å‰çª—å£ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„æ ‡ç­¾ # æ ‡ç­¾ :lcd \u003cLOCAL_PATH\u003e è¿›å…¥æœ¬åœ°æŒ‡å®šç›®å½•, ä»…å¯¹å½“å‰çª—å£æœ‰ç”¨, å¦‚æœä¸€ä¸ªæ ‡ç­¾ä¸­æœ‰å¤šä¸ªçª—å£, æƒ³è¦å¯¹æ‰€æœ‰çª—å£ç”Ÿæ•ˆéœ€è¦ä½¿ç”¨Exå‘½ä»¤`:windo lcd {path}` :tabedit {filename} åˆ›å»ºä¸€ä¸ªæ–°çš„æ ‡ç­¾é¡µ :tabc[lose] å…³é—­å½“å‰æ ‡ç­¾ä»¥åŠæ ‡ç­¾ä¸‹å±çš„æ‰€æœ‰çª—å£ :tabo[nly] å…³é—­å…¶ä»–æ‰€æœ‰æ ‡ç­¾, ä¿ç•™å½“å‰æ´»åŠ¨æ ‡ç­¾ # æ ‡ç­¾åˆ‡æ¢ :tabn[ext] {N} åŒ`{N}gt`, åˆ‡æ¢åˆ°ç¼–å·ä¸º {N} çš„æ ‡ç­¾é¡µ :tabn[ext] åŒ`gt`, åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ ‡ç­¾ :tabp[revious] åŒ`gT`, åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ ‡ç­¾ :tabmove \u003cNUMBER\u003e å°†å½“å‰æ ‡ç­¾ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®, å¼€å¤´çš„åºå·ä¸º`0` :find \u003cFILENAME\u003e åœ¨`path`ä¸­æŸ¥æ‰¾æ–‡ä»¶å¹¶æ‰“å¼€ :set path+=app/* **é€šé…ç¬¦ä¼šåŒ¹é… app/ ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½• :e. æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨ï¼Œå¹¶æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½• \u003cC-^\u003e è°ƒå‡ºæ–‡ä»¶ç®¡ç†å™¨, å‘ç°åªæ˜¯æ‰“å¼€ç©ç©? ä½¿ç”¨è¯¥å¿«æ·é”®å¯ä»¥è¿”å›æ–‡ä»¶ç¼–è¾‘ :E æ‰“å¼€æ–‡ä»¶ç®¡ç†å™¨ï¼Œå¹¶æ˜¾ç¤ºæ´»åŠ¨ç¼“å†²åŒºæ‰€åœ¨çš„ç›®å½• \u003cC-g\u003e æ˜¾ç¤ºå½“å‰æ–‡ä»¶çŠ¶æ€ :!mkdir -p %:h å¦‚æœä¸€ä¸ªæ–°åˆ›å»ºçš„æ–‡ä»¶æ‰€å±çš„æ–‡ä»¶å¤¹ä¸å­˜åœ¨, åˆ™å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œåˆ›å»º, ç„¶åä½¿ç”¨ `:w`è¿›è¡Œä¿å­˜ :w !sudo tee % \u003e /dev/null ææƒä¿å­˜æ–‡ä»¶ :args *.html åˆ›å»ºæ–‡ä»¶åˆ—è¡¨, ä¸å¸¦ä»»ä½•å‚æ•°åˆ™æ˜¾ç¤ºåˆ—è¡¨å†…å®¹`:args` :firstã€:lastã€:prevã€:next æµè§ˆæ–‡ä»¶åˆ—è¡¨ :argdo normal dd åœ¨æ–‡ä»¶åˆ—è¡¨ä¸­åŒæ—¶æ‰§è¡Œæ™®é€šæ¨¡å¼çš„å‘½ä»¤ å® qa å¼€å§‹å®å½•åˆ¶, å¹¶è®°å½•åˆ°`a`å¯„å­˜å™¨ \u003cESC\u003eq ç»“æŸå®å½•åˆ¶ ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:1:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"ä¸å¸¸ç”¨å°æŠ€å·§ å¿«é€ŸåŠ å‡ \u003cC-a\u003e å’Œ \u003cC-x\u003e å‘½ä»¤åˆ†åˆ«å¯¹æ•°å­—æ‰§è¡ŒåŠ å’Œå‡æ“ä½œ ä½¿ç”¨æ–¹æ³•: å°†å…‰æ ‡ç§»åŠ¨åˆ°æ•°å­—å­—ç¬¦ä¸Š, æŒ‰ä¸‹æ‰€è¦åŠ æˆ–è€…å‡çš„æ•°å­—, æŒ‰ä¸‹\u003cC-a\u003eæˆ–è€…\u003cC-x\u003eå³å¯è¿›è¡Œå¿«é€ŸåŠ å‡ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯, åŠ æˆ–è€…å‡æ— æ³•ä½¿ç”¨å°æ•°ç‚¹, å› ä¸ºå°æ•°ç‚¹æœ‰ç‰¹æ®Šç”¨é€” å¦, éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯: å¦‚æœæ•°å­—æ˜¯ä»¥`007`è¿™æ ·ä»¥`0`å¼€å¤´çš„è¯, vimä¼šè‡ªåŠ¨å°†å…¶è¯†åˆ«ä¸ºå…«è¿›åˆ¶æ•°, åŠ å‡æ—¶ä¹Ÿä¼šæŒ‰ç…§å…«è¿›åˆ¶è¿›è¡Œè¿ç®—, è¦ç¦æ­¢è¯¥è¡Œä¸º, å°†ä¸€åˆ‡æ•°å­—è§†ä¸ºåè¿›åˆ¶æ•°å­—çš„è¯, éœ€è¦è®¾ç½®ä»¥ä¸‹å‚æ•°: set nrformats= ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:2:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"å°æŠ€å·§ å¿«é€Ÿç¼©è¿›æŒ‡å®š Ctrl+vå¼€å¯ä»»æ„é€‰æ‹©, ä½¿ç”¨ä¸Šä¸‹é”®é€‰ä¸­å¤šè¡Œè¡Œé¦–, ç„¶åæŒ‰ä¸‹shift+ié”®è¿›å…¥æ’å…¥æ¨¡å¼, è¿ç»­è¾“å…¥å››ä¸ªç©ºæ ¼ä¹‹å(æ­¤æ—¶å¹¶ä¸ä¼šç¼©è¿›æ‰€æœ‰, åªä¼šç¼©è¿›ç¬¬ä¸€è¡Œå†…å®¹), ç„¶åæŒ‰ä¸‹ESCé”®å°±å¯ä»¥å•¦. é‡æ’å­—æ®µ # ç»™å‡ºç¤ºä¾‹æ–‡æœ¬å†…å®¹å¦‚ä¸‹æ‰€ç¤º: last name,first name,email neil,drew,drew@vimcasts.org doe,john,john@example.com # ç›®æ ‡æ˜¯: å°†é‚®ç®±æ”¾ç½®äºæœ€å‰æ–¹, ç„¶åæ˜¯first name, æœ€åæ˜¯last name /\\v^([^,]*),([^,]*),([^,]*)$ :%s//\\3,\\2,\\1 ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:3:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"å…¶ä»–hotkeys æ’ä»¶ä¸­çš„hotkeyï¼š ctrl + p æ‰“å¼€æ–‡ä»¶æœç´¢ gd è·³è½¬å®šä¹‰ ctrl + o ä»å®šä¹‰è¿”å› m æ‰“å¼€nerdtreeèœå• # simpleflod å¿«æ·é”® zc/zC æŠ˜å å•ä¸ª/æ‰€æœ‰ zo/zO å±•å¼€å•ä¸ª/æ‰€æœ‰ ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:4:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"é™„å½•ï¼šNERDTree å¿«æ·é”® ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:5:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["vim","æŠ€å·§","æŒç»­æ›´æ–°"],"content":"å‚è€ƒé“¾æ¥ æˆ‘çš„vim dotfile: https://github.com/AGou-ops/dotfiles Vimå®ç”¨æŠ€å·§(ç¬¬2ç‰ˆ): https://agou-images.oss-cn-qingdao.aliyuncs.com/pdfs/Vim%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7%EF%BC%88%E7%AC%AC2%E7%89%88%EF%BC%89.pdf Vim cheatsheet: https://devhints.io/vim Vim Cheat Sheet: https://vim.rtorr.com/ ","date":"2020-12-06","objectID":"/myBlog-2/post/vim-tricks/:6:0","tags":["vim","tricks"],"title":"Vim Hotkeys and Cheat Sheet","uri":"/myBlog-2/post/vim-tricks/"},{"categories":["DevOps","è½¬è½½"],"content":"ç¯‡å¹…æœ‰é™ï¼Œç‚¹å‡»ä¸‹æ–¹é“¾æ¥è¿›è¡Œè®¿é—®ã€‚ DevOps Note-01ï¼ˆä¸­æ–‡ï¼Œ @sunrisenan å¤‡ä»½ç«™ç‚¹ï¼‰ï¼šhttp://bak.agou-ops.top/ DevOps Note-02ï¼ˆè‹±æ–‡ï¼Œ @vinayhegde1990 è½¬è½½ï¼‰ï¼šhttp://agou-ops.top/devops ","date":"2020-10-27","objectID":"/myBlog-2/post/devops-notes/:0:0","tags":["DevOps","è½¬è½½"],"title":"DevOps - Notes","uri":"/myBlog-2/post/devops-notes/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"é¢„å…ˆå‡†å¤‡ minikube For Windows(èµ„æºå……è¶³, æœ‰é›†ç¾¤æ›´å¥½ä¸è¿‡); Helm; ç§‘å­¦ä¸Šç½‘èƒ½åŠ›. ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:1:0","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"æ•´ä½“æ¡†æ¶ éšæ‰‹åœ¨çº¿ç”»çš„, ä¸ç¾è§‚, qwq. ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:2:0","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"æ“ä½œæ­¥éª¤ ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:0","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"å¯ç”¨helm-tiller(helmæœåŠ¡å™¨ç«¯) åœ¨minikubeä¸­å¯ç”¨helm-tilleræ’ä»¶, å¾ˆç®€å•, åªéœ€è¦ä¸€æ¡å‘½ä»¤å³å¯: $ minikube addons enable helm-tiller # æˆ–è€…åœ¨å¯åŠ¨ minikube çš„æ—¶å€™ç›´æ¥å¯ç”¨ helm-tiller $ minikube start --addons=[\"helm-tiller\"] \u003cOther_Options\u003e ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:1","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"å®‰è£…Prometheus-operator é¦–å…ˆæ·»åŠ æ‰€éœ€ä»“åº“: $ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts # æ›´æ–°ä»“åº“å†…å®¹ $ helm repo update å®‰è£…/ä¸‹è½½chart: $ helm install prometheus-community/kube-prometheus-stack --version 9.4.10 # æˆ–è€…å…ˆä¸‹è½½ä¸‹æ¥æ›´æ”¹æ‰€éœ€å†…å®¹ä¹‹åå†è¿›è¡Œå®‰è£…(æ¨èä½¿ç”¨æ–¹æ³•) $ helm pull prometheus-community/kube-prometheus-stack --version 9.4.10 --untar # å®‰è£… $ helm install prometheus kube-prometheus-stack/ å®‰è£…å®Œæˆä¹‹å, kubernetesä¼šè‡ªåŠ¨æ¥ç®¡åç»­å·¥ä½œ, å¦‚æ‹‰å–é•œåƒç­‰: # è§‚å¯Ÿéƒ¨ç½²è¿›åº¦ $ kubectl get po -w NAME READY STATUS RESTARTS AGE alertmanager-prometheus-kube-prometheus-alertmanager-0 2/2 Running 0 24m prometheus-grafana-79b677fd4b-t9kr9 2/2 Running 0 25m prometheus-kube-prometheus-operator-69cd74c99f-wltf4 2/2 Running 0 25m prometheus-kube-state-metrics-95d956569-mlfwv 1/1 Running 0 25m prometheus-prometheus-kube-prometheus-prometheus-0 3/3 Running 1 24m prometheus-prometheus-node-exporter-tvwf5 1/1 Running 0 25m # æŸ¥çœ‹service $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE alertmanager-operated ClusterIP None \u003cnone\u003e 9093/TCP,9094/TCP,9094/UDP 25m kubernetes ClusterIP 10.96.0.1 \u003cnone\u003e 443/TCP 44h prometheus-grafana ClusterIP 10.108.199.68 \u003cnone\u003e 80/TCP 26m prometheus-kube-prometheus-alertmanager ClusterIP 10.96.81.7 \u003cnone\u003e 9093/TCP 26m prometheus-kube-prometheus-operator ClusterIP 10.109.9.111 \u003cnone\u003e 8080/TCP,443/TCP 26m prometheus-kube-prometheus-prometheus ClusterIP 10.98.173.241 \u003cnone\u003e 9090/TCP 26m prometheus-kube-state-metrics ClusterIP 10.109.121.40 \u003cnone\u003e 8080/TCP 26m prometheus-operated ClusterIP None \u003cnone\u003e 9090/TCP 25m prometheus-prometheus-node-exporter ClusterIP 10.107.29.93 \u003cnone\u003e 9100/TCP 26m ä»¥ä¸Šä¿¡æ¯æ— è¯¯åˆ™è¡¨æ˜prometheuså·²æˆåŠŸéƒ¨ç½². ä½¿ç”¨minikube(kubectläº¦å¯)çš„è½¬å‘åŠŸèƒ½, å°†svc/prometheus-kube-prometheus-prometheus çš„ç«¯å£æ˜ å°„åˆ°æœ¬åœ°: $ minikube port-forward svc/prometheus-kube-prometheus-prometheus 9090 Forwarding from 127.0.0.1:9090 -\u003e 9090 Forwarding from [::1]:9090 -\u003e 9090 Handling connection for 9090 æ‰“å¼€æµè§ˆå™¨è®¿é—®http://127.0.0.1:9090/æŸ¥çœ‹prometheus UI: ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹prometheusçš„servicemonitor(å…¶å¯¹åº”prometheus UIä¸­çš„target): $ kubectl get servicemonitor NAME AGE prometheus-kube-prometheus-alertmanager 36m prometheus-kube-prometheus-apiserver 36m prometheus-kube-prometheus-coredns 36m prometheus-kube-prometheus-grafana 36m prometheus-kube-prometheus-kube-controller-manager 36m prometheus-kube-prometheus-kube-etcd 36m prometheus-kube-prometheus-kube-proxy 36m prometheus-kube-prometheus-kube-scheduler 36m prometheus-kube-prometheus-kube-state-metrics 36m prometheus-kube-prometheus-kubelet 36m prometheus-kube-prometheus-node-exporter 36m prometheus-kube-prometheus-operator 36m prometheus-kube-prometheus-prometheus 36m æŸ¥çœ‹æ‰€æœ‰crd: $ kubectl get crd NAME CREATED AT alertmanagers.monitoring.coreos.com 2020-10-08T01:10:04Z podmonitors.monitoring.coreos.com 2020-10-08T01:10:04Z prometheuses.monitoring.coreos.com 2020-10-08T01:10:04Z prometheusrules.monitoring.coreos.com 2020-10-08T01:10:04Z servicemonitors.monitoring.coreos.com 2020-10-08T01:10:04Z thanosrulers.monitoring.coreos.com 2020-10-08T01:10:04Z é€šè¿‡describeå­å‘½ä»¤å¯ä»¥å‘ç°crdçš„matchLabelséƒ½åŒ…å«release: prometheusæ ‡ç­¾. ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:2","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"éƒ¨ç½²MongoDBåŠå…¶æœåŠ¡ å‚è€ƒMongoDB-depl-svc.yamlæ–‡ä»¶å†…å®¹å¦‚ä¸‹: apiVersion:apps/v1kind:Deploymentmetadata:name:mongodb-deploymentlabels:app:mongodbspec:replicas:2selector:matchLabels:app:mongodbtemplate:metadata:labels:app:mongodbspec:containers:- name:mongodbimage:mongoports:- containerPort:27017---apiVersion:v1kind:Servicemetadata:name:mongodb-servicespec:selector:app:mongodbports:- protocol:TCPport:27017targetPort:27017 æŒ‰éœ€è¿›è¡Œä¿®æ”¹, ä¿®æ”¹å®Œæˆä¹‹ååº”ç”¨é…ç½®æ¸…å•: $ kubectl apply -f MongoDB-depl-svc.yaml ç­‰å¾…MongoDBéƒ¨ç½²å®Œæˆâ€¦ $ kubectl get deployment/mongodb-deployment -w NAME READY UP-TO-DATE AVAILABLE AGE mongodb-deployment 2/2 2 0 3m13s ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:3","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"éƒ¨ç½²MongoDB Exporter æ·»åŠ helm repo: $ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts $ helm repo update ä¸‹è½½chart: $ helm pull prometheus-community/prometheus-mongodb-exporter --untar ä¿®æ”¹value.yamlæ–‡ä»¶å†…å®¹: ...# ä½¿ç”¨kubectl get svcè·å–MongoDBçš„æœåŠ¡åŠç«¯å£mongodb:uri:\"mongodb://mongodb-service:27017\"...# ä»ä¸Šé¢å¯ä»¥å¾—çŸ¥servicemonitoræ‰€åŒ¹é…çš„æ ‡ç­¾ release: prometheusserviceMonitor:additionalLabels:release:prometheus... åº”ç”¨chart: $ helm install mongodb-exporter prometheus-mongodb-exporter/ ç­‰å¾…svc,podéƒ¨ç½²å®Œæˆä¹‹å, æ˜ å°„mongodb-exporter, æ£€æŸ¥/metrics: $ kubectl port-forward service/mongodb-exporter-prometheus-mongodb-exporter 9216 æ‰“å¼€æµè§ˆå™¨è®¿é—®http://localhost:9216/metricsè¿›è¡ŒæŸ¥çœ‹: æ­¤æ—¶, å†æ‰“å¼€prometheus UIæŸ¥çœ‹targetå¯ä»¥çœ‹åˆ°mongodb-exporterå·²ç»å¤„äºUPçŠ¶æ€: ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:4","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"åœ¨GrafanaæŸ¥çœ‹ $ kubectl port-forward deployment/prometheus-grafana 3000 æ‰“å¼€æµè§ˆå™¨è®¿é—®http://localhost:3000: :information_source:é»˜è®¤è´¦å·admin, é»˜è®¤å¯†ç prom-operator (ä»å®˜æ–¹æ–‡æ¡£ä¸­å³å¯è·å–) ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:3:5","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"é™„å½•1: chart åœ°å€ ä¸Šæ–‡ä¸­æ‰€ä½¿ç”¨çš„chartä»“åº“åœ°å€: kube-prometheus-stack: https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack mongodb-exporter: https://github.com/prometheus-community/helm-charts/tree/main/charts/prometheus-mongodb-exporter ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:4:0","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["kubernetes","prometheus","database","grafana"],"content":"é™„å½•2: kubectl get all ","date":"2020-10-08","objectID":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/:5:0","tags":["k8s","prometheus","mongodb","grafana"],"title":"åœ¨k8sä¸Šä½¿ç”¨Prometheusç›‘æ§MongoDB","uri":"/myBlog-2/post/%E5%9C%A8k8s%E4%B8%8A%E4%BD%BF%E7%94%A8prometheus%E7%9B%91%E6%8E%A7mongodb/"},{"categories":["hugo","shortcode"],"content":"shortcode ??? ä»€ä¹ˆæ˜¯shortcodeä»¥åŠhugoå†…ç½®shortcodeå‚è€ƒï¼š shortcodes-preview ","date":"2020-10-06","objectID":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/:0:0","tags":[],"title":"è‡ªå®šä¹‰ shortcode","uri":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/"},{"categories":["hugo","shortcode"],"content":"github shortcode åœ¨æŒ‡å®šç›®å½•æ·»åŠ ä»¥ä¸‹æ–‡ä»¶ï¼š \u003c!-- æ–‡ä»¶ä½ç½®ï¼š~/layouts/shortcodes/github.html --\u003e \u003cdiv class=\"github\"\u003e \u003cdiv class=\"logo\"\u003e {{ replace $.Site.Data.SVG.repository \"icon\" \"icon github-icon\" | safeHTML }} \u003ca class=\"name\" href={{ .Get \"link\" }} target=\"_blank\"\u003e{{ .Get \"name\" }}\u003c/a\u003e \u003c/div\u003e \u003cdiv class=\"description\"\u003e{{ .Get \"description\" }}\u003c/div\u003e \u003cdiv class=\"language\"\u003e \u003cspan class=\"language-color\" style=\"background-color: {{ .Get \"color\" }}\"\u003e\u003c/span\u003e \u003cspan class=\"language-name\"\u003e{{ .Get \"language\" }}\u003c/span\u003e \u003c/div\u003e \u003c/div\u003e // æ–‡ä»¶ä½ç½®ï¼š~/assets/scss/custom/_custom.scss // github shortcode .github { border: 1px solid var(--color-contrast-low); border-color: #b3b4ac; border-style: dotted; border-radius: 12px !important; margin: 0 auto; margin-bottom: 1em; padding: 1em; background-color: #fcfdf8; .github-icon { width: 1.2em; height: 1.2em; margin-right: 0.5em; margin-bottom: 0.2em; fill: var(--color-contrast-high); transition: all .5s; } .name { font-weight: bold; color: #0366d6 !important; text-decoration: none; } .description { margin-top: 0.5em; margin-bottom: 1em; color: #586069; text-align: justify; font-size: 90%; transition: all .5s; } .language-color { position: relative; top: 1px; display: inline-block; width: 0.75em; height: 0.75em; border-radius: 50%; } .language-name { color: var(--color-contrast-high); font-size: 90%; color: #586069; margin-left: 0.5em; transition: all .5s; } } markdownä»£ç å¦‚ä¸‹ï¼ˆå»æ‰æ³¨é‡Šç¬¦å·/*å’Œ*/ï¼‰ï¼š {{/*\u003c github name=\"kubernetes/kubernetes\" link=\"https://github.com/kubernetes/kubernetes\" description=\"Production-Grade Container Scheduling and Management\" color=\"#00ADD8\" language=\"Go\" \u003e*/}} \rkubernetes/kubernetes\r\rProduction-Grade Container Scheduling and Management \rGo\r\r\r","date":"2020-10-06","objectID":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/:1:0","tags":[],"title":"è‡ªå®šä¹‰ shortcode","uri":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/"},{"categories":["hugo","shortcode"],"content":"bilibili shortcode {{/*\u003c bilibili BV1YK4y1C7CU \u003e*/}} \r ","date":"2020-10-06","objectID":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/:2:0","tags":[],"title":"è‡ªå®šä¹‰ shortcode","uri":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/"},{"categories":["hugo","shortcode"],"content":"video shortcode {{/*\u003c video link=\"http://agou-resources.oss-cn-chengdu.aliyuncs.com/video/test.mp4\" pic=\"http://agou-images.oss-cn-qingdao.aliyuncs.com/Wallpapers/violet.png\" time=10 text=\"é«˜èƒ½éƒ¨åˆ†\" time1=20 text1=\"é«˜èƒ½ç»“æŸ\" \u003e*/}} #dplayer-video-container { max-width: 800px; margin: 0 auto; margin-top: -1rem; } @media screen and (max-device-width: 400px) { #dplayer { width: 100%; } } const dp = new DPlayer({ container: document.getElementById('dplayer'), autoplay: false, theme: '#c05b4d', loop: false, lang: 'zh-cn', screenshot: false, hotkey: true, preload: 'auto', volume: 0.7, mutex: true, logo: 'https://agou-images.oss-cn-qingdao.aliyuncs.com/BaseIMG/youtube.png', subtitle: { url: '', type: 'webvtt', fontSize: '20px', bottom: '3%', color: '#0000', }, video: { type: 'auto', url: 'http:\\/\\/agou-resources.oss-cn-chengdu.aliyuncs.com\\/video\\/test.mp4', pic: 'http:\\/\\/agou-images.oss-cn-qingdao.aliyuncs.com\\/Wallpapers\\/violet.png' }, contextmenu: [ { text: 'â¤ åšå®¢ä¸»é¡µ', link: 'https://agou-ops.github.io' }, { text: 'æ’­æ”¾å™¨ä¿¡æ¯', click: (player) = { console.log(player); } } ], highlight: [ { time: '10', text: 'é«˜èƒ½éƒ¨åˆ†', }, { time: '20', text: 'é«˜èƒ½ç»“æŸ', }, { time: '', text: '', }, { time: '', text: '', }, { time: '', text: '', }, ], }); ","date":"2020-10-06","objectID":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/:3:0","tags":[],"title":"è‡ªå®šä¹‰ shortcode","uri":"/myBlog-2/post/%E8%87%AA%E5%AE%9A%E4%B9%89shortcode/"},{"categories":["Anime"],"content":"My Anime Trip.","date":"2020-09-30","objectID":"/myBlog-2/anime/","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"æŒ‰ç…§è§‚çœ‹ç»“æŸæ—¶é—´æ’åºï¼Œåºå·ä»…ç”¨äºè®¡æ•°ã€‚(2020-03-28 è‡³ ????-??-??) å˜æ›´æ—¥å¿—ï¼š 2020å¹´10æœˆ01æ—¥ï¼šåˆå§‹åŒ–è¡¨æ ¼ã€å¢åŠ åºå·è‡³39ï¼› 2020å¹´11æœˆ13æ—¥ï¼šå¢åŠ å–œå¥½æ ‡ç­¾ï¼Œæ›´æ–°åºå·è‡³51ï¼› 2021å¹´01æœˆ01æ—¥ï¼šå¢åŠ ç•ªå‰§å–œå¥½æ ‡è¯† :two_hearts: ï¼Œ2020å¹´å®Œç»“ï¼Œæ›´æ–°åºå·è‡³79ï¼› 2021å¹´02æœˆ18æ—¥ï¼š å¢åŠ æµè¡Œçš„åœ†è§’è®¾è®¡ï¼Œå¢åŠ é€æ˜åº¦ï¼Œå¢åŠ éšæœºåŠ¨æ¼«èƒŒæ™¯ï¼› æ›´æ”¹PCç«¯é¼ æ ‡æ ·å¼ä¸ºamong usï¼Œå·¦ä¸‹è§’æ–°å¢é»„å‰ä¹…ç¾å­ç”»åƒï¼› å¢åŠ æ³¡é¢ç•ªæ ‡è¯†ğŸœï¼Œæ›´æ–°åºå·è‡³100ï¼› 2021å¹´06æœˆ21æ—¥ï¼šå¢åŠ ç»Ÿè®¡ï¼Œæ›´æ–°åºå·è‡³125ï¼› 2021å¹´08æœˆ17æ—¥ï¼šæ›´æ¢é¡µé¢titleä¸ºè‰ºæœ¯å­—ï¼Œå¢åŠ emojiï¼Œæ›´æ–°åºå·è‡³138ï¼› :warning: æ³¨ï¼š-è¡¨ç¤ºæ— æˆ–ä¸ç¥¥ï¼Œ^è¡¨ç¤ºå’Œä¸Šä¸ªä¸€æ ·ã€‚:information_source: â€” ç§»åŠ¨ç«¯åŒå‡»å±å¹•æŸ¥çœ‹æ›´ä½³ï½ â€” ","date":"2020-09-30","objectID":"/myBlog-2/anime/:0:0","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"äºŒã€‡äºŒã€‡å¹´ å–œå¥½æ ‡ç­¾ï¼ˆç”±é«˜åˆ°ä½ï¼‰ï¼š#æ—¥å¸¸Â #èŒç³»Â #è½»ç™¾åˆ #æç¬‘Â #æ²»æ„ˆ (ä¸æ˜¯è‡´éƒ)Â #é­”æ³•Â  åºå· æ—¶é—´ åŠ¨æ¼«å æœ€å–œæ¬¢çš„è§’è‰² åˆ¶ç‰‡æ–¹ 000 2020/03/28 ã€Šå°æ—å®¶çš„é¾™å¥³ä»†ã€‹ :two_hearts: æ‰˜å°”ã€åº·å¨œã€å°”ç§‘äºš äº¬éƒ½åŠ¨ç”» 001 2020/04/02 ã€Šç´«ç½—å…°æ°¸æ’èŠ±å›­ã€‹ :two_hearts: è–‡å°”è‰ç‰¹Â·ä¼ŠèŠ™åŠ ç™» äº¬éƒ½åŠ¨ç”» 002 2020/04/06 ã€Šå¹å“ï¼ä¸Šä½éŸ³å·ã€‹ :two_hearts: é»„å‰ä¹…ç¾å­(é»„å¤§å”)ã€ä¸­ä¸–å¤é¦™ç»‡(å°é¦™ç»‡) äº¬éƒ½åŠ¨ç”» 003 2020/04/18 ã€Šè½»éŸ³å°‘å¥³ã€‹(K-ON!) :two_hearts: å¹³æ³½å”¯ äº¬éƒ½åŠ¨ç”» 004 2020/04/24 ã€Šæ—¥å¸¸ã€‹ :two_hearts: é•¿é‡åŸç¾ç»ª(ç¾ç»ªé…±) äº¬éƒ½åŠ¨ç”» 005 2020/05/02 ã€ŠCLANNADã€‹ :two_hearts: å¤æ²³æ¸šã€å†ˆå´æ± äº¬éƒ½åŠ¨ç”» 006 2020/05/07 ã€Šä¸­äºŒç—…ä¹Ÿè¦è°ˆæ‹çˆ±ã€‹ ä¸ƒå®«æ™ºéŸ³ã€å°é¸Ÿæ¸¸å…­èŠ± äº¬éƒ½åŠ¨ç”» 007 2020/05/12 ã€Šå¢ƒç•Œçš„å½¼æ–¹ã€‹ æ —å±±æœªæ¥ äº¬éƒ½åŠ¨ç”» 008 2020/05/17 ã€Šç”˜åŸå…‰è¾‰æ¸¸ä¹å›­ã€‹ åƒæ–—äº”åé“ƒ äº¬éƒ½åŠ¨ç”» 009 2020/05/21 ã€Šé¾™ç‹çš„å·¥ä½œã€‹ é›é¹¤çˆ±ã€å¤æ´›ç‰¹Â·ä¼Šä½é˜¿å°” project No.9 010 2020/05/26 ã€ŠåŸƒç½—èŠ’é˜¿è€å¸ˆã€‹ é«˜ç ‚æ™ºæƒ (åº—é•¿)ã€å’Œæ³‰çº±é›¾ A-1 Pictures 011 2020/05/26 ã€Šçˆç™¾ç’ƒçš„å •è½ã€‹ èƒ¡æ¡ƒæ³½Â·è¨å¡”å¦®å¨…Â·éº¦å…‹é“å¨å°”(è¨å¡”å°¼äºš)ã€ç™½ç¾½Â·èˆè²å°”Â·æ©å…¹æ²ƒæ–¯(æ‹‰è²) åŠ¨ç”»å·¥æˆ¿ 012 2020/05/28 ã€Šæœªé—»èŠ±åã€‹ æœ¬é—´èŠ½è¡£å­(é¢ç ) A-1 Pictures 013 2020/05/31 ã€Šè·¯äººå¥³ä¸»çš„å…»æˆæ–¹æ³•ã€‹ åŠ è—¤æƒ ã€éœä¹‹ä¸˜è¯—ç¾½ A-1 Pictures \u0026 CloverWorks 014 2020/06/01 ã€Šè¿™ä¸ªç¾æœ¯ç¤¾æœ‰å¤§é—®é¢˜ï¼ã€‹ å®‡ä½ç¾ç‘å¸Œ feel. 015 2020/06/06 ã€ŠLoveLive!ã€‹(Î¼â€™s) ä¸œæ¡å¸Œ(å¸Œ)ã€çŸ¢æ³½å¦®å¯(å¦®å¯) SUNRISE 016 2020/06/15 ã€Šæ‹çˆ±ç ”ç©¶æ‰€ã€‹ çœŸæœ¨å¤ç»ªã€ä»“æ¡¥è‰å­(æç‹—) åŠ¨ç”»å·¥æˆ¿ 017 2020/06/17 ã€Šç»ˆå°†æˆä¸ºä½ ã€‹ ä¸ƒæµ·ç¯å­ã€å°ç³¸ä¾‘ TROYCA 018 2020/06/19 ã€Šå¦–ç²¾æ£®æ—çš„å°ä¸ç‚¹ã€‹ :two_hearts: å¾¡å­åœ°ã€ç™½æ˜ Lerche 019 2020/06/22 ã€Šé‚»å®¶ç´¢è²ã€‹ å¤©é‡ç¯ Studioäº”ç»„Ã—AXsiZ 020 2020/06/26 ã€Štari tariã€‹ å†²ç”°çº±ç¾½ P.A.WORKS 021 2020/06/26 ã€Šæ‘‡æ›³éœ²è¥ã€‹:two_hearts: å¿—æ‘©å‡›ã€å„åŠ¡åŸæŠšå­ C-Station 022 2020/07/01 ã€ŠèŠ±å¼€ä¼Šå•æ³¢ã€‹ æŠ¼æ°´èœå­ P.A.WORKS 023 2020/07/12 ã€Šæ¨±èŠ±åº„çš„å® ç‰©å¥³å­©ã€‹ ä¸Šäº•è‰ç¾å’²ã€é’å±±ä¸ƒæµ· J.C.STAFF 024 2020/07/23 ã€Šæ‚ å“‰æ—¥å¸¸å¤§ç‹ã€‹ :two_hearts: å®«å†…è²å(å–µå¸•æ–¯)ã€è¶Šè°·å¤æµ· SILVER LINK. 025 2020/07/27 ã€Šæ€•ç—›çš„æˆ‘ï¼ŒæŠŠé˜²å¾¡åŠ›ç‚¹æ»¡å°±å¯¹äº†ã€‹ æ¢…æ™®éœ² SILVER LINK. 026 2020/08/06 ã€ŠNEW GAME!ã€‹ æ³·æœ¬ä¸€äºŒä¸‰ã€é¥­å²›ç»“éŸ³(å…³è¥¿è…”iäº†)ã€æ¨±å®å®(å®å®é¸¡) åŠ¨ç”»å·¥æˆ¿ 027 2020/08/10 ã€ŠSlow Startã€‹ åä»“è£ä¾å­ã€åƒçŸ³å† ã€ä¸€ä¹‹æ¿‘èŠ±å ã€ ç™¾åœ°ç‰æ‰‹ A-1 Picturesâ†’CloverWorks[1] 028 2020/08/15 ã€ŠComic Girlsã€‹ èŒç”°è–°å­(å°æ··æ²Œ) Nexus 029 2020/08/19 ã€Šæ‹çˆ±å°è¡Œæ˜Ÿã€‹ æœ¨ä¹‹å¹¡ç±³æ‹‰ åŠ¨ç”»å·¥æˆ¿ 030 2020/08/22 ã€Šè¡—è§’é­”æ—ã€‹ å‰ç”°ä¼˜å­(å¤ç¾å­) J.C.STAFF 031 2020/08/27 ã€Šå±æ€§å’–å•¡é¦†ã€‹(BlendÂ·S) æ—¥å‘å¤å¸† A-1 Pictures èŠ³æ–‡ç¤¾ 032 2020/08/30 ã€Šæœªç¡®è®¤è¿›è¡Œå¼ã€‹ ä¸‰å³°çœŸç™½ã€å¤œä¹‹æ£®å°çº¢(å°çº¢) åŠ¨ç”»å·¥æˆ¿ 033 2020/09/02 ã€Šå¤©ä½“çš„ç§©åºã€‹ å¤å®«ä¹ƒä¹ƒé¦™ã€è¯ºè‰¾å°” Studio 3Hz 034 2020/09/08 ã€Šcitrusã€‹ è“åŸæŸšå­ã€è“åŸèŠ½è¡£ Passione 035 2020/09/15 ã€ŠAnne Happyâ™ªã€‹ èŠ±å°æ³‰æ SILVER LINK. 036 2020/09/24 ã€Šæ”¾å­¦åæµ·å ¤æ—¥è®°ã€‹ é¹¤æœ¨é˜³æ¸š åŠ¨ç”»å·¥æˆ¿ 037 2020/09/25 ã€Šè¯·é—®æ‚¨ä»Šå¤©è¦æ¥ç‚¹å…”å­å—ï¼Ÿã€‹ æ¡é—´çº±è·¯(çº±è·¯é…±)ã€å®‡æ²»æ¾åƒå¤œ Koi(åŸä½œ) 038 2020/09/25 ã€Šå®‡å´é…±æƒ³è¦ç©è€ï¼ã€‹ å®‡å´èŠ± ENGI 039 2020/09/29 ã€Šé›å­çš„ç¬”è®°ã€‹ å¤å·ç–äº•èœ(å¥‡æ€ªçš„çˆ±å¥½ï¼šå–œæ¬¢åƒä¹¦) Passione 040 2020/10/09 ã€Šæ‘‡æ›³ç™¾åˆã€‹â€‹ :two_hearts: å²çº³äº¬å­ã€èµ¤åº§ç¯é‡Œ åŠ¨ç”»å·¥æˆ¿ã€TYO ANIMATIONSã€TYO ANIMATIONS 041 2020/10/15 ã€Šä¸‰è€…ä¸‰å¶ã€‹ è¥¿å·å¶å­ åŠ¨ç”»å·¥æˆ¿ 042 2020/10/16 ã€Šè‹¥å¶å¥³å­©ã€‹ğŸœ å°æ¡¥è‹¥å¶ Nexus 043 2020/10/17 ã€Šç‰µç‰›èŠ±ä¸åŠ æ¿‘åŒå­¦ã€‹ å±±ç”°ç»“è¡£åŠ æ¿‘å‹é¦™ ZEXCS 044 2020/10/21 ã€ŠAnima Yell!ã€‹ çŒ¿æ¸¡å®‡å¸Œ åŠ¨ç”»å·¥æˆ¿ 045 2020/10/24 ã€Šä¸€ä¸ªäººçš„OOå°æ—¥å­ã€‹ ä¸€é‡Œæ³¢çŸ¥ C2C 046 2020/10/25 ã€Šå…¬ä¸»è¿ç»“Re:Diveã€‹ ä½©å¯è‰å§†ã€å‡¯éœ² CygamesPictures 047 2020/10/30 ã€Šæˆ‘å®¶å¥³ä»†æœ‰å¤Ÿçƒ¦ï¼ã€‹ é«˜æ¢¨ç±³å¤ åŠ¨ç”»å·¥æˆ¿ 048 2020/10/30 ã€Šå‰è¿›å§ï¼Œç™»å±±å°‘å¥³ã€‹ğŸœ ä»“ä¸Šæ—¥å‘ã€é›ªæ‘è‘µ ã—ã‚ï¼ˆåŸä½œï¼‰ â€¢ 8-bitï¼ˆåŠ¨ç”»åˆ¶ä½œï¼‰ 049 2020/11/02 ã€Šæ˜¥åŸåº„çš„ç®¡ç†å‘˜å°å§ã€‹ æ˜¥åŸå½©èŠ±ã€é›ªæœ¬æŸšå­ SILVER LINK. 050 2020/11/06 ã€Šå¥³é«˜ä¸­ç”Ÿçš„è™šåº¦æ—¥å¸¸ã€‹ é¹­å®«è¯—ç»‡ï¼ˆæœºå™¨äººï¼‰ Passione 051 2020/11/07 ã€Šç¬¨å¥³å­©ã€‹ï¼ˆåˆåï¼šå•è ¢å¥³å­©ï¼‰ éš…é‡æ²™è€¶é¦™ diomedÃ©a 052 2020/11/16 ã€ŠHappy Sugar Lifeã€‹ï¼ˆå°å¿ƒè¿™ç³–æœ‰æ¯’ï¼‰ ç¥æˆ¶é¹½ Ezoâ€™la 053 2020/11/18 ã€Šæ¨±Trickã€‹ é«˜å±±æ˜¥é¦™ STUDIO DEEN 054 2020/11/21 ã€ŠENDRO~!ã€‹ ç›æ¬§ã€æ¢…ï¼ˆæ¢…ç‘ŸÂ·æ©è¾¾æ–¯ç‰¹ï¼‰ Studioäº”ç»„ 055 2020/11/22 ã€Šæ­¤èŠ±äº­å¥‡è°­ã€‹ æŸš Lerche 056 2020/11/24 ã€Šç›çº³åˆ©äºšçš„å¯†å‹ã€‹ :two_hearts: å¤ç‘å¨…ã€å®‰ CygamesPictures 057 2020/11/28 ã€ŠA CHANNELã€‹ ä¼˜å­ Studioäº”ç»„ 058 2020/11/29 ã€Šä½ é­éš¾äº†å—ï¼Ÿã€‹ - Ezoâ€™la 059 2020/12/04 ã€Šæ— å½©é™çš„æ€ªçµä¸–ç•Œã€‹ å’Œæ³‰ç²å¥ˆ äº¬éƒ½åŠ¨ç”» 060 2020/12/04 ã€Šçˆ±æ€å®è´ã€‹ æŠ˜éƒ¨å®‰å¥ˆ J.C.STAFF 061 2020/12/05 ã€Šå®…é¥®ã€‹ğŸœ - Production IMS 062 2020/12/08 ã€Šçˆ±åƒæ‹‰é¢çš„å°æ³‰åŒå­¦ã€‹ å°æ³‰åŒå­¦ Studioäº”ç»„ã€AXsiZ 063 2020/12/09 ã€Šæœˆå½±ç‰¹å·¥ã€‹ æºæ¡ƒã€åŠè—é—¨é›ª Lay-duce 064 2020/12/10 ã€ŠURARAè¿·è·¯è´´ã€‹ åƒçŸ¢ J.C.STAFF 065 2020/12/11 ã€Šæ— å£çš„æ£®ç”°å°å§ã€‹ğŸœ - ç«¹ä¹¦æˆ¿ 066 2020/12/14 ã€Šé¢åŒ…å¸¦æ¥å’Œå¹³ï¼ã€‹ğŸœ - æ—­Production 067 2020/12/18 ã€Šä¸‰é¢—æ˜Ÿå½©è‰²å†’é™©ã€‹ ç´å¶ã€ç»“è¡£ã€å°å¹¸ SILVER LINK. 068 2020/12/19 ã€Šæ´²å´è¥¿ã€‹ğŸœ - feel. 069 2020/12/19 ã€Šå°æ£®åŒå­¦æ‹’ç»ä¸äº†ï¼ã€‹ - Animation Studio Artland 070 2020/12/19 ã€Šé­”å¥³ä¹‹æ—…ã€‹ :two_hearts: æ²™è€¶ã€ä¼Šè•¾å¨œ C2C 071 2020/12/20 ã€ŠGJéƒ¨ã€‹ å¤©ä½¿çœŸå¤® åŠ¨ç”»å·¥æˆ¿ 072 2020/12/22 ã€Šåœ¨é­”ç‹åŸè¯´æ™šå®‰ã€‹ æ –å¤œè‰ä¸ åŠ¨ç”»å·¥æˆ¿ 073 2020/12/25 ã€ŠçŠ¬ç¥åŒå­¦å’ŒçŒ«å±±åŒå­¦ã€‹ğŸœ - SEVEN 074 2020/12/25 ã€Šåƒç»ªçš„ä¸Šå­¦è·¯ã€‹ - diomedÃ©a 075 2020/12/25 ã€Šå®‰è¾¾ä¸å²›æ‘ã€‹ :two_hearts: å®‰è¾¾æ¨±ã€å²›æ‘æŠ±æœˆ æ‰‹å†¢Production 076+ 2020/12/27 ã€Šè¯·é—®æ‚¨ä»Šå¤©è¦æ¥ç‚¹å…”å­å—ï¼ŸBLOOMã€‹ ^ ^ 077 2020/12/27 ã€Šlovelive è™¹å’²å­¦å›­å­¦å›­å¶åƒåŒå¥½ä¼šã€‹ ä¸ŠåŸæ­¥æ¢¦ æ—¥æ˜‡ 078 2020/12/27 ã€Šæˆç¥ä¹‹æ—¥ã€‹ ä¼Šåº§å¹¶æå­ã€ä½è—¤é› P.A.WORKS 079 2020/12/28 ã€Šæ»¡æº¢çš„æ°´æœæŒã€‹ æ¨±è¡£ä¹ƒã€å‰åŸä»èœ feel. ","date":"2020-09-30","objectID":"/myBlog-2/anime/:1:0","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"å¹´åº¦æœ€å–œæ¬¢çš„å£°ä¼˜(åŠæ‰€é…éŸ³è§’è‰²) çŸ³å·ç”±ä¾ï¼šè–‡å°”è‰ç‰¹Â·ä¼ŠèŠ™åŠ ç™»ã€é«˜ç ‚æ™ºæƒ ã€ä¼Šåº§å¹¶æå­ï¼› é»‘æ³½æœ‹ä¸–ï¼šé»„å‰ä¹…ç¾å­ï¼Œæ²™è€¶ï¼› å­å®‰æ­¦äººï¼šå…‹åŠ³è¿ªäºšÂ·éœé‡‘æ–¯ï¼› ","date":"2020-09-30","objectID":"/myBlog-2/anime/:1:1","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"å¹´åº¦æœ€å–œæ¬¢çš„OP/ED/OST/IN ã ã‚“ã”å¤§å®¶æ—ï¼ˆå›¢å­å¤§å®¶æ—ï¼‰ã€CLANNAD EDã€‘ï¼› æ˜æ—¥ã§ã„ã„ã‹ã‚‰ï¼ˆæ˜å¤©ä¹Ÿæ²¡å…³ç³»ï¼‰ã€Anne Happy EDã€‘ï¼› neï¼neï¼neï¼ï¼ˆå‘ï¼å‘ï¼å‘ï¼ï¼‰ã€slow start OPã€‘ï¼› ","date":"2020-09-30","objectID":"/myBlog-2/anime/:1:2","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"äºŒã€‡äºŒä¸€å¹´ åºå· æ—¶é—´ åŠ¨æ¼«å æœ€å–œæ¬¢çš„è§’è‰² åˆ¶ç‰‡æ–¹ 080 2021/01/02 ã€Šè‰è“æ£‰èŠ±ç³–ã€‹ ä¼Šè—¤åƒä½³ ç«¥æ¢¦ 081 2021/01/04 ã€Šæ–¯ç‰¹æ‹‰çš„é­”æ³•ã€‹ æœ¬ç”°ç è¼ SILVER LINK. 082 2021/01/06 ã€Šç”µå™¨è¡—çš„æ¼«ç”»åº—ã€‹ å°æ—¥ï¼ˆã²ãŠãŸã‚“ï¼‰ã€ç›¸æœºå­ï¼ˆã‚«ãƒ¡å­ï¼ˆã‚«ãƒ¡ã“ï¼‰ï¼‰ SHIN-EIåŠ¨ç”» 083 2021/01/07 ã€ŠCandy Boyã€‹ æ¨±äº•å¥ã€æ¨±äº•é›ªä¹ƒ AIC Digital 084 2021/01/08 ã€Šé­”ç‰©å¨˜çš„åŒ»ç”Ÿã€‹ - ARVO ANIMATION 085 2021/01/12 ã€Šè½»å£°å¯†è¯­ã€‹ é£é—´æ±ã€æ‘é›¨çº¯å¤ AIC 086 2021/01/13 ã€Šé›é€»è¾‘ã€‹ è‰æ˜‚å¦®ä¸Â·å¶åˆ©æ–¯ç‰¹æ‹‰æ‰˜å¨ƒã€äº¬æ¡¥ä¸‡åš åŠ¨ç”»å·¥æˆ¿ 087 2021/01/16 ã€Šå°‘å¥³ç»ˆæœ«æ—…è¡Œã€‹â€‹:two_hearts: åƒæˆ·ã€å°¤è‰ WHITE FOX 088 2021/01/20 ã€Šé»„é‡‘æ‹¼å›¾ã€‹ å°è·¯ç»«ï¼ˆayayaï¼‰ã€ä¹Œä¸¸æ¨± Studioäº”ç»„ã€AXsiZï¼ˆåˆ¶ä½œååŠ›ï¼‰ 089 2021/01/22 ã€Šè¸åˆ‡æ—¶é—´ã€‹ğŸœ - EKACHI EPILKA 090 2021/01/27 ã€Šæµ¦å’Œå°è°ƒã€‹ğŸœ - - 091 2021/01/28 ã€Šé‚ªç¥ä¸å¨äºŒç—…å°‘å¥³ã€‹ é‚ªç¥é…±ï¼ˆå¤¹å¿ƒé…±ï¼‰ã€èŠ±å›­ç™¾åˆé“ƒ NOMAD 092 2021/02/01 ã€ŠSHOW BY ROCK!!ã€‹ å¸Œå®‰ã€è«äºš BONES 093 2021/02/03 ã€Š22/7ã€‹ æ³·å·ç¾ç¾½ã€è—¤é—´æ¨± A-1 Pictures 094 2021/02/06 ã€ŠSHOW BY ROCK!! Mashumairesh!!ã€‹ ç‹ä¸¸ã€çœŸå²›å§¬å­ BONES 095 2021/02/08 ã€Šç´§æ‰£çš„æ˜Ÿæ˜Ÿã€‹ - PRIMASTEA 096 2021/02/11 ã€Šæ¸¸æˆ3äººå¨˜ã€‹ é‡æ‘é¦™çº¯ Lerche 097 2021/02/14 ã€ŠçŒ«ç¥å…«ç™¾ä¸‡ã€‹ å¤å®«æŸšå­ AIC PLUS+ 098 2021/02/17 ã€Šæˆ¿ä¸œé’æ˜¥æœŸï¼ã€‹ - Seven Arcs Pictures 099 2021/02/17 ã€Šé£ç¿”çš„é­”å¥³ã€‹ æœ¨å¹¡çœŸç´ã€ä»“æœ¬åƒå¤ J.C.STAFF 100 2021/02/18 å¹¸è¿â˜†æ˜Ÿ æŸŠå¸ã€æ³‰æ­¤æ–¹ äº¬éƒ½åŠ¨ç”» 101 2021/02/20 ã€Š+TICæ¨¡å‹å§å¦¹ã€‹ğŸœ - TYO Animations Inc.ã€BARNUM STUDIO 102 2021/02/21 ã€ŠLapis Re:LiGHTsã€‹ ç¼‡äºšæ‹‰ã€å˜‰å¥ˆç‰¹ æ¨ªæ»¨åŠ¨ç”»ç ”ç©¶æ‰€ 103 2021/03/06 ã€Šå—å®¶ä¸‰å§å¦¹ã€‹ï¼ˆå…±å››å­£ï¼‰ ALL ç«¥æ¢¦(1)ã€asread(2-3)ã€feel.(4) 104 2021/03/11 ã€Šæ‚ æ‚ å¼ã€‹ - KINEMA CITRUS 105+ 2021/04/05 ã€Šæ‘‡æ›³éœ²è¥â–³ç¬¬äºŒå­£ã€‹ ^ ^ 106+ 2021/04/05 ã€Šæ‚ å“‰æ—¥å¸¸å¤§ç‹ ç¬¬ä¸‰å­£ã€‹ ^ ^ 107 2021/04/05 ã€Šé‡Œä¸–ç•ŒéƒŠæ¸¸ã€‹ ç´™è¶Šç©ºé­šã€ä»ç§‘é³¥å­ LIDENFILMSÃ—FelixFilm 108 2021/04/12 ã€Šå‰§å¶åƒã€‹ å„åŠ¡çˆ±ç† Hoods Entertainment 109 2021/04/19 ã€Šç«‹èŠ±é¦†æ‹çˆ±ä¸‰è§’é“ƒã€‹ğŸœ - Creators in pack/STUDIO LINGS 110 2021/04/25 ã€Šå¹¸è¿æ˜Ÿã€‹ æŸŠé•œã€æ³‰æ­¤æ–¹ã€æŸŠå¸ äº¬éƒ½åŠ¨ç”» 111 2021/05/06 ã€Šç”Ÿå­˜æ¸¸æˆç¤¾ã€‹ - Studio Pierrot+ 112 2021/05/06 ã€Šç½‘çƒå¹¶ä¸å¯ç¬‘å˜›ã€‹ğŸœï¼ˆå…±ä¹å­£ï¼‰ çœ‹äº†ä¹å­£åå­—ä¸€ä¸ªæ²¡è®°ä½:joy: MAPPAï¼ˆç¬¬1~3å­£ï¼‰ï¼Œmillepenseeï¼ˆç¬¬4~9å­£ï¼‰ 113 2021/05/13 ã€Šç¢§è“èˆªçº¿ã€‹ æ ‡æªã€æ‹‰è²ã€ä¼ä¸š Bibury Animation Studios 114 2021/05/14 ã€Šç¢§è“èˆªçº¿ å¾®é€Ÿå‰è¿›ã€‹ ^ ^ 115 2021/05/15 ã€ŠGO!GO!575ã€‹ğŸœ - Lay-duceã€C2C 116 2021/05/21 ã€Šç”·å­é«˜ä¸­ç”Ÿçš„æ—¥å¸¸ã€‹ å°è‹¹æœ æ—¥å‡åŠ¨ç”» 117 2021/05/25 ã€Šå¥³å­é«˜ä¸­ç”Ÿã€‹ğŸœ - - 118 2021/05/26 ã€Šæ¼«ç ”éƒ¨ã€‹ğŸœ - Seven 119 2021/06/04 ã€Šä¼ªå§¬ç‰©è¯­ã€‹ğŸœ æ—­Production 120 2021/06/06 ã€Šæˆ‘ï¼Œä¸æ˜¯è¯´äº†èƒ½åŠ›è¦å¹³å‡å€¼ä¹ˆï¼ã€‹ é˜¿é»›å°”Â·å†¯Â·é˜¿æ–¯å¡å§†/éº¦éœ² project No.9 121 2021/06/07 ã€Šé›¨è‰²å¯å¯side Gã€‹ğŸœ - EMT Squared 122 2021/06/15 ã€Šæœªæ¥æ—¥è®°ã€‹ æˆ‘å¦»ç”±ä¹ƒ Asread 123 2021/06/20 ã€Šæä¹é™¢å¥³å­é«˜å¯®ç‰©è¯­ã€‹ - CAMMOT 124 2021/06/21 ã€ŠReBIRTHã€‹ğŸœ - - 125 2021/06/21 ã€Šå·¥ä½œç»†èƒã€‹ çº¢è¡€çƒ(AE3803) david production 126 2021/06/21 ã€Šç»ˆæœ«çš„å¥³æ­¦ç¥ã€‹ - Graphinica 127 2021/06/23 ã€Šå¥³å­è½è¯­ã€‹ èŠœç½—äº­é­”æ¢¨å¨ J.C.STAFF 128 2021/06/25 ã€Šå½’å®…éƒ¨æ´»åŠ¨è®°å½•ã€‹ é“æ˜å¯ºæ¨± NOMAD 129 2021/06/26 ã€Šæœ¬ç”°å°ç‹¼ä¸æˆ‘ã€‹ å°ç†Š STUDIO KAI 130 2021/06/26 ã€Šæ‰“äº†300å¹´çš„å²è±å§†ï¼Œä¸çŸ¥ä¸è§‰å°±ç»ƒåˆ°äº†æ»¡çº§ã€‹:two_hearts: ç›¸æ³½æ¢“ã€è±å¡ã€èŠ™æ‹‰å¾·éœ²å¿’ REVOROOT 131 2021/07/02 ã€Šæ™®é€šå¥³é«˜ä¸­ç”Ÿè¦åšå½“åœ°å¶åƒã€‹ - feel. 132 2021/07/07 ã€Šä»»æ€§HighSpecã€‹ğŸœ - AXsiZ 133 2021/07/18 ã€Šè´«ç©·å§å¦¹ç‰©è¯­ã€‹ ALL ä¸œæ˜ åŠ¨ç”» 134 2021/07/18 ã€Šçƒ§çª‘çš„è¯ä¹Ÿè¦é©¬å…‹æ¯ã€‹ - æ—¥æœ¬åŠ¨ç”»å…¬å¸ 135 2021/07/31 ã€Šå‘é˜³ç´ æã€‹ï¼ˆå…¨å­£+SPï¼‰ - SHAFTã€ã€Aniplexã€èŠ³æ–‡ç¤¾ã€Movicã€‘ï¼ˆååŠ©ï¼‰ 136 2021/08/01 ã€Šå¤©å®ä¼å¦–å½•ï¼ˆç¬¬äºŒå­£ï¼‰ - ç„æœº 137 2021/08/04 ã€Šå‰è¯´ã€‹ - Studioäº”ç»„ã€AXsiZ 138 2021/08/09 ã€Šå¤è‰²å¥‡è¿¹ã€‹ - æ—¥å‡åŠ¨ç”» ","date":"2020-09-30","objectID":"/myBlog-2/anime/:2:0","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"å¹´åº¦æœ€å–œæ¬¢çš„å£°ä¼˜(åŠæ‰€é…éŸ³è§’è‰²) æ°´æ¿‘ç¥ˆï¼šåƒæˆ·ã€é¦™é£æ™ºä¹ƒï¼› ","date":"2020-09-30","objectID":"/myBlog-2/anime/:2:1","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"å¹´åº¦æœ€å–œæ¬¢çš„OP/ED/OST/IN More One Nightã€å°‘å¥³ç»ˆæœ«æ—…è¡ŒEDã€‘ï¼› é›¨ã ã‚Œã®æ­Œã€å°‘å¥³ç»ˆæœ«æ—…è¡Œ INã€‘ï¼› æµæ˜Ÿãƒ‰ãƒªãƒ¼ãƒ ãƒ©ã‚¤ãƒ³ãƒãƒ©ãƒ¼ãƒ‰ã€SHOW BY ROCK!! INã€‘ï¼› æ„›ã®ã‚·ãƒ¥ãƒ—ãƒªãƒ¼ãƒ ï¼ã€å°æ—å®¶çš„é¾™å¥³ä»†S OPã€‘ï¼› ","date":"2020-09-30","objectID":"/myBlog-2/anime/:2:2","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["Anime"],"content":"â€“ ç»Ÿè®¡ â€“ æˆªæ­¢2021å¹´08æœˆ17æ—¥09:42:22ï¼Œç•ªå‰§æ€»æ•°ä¸ºã€138+ã€‘ï¼Œå…¶ä¸­ï¼š æ³¡é¢ç•ªğŸœï¼šã€20ã€‘ ç»­é›†ç•ªï¼šã€4ã€‘ ","date":"2020-09-30","objectID":"/myBlog-2/anime/:3:0","tags":["Anime"],"title":"æˆ‘çš„åŠ¨æ¼«ä¹‹æ—…(My Anime Trip.)","uri":"/myBlog-2/anime/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"è´­ç½®èƒŒæ™¯ ã€€é•¿è¾¾ä¸¤ä¸ªå¤šæœˆçš„èæ³½å®ä¹ ç»“æŸäº†ï¼Œæ„Ÿè§‰å¦‚é‡Šé‡è´Ÿï¼Œç»ˆäºæ‘†è„±äº†å®ä¹ å¸¦æ¥çš„å›°æ‰°å’Œé™åˆ¶ï¼Œå¿ƒæƒ…ä¹Ÿä¸ç”±åœ°å˜å¥½äº†èµ·æ¥ã€‚åœ¨è¿”æ ¡çš„ç«è½¦ä¸Šï¼Œé—²ç€æ²¡äº‹åˆ·äº†åˆ·é—²é±¼ï¼Œçœ‹äº†çœ‹è‡ªå·±è¿™æ®µæ—¶é—´ä»¥æ¥å–å‡ºçš„è™šæ‹Ÿå•†å“ï¼ˆä»£æ­å»ºåšå®¢/ä»£ä¸‹è½½GitHubèµ„æºç­‰ï¼‰ï¼Œå¤§æ¦‚èµšäº†1kå—é’±å·¦å³å§ï¼Œå‘ƒâ€¦è¿˜æ˜¯è›®ä¸é”™çš„ã€‚ ã€€ç„¶åä¸ç»æ„ä¹‹é—´å°±çœ‹åˆ°æˆ‘ä¸Šä¸Šå­¦æœŸä¹°åˆ°çš„èœ—ç‰›æ˜Ÿé™…Bæ¬¾åŒåƒï¼ˆçŸ¿éš¾æ— æƒ…äººæœ‰æƒ…ï¼‰ï¼Œæƒ³èµ·æ¥æœºå­è¿˜åœ¨å®¿èˆæ¡Œå­ä¸Šï¼Œå¤§åŠå¹´æ²¡åŠ¨è¿‡äº†ï¼Œä¼°è®¡å·²ç»åƒç°äº†ã€‚æ­£å½“æˆ‘çŠ¹è±«æ˜¯æŒ‚é—²é±¼è½¬æ‰‹å†å–å‡ºå»æ—¶ï¼ˆèƒ½å°èµšä¸€ç¬”ï¼‰ï¼Œæˆ‘çœ‹åˆ°äº†äºŒæ‰‹çš„ç¬”è®°æœ¬æ‹†æœºå±å¹•ï¼ŒèŒå‘èµ·é‡æŒ¯èœ—ç‰›æ˜Ÿé™…çš„æƒ³æ³•ï¼Œåˆæƒ³äº†æƒ³å®ä¹ ä¹Ÿèµšäº†ç‚¹å°é’±ï¼Œæï¼ã€‚è¯¢é—®äº†ä¸€åœˆä¹‹åï¼Œæœ€ç»ˆä¹°ä¸‹äº†è¿™æ¬¾å‹å·ä¸ºå‹è¾¾(AUO)-B101EW05 V1(AUO51D4)çš„æ‹†æœºå±ï¼Œå¤§å°æ˜¯10.1å¯¸ï¼Œæœ€é«˜åˆ†è¾¨ç‡ä¸º1280*800ï¼Œå‚æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æœ‰äººä¼šé—®ä¸ºå•¥éè¦ä¹°ä¸€ä¸ªäºŒæ‰‹æ‹†æœºå±å‘¢ï¼Ÿï¼ˆå…¶å®æ ¹æœ¬æ²¡äººé—®ï¼Œè¿™ä¸€åˆ‡éƒ½æ˜¯åšä¸»è‡ªå·±å¹»æƒ³å‡ºæ¥çš„ï¼‰ ç†ç”±å¦‚ä¸‹ï¼š æ‰‹ä¸Šæ²¡æœ‰ç°æˆçš„æ˜¾ç¤ºå±ï¼Œä¹‹å‰å…¨æ˜¯å€Ÿéš”å£å®¿èˆçš„æ˜¾ç¤ºå±æ¥ç”¨çš„; ç¬”è®°æœ¬æ˜¾ç¤ºå±é©±åŠ¨éƒ¨ä»¶åµŒåœ¨ä¸»æ¿ä¸Šï¼Œæ— æ³•ç›´æ¥ä½¿ç”¨; å¯ä»¥ä½œä¸ºç¬”è®°æœ¬æ‹“å±•å±ï¼Œä¸€ç®­åŒé›•; æœ€åä¸€ç‚¹ä¹Ÿæ˜¯æœ€æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œç©·ç©·ç©·ï¼Œæ²¡é’±ä¹°æ‹“å±•å±ï¼Œåªèƒ½è‡ªå·±ä¹°ç ´çƒ‚å‡‘ä¸€ä¸ªã€‚ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:1:0","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"å…¶ä»–ç¡¬ä»¶è®¾å¤‡è´­ç½® ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:2:0","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"é©±åŠ¨æ¿ ã€€å…‰æœ‰æ˜¾ç¤ºå±è¿˜ä¸è¡Œï¼Œè¿˜éœ€è¦é©±åŠ¨æ¿æ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä¸å¾—ä¸è¯´é—²é±¼å’Œæ·˜å®æ˜¯ä¸‡èƒ½çš„ï¼Œä»€ä¹ˆä¸œè¥¿éƒ½èƒ½å¤Ÿä¹°åˆ°ï¼Œåœ¨è‹¦è‹¦å¯»æ‰¾å’Œå¯¹æ¯”äº†ä¸€ç•ªä¹‹åï¼Œæœ€ç»ˆæ‰¾åˆ°äº†ä¸€ä¸ªæ·˜å®å–å®¶ï¼ˆåº—é“ºé“¾æ¥ï¼šhttpsï¼š//m.tb.cn/h.VBYebL1?sm=6c9ebe ï¼‰ï¼Œé”€é‡å’Œå£ç¢‘éƒ½è¿˜ä¸é”™ï¼ŒæŠŠæ˜¾ç¤ºå±å‹å·å‘ç»™å–å®¶åï¼Œå–å®¶åˆ¶ä½œå®Œå½“å¤©æ™šä¸Šå°±å‘è´§äº†ï¼ŒçœŸæ˜¯è¿…é€Ÿå•Šï¼Œç‚¹ä¸ªèµ:+1:ã€‚ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:2:1","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"mSATA ã€€èœ—ç‰›æ˜Ÿé™…åŸè£…è‡ªå¸¦çš„mSATAæ˜¯16gçš„ï¼Œåªå¤Ÿè£…ä¸ªpveã€VMware ESXiã€iKuaiã€openwrtã€ç¾¤æ™–å•¥çš„ï¼Œæ ¹æœ¬ä¸å¤Ÿç”¨çš„ï¼Œç„¶åå˜ï¼Œè‡ªå·±åˆæƒ³å®‰è£…ä¸ªWindows Server 2008 R2æŒ‚ä¸€äº›è½¯ä»¶ï¼Œæ‰€ä»¥å°±ä¸‹ç‹ å¿ƒæ¥åˆä¹°äº†ä¸€æ¡128gçš„æ¸£å£«é¡¿mSATAå›ºæ€ç¡¬ç›˜ï¼Œä¹Ÿæ˜¯é—²é±¼ä¹°çš„ï¼Œå¤§æ¦‚100è½¯å¦¹å¸ï¼ŒMLCé¢—ç²’çš„ï¼Œè¿˜æ˜¯è›®å€¼çš„ã€‚ CrystalDiskMarkè·‘åˆ†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ã€€è¿™æ ·ä¸€æ¥ï¼Œæ‹†èœ—ç‰›æ˜Ÿé™…å¤šå‡ºæ¥çš„é‚£å—mSATA 16gå²‚ä¸æ˜¯åƒç°äº†ï¼Ÿä¸ï¼Œåƒåœ¾ä½¬ä¸ä¼šå°±æ­¤æ­¢æ­¥ï¼Œä¸ä¼šã€‚ æ‰€ä»¥å°±æœ‰äº†ä¸‹é¢è¿™ä¸ªè®¾å¤‡:laughing:ã€‚ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:2:2","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"USB3.0 TO mSATA Box ã€€è¿™å°ä¸œè¥¿åŠŸèƒ½å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠmSATAæ¥å£è½¬ä¸ºUSBæ¥å£ï¼Œä»¥ä¾¿ç›´æ¥æ’åœ¨ç”µè„‘ä¸Šç›´æ¥ä½¿ç”¨ã€‚å®ä½“å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š è¿˜æ˜¯è›®å¥½çœ‹çš„ï¼Œä¸é”™ï¼Œä¸é”™ã€‚ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:2:3","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"HDMI çº¿ \u0026 äºšå…‹åŠ›å£³ ã€€ä¸»è¦è®¾å¤‡ä¹°å®Œä¹‹åï¼Œçªç„¶å‘ç°è¿˜ç¼ºä¸€æ¡HDMIçº¿ï¼Œå›å®¿èˆæ‰¾äº†æ‰¾æ²¡æ‰¾åˆ°åŸæ¥é‚£æ ¹ï¼Œäºæ˜¯10å—é’±åœ¨é—²é±¼åˆä¹°äº†æ¡ç»¿è”0.75mçš„HDMIçº¿ï¼Œé»„è‰²æ‰çº¿å‹çš„ã€‚ äºšå…‹åŠ›å£³å­æ˜¯ä¹°é©±åŠ¨æ¿æ—¶åŠ ä»·10å—ä¹°çš„ï¼Œç”¨æ¥ä¿æŠ¤é©±åŠ¨æ¿å„å…ƒä»¶å’Œå¢åŠ è§‚èµæ€§ç”¨çš„ã€‚ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:2:4","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"æˆæœå±•ç¤º-é™„å…¨å®¶ç¦ æ¡Œé¢å›¾ï¼š ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:3:0","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"æœªæ¥ç”¨é€” ã€€ä»¥åæœ‰ç©ºçš„è¯ä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»èœ—ç‰›æ˜Ÿé™…çš„ç”¨é€”ï¼Œæ•¬è¯·æœŸå¾…å§ï¼ ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:4:0","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"å‚è€ƒèµ„æ–™ ã€è£…æœºæ—¥å¸¸ã€‘åºŸæ—§ç¬”è®°æœ¬ä¸è¦æ‰”ï¼Œæ‹†ä¸‹å±å¹•ï¼Œè£¹ä¸Šé©±åŠ¨æ¿ï¼Œåšæˆå‰¯å±ï¼Œéš”å£å°å­©éƒ½é¦‹å“­å•¦ï¼ï¼š httpsï¼š//www.youtube.com/watch?v=V1wC3KKF2TM ","date":"2020-09-14","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/:5:0","tags":["æ—¥è®°","é—²é±¼","åƒåœ¾ä½¬"],"title":"ã€æ—¥è®°ã€‘é—²é±¼åƒåœ¾ä½¬çš„ä¸€å¤©","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%97%B2%E9%B1%BC%E5%9E%83%E5%9C%BE%E4%BD%AC%E7%9A%84%E4%B8%80%E5%A4%A9/"},{"categories":["CentOS"],"content":" æ­å»ºå†…ç½‘yumæºï¼Œæ‘†è„±è½¯ä»¶åŒ…å›°æ‰°ã€‚ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:0:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"é€‰æ‹©åˆé€‚ç¨³å®šçš„å…¬ç½‘yumä»“åº“ å»ºè®®é€‰æ‹©å¯¹è¿è¥å•†ç½‘ç»œå‹å¥½çš„yumä»“åº“ å›½å†…å¯ä¾›é€‰æ‹©çš„æœ‰: é˜¿é‡Œäº‘ï¼šhttp://mirrors.aliyun.com/ (è¿™é‡Œæˆ‘ä½¿ç”¨é˜¿é‡Œäº‘) ç½‘æ˜“ï¼šhttp://mirrors.163.com/ æ›´å¤šå›½å†…é•œåƒä»“åº“å‚è€ƒï¼šhttps://blog.csdn.net/wyqwilliam/article/details/90581159 ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:1:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"å®‰è£…nginxå¹¶ä¿®æ”¹é…ç½®æ–‡ä»¶ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨yumä»“åº“è¿›è¡Œå®‰è£…. [root@centos-7 ~]# yum install nginx -y [root@centos-7 ~]# vi /etc/nginx/conf.d/default.conf # -----åœ¨serveræ®µæ·»åŠ ä»¥ä¸‹å†…å®¹ # è‡ªåŠ¨åœ¨index.htmlçš„ç´¢å¼•æ‰“å¼€ autoindex on; # å¦‚æœæœ‰æ–‡ä»¶åˆ™æ˜¾ç¤ºæ–‡ä»¶å¤§å° autoindex_exact_size on; # æ˜¾ç¤ºæ›´æ”¹æ—¶é—´ï¼Œä»¥å½“å‰ç³»ç»Ÿæ—¶é—´ä¸ºå‡† autoindex_localtime on å…·ä½“ä½ç½®åœ¨ä¸‹é¢è¿™ä¸ªä½ç½® å¯åŠ¨nginxï¼Œä½¿ç”¨service nignx start å³å¯ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:2:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"åˆ›å»ºè‡ªå®šä¹‰index.htmlæ–‡ä»¶ ä¿®æ”¹é»˜è®¤index.htmlä¸ºä»¥ä¸‹å†…å®¹ï¼š \u003cp style=\"font-weight:bolder;color:green;font-size:30px;\"\u003eALL of the packages in the below:\u003c/p\u003e \u003cbr/\u003e \u003ca href=\"http://192.168.1.128/CentOS-YUM/Aliyun\"\u003eAliyun\u003c/a\u003e\u003cbr/\u003e These packagers from of CentOS ISO.\u003cbr/\u003e \u003ca href=\"http://192.168.1.128/CentOS7-aliyun\"\u003eCentOS\u003c/a\u003e\u003cbr/\u003e These packagers from of \"Internet service provider\".\u003cbr/\u003e \u003cp style=\"font-weight:bolder;color:red;font-size:18px;\"\u003ePlease replace the file and fill in the following content:\u003c/p\u003e \u003cp style=\"font-weight:bolder;color:blue;font-size:15px;\"\u003eWay: /etc/yum.repos.d/CentOS-Base.repo\u003c/p\u003e åœ¨ç«™ç‚¹ç›®å½•ä¸­åˆ›å»ºCentOS-YUM/Aliyunï¼ˆæœ¬åœ°ISOæ–‡ä»¶ä»“åº“ï¼‰å’ŒCentOS7-aliyunç›®å½• ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:3:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"æ·»åŠ å¹¶åŒæ­¥é˜¿é‡Œäº‘yumæº æ·»åŠ é˜¿é‡Œäº‘CentOS7 yumæº # æ³¨æ„å¤‡ä»½åŸä»“åº“æº curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo åŒæ­¥é˜¿é‡Œäº‘CentOS7 yumæºåˆ°ä¹‹å‰åˆ›å»ºå¥½çš„ç›®å½•å½“ä¸­ï¼Œä½¿ç”¨å‘½ä»¤reposync -p /usr/share/nginx/html/CentOS7-aliyun æ¥ç€ï¼Œä½¿ç”¨createrepo -p /usr/share/nginx/html/CentOS7-aliyunæ¥åˆ›å»ºrepodataæ–‡ä»¶ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:4:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"å®¢æˆ·ç«¯é…ç½® ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸ºå®¢æˆ·ç«¯æ·»åŠ å†…ç½‘ä»“åº“åœ°å€ yum-config-manager --add-repo=\"http://192.168.1.128/CentOS7-aliyun/base/Packages\" yum makecache # æ›´æ–°ç¼“å­˜ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:5:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"åœ¨yumä»“åº“æœåŠ¡å™¨ç«¯åˆ›å»ºå®šæ—¶ä»»åŠ¡ æ–°å»ºshellæ›´æ–°è„šæœ¬update-aliyun.shï¼Œå†…å®¹å¦‚ä¸‹ï¼š #!/bin/bash /usr/bin/reposync -np /usr/share/nginx/html/CentOS7-aliyun ä½¿ç”¨chmod +x update-aliyun.shä¸ºå…¶æ·»åŠ æ‰§è¡Œæƒé™ æ·»åŠ å®šæ—¶ä»»åŠ¡(æ¯5minæ‰§è¡Œä¸€æ¬¡) 5 * * * * root run-parts /root/update-aliyun.sh å…¶ä¸­run-partsçš„æ„æ€æ˜¯æ‰§è¡Œåé¢ç›®å½•ä¸­çš„è„šæœ¬ã€‚ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:6:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"ä½¿ç”¨ftpæ­å»ºyumæœ¬åœ°å’Œè¿œç¨‹ä»“åº“ ä»¥ä¸‹ä»…è®°å½•å…³é”®å‘½ä»¤ï¼š $ yum install vsftpd $ systemctl start vsftpd \u0026\u0026 systemctl enable vsftpd # å¼€å¯yumç¼“å­˜åŠŸèƒ½ $ vim /etc/yum.conf [main] cachedir=/var/cache/yum/$basearch/$releasever keepcache=1 # æ¸…é™¤ç¼“å­˜ $ yum clean all # è®¾ç½®åŸºç¡€å…‰ç›˜baseæº $ mkdir /var/ftp/centos7-base $ mount /dev/cdrom /mnt $ cp -arp /mnt/Packages/*.rpm /var/ftp/centos7-base # æä¾›ç¬¬ä¸‰æ–¹é•œåƒæº $ cd /var/ftp # åŒæ­¥ä¸­ç§‘å¤§çš„nginxæºåˆ°ä»¥ä¸Šç›®å½• $ rsync -avzP rsync://rsync.mirrors.ustc.edu.cn/repo/nginx ./ # å®‰è£…createrepoå·¥å…·å¹¶åˆ›å»ºrepodataä»“åº“ $ yum install -y createrepo # ç”Ÿæˆrepodata $ createrepo ./ éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå¦‚æœä»“åº“ä¸­æ–°å¢è½¯ä»¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆrepodataï¼Œä¹Ÿå¯ä»¥é€šè¿‡è§¦å‘è„šæœ¬å®ç°ã€‚ å®¢æˆ·ç«¯æ·»åŠ è¿œç¨‹yumä»“åº“ï¼š $ yum-config-manager --add-repo=\"ftp://YOUR_SERVER_IP/centos7-base\" $ yum-config-manager --add-repo=\"ftp://YOUR_SERVER_IP/nginx\" # å½“ç„¶ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶æŒ‡å®šè¿œç¨‹ä»“åº“ $ vim /etc/yum.repos.d/centos7-base.repo [centos7-base] name=centos 7 base baseurl=ftp://YOUR_SERVER_IP/centos7-base enabled=1 gpgcheck=0 ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:7:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["CentOS"],"content":"é™„å½•ï¼šrpmå’Œyumå¸¸ç”¨å‘½ä»¤ rpmå¸¸ç”¨å‘½ä»¤ï¼š rpm -q # æŸ¥çœ‹æŒ‡å®šè½¯ä»¶åŒ…æ˜¯å¦å®‰è£… rpm -qa # æŸ¥çœ‹ç³»ç»Ÿä¸­å·²å®‰è£…çš„æ‰€æœ‰RPMè½¯ä»¶åŒ…åˆ—è¡¨ rpm -qi # æŸ¥çœ‹æŒ‡å®šè½¯ä»¶çš„è¯¦ç»†ä¿¡æ¯ rpm -ql # æŸ¥è¯¢æŒ‡å®šè½¯ä»¶åŒ…æ‰€å®‰è£…çš„ç›®å½•ã€æ–‡ä»¶åˆ—è¡¨ rpm -qc # æŸ¥è¯¢æŒ‡å®šè½¯ä»¶åŒ…çš„é…ç½®æ–‡ä»¶ rpm -qd # æŸ¥è¯¢æŒ‡å®šè½¯ä»¶åŒ…çš„å¸®åŠ©æ–‡æ¡£ rpm -qf # æŸ¥è¯¢æ–‡ä»¶æˆ–ç›®å½•å±äºå“ªä¸ªRPMè½¯ä»¶ rpm -q --scripts # æŸ¥è¯¢rpmåŒ…å®‰è£…å‰å’Œå®‰è£…åæ‰§è¡Œçš„è„šæœ¬ # æŸ¥è¯¢æœªå®‰è£…çš„è½¯ä»¶åŒ…ä¿¡æ¯ rpm -qip # æŸ¥è¯¢æœªå®‰è£…çš„rpmåŒ…è¯¦ç»†ä¿¡æ¯ rpm -qlp # æŸ¥è¯¢æœªå®‰è£…çš„è½¯ä»¶åŒ…ä¼šäº§ç”Ÿå“ªäº›æ–‡ä»¶ # rpm è½¯ä»¶åŒ…å‡çº§ rpm -Uvh # å¦‚æœè€ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œåˆ™å…¨æ–°å®‰è£… rpm -fvh # è€ç‰ˆæœ¬å¿…é¡»å­˜åœ¨ # å¸è½½è½¯ä»¶åŒ… rpm -e yumå¸¸ç”¨å‘½ä»¤ï¼š # åœ¨çº¿æŸ¥è¯¢è½¯ä»¶åŒ… yum provides zip yum provides */ifconfig yum check-update # æ£€æŸ¥æ›´æ–° yum clean package # åªæ¸…é™¤è½¯ä»¶åŒ…ç¼“å­˜ # yumå†å²å‘½ä»¤ # æŸ¥çœ‹å†å²æ‰§è¡Œyumå‘½ä»¤ yum history # æŸ¥è¯¢å†å²æ‰§è¡Œyumå‘½ä»¤IDè¯¦ç»†ä¿¡æ¯ yum history info N # æ’¤é”€å†å²æ‰§è¡Œè¿‡çš„yumå‘½ä»¤ yum history undo N ","date":"2020-08-04","objectID":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/:8:0","tags":["yum"],"title":"æ­å»ºå†…ç½‘yumæº(nginxã€ftp)","uri":"/myBlog-2/post/%E6%90%AD%E5%BB%BA%E5%86%85%E7%BD%91yum%E6%BA%90/"},{"categories":["Git"],"content":"Git é’©å­å’Œå…¶å®ƒç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸€æ ·ï¼ŒGit èƒ½åœ¨ç‰¹å®šçš„é‡è¦åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è‡ªå®šä¹‰è„šæœ¬ã€‚ æœ‰ä¸¤ç»„è¿™æ ·çš„é’©å­ï¼šå®¢æˆ·ç«¯çš„å’ŒæœåŠ¡å™¨ç«¯çš„ã€‚ å®¢æˆ·ç«¯é’©å­ç”±è¯¸å¦‚æäº¤å’Œåˆå¹¶è¿™æ ·çš„æ“ä½œæ‰€è°ƒç”¨ï¼Œè€ŒæœåŠ¡å™¨ç«¯é’©å­ä½œç”¨äºè¯¸å¦‚æ¥æ”¶è¢«æ¨é€çš„æäº¤è¿™æ ·çš„è”ç½‘æ“ä½œã€‚ ä½ å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¿ç”¨è¿™äº›é’©å­ã€‚ ","date":"2020-08-04","objectID":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/:0:0","tags":["Git","hook"],"title":"Git Hookä»‹ç»ä¸ä½¿ç”¨","uri":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"categories":["Git"],"content":"å®‰è£…é’©å­ é’©å­éƒ½è¢«å­˜å‚¨åœ¨ Git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ã€‚ ä¹Ÿå³ç»å¤§éƒ¨åˆ†é¡¹ç›®ä¸­çš„ .git/hooks ã€‚ å½“ä½ ç”¨ git init åˆå§‹åŒ–ä¸€ä¸ªæ–°ç‰ˆæœ¬åº“æ—¶ï¼ŒGit é»˜è®¤ä¼šåœ¨è¿™ä¸ªç›®å½•ä¸­æ”¾ç½®ä¸€äº›ç¤ºä¾‹è„šæœ¬ã€‚ è¿™äº›è„šæœ¬é™¤äº†æœ¬èº«å¯ä»¥è¢«è°ƒç”¨å¤–ï¼Œå®ƒä»¬è¿˜é€éœ²äº†è¢«è§¦å‘æ—¶æ‰€ä¼ å…¥çš„å‚æ•°ã€‚ æ‰€æœ‰çš„ç¤ºä¾‹éƒ½æ˜¯ shell è„šæœ¬ï¼Œå…¶ä¸­ä¸€äº›è¿˜æ··æ‚äº† Perl ä»£ç ï¼Œä¸è¿‡ï¼Œä»»ä½•æ­£ç¡®å‘½åçš„å¯æ‰§è¡Œè„šæœ¬éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ â€”â€” ä½ å¯ä»¥ç”¨ Ruby æˆ– Pythonï¼Œæˆ–ä»»ä½•ä½ ç†Ÿæ‚‰çš„è¯­è¨€ç¼–å†™å®ƒä»¬ã€‚ è¿™äº›ç¤ºä¾‹çš„åå­—éƒ½æ˜¯ä»¥ .sample ç»“å°¾ï¼Œå¦‚æœä½ æƒ³å¯ç”¨å®ƒä»¬ï¼Œå¾—å…ˆç§»é™¤è¿™ä¸ªåç¼€ã€‚ æŠŠä¸€ä¸ªæ­£ç¡®å‘½åï¼ˆä¸å¸¦æ‰©å±•åï¼‰ä¸”å¯æ‰§è¡Œçš„æ–‡ä»¶æ”¾å…¥ .git ç›®å½•ä¸‹çš„ hooks å­ç›®å½•ä¸­ï¼Œå³å¯æ¿€æ´»è¯¥é’©å­è„šæœ¬ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå®ƒå°±èƒ½è¢« Git è°ƒç”¨ã€‚ åˆ›å»ºä¸€ä¸ªç©ºçš„ä»“åº“ï¼š git --bare init # æ¨èä½¿ç”¨ # git init å…¶ä¸­--bareå‚æ•°è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªè£¸ä»“åº“ï¼Œè£¸ä»“åº“ä½•æ„ï¼Ÿä¸æ™®é€šç©ºä»“åº“æœ‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå‚è€ƒï¼šhttps://www.cnblogs.com/irockcode/p/8761954.html ä½†æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹çš„æ˜¯gitä»“åº“å’Œgitè£¸ä»“åº“çš„é’©å­æ‰€åœ¨ä½ç½®ä¸åŒ: gitæ™®é€šä»“åº“é’©å­åœ¨.git/hooks/ä¸­ gitè£¸ä»“åº“é’©å­åœ¨hooks/ä¸­ è£¸ä»“åº“åˆå§‹åŒ–å®Œæˆåï¼Œåœ¨hooksæ–‡ä»¶å¤¹ä¸­ä¼šå‘ç°ä¸€äº›ä»¥.sampleç»“å°¾çš„å®ä¾‹æ–‡ä»¶ï¼š ","date":"2020-08-04","objectID":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/:1:0","tags":["Git","hook"],"title":"Git Hookä»‹ç»ä¸ä½¿ç”¨","uri":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"categories":["Git"],"content":"å®¢æˆ·ç«¯é’©å­ç®€å•ç¤ºä¾‹ ä½¿ç”¨commit-msgé’©å­å®ç°commitä¿¡æ¯å­—ç¬¦æ•°é™åˆ¶ï¼ˆå®é™…å¯èƒ½æ²¡ä»€ä¹ˆåµç”¨,ä»…ä½œä¸ºå­¦ä¹ å‚è€ƒï¼‰ ç¼–è¾‘.git/hooks/commit-msgæ–‡ä»¶å¦‚ä¸‹ï¼š âœ git-hook-test git:(master) âœ— cat .git/hooks/commit-msg 20:55:37 #!/bin/sh MSG=`awk '{printf(\"%s\",$0)}' $1` if [ ${#MSG} -lt 5 ] then echo \"-------------------------------------------------------------------\" echo \"commit message åªæœ‰${#MSG}å­—ç¬¦ï¼Œä¸ç¬¦åˆè¦æ±‚\" echo \"messageçš„é•¿åº¦ä¸èƒ½å°äº5, æœ¬æ¬¡æäº¤å¤±è´¥ï¼Œè¯·å®Œå–„commit messageï¼Œå†æäº¤\" echo \"-------------------------------------------------------------------\" exit 1 fi ä¸ºcommit-msgæ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ï¼š chmod u+x .git/hooks/commit-msg ç”Ÿæˆä¸€æ¬¡æäº¤ä¿¡æ¯ï¼š âœ git-hook-test git:(master) âœ— git add . 21:00:48 âœ git-hook-test git:(master) âœ— git commit -m \"test\" ------------------------------------------------------------------- commit message åªæœ‰4å­—ç¬¦ messageçš„é•¿åº¦ä¸èƒ½å°äº5, æœ¬æ¬¡æäº¤å¤±è´¥ï¼Œè¯·å®Œå–„commit messageï¼Œå†æäº¤ ------------------------------------------------------------------- ä¸æ»¡è¶³æœ€ä½5å­—ç¬¦è¦æ±‚ï¼Œæäº¤å¤±è´¥ã€‚ ","date":"2020-08-04","objectID":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/:2:0","tags":["Git","hook"],"title":"Git Hookä»‹ç»ä¸ä½¿ç”¨","uri":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"categories":["Git"],"content":"æœåŠ¡ç«¯é’©å­ç®€å•ç¤ºä¾‹ ä½¿ç”¨post-receiveå°†ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ æµç¨‹å¤§è‡´å¦‚ä¸‹ï¼šåœ¨æœåŠ¡å™¨ç«¯åˆ›å»ºä¸€ä¸ª Git ä»“åº“(repository)ï¼Œç„¶åå°†æœ¬åœ°çš„æ–‡ä»¶ä½¿ç”¨git pushä¸Šä¼ åˆ°è¿™ä¸ªä»“åº“åï¼Œå°†ä¸Šä¼ åˆ°Git ä»“åº“çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨å¤åˆ¶åˆ°æœåŠ¡å™¨é‡Œç½‘ç«™ç›®å½•æ–‡ä»¶å¤¹ä¸‹ã€‚ åœ¨æœåŠ¡å™¨ç«¯åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„Gitä»“åº“ git init --bare myblog.git åœ¨hooksç›®å½•ä¸­åˆ›å»ºpost-receiveæ–‡ä»¶ï¼Œå¹¶ç»™äºˆæ‰§è¡Œæƒé™ cd hooks/ touch post-receive;chmod u+x post-receive ç¼–è¾‘post-receiveæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š [root@localhost hooks]# cat post-receive #!/bin/bash -l GIT_REPO=/root/myblog.git TMP_GIT_CLONE=/tmp/myblog PUBLIC_WWW=/var/www/html rm -rf ${TMP_GIT_CLONE} git clone $GIT_REPO $TMP_GIT_CLONE cd $TMP_GIT_CLONE rm -rf ${PUBLIC_WWW}/* cp -rf ${TMP_GIT_CLONE}/* ${PUBLIC_WWW} æœ¬åœ°æ·»åŠ è¿œç¨‹Gitä»“åº“å¹¶è¿›è¡Œæµ‹è¯• âœ test git:(master) âœ— git remote add deploy ssh://root@172.16.224.128:/root/myblog.git 21:20:35 âœ test git:(master) âœ— git add . 21:20:52 âœ test git:(master) âœ— git commit -m \"auto deploy test\" 21:21:01 [master (root-commit) 26fde86] auto deploy test 2 files changed, 1 insertion(+) create mode 100644 index.html create mode 100644 testfile âœ test git:(master) git push --set-upstream deploy master 21:28:19 åœ¨gitæœåŠ¡å™¨ç«¯æŸ¥çœ‹post-receiveæ˜¯å¦æˆåŠŸè¿è¡Œ [root@localhost ~]# cd /var/www/html/ [root@localhost html]# ls index.html testfile [root@localhost html]# cat index.html auto deploy auto deploy å°†ä»£ç æ¨é€æŒ‡å®šåˆ†æ”¯ï¼š #!/bin/bash -l while read oldrev newrev ref do branch=`echo $ref | cut -d/ -f3` if [ \"master\" == \"$branch\" ] || [ \"production\" == \"$branch\" ]; then GIT_REPO=/root/myblog.git TMP_GIT_CLONE=/tmp/myblog PUBLIC_WWW=/var/www/html rm -rf ${TMP_GIT_CLONE} git clone $GIT_REPO $TMP_GIT_CLONE cd $TMP_GIT_CLONE unset GIT_DIR git checkout $branch rm -rf ${PUBLIC_WWW}/* cp -rf ${TMP_GIT_CLONE}/* ${PUBLIC_WWW} fi done æ›´å¤šé’©å­å‚è€ƒï¼šhttps://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90 ","date":"2020-08-04","objectID":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/:3:0","tags":["Git","hook"],"title":"Git Hookä»‹ç»ä¸ä½¿ç”¨","uri":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"categories":["Git"],"content":"å‚è€ƒé“¾æ¥ gité’©å­-å›¾çµç¤¾åŒº git hooks with python commit-msgå®ç”¨ç¤ºä¾‹ ","date":"2020-08-04","objectID":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/:4:0","tags":["Git","hook"],"title":"Git Hookä»‹ç»ä¸ä½¿ç”¨","uri":"/myBlog-2/post/git-hook%E4%BB%8B%E7%BB%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/"},{"categories":[],"content":"gulp å°†å¼€å‘æµç¨‹ä¸­è®©äººç—›è‹¦æˆ–è€—æ—¶çš„ä»»åŠ¡è‡ªåŠ¨åŒ–ï¼Œä»è€Œå‡å°‘ä½ æ‰€æµªè´¹çš„æ—¶é—´ã€åˆ›é€ æ›´å¤§ä»·å€¼ã€‚ å®˜æ–¹ç«™ç‚¹ï¼šhttps://www.gulpjs.com.cn/ ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:0","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":[],"content":"1ã€å…¨å±€å®‰è£…gulp npm install gulp -g # æŸ¥çœ‹ç‰ˆæœ¬ gulp -v ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:1","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":[],"content":"2ã€å®‰è£…gulpæ’ä»¶ åœ¨ç«™ç‚¹æ ¹ç›®å½•ä¸‹å®‰è£… npm install gulp --save npm install gulp-minify-css --save npm install gulp-uglify --save npm install gulp-htmlmin --save npm install gulp-htmlclean --save npm install gulp-imagemin --save # è§£å†³ã€Gulpæ‰“åŒ…é—®é¢˜ã€‘ GulpUglifyError: unable to minify JavaScript # è§£å†³ gulp-uglify å‹ç¼©JavaScript ä¸å…¼å®¹ es5 è¯­æ³•çš„é—®é¢˜ npm install babel-core@6.26.3 --save npm install gulp-babel@7.0.1 --save npm install babel-preset-es2015@6.24.1 --save # gulp-babel å–æ¶ˆä¸¥æ ¼æ¨¡å¼æ–¹æ³•(\"use strict\") npm install babel-plugin-transform-remove-strict-mode --save é—®é¢˜ï¼šå¦‚æœå®‰è£…gulp-imageminé”™è¯¯è¯·æ‰§è¡Œä»¥ä¸‹è¯­å¥ sudo npm i gulp-imagemin --unsafe-perms ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:2","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":[],"content":"3ã€åˆ›å»ºgulpfile.jsæ–‡ä»¶ åœ¨ Hexo ç«™ç‚¹ä¸‹æ–°å»ºgulpfile.jsæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š var gulp = require('gulp'); var minifycss = require('gulp-minify-css'); var uglify = require('gulp-uglify'); var htmlmin = require('gulp-htmlmin'); var htmlclean = require('gulp-htmlclean'); var imagemin = require('gulp-imagemin'); var babel = require('gulp-babel'); // å‹ç¼©cssæ–‡ä»¶ gulp.task('minify-css', function (done) { return gulp.src('./public/**/*.css') .pipe(minifycss()) .pipe(gulp.dest('./public')); done(); }); // å‹ç¼©htmlæ–‡ä»¶ gulp.task('minify-html', function (done) { return gulp.src('./public/**/*.html') .pipe(htmlclean()) .pipe(htmlmin({ removeComments: true, minifyJS: true, minifyCSS: true, minifyURLs: true, })) .pipe(gulp.dest('./public')); done(); }); // å‹ç¼©jsæ–‡ä»¶ gulp.task('minify-js', function (done) { return gulp.src(['./public/**/*.js', '!./public/**/*.min.js']) .pipe(babel({ //å°†ES6ä»£ç è½¬è¯‘ä¸ºå¯æ‰§è¡Œçš„JSä»£ç  presets: ['es2015'] // es5æ£€æŸ¥æœºåˆ¶ })) .pipe(uglify()) .pipe(gulp.dest('./public')); done(); }); // å‹ç¼© public/images ç›®å½•å†…å›¾ç‰‡(Version\u003c3) // gulp.task('minify-images', function () { // gulp.src('./public/images/**/*.*') // .pipe(imagemin({ // optimizationLevel: 5, //ç±»å‹ï¼šNumber é»˜è®¤ï¼š3 å–å€¼èŒƒå›´ï¼š0-7ï¼ˆä¼˜åŒ–ç­‰çº§ï¼‰ // progressive: true, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse æ— æŸå‹ç¼©jpgå›¾ç‰‡ // interlaced: false, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse éš”è¡Œæ‰«ægifè¿›è¡Œæ¸²æŸ“ // multipass: false, //ç±»å‹ï¼šBoolean é»˜è®¤ï¼šfalse å¤šæ¬¡ä¼˜åŒ–svgç›´åˆ°å®Œå…¨ä¼˜åŒ– // })) // .pipe(gulp.dest('./public/images')); // }); // å‹ç¼© public/images ç›®å½•å†…å›¾ç‰‡(Version\u003e3) gulp.task('minify-images', function (done) { gulp.src('./public/images/**/*.*') .pipe(imagemin([ imagemin.gifsicle({interlaced: true}), imagemin.jpegtran({progressive: true}), imagemin.optipng({optimizationLevel: 5}), imagemin.svgo({ plugins: [ {removeViewBox: true}, {cleanupIDs: false} ] }) ])) .pipe(gulp.dest('./public/images')); done(); }); //4.0ä»¥å‰çš„å†™æ³• //gulp.task('default', [ // 'minify-html', 'minify-css', 'minify-js', 'minify-images' //]); //4.0ä»¥åçš„å†™æ³• // æ‰§è¡Œ gulp å‘½ä»¤æ—¶æ‰§è¡Œçš„ä»»åŠ¡ gulp.task('default', gulp.series(gulp.parallel('minify-html', 'minify-css', 'minify-js', 'minify-images')), function () { console.log(\"----------gulp Finished----------\"); // Do something after a, b, and c are finished. }); ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:3","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":[],"content":"4ã€åˆ›å»º.babelrcæ–‡ä»¶ åœ¨ Hexo ç«™ç‚¹ä¸‹æ–°å»º.babelrcæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š { 'presets': ['es2015'], \"plugins\": [\"transform-remove-strict-mode\"] } ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:4","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":[],"content":"5ã€å¯ç”¨é™æ€èµ„æºå‹ç¼© æ¨èå§¿åŠ¿ï¼š hexo cl \u0026\u0026 hexo g \u0026\u0026 gulp \u0026\u0026 hexo d å¯åœ¨package.json ä¸­çš„ \"scripts\" é¡¹å¢åŠ ä¸€ä¸ª \"publish\" å‘½ä»¤ï¼š { //... \"scripts\": { //... \"publish\": \"hexo cl \u0026\u0026 hexo g \u0026\u0026 gulp \u0026\u0026 hexo d\", //... } //... } ","date":"2020-08-04","objectID":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/:0:5","tags":["hexo","gulp"],"title":"Hexoåšå®¢ä½¿ç”¨gulpå‹ç¼©é™æ€èµ„æº 1","uri":"/myBlog-2/post/hexo%E5%8D%9A%E5%AE%A2%E4%BD%BF%E7%94%A8gulp%E5%8E%8B%E7%BC%A9%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90-1/"},{"categories":["GitHub"],"content":"é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆObject Storage Serviceï¼Œç®€ç§°OSSï¼‰ä¸ºæ‚¨æä¾›åŸºäºç½‘ç»œçš„æ•°æ®å­˜å–æœåŠ¡ã€‚ä½¿ç”¨OSSï¼Œæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’Œè°ƒç”¨åŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ç­‰åœ¨å†…çš„å„ç§éç»“æ„åŒ–æ•°æ®æ–‡ä»¶ã€‚ å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼šhttps://help.aliyun.com/document_detail/31883.html é¦–å…ˆæ‰“å¼€æ‰€è¦ä½¿ç”¨Github Actionsçš„ä»“åº“ï¼Œç‚¹å‡»Actionsï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„workflow æ­¤æ—¶ï¼Œgithubå°†ä¼šè‡ªåŠ¨åœ¨ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªåä¸º.github/workflowsçš„æ–‡ä»¶å¤¹ã€‚ ç¼–è¾‘é…ç½®æ–‡ä»¶oss.yml,è¾“å…¥ä»¥ä¸‹å†…å®¹ name:MainWorkflowon:[push]jobs:build:runs-on:ubuntu-lateststeps:- uses:actions/checkout@v1- uses:actions/setup-node@v1with:node-version:\"12.x\"- name:Build Blogrun:| npm install npm install -g hexo-cli hexo generate - uses: manyuanrong/setup-ossutil@v1.0 with: # endpoint å¯ä»¥å»ossæ§åˆ¶å°ä¸ŠæŸ¥çœ‹ endpoint: \"oss-cn-hangzhou.aliyuncs.com\" # ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰é…ç½®åœ¨secretsé‡Œé¢çš„accesskeysæ¥é…ç½®ossutil access-key-id: ${{ secrets.ACCESS_KEY_ID }} access-key-secret: ${{ secrets.ACCESS_KEY_SECRET }} - name: Deply To OSS run: ossutil cp public oss://agou-ops/ -rf å…¶ä¸­ï¼Œsecrets.ACCESS_KEY_IDå’Œsecrets.ACCESS_KEY_SECRETå±äºgithubçš„ä¸“ç”¨ç§˜é’¥ï¼Œæ¯”è¾ƒéšç§çš„å˜é‡å¯ä»¥æ”¾ç½®åœ¨æ­¤å¤„ï¼Œå…·ä½“ä½ç½®åœ¨Settings\u003eSecrets 3. æäº¤commitï¼Œgithubä¼šè‡ªåŠ¨è¿›è¡Œéƒ¨ç½²ï¼Œç‚¹å‡»Actionså¯ä»¥æŸ¥çœ‹éƒ¨ç½²çš„è¯¦ç»†çŠ¶æ€ ","date":"2020-08-04","objectID":"/myBlog-2/post/%E4%BD%BF%E7%94%A8github-actions%E5%B0%86%E6%96%87%E4%BB%B6push%E5%88%B0oss/:0:0","tags":["GitHub Action","OSS"],"title":"ä½¿ç”¨GitHub Actionså°†æ–‡ä»¶pushåˆ°OSS","uri":"/myBlog-2/post/%E4%BD%BF%E7%94%A8github-actions%E5%B0%86%E6%96%87%E4%BB%B6push%E5%88%B0oss/"},{"categories":["GitHub"],"content":"å‚è€ƒé“¾æ¥ Github Actionså…¥é—¨æ•™ç¨‹,é˜®ä¸€å³° GitHub Pages å®˜æ–¹æ–‡æ¡£ Github Actions for web apps, Luke Boyle My First Week With GitHub Actions, Adam Zolyak ","date":"2020-08-04","objectID":"/myBlog-2/post/%E4%BD%BF%E7%94%A8github-actions%E5%B0%86%E6%96%87%E4%BB%B6push%E5%88%B0oss/:1:0","tags":["GitHub Action","OSS"],"title":"ä½¿ç”¨GitHub Actionså°†æ–‡ä»¶pushåˆ°OSS","uri":"/myBlog-2/post/%E4%BD%BF%E7%94%A8github-actions%E5%B0%86%E6%96%87%E4%BB%B6push%E5%88%B0oss/"},{"categories":["Linux","shell"],"content":"ä¸ºä½ çš„shellè„šæœ¬ç¼–å†™å¸®åŠ©ä¿¡æ¯æ–‡æ¡£","date":"2020-07-14","objectID":"/myBlog-2/post/%E7%BC%96%E5%86%99shell%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/","tags":["Linux","shell","è„šæœ¬","å¸®åŠ©æ–‡æ¡£","æŠ€å·§"],"title":"ç¼–å†™shellå¸®åŠ©ä¿¡æ¯é€šç”¨å°æŠ€å·§","uri":"/myBlog-2/post/%E7%BC%96%E5%86%99shell%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/"},{"categories":["Linux","shell"],"content":"åºŸè¯å°‘è¯´ï¼Œ ç›´æ¥ä¸Šè„šæœ¬ï¼š #!/bin/bash ### ### Some shell version or description here. ### ### Usage: ### test \u003cinput\u003e \u003coutput\u003e ### ### Options: ### \u003cinput\u003e Input file to read. ### \u003coutput\u003e Output file to write. Use '-' for stdout. ### -h | --help Show this message. help() { sed -rn 's/^### ?//;T;p' \"$0\" } # å¦‚æœç”¨æˆ·è¾“å…¥â€œ-hâ€æˆ–è€…æ— å‚æ•°ï¼Œæ‰§è¡Œhelpå‡½æ•° if [[ $# == 0 ]] || [[ \"$1\" == \"-h\" ]] || [[ \"$1\" == \"--help\" ]]; then help exit 1 fi æ•ˆæœï¼š â•­â”€agou-ops@ideapad-15ISK ~/tmp â•°â”€$ bash test.sh --help Some shell version or description here. Usage: test \u003cinput\u003e \u003coutput\u003e Options: \u003cinput\u003e Input file to read. \u003coutput\u003e Output file to write. Use '-' for stdout. -h | --help Show this message. ","date":"2020-07-14","objectID":"/myBlog-2/post/%E7%BC%96%E5%86%99shell%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/:0:0","tags":["Linux","shell","è„šæœ¬","å¸®åŠ©æ–‡æ¡£","æŠ€å·§"],"title":"ç¼–å†™shellå¸®åŠ©ä¿¡æ¯é€šç”¨å°æŠ€å·§","uri":"/myBlog-2/post/%E7%BC%96%E5%86%99shell%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3/"},{"categories":["benchmark","web","Tools"],"content":"web benchmark tools ","date":"2020-07-14","objectID":"/myBlog-2/post/web-benchmark/:1:0","tags":["å‹æµ‹","web","http","å·¥å…·","æŒç»­æ›´æ–°"],"title":"Web å‹æµ‹å·¥å…·","uri":"/myBlog-2/post/web-benchmark/"},{"categories":["benchmark","web","Tools"],"content":"Apache Bench ApacheBench æ˜¯ä¸€ä¸ªç”¨æ¥è¡¡é‡httpæœåŠ¡å™¨æ€§èƒ½çš„å•çº¿ç¨‹å‘½ä»¤è¡Œå·¥å…·ã€‚åŸæœ¬é’ˆå¯¹Apache httpæœåŠ¡å™¨ï¼Œä½†æ˜¯ä¹Ÿé€‚ç”¨äºå…¶ä»–httpæœåŠ¡å™¨ã€‚ å¦‚æœä½ çš„æ“ä½œç³»ç»Ÿæ²¡æœ‰abå·¥å…·ï¼Œ é‚£ä¹ˆåªéœ€å®‰è£…httpd-tools(CentOS)æˆ–è€…apache-utils(Ubuntu)å³å¯ã€‚ å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š -nï¼šæ‰§è¡Œçš„è¯·æ±‚æ¬¡æ•° -cï¼šå¹¶å‘æ•°é‡ -sï¼šå“åº”çš„è¶…æ—¶æ—¶é—´ -pï¼špostè¯·æ±‚çš„æ•°æ®æ–‡ä»¶è·¯å¾„ï¼Œéœ€è¦è®¾ç½®-Tå‚æ•° -Tï¼šContent-Type -Cï¼šè®¾ç½®cookieï¼Œæ ¼å¼ä¸º\"name=zhou\" å¸¸ç”¨ç»„åˆï¼š ab -n 10000 -c 1000 http://localhost/index.html ","date":"2020-07-14","objectID":"/myBlog-2/post/web-benchmark/:1:1","tags":["å‹æµ‹","web","http","å·¥å…·","æŒç»­æ›´æ–°"],"title":"Web å‹æµ‹å·¥å…·","uri":"/myBlog-2/post/web-benchmark/"},{"categories":["benchmark","web","Tools"],"content":"wrk wrk HTTPæ˜¯ä¸€ä¸ªç°ä»£çš„åŸºå‡†æµ‹è¯•å·¥å…·èƒ½äº§ç”Ÿæ˜¾è‘—çš„è´Ÿè½½è¿è¡Œæ—¶åœ¨ä¸€ä¸ªå¤šæ ¸CPUã€‚å®ƒç»“åˆäº†å¤šçº¿ç¨‹è®¾è®¡å¯ä¼¸ç¼©çš„ç³»ç»Ÿå¦‚epollå’Œkqueueäº‹ä»¶é€šçŸ¥ã€‚ å®˜æ–¹githubä»“åº“ï¼š https://github.com/wg/wrk ç¼–è¯‘å®‰è£…ï¼š wget https://github.com/wg/wrk/archive/4.1.0.tar.gz tar xf 4.1.0.tar.gz cd 4.1.0/deps tar xf LuaJIT-2.1.0-beta3.tar.gz -C /usr/local tar xf openssl-1.1.0g.tar.gz -C /usr/local cd .. make WITH_LUAJIT=/usr/local/LuaJIT-2.1.0-beta3 WITH_OPENSSL=/usr/local/openssl-1.1.0g make install å¸¸ç”¨å‚æ•°è¯´æ˜ï¼š -tï¼šçº¿ç¨‹æ•° -cï¼šhttpæ€»è¯·æ±‚æ•°é‡ -dï¼šæµ‹è¯•æ—¶é•¿ï¼Œe.g. 2s, 2m, 2h ç®€å•ä½¿ç”¨ï¼š wrk -t12 -c400 -d30s http://127.0.0.1:8080/index.html ","date":"2020-07-14","objectID":"/myBlog-2/post/web-benchmark/:1:2","tags":["å‹æµ‹","web","http","å·¥å…·","æŒç»­æ›´æ–°"],"title":"Web å‹æµ‹å·¥å…·","uri":"/myBlog-2/post/web-benchmark/"},{"categories":["benchmark","web","Tools"],"content":"å¾…ç»­ã€‚ã€‚ã€‚","date":"2020-07-14","objectID":"/myBlog-2/post/web-benchmark/:1:3","tags":["å‹æµ‹","web","http","å·¥å…·","æŒç»­æ›´æ–°"],"title":"Web å‹æµ‹å·¥å…·","uri":"/myBlog-2/post/web-benchmark/"},{"categories":["Linux","ECS","æ•…éšœå¤„ç†"],"content":"ç¯‡å¹…æœ‰é™ï¼Œè½¬è‡³ https://agou-ops.top/linux_sys_fix è¿›è¡ŒæŸ¥çœ‹ã€‚ ","date":"2020-07-14","objectID":"/myBlog-2/post/ecs-linux-%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/:0:0","tags":["Linux","æ•…éšœå¤„ç†"],"title":"ECS-Linux æ•…éšœå¤„ç†","uri":"/myBlog-2/post/ecs-linux-%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"nloadå·¥å…· nloadç”¨äºå®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡ï¼Œé»˜è®¤ç³»ç»Ÿéƒ½æ²¡æœ‰å®‰è£…ï¼Œé¦–å…ˆå®‰è£…æ–¹å¼å¦‚ä¸‹ï¼š $ yum install -y epel-release $ yum install -y nload ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œå¦‚ä¸‹ï¼š $ nload Device eth0 [192.168.0.110] (4/5): =================================================================================== Incoming: Curr: 5.21 kBit/s # Incomingï¼šè¿›æ¥çš„æµé‡ Avg: 4.09 kBit/s # Outgoingï¼šå‡ºå»çš„æµé‡ Min: 1.59 kBit/s # Currï¼šå½“å‰çš„æµé‡å€¼ Max: 12.51 kBit/s # Avgï¼šå¹³å‡å€¼çš„æµé‡å€¼ Ttl: 4.16 GByte # Minï¼šæœ€å°çš„æµé‡å€¼ Outgoing: # Maxï¼šæœ€å¤§çš„æµé‡å€¼ Curr: 16.48 kBit/s # Ttlï¼šæ€»çš„æµé‡å€¼ Avg: 14.38 kBit/s Min: 6.73 kBit/s Max: 28.39 kBit/s ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:1:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"iftopå·¥å…· é»˜è®¤ç³»ç»Ÿæ²¡æœ‰å®‰è£…ï¼Œéœ€è¦å®‰è£…ï¼Œå¦‚ä¸‹ï¼š # éœ€è¦epelç¯å¢ƒ $ yum install -y epel-release $ yum install -y iftop å®‰è£…å®Œæˆä¹‹åï¼Œè¾“å…¥iftopä¾¿å¯çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ å…¶ä¸­ï¼Œç›¸å…³å‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š ç•Œé¢ä¸Šé¢æ˜¾ç¤ºçš„æ˜¯ç±»ä¼¼åˆ»åº¦å°ºçš„åˆ»åº¦èŒƒå›´ï¼Œä¸ºæ˜¾ç¤ºæµé‡å›¾å½¢çš„é•¿æ¡ä½œæ ‡å°ºç”¨çš„ã€‚ ä¸­é—´çš„\u003c= =\u003eè¿™ä¸¤ä¸ªå·¦å³ç®­å¤´ï¼Œè¡¨ç¤ºçš„æ˜¯æµé‡çš„æ–¹å‘ã€‚ TXï¼šå‘é€æµé‡ RXï¼šæ¥æ”¶æµé‡5.TOTALï¼šæ€»æµé‡6.Cummï¼šè¿è¡Œiftopåˆ°ç›®å‰æ—¶é—´çš„æ€»æµé‡ peakï¼šæµé‡å³°å€¼ ratesï¼šåˆ†åˆ«è¡¨ç¤ºè¿‡å» 2s 10s 40s çš„å¹³å‡æµé‡ ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:2:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"sarå‘½ä»¤ sarå‘½ä»¤åŒ…å«åœ¨sysstatå·¥å…·åŒ…ä¸­ï¼Œæä¾›ç³»ç»Ÿçš„ä¼—å¤šç»Ÿè®¡æ•°æ®ã€‚å…¶åœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šå‘½ä»¤æœ‰äº›å·®å¼‚ï¼ŒæŸäº›ç³»ç»Ÿæä¾›çš„saræ”¯æŒåŸºäºç½‘ç»œæ¥å£çš„æ•°æ®ç»Ÿè®¡ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹è®¾å¤‡ä¸Šæ¯ç§’æ”¶å‘åŒ…çš„ä¸ªæ•°å’Œæµé‡ã€‚ # DEVæ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ # å‘½ä»¤åé¢1 2 æ„æ€æ˜¯ï¼šæ¯ä¸€ç§’é’Ÿå–1æ¬¡å€¼ï¼Œå–2æ¬¡ $ sar -n DEV 1 2 å¦å¤–ï¼Œ-nå‚æ•°å¾ˆæœ‰ç”¨ï¼Œä»–æœ‰6ä¸ªä¸åŒçš„å¼€å…³ï¼šDEV | EDEV | NFS | NFSD | SOCK | ALL ï¼Œå…¶ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š DEVæ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ã€‚ EDEVæ˜¾ç¤ºå…³äºç½‘ç»œé”™è¯¯çš„ç»Ÿè®¡æ•°æ®ã€‚ NFSç»Ÿè®¡æ´»åŠ¨çš„NFSå®¢æˆ·ç«¯çš„ä¿¡æ¯ã€‚ NFSDç»Ÿè®¡NFSæœåŠ¡å™¨çš„ä¿¡æ¯ SOCKæ˜¾ç¤ºå¥—æ¥å­—ä¿¡æ¯ ALLæ˜¾ç¤ºæ‰€æœ‰5ä¸ªå¼€å…³ $ sar -n DEV 1 2 Linux 3.10.0-514.26.2.el7.x86_64 (localhost) 08/31/2019 _x86_64_ (1 CPU) 09:52:28 AM IFACE rxpck/s txpck/s rxkB/s txkB/s rxcmp/s txcmp/s rxmcst/s 09:52:29 AM eth0 2.02 1.01 0.13 0.16 0.00 0.00 0.00 09:52:29 AM lo 0.00 0.00 0.00 0.00 0.00 0.00 0.00 09:52:29 AM IFACE rxpck/s txpck/s rxkB/s txkB/s rxcmp/s txcmp/s rxmcst/s 09:52:30 AM eth0 1.02 1.02 0.07 0.23 0.00 0.00 0.00 09:52:30 AM lo 0.00 0.00 0.00 0.00 0.00 0.00 0.00 Average: IFACE rxpck/s txpck/s rxkB/s txkB/s rxcmp/s txcmp/s rxmcst/s Average: eth0 1.52 1.02 0.10 0.19 0.00 0.00 0.00 Average: lo 0.00 0.00 0.00 0.00 0.00 0.00 0.00 å‚æ•°è¯´æ˜ï¼š IFACEï¼šLANæ¥å£ rxpck/sï¼šæ¯ç§’é’Ÿæ¥æ”¶çš„æ•°æ®åŒ… txpck/sï¼šæ¯ç§’é’Ÿå‘é€çš„æ•°æ®åŒ… rxbyt/sï¼šæ¯ç§’é’Ÿæ¥æ”¶çš„å­—èŠ‚æ•° txbyt/sï¼šæ¯ç§’é’Ÿå‘é€çš„å­—èŠ‚æ•° rxcmp/sï¼šæ¯ç§’é’Ÿæ¥æ”¶çš„å‹ç¼©æ•°æ®åŒ… txcmp/sï¼šæ¯ç§’é’Ÿå‘é€çš„å‹ç¼©æ•°æ®åŒ… rxmcst/sï¼šæ¯ç§’é’Ÿæ¥æ”¶çš„å¤šæ’­æ•°æ®åŒ… rxerr/sï¼šæ¯ç§’é’Ÿæ¥æ”¶çš„åæ•°æ®åŒ… txerr/sï¼šæ¯ç§’é’Ÿå‘é€çš„åæ•°æ®åŒ… coll/sï¼šæ¯ç§’å†²çªæ•° rxdrop/sï¼šå› ä¸ºç¼“å†²å……æ»¡ï¼Œæ¯ç§’é’Ÿä¸¢å¼ƒçš„å·²æ¥æ”¶æ•°æ®åŒ…æ•° txdrop/sï¼šå› ä¸ºç¼“å†²å……æ»¡ï¼Œæ¯ç§’é’Ÿä¸¢å¼ƒçš„å·²å‘é€æ•°æ®åŒ…æ•° txcarr/sï¼šå‘é€æ•°æ®åŒ…æ—¶ï¼Œæ¯ç§’è½½æ³¢é”™è¯¯æ•° rxfram/sï¼šæ¯ç§’æ¥æ”¶æ•°æ®åŒ…çš„å¸§å¯¹é½é”™è¯¯æ•° rxfifo/sï¼šæ¥æ”¶çš„æ•°æ®åŒ…æ¯ç§’FIFOè¿‡é€Ÿçš„é”™è¯¯æ•° txfifo/sï¼šå‘é€çš„æ•°æ®åŒ…æ¯ç§’FIFOè¿‡é€Ÿçš„é”™è¯¯æ•° è¿™ç§æ–¹å¼ç®€å•ï¼Œç›´è§‚ï¼Œæ¨èä½¿ç”¨ã€‚ ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:3:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"cat /proc/net/dev Linux å†…æ ¸æä¾›äº†ä¸€ç§é€šè¿‡ /proc æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨è¿è¡Œæ—¶è®¿é—®å†…æ ¸å†…éƒ¨æ•°æ®ç»“æ„ã€æ”¹å˜å†…æ ¸è®¾ç½®çš„æœºåˆ¶ã€‚procæ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒåªå­˜åœ¨å†…å­˜å½“ä¸­ï¼Œè€Œä¸å ç”¨å¤–å­˜ç©ºé—´ã€‚å®ƒä»¥æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼ä¸ºè®¿é—®ç³»ç»Ÿå†…æ ¸æ•°æ®çš„æ“ä½œæä¾›æ¥å£ã€‚ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡procå¾—åˆ°ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¹¶å¯ä»¥æ”¹å˜å†…æ ¸çš„æŸäº›å‚æ•°ã€‚ç”±äºç³»ç»Ÿçš„ä¿¡æ¯ï¼Œå¦‚è¿›ç¨‹ï¼Œæ˜¯åŠ¨æ€æ”¹å˜çš„ï¼Œæ‰€ä»¥ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºè¯»å–procæ–‡ä»¶æ—¶ï¼Œprocæ–‡ä»¶ç³»ç»Ÿæ˜¯åŠ¨æ€ä»ç³»ç»Ÿå†…æ ¸è¯»å‡ºæ‰€éœ€ä¿¡æ¯å¹¶æäº¤çš„ã€‚/procæ–‡ä»¶ç³»ç»Ÿä¸­åŒ…å«äº†å¾ˆå¤šç›®å½•ï¼Œå…¶ä¸­/proc/net/dev ä¿å­˜äº†ç½‘ç»œé€‚é…å™¨åŠç»Ÿè®¡ä¿¡æ¯ã€‚ [root@agou ~]\\# cat /proc/net/dev Inter-| Receive | Transmit face |bytes packets errs drop fifo frame compressed multicast|bytes packets errs drop fifo colls carrier compressed ens32: 11196722 21042 0 0 0 0 0 0 4605085 14465 0 0 0 0 0 0 lo: 1934784 7162 0 0 0 0 0 0 1934784 7162 0 0 0 0 0 0 è¯´æ˜ï¼š æœ€å·¦è¾¹çš„è¡¨ç¤ºæ¥å£çš„åå­—ï¼ŒReceiveè¡¨ç¤ºæ”¶åŒ…ï¼ŒTransmitè¡¨ç¤ºå‘é€åŒ…ï¼› bytesè¡¨ç¤ºæ”¶å‘çš„å­—èŠ‚æ•°ï¼› packetsè¡¨ç¤ºæ”¶å‘æ­£ç¡®çš„åŒ…é‡ï¼› errsè¡¨ç¤ºæ”¶å‘é”™è¯¯çš„åŒ…é‡ï¼› dropè¡¨ç¤ºæ”¶å‘ä¸¢å¼ƒçš„åŒ…é‡ï¼› å…¶å®ï¼Œæˆ‘ä»¬å¹³æ—¶ç»å¸¸ç”¨çš„å¾ˆå¤šæŸ¥çœ‹ç½‘å¡å®æ—¶æµé‡çš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡è¯»å–è¯¥ç›®å½•ä¸‹çš„å®æ—¶æµé‡ï¼Œå¹¶é€šè¿‡ç®€å•è®¡ç®—å¾—åˆ°çš„ã€‚ ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:4:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"å®æ—¶ç›‘æ§è„šæœ¬1 ifconfigå¯ä»¥æŸ¥çœ‹çš„æ˜¯ä»è¿ä¸Šç½‘å¼€å§‹çš„æµé‡æ€»å’Œï¼Œcat /proc/net/devè®°å½•çš„å€¼ä¹Ÿæ˜¯æ€»æµé‡ï¼Œé‚£ä¹ˆå¯ä»¥è®¡ç®—ä¸€ä¸‹ï¼Œå®æ—¶æµé‡=å½“å‰æµé‡-ä¸Šä¸€ç§’çš„æµé‡ã€‚ [root@localhost ~]\\# cat network.sh # ä¼ å…¥ç½‘å¡å‚æ•° ethn=$1 while true do RX_pre=$(cat /proc/net/dev | grep $ethn | sed 's/:/ /g' | awk '{print $2}') TX_pre=$(cat /proc/net/dev | grep $ethn | sed 's/:/ /g' | awk '{print $10}') sleep 1 RX_next=$(cat /proc/net/dev | grep $ethn | sed 's/:/ /g' | awk '{print $2}') TX_next=$(cat /proc/net/dev | grep $ethn | sed 's/:/ /g' | awk '{print $10}') clear # echo -eæ¿€æ´»è½¬ä¹‰ç¬¦ # è¾“å‡ºæ—¶é—´çš„æ ‡é¢˜ echo -e \"t RX `date +%k:%M:%S` TX\" RX=$((${RX_next}-${RX_pre})) TX=$((${TX_next}-${TX_pre})) if [[ $RX -lt 1024 ]];then RX=\"${RX}B/s\" elif [[ $RX -gt 1048576 ]];then RX=$(echo $RX | awk '{print $1/1048576 \"MB/s\"}') else RX=$(echo $RX | awk '{print $1/1024 \"KB/s\"}') fi if [[ $TX -lt 1024 ]];then TX=\"${TX}B/s\" elif [[ $TX -gt 1048576 ]];then TX=$(echo $TX | awk '{print $1/1048576 \"MB/s\"}') else TX=$(echo $TX | awk '{print $1/1024 \"KB/s\"}') fi # è¾“å‡ºæµé‡ echo -e \"$ethnt $RX$TX\" done æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š [root@localhost ~]\\# ./network.sh eth0 RX 20:23:38 TX eth0 66B/s 0B/s RX 20:23:39 TX eth0 132B/s 0B/s RX 20:23:40 TX eth0 186B/s 194B/s RX 20:23:41 TX eth0 240B/s 194B/s RX 20:23:42 TX eth0 132B/s 0B/s RX 20:23:43 TX eth0 240B/s 194B/s RX 20:23:44 TX eth0 396B/s 4.19727KB/s RX 20:23:45 TX eth0 276B/s 178B/s ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:5:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","Tools","è½¬è½½"],"content":"å®æ—¶ç›‘æ§è„šæœ¬2 $ cat network_flow.sh # ç›‘æ§å®æ—¶ç½‘å¡æµé‡ # $1 æ¥æ”¶æ‰€ä¼ ç¬¬ä¸€ä¸ªå‚æ•° å³è¦ç›‘æ§çš„ç½‘å¡ NIC=$1 # echo -e \"traffic in --- traffic out\" while true;do # $0 å‘½ä»¤è¾“å‡ºç»“æœ ~ åŒ¹é…æ¨¡å¼ OLD_IN=`awk '$0~\"'$NIC'\"{print $2}' /proc/net/dev` OLD_OUT=`awk '$0~\"'$NIC'\"{print $10}' /proc/net/dev` sleep 1 NEW_IN=`awk '$0~\"'$NIC'\"{print $2}' /proc/net/dev` NEW_OUT=`awk '$0~\"'$NIC'\"{print $10}' /proc/net/dev` clear # printfä¸æ¢è¡Œ %så ä½ç¬¦ IN=$(printf \"%.1f%s\" \"$(($NEW_IN-$OLD_IN))\" \"B/s\") OUT=$(printf \"%.1f%s\" \"$(($NEW_OUT-$OLD_OUT))\" \"B/s\") echo \" traffic in `date +%k:%M:%S` traffic out \" echo \"$NIC$IN$OUT\" done æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š $ ./network_flow.sh eth0 traffic in 11:15:02 traffic out eth0 732.0B/s 948.0B/s traffic in 11:15:03 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:04 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:05 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:06 traffic out eth0 186.0B/s 242.0B/s traffic in 11:15:07 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:08 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:09 traffic out eth0 132.0B/s 0.0B/s traffic in 11:15:10 traffic out eth0 240.0B/s 242.0B/s traffic in 11:15:11 traffic out eth0 132.0B/s 0.0B/s è¯¥æ–‡ç« å†…å®¹æ”¶é›†äºç½‘ç»œã€‚ ","date":"2020-07-11","objectID":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/:6:0","tags":["Linux","å·¥å…·","ç½‘å¡"],"title":"Linux å®æ—¶æŸ¥çœ‹ç½‘å¡æµé‡","uri":"/myBlog-2/post/linux-%E5%AE%9E%E6%97%B6%E6%9F%A5%E7%9C%8B%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"Mondo Rescue Mondo Rescueï¼ˆç®€ç§° Mondoï¼‰ï¼šæ˜¯ä¸€æ¬¾å¼€æºå…è´¹çš„æ•…éšœæ¢å¤å’Œå¤‡ä»½å·¥å…·ï¼Œå¯ä»¥è¯´æ˜¯ Linux æ“ä½œç³»ç»Ÿä¸‹çš„ Ghost ï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ›å»ºç³»ç»Ÿï¼ˆLinux æˆ– Windowsï¼‰å…‹éš†æˆ–å¤‡ä»½çš„ ISO é•œåƒï¼Œå¯ä»¥å°†è¿™äº›é•œåƒå­˜æ”¾åœ¨ CDã€DVDã€ç£å¸¦ã€USB è®¾å¤‡ã€ç¡¬ç›˜å’Œ NFS ä¸Šã€‚ å®˜æ–¹ç«™ç‚¹:http://www.mondorescue.org/ ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:1:0","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"å®‰è£… mondo ä»å®˜æ–¹æŒ‡å®šçš„ä»“åº“ä¸‹è½½ wget http://mondo.mirror.pclark.com/ftp/pub/mondorescue/centos/7/x86_64/mondorescue.repo -O /etc/yum.repos.d/mondorescue.repo yum install -y mondo æˆ–è€…ç›´æ¥å®‰è£…rpmåŒ…: yum install -y http://mondo.mirror.pclark.com/ftp/pub/mondorescue/centos/7/x86_64/mondo-3.3.0-1.centos7.x86_64.rpm ä½¿ç”¨è¯¥æ–¹æ³•å®‰è£…å¯èƒ½ä¼šç¼ºå°‘ä¾èµ–åŒ…æ–‡ä»¶,åœ¨è¿™é‡Œæ‰‹åŠ¨è§£å†³ä¾èµ–å…³ç³»å³å¯(å¤ªå¤šäº†,è¯´ç€ç©çš„,è¿˜æ˜¯æ¨èç”¨åœ¨çº¿ä»“åº“å®‰è£…å§â€¦): yum install -y http://ftp.mondorescue.org/centos/7/x86_64/afio-2.5-1.centos7.x86_64.rpm yum install -y http://ftp.mondorescue.org/centos/7/x86_64/mindi-3.3.0-1.centos7.x86_64.rpm yum install -y http://ftp.mondorescue.org/centos/7/x86_64/buffer-1.19-8.centos7.x86_64.rpm ... ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:1:1","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"åˆ¶ä½œå…‰ç›˜é•œåƒ å®‰è£…å®Œæ¯•åï¼Œåœ¨ç»ˆç«¯ä¸‹è¾“å…¥mondoarchiveï¼Œå³å¯è¿›å…¥å›¾å½¢å®‰è£…ç•Œé¢ã€‚ mondoarchive See /var/log/mondoarchive.log for details of backup run. Checking sanity of your Linux distribution ....... éšå,æŒ‰ç…§å¼•å¯¼ä¸€æ­¥æ­¥è®¾ç½®å³å¯. ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:1:2","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"Remastersys Remastersys å¯ä»¥å°†ä½ å®‰è£…çš„ Ubuntuã€Debian åŠå…¶è¡ç”Ÿç‰ˆæ‰“åŒ…æˆä¸€ä¸ªå¯ä»¥ç”¨æ¥å®‰è£…çš„ Live CD/DVD çš„ ISO é•œåƒæ–‡ä»¶ï¼Œå¯æ‰“åŒ…ä¸€ä¸ªåŒ…å«ä¸ªäººæ•°æ®çš„ ISO é•œåƒæ–‡ä»¶ä½œä¸ºæ“ä½œç³»ç»Ÿå¤‡ä»½ï¼Œä¹Ÿå¯ä»¥æ‰“åŒ…ä¸€ä¸ªä¸åŒ…å«ä¸ªäººæ•°æ®çš„ ISO é•œåƒæ–‡ä»¶å‘å¸ƒç»™å…¶ä»–äººå®‰è£…ã€‚ ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:2:0","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"Remastersys åŒ…ä¸‹è½½ $ mkdir tools $ cd tools/ $ wget ftp://ftp.gwdg.de/pub/linux/easyvdr/mirror/remastersys/ubuntu/remastersys/remastersys_3.0.4-2_all.deb $ wget ftp://ftp.gwdg.de/pub/linux/easyvdr/mirror/remastersys/ubuntu/remastersys-gui/remastersys-gui_3.0.4-1_amd64.deb ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:2:1","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"å®‰è£… Remastersys ä¾èµ– $ sudo apt-get install syslinux-utils isolinux squashfs-tools casper libdebian-installer4 ubiquity-frontend-debconf user-setup discover xresprobe systemd ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:2:2","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"å®‰è£… Remastersys-gui ä¾èµ– $ sudo apt-get install libvte-common libvte9 plymouth-x11 ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:2:3","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux","CentOS","Ubuntu"],"content":"å¼€å§‹å®‰è£… Remastersys $ cd tools/ $ sudo dpkg -i remastersys_3.0.4-2_all.deb $ sudo dpkg -i remastersys-gui_3.0.4-1_amd64.deb Remastersys å¤‡ä»½æ“ä½œç³»ç»Ÿ å‘½ä»¤è¡Œæ¨¡å¼ï¼š $ sudo remastersys backup å›¾å½¢åŒ–æ¨¡å¼ï¼š $ sudo remastersys-gui ","date":"2020-07-10","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/:2:4","tags":["Linux","ç³»ç»Ÿå°è£…"],"title":"Linux ç³»ç»Ÿå°è£…","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E5%B0%81%E8%A3%85/"},{"categories":["Linux"],"content":"Apache HTTPDä½¿ç”¨Let's Encryptå®ç°å®‰å…¨è¿æ¥(https) å®‰è£…cerbot: yum update -y yum install -y cerbot ç”Ÿæˆé«˜å®‰å…¨æ€§çš„DHç§˜é’¥åˆ°/etc/ssl/certs/ç›®å½•å½“ä¸­å»: sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048 è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç›®å½•, å¹¶ä½¿å®ƒå¯å†™ä¸ºApacheæœåŠ¡å™¨: sudo mkdir -p /var/lib/letsencrypt/.well-known sudo chgrp www-data /var/lib/letsencrypt sudo chmod g+s /var/lib/letsencrypt ä¸ºäº†é¿å…å¤åˆ¶ä»£ç å’Œé…ç½®æ›´æ˜“äºç»´æŠ¤, åˆ›å»ºä»¥ä¸‹ä¸¤ä¸ªé…ç½®ä»£ç ç‰‡æ®µ: ç¼–è¾‘/etc/apache2/conf-available/letsencrypt.conf Alias /.well-known/acme-challenge/ \"/var/lib/letsencrypt/.well-known/acme-challenge/\" \u003cDirectory \"/var/lib/letsencrypt/\"\u003e AllowOverride None Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec Require method GET POST OPTIONS \u003c/Directory\u003e ç¼–è¾‘/etc/apache2/conf-available/ssl-params.conf: SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1 SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384 SSLHonorCipherOrder off SSLSessionTickets off SSLUseStapling On SSLStaplingCache \"shmcb:logs/ssl_stapling(32768)\" SSLOpenSSLConfCmd DHParameters \"/etc/ssl/certs/dhparam.pem\" Header always set Strict-Transport-Security \"max-age=63072000\" è¿›è¡Œå¯ç”¨é…ç½®æ–‡ä»¶ä¹‹å‰, ç¡®ä¿mod_ssl å’Œmod_headerså·²ç»è¢«å¯ç”¨: sudo a2enmod ssl sudo a2enmod headers ç„¶å, å¯ç”¨SSLé…ç½®æ–‡ä»¶, è¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯: sudo a2enconf letsencrypt sudo a2enconf ssl-params å¯ç”¨HTTP/2æ¨¡å—: sudo a2enmod http2 é‡å¯httpdè®©é…ç½®ç”Ÿæ•ˆ: systemctl restart httpd ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨webrootæ’ä»¶è¿è¡ŒCertbotå·¥å…·å¹¶è·å–SSLè¯ä¹¦æ–‡ä»¶ï¼š sudo certbot certonly --agree-tos --email agou-ops@foxmail.com --webroot -w /var/lib/letsencrypt/ -d agou-ops.top -d www.agou-ops.top å¦‚æœè¾“å‡ºä»¥ä¸‹ä¿¡æ¯, åˆ™è¡¨å·²ç»æˆåŠŸç”³è¯·åˆ°SSLè¯ä¹¦æ–‡ä»¶: IMPORTANT NOTES: - Congratulations! Your certificate and chain have been saved at: /etc/letsencrypt/live/agou-ops.top/fullchain.pem Your key file has been saved at: /etc/letsencrypt/live/agou-ops.top/privkey.pem Your cert will expire on 2020-10-06. To obtain a new or tweaked version of this certificate in the future, simply run certbot again. To non-interactively renew *all* of your certificates, run \"certbot renew\" - Your account credentials have been saved in your Certbot configuration directory at /etc/letsencrypt. You should make a secure backup of this folder now. This configuration directory will also contain certificates and private keys obtained by Certbot so making regular backups of this folder is ideal. - If you like Certbot, please consider supporting our work by: Donating to ISRG / Let's Encrypt: https://letsencrypt.org/donate Donating to EFF: https://eff.org/donate-le ","date":"2020-07-10","objectID":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/:1:0","tags":["Linux","Apache","httpd","SSL"],"title":"Apache HTTPDä½¿ç”¨Let's Encrypt","uri":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/"},{"categories":["Linux"],"content":"é…ç½®è™šæ‹Ÿä¸»æœº åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºconf.d/agou-ops-top.conf(ä»…ä¸ºç¤ºä¾‹): \u003cVirtualHost *:80\u003e ServerName mail.agou-ops.top Redirect permanent / https://mail.agou-ops.top/ \u003c/VirtualHost\u003e \u003cVirtualHost *:443\u003e ServerName mail.agou-ops.top Protocols h2 http:/1.1 \u003cIf \"%{HTTP_HOST} == 'www.mail.agou-ops.top'\"\u003e Redirect permanent / https://mail.agou-ops.top/ \u003c/If\u003e DocumentRoot /var/www/mail.agou-ops.top/public_html ErrorLog ${APACHE_LOG_DIR}/mail.agou-ops.top-error.log CustomLog ${APACHE_LOG_DIR}/mail.agou-ops.top-access.log combined SSLEngine On SSLCertificateFile /etc/letsencrypt/live/mail.agou-ops.top/fullchain.pem SSLCertificateKeyFile /etc/letsencrypt/live/mail.agou-ops.top/privkey.pem # Other Apache Configuration \u003c/VirtualHost\u003e é‡è½½httpdä½¿è™šæ‹Ÿä¸»æœºé…ç½®ç”Ÿæ•ˆ: systemctl reload httpd ç°åœ¨, å°±å¯ä»¥é€šè¿‡httpsè®¿é—®ä½ çš„ç«™ç‚¹äº†: https://agou-ops.top ","date":"2020-07-10","objectID":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/:2:0","tags":["Linux","Apache","httpd","SSL"],"title":"Apache HTTPDä½¿ç”¨Let's Encrypt","uri":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/"},{"categories":["Linux"],"content":"è‡ªåŠ¨æ›´æ–°Letâ€™s Encryptè¯ä¹¦ Letâ€™s Encryptçš„è¯ä¹¦æœ‰æ•ˆæœŸä¸º90å¤©, è‡ªåŠ¨æ›´æ–°è¯ä¹¦åˆ°æœŸå‰,certbotåŒ…åˆ›å»ºä¸€ä¸ªè®¡åˆ’, ä¸€å¤©ä¸¤æ¬¡, å¹¶è‡ªåŠ¨æ›´æ–°ä»»ä½•è¯ä¹¦åˆ°æœŸå‰30å¤©. è§£å†³æ–¹æ³•, æ·»åŠ å®šæ—¶ä»»åŠ¡, /etc/cron.d/cerbot, å†…å®¹å¦‚ä¸‹æ‰€ç¤º: 0 */12 * * * root test -x /usr/bin/certbot -a \\! -d /run/systemd/system \u0026\u0026 perl -e 'sleep int(rand(3600))' \u0026\u0026 certbot -q renew --renew-hook \"systemctl reload apache2\" æµ‹è¯•æ›´æ–°, ä½¿ç”¨certbotçš„å¹²è·‘æ¨¡å¼è¿›è¡Œæµ‹è¯•: sudo certbot renew --dry-run ","date":"2020-07-10","objectID":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/:3:0","tags":["Linux","Apache","httpd","SSL"],"title":"Apache HTTPDä½¿ç”¨Let's Encrypt","uri":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/"},{"categories":["Linux"],"content":"å‚è€ƒé“¾æ¥ SSL lab: https://www.ssllabs.com/ Letâ€™s Encrypt: https://letsencrypt.org/ ","date":"2020-07-10","objectID":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/:4:0","tags":["Linux","Apache","httpd","SSL"],"title":"Apache HTTPDä½¿ç”¨Let's Encrypt","uri":"/myBlog-2/post/apache-httpd%E4%BD%BF%E7%94%A8lets-encrypt/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"â€‹ 2020å¹´06æœˆ28æ—¥ï¼Œç«¯åˆâ€œä¸‰å¤©å°çŸ­å‡â€å·²ç»è¿‡å»äº†ï¼ŒæŒ‰å¸¸ç†è¯´åº”å½“æ”¾å‡ï¼Œå“ªæ€•ä¸€å¤©ä¹Ÿå¥½ï¼Œä½†æˆ‘ä»¬æ²¡æœ‰æ”¾å‡ï¼Œä¸€è¡Œäº”äººè¿˜æ˜¯åƒå¾€å¸¸ä¸€æ ·å‡ºå¤–ä¸šï¼Œç»ç†å‘¢ä¹Ÿå®Œå…¨æ²¡æœ‰ä»»ä½•è¡¨ç¤ºï¼Œå½“ç„¶æˆ‘ä¹Ÿä¸å¥¢æœ›æœ‰ä½•è¡¨ç¤ºï¼Œæ¯•ç«Ÿè¿™ä¸ªä¸œè¥¿çœ‹ä¸ªäººï¼Œå¯¹æˆ‘æ¥è¯´ä¹Ÿå°±æ— æ‰€è°“äº†ã€‚ å¯ä»Šå¤©æ˜¯å‘¨æ—¥ï¼Œåˆè®©æˆ‘ä»¬å‡ºå¤–ä¸šäº†ï¼Œæ—©ä¸Šä¸ƒç‚¹å°±æŠŠæˆ‘ä»¬å«èµ·æ¥ï¼ˆå…¶å®å…«ç‚¹åŠæ‰ä¸Šç­ï¼‰ï¼Œç­‰äº†ä¸€ä¸ªå¤šå°æ—¶æ‰å‡ºå‘ã€‚ æ¬¸ï¼Œè¿™æ—¶å€™å¯èƒ½å°±æœ‰å°ä¼™ä¼´è¦é—®äº†ï¼Œä¸ºä»€ä¹ˆå‘¨æ—¥ä¹Ÿè¦ä¸Šç­å‘¢ï¼Ÿæ²¡æœ‰ä¼‘æ¯çš„çš„æ—¶é—´ä¹ˆï¼Œè¿™é‡Œå¼•ç”¨ç»ç†çš„ä¸€äº›è¯ï¼Œå¤§æ¦‚æ„æ€æ˜¯ï¼š é¡¹ç›®æ¯”è¾ƒâ€œç´§å¼ â€ï¼Œä¼‘æ¯çš„è¯è§†æƒ…å†µè€Œè¨€ï¼Œæ¯”å¦‚è¯´é¡¹ç›®æœ‰å¯èƒ½è¿›åº¦å¿«ï¼Œä¸åˆ°å‘¨æœ«å°±ä¼šä¼‘æ¯ï¼Œæœ‰æ—¶å€™å‘¢é¡¹ç›®â€œç´§å¼ â€ï¼Œä¹Ÿå°±ä¸ä¼‘æ¯äº†ã€‚ â€‹ å˜¿å˜¿ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼Œé™¤éå¤–é¢ä¸‹å¤§é›¨æˆ–è€…è€ƒè¯•ä¸å·¥ä½œæ—¶é—´å†²çªæ‰ä¼šæ”¾å‡ä¼‘æ¯ï¼Œå¦åˆ™å°±åˆ«æƒ³äº†ï¼Œå“¦ï¼Œè¯´ä¸å®šå¿ƒæƒ…å¥½ä¼šç»™æ”¾åŠå¤©å‡ã€‚ å˜¿å˜¿\" å˜¿å˜¿ â€‹ ä½ ä¹Ÿåˆ«è·Ÿæˆ‘è¯´æ¥å®ä¹ å°±æ˜¯æ¥é”»ç‚¼è‡ªå·±çš„åƒè‹¦ç²¾ç¥çš„ï¼Œé‚£éƒ½æ˜¯æ”¾ç‹—è‡­å±ï¼Œè‡³å°‘å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œä¸éœ€è¦ã€‚ è¦ä¸æ˜¯ä¸ºäº†é‚£ç‚¹å­¦åˆ†ï¼Œå­¦æ ¡åˆå¼ºåˆ¶è¦æ±‚æ¥å®ä¹ ï¼ˆè™½ç„¶è¡¨é¢æ²¡ç›´æ¥è¯´ï¼‰ï¼Œæ‰ªå¿ƒè‡ªé—®ï¼Œè°åˆä¼šé—²ç€æ²¡äº‹æ¥å®ä¹ å‘¢ï¼Ÿè¿™é‡Œæˆ‘å¯èƒ½è¨€é‡äº†ï¼Œä½†å¯¹äºæˆ‘æˆ–è€…æˆ‘è¿™ç±»äººæ¥è¯´ï¼Œæ˜¯è¿™æ ·çš„ï¼Œæ¯•ç«Ÿæˆ‘/æˆ‘ä»¬çš„å¿—å‘ä¸åœ¨äºæ­¤ï¼Œå¯¹äºä»¥åè¦æ··è¿™ç¢—é¥­çš„äººæ¥è¯´ï¼Œå®ä¹ â€œæˆ–è®¸â€æ˜¯ä¸ªå¥½é€‰æ‹©ï¼Œä¸ºä»€ä¹ˆç”¨â€œæˆ–è®¸â€è¿™ä¸ªè¯å‘¢ï¼Œå› ä¸ºå†³å®šæ€§å› ç´ å¤ªå¤šï¼Œå­¦æ ¡ï¼ŒæŒ‡å¯¼è€å¸ˆï¼Œè¿˜æœ‰é¡¹ç›®ç»ç†ç­‰ç­‰ã€‚ã€‚ã€‚ â€‹ æ˜¯å•Šï¼Œä»–ä»¬éƒ½èƒ½åšæŒä¸ƒå¤©æ— ä¼‘ä¸Šç­æ›´ä½•å†µæˆ‘ä»¬è¿™äº›å°é’å¹´å‘¢ï¼Ÿèƒ½è¿™ä¹ˆå•çº¯æƒ³çš„ä¹ŸçœŸæ˜¯å¤©çœŸçƒ‚æ¼«ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬å®ä¹ ç”Ÿä¸€å¤©åœ¨å¤–é¢åˆ°å¤„è·‘ä¸€å¤©åŠ ä¸Šé¤è´¹ï¼ˆç®—ä¸Šè¡¥è´´ï¼‰å·¥èµ„æ‰å…­åå—å·¦å³ï¼Œå’Œä»–ä»¬ä¸€å¤©äºŒä¸‰ç™¾å—ï¼Œä¸‰å››ç™¾å—ç›¸æ¯”ã€‚ã€‚ã€‚ å•Šï¼Œæœç„¶å¤§å­¦ç”Ÿæ˜¯å»‰ä»·åŠ³åŠ¨åŠ›ï¼Œå¯æ¶ï¼ è¦æ˜¯æˆ‘æœ‰è¿™å·¥èµ„ï¼Œä¸è¯´å’Œä»–ä»¬ä¸€æ ·å·¥èµ„å¾…é‡ï¼Œæœ‰ä¸€åŠï¼Œå°±ç®—æ—©ä¸Šä¸ƒç‚¹å¼€å§‹å·¥ä½œåˆ°æ™šä¸Šä¹ç‚¹åŠåç‚¹ä¸‹ç­æˆ‘ä¹Ÿæ„¿æ„ï¼Œè¿«çœŸï¼Œå“ˆå“ˆã€‚ â€‹ å¦å¤–å‘¢ï¼Œæˆ‘ç°åœ¨ååˆ†è®¨åŒåˆ«äººæ‹¿ä»–é‚£ä¸€è¾ˆçš„è‰°è¾›å’Œéš¾å¤„â€œæ•™å¯¼/å¼€å¯¼â€æˆ‘ä»¬è¿™äº›åè¾ˆï¼Œé‚£æ—¶å€™ç¡®å®å¾ˆéš¾ï¼Œè¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ï¼Œæˆ‘ä¹Ÿååˆ†æ„Ÿæ¿€å‰è¾ˆä»¬çš„åŠªåŠ›å’Œä»˜å‡ºï¼Œè¿™æ‰æœ‰äº†å½“ä»Šè¿™æ ·ç¾å¥½çš„ç¤¾ä¼šã€‚ ä¹Ÿè®¸åˆä¸­é«˜ä¸­å‰è¾ˆä»¬çš„è¿™äº›è¯èƒ½æ„ŸæŸ“åˆ°æˆ‘ä»¬ï¼Œä½†ç°åœ¨é•¿å¤§äº†ï¼Œæœ‰äº›é“ç†ä¸è¨€è€Œå–»ï¼Œä¸çŸ¥ä¸è§‰ä¹‹é—´ä¹Ÿå¼€å§‹åŒæ¶è¿™äº›è¯ï¼Œç”šè‡³éº»ç—¹ï¼Œå¯¹äºè¿™äº›ï¼Œæˆ‘åªæƒ³è¯´ï¼Œæ—¶ä»£å˜äº†ï¼Œæ¯ä¸€ä»£äººéƒ½æœ‰æ¯ä¸€ä»£äººçš„çƒ¦æ¼å’Œè‰°è¾›ä¹‹å¤„ï¼Œæˆ–è®¸ä¸æ˜¯èº«ä½“ä¸Šçš„ï¼Œä½†ç²¾ç¥å’Œèº«å¿ƒä¸Šçš„çƒ¦æ¼ä¸ä¼¤å®³ï¼Œæˆ‘è§‰å¾—è¦æ¯”èº«ä½“ä¸Šçš„ä¸¥é‡ç™¾å€ä¸æ­¢ï¼ â€‹ è¿™é‡Œåˆæ‰¯è¿œäº†ï¼Œè¿›å…¥æ­£é¢˜ã€‚:next_track_button::next_track_button: ä¸Šé¢è¿™äº›éƒ½ä¸æ˜¯ä»Šå¤©çœŸæ­£è®©æˆ‘æ„¤æ‡‘å†™ä¸‹è¿™ç¯‡åšå®¢çš„åŸå› ï¼Œä¸æ­¢æˆ‘ä¸€äººç»™ä»–è¯´è¿‡28å·ä¸‹åˆ1:30-3:00è€ƒVRï¼Œå¹¶ä¸”éœ€è¦æå‰è‡³å°‘åŠå°æ—¶æ¥å‡†å¤‡è€ƒè¯•ã€‚ â€‹ å¯æ˜¯å‘¢ï¼Œä¸­åˆåä¸€ç‚¹åŠä¸‹ç­äº†è¿˜æ²¡è§åˆ°ä»–äººï¼Œå¼€è½¦ä¹Ÿä¸çŸ¥é“å»å“ªåŠäº›é‡è¦çš„ä¸šåŠ¡äº†ï¼Œæœç„¶å¤§å­¦ç”Ÿå°±æ˜¯å¤§å­¦ç”Ÿï¼Œå¯èƒ½æˆ‘ä»¬æ˜¯ä¸€äº›æ— æ‰€è°“çš„äººå§ï¼Œè¿‡äº†ååˆ†é’Ÿï¼Œä¹Ÿå°±æ˜¯åä¸€ç‚¹å››åå·¦å³ï¼Œæˆ‘è®©å’Œæˆ‘ä¸€èµ·å®ä¹ çš„åŒç­åŒå­¦æ‰“ç”µè¯ç»™ä»–ï¼Œå“ˆå“ˆï¼ŒçœŸæ˜¯æ²¡æƒ³åˆ°ï¼Œæ‰“è¿‡å»ï¼Œè¿™è¾¹å“äº†ä¸¤å£°ï¼Œé‚£è¾¹ç›´æ¥ç»™æŒ‚äº†ï¼æˆ‘æ•²ï¼Œæˆ‘è¿˜ä»¥ä¸ºåœ¨è·¯ä¸Šå‘¢ï¼Œå¿«è¦åˆ°äº†æ‰æ²¡æ¥ç”µè¯ï¼Œç»“æœå‘¢ï¼Œåˆè¿‡äº†åå‡ äºŒååˆ†é’Ÿå§ï¼Œå¤§æ¦‚åä¸€ç‚¹äº”åå¤šï¼Œä»–æ‰“ç”µè¯ç»™å¦å¤–ä¸€ä¸ªå’Œæˆ‘ä»¬ä¸€èµ·å®ä¹ çš„å¥³ç”Ÿï¼Œè¯´ä¸è¿‡æ¥äº†ï¼Œè®©æˆ‘ä»¬æ‰“è½¦å›å»ï¼Œï¼Ÿï¼Ÿï¼Ÿï¼ï¼ï¼çœŸæ˜¯ä¸ªå°æœºçµé¬¼å‘¢â€¦ä¸ªå±ã€‚ æˆ‘ä»¬åœ¨éƒŠåŒºåˆåœ¨ä¸€ä¸ªä½ç½®æ¯”è¾ƒé å¤§è·¯è¿œçš„ä¸€ä¸ªæ‘é‡Œï¼Œèƒ½æ‰“åˆ°è½¦ï¼Œæˆ‘ä¼°è®¡è€ƒè¯•éƒ½è€ƒå®Œäº†ï¼Œéšåï¼Œæœç„¶ï¼Œåœ¨æ»´æ»´ä¸Šç­‰äº†ååˆ†é’Ÿæ²¡è§ä¸ªè½¦å½±ã€‚ æœ€åï¼Œè¿™é‡Œè¦ååˆ†æ„Ÿè°¢é©¬å²­å²—æ‘é‡Œçš„é‚£ä¸ªä¹¦è®°å¤§å“¥æŠŠæˆ‘ä¿©é€å›å»ï¼Œè¿˜æœ‰ä¸€åŒå®ä¹ çš„é‚£ä¸ªå¥³ç”Ÿå¸®æˆ‘ä»¬è¯´æ¸…æ¥šåŸå› è®©å¤§å“¥å¸¦æˆ‘ä»¬å›å»è€ƒè¯•ï¼ŒçœŸæ˜¯ååˆ†æ„Ÿè°¢ã€‚ ä»¥ä¸Šéƒ½åªæ˜¯æˆ‘çš„ä¸ªäººè§‚ç‚¹ï¼Œæƒ³æ‰¯æ·¡çš„è¯ï¼Œå¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºåŒºå’Œæˆ‘ä¸€èµ·äº¤æµäº¤æµè¿™æ–¹é¢çš„ä¸€äº›ä¸œè¥¿ã€‚ åœ¨æ­¤ï¼Œæœ€åä¸€æ¬¡å‘ä¸‡æ¶çš„èµ„æœ¬ä¸»ä¹‰ä½å¤´ã€‚ ","date":"2020-06-28","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E6%9E%9C%E7%84%B6%E5%A4%A7%E5%AD%A6%E7%94%9F%E9%83%BD%E6%98%AF%E5%BB%89%E4%BB%B7%E5%8A%B3%E5%8A%A8%E5%8A%9B%E5%90%97%E5%8F%AF%E6%81%B6/:0:0","tags":["æ—¥è®°","å®ä¹ ","åæ§½"],"title":"ã€æ—¥è®°ã€‘æœç„¶å¤§å­¦ç”Ÿéƒ½æ˜¯å»‰ä»·åŠ³åŠ¨åŠ›å—ï¼Ÿå¯æ¶ï¼","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E6%9E%9C%E7%84%B6%E5%A4%A7%E5%AD%A6%E7%94%9F%E9%83%BD%E6%98%AF%E5%BB%89%E4%BB%B7%E5%8A%B3%E5%8A%A8%E5%8A%9B%E5%90%97%E5%8F%AF%E6%81%B6/"},{"categories":["ç”Ÿæ´»","æ—¥è®°"],"content":"è‹¦é€¼çš„å®ä¹ å·²ç»è¿›è¡Œåˆ°ç¬¬ä¸‰å¤©ï¼Œå¤©æ°”ä¸€å¤©æ¯”ä¸€å¤©çƒ­ï¼Œä¸è¿‡å€¼å¾—é«˜å…´çš„æ˜¯ï¼Œä¸ç”¨å†ä¸€ä¸€è¿›æˆ·å¯¹æ‰€æœ‰æˆ¿å±‹è¿›è¡Œæµ‹é‡äº†ï¼Œå‡å°‘äº†äº†ä¸å°‘çš„å·¥ä½œé‡ï¼Œå› ä¸ºæ˜¨å¤©ä¸‹åˆå·²ç»ç”¨RTKæµ‹é‡å¥½äº†æ§åˆ¶ç‚¹ï¼Œé‚£äº›æ— æ•°æœ¨é®æŒ¡çš„å»ºç­‘ç‰©å°±å¯ä»¥ç›´æ¥ç”¨æ— äººæœºè¿›è¡Œæµ‹é‡äº†ã€‚æ— éœ€äººå·¥å†æµ‹é‡ã€‚ æµ‹é‡ingæµ‹é‡ing \" æµ‹é‡ing å¦å¤–å‘¢ï¼Œè¿™é‡Œçš„æ‘æ°‘ååˆ†çš„çƒ­å¿ƒå¥½å®¢ï¼Œå¤©æ°”ç‚çƒ­ï¼Œç»™æˆ‘ä»¬åˆ‡è¥¿ç“œå’Œå†°æ£åƒï¼Œå“ˆå“ˆï¼Œæˆ‘ä»¬ä¸‰äººåƒäº†ä¸€è·¯ï¼ˆå½“ç„¶æ²¡è¿™ä¹ˆå¤¸å¼ ï¼‰ï¼ŒçœŸæ˜¯ä¸é”™å‘¢ã€‚ å¦é™„ä¸€å¼ æ‘æ°‘å®¶é‡Œé‡åˆ°çš„å±±ç¾Šå…„å¼Ÿï¼š å±±ç¾Šå…„å¼Ÿå±±ç¾Šå…„å¼Ÿ \" å±±ç¾Šå…„å¼Ÿ å•Šï¼Œè¿˜æœ‰å¥½å¤šæˆ·è¦é‡ï¼ŒåšæŒåšæŒï¼Œä¹Ÿå°±è¿™å‡ å¤©äº†ï¼Œæ¸¯å·´å˜šï¼ ","date":"2020-06-25","objectID":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%A9%AC%E5%B2%AD%E5%B2%97%E6%9D%91%E5%AE%9E%E4%B9%A0/:0:0","tags":["æ—¥è®°","å®ä¹ "],"title":"ã€æ—¥è®°ã€‘é©¬å²­å²—æ‘å®ä¹ ","uri":"/myBlog-2/post/%E6%97%A5%E8%AE%B0%E9%A9%AC%E5%B2%AD%E5%B2%97%E6%9D%91%E5%AE%9E%E4%B9%A0/"},{"categories":["Linux","Tools"],"content":"æœ¬æ–‡ä¸»è¦ä»‹ç»Linuxç³»ç»Ÿä¸‹çš„æ—¥å¿—åˆ†å‰²å·¥å…·ï¼ŒSplit å’Œ Logrotateã€‚ ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:0:0","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"Split Linux ç³»ç»Ÿè‡ªå¸¦ç®€å•æ—¥å¿—æ–‡ä»¶åˆ†å‰²å·¥å…·ã€‚ å¸¸ç”¨å‚æ•°åˆ—è¡¨ï¼š é€‰é¡¹ å«ä¹‰ -b åˆ†å‰²åçš„æ–‡æ¡£å¤§å°ï¼Œå•ä½æ˜¯byte -C åˆ†å‰²åçš„æ–‡æ¡£ï¼Œå•è¡Œæœ€å¤§byteæ•° -d ä½¿ç”¨æ•°å­—ä½œä¸ºåç¼€(default: å­—æ¯)ï¼ŒåŒæ—¶ä½¿ç”¨-a length(default: 2)æŒ‡å®šåç¼€é•¿åº¦ -l åˆ†å‰²åæ–‡æ¡£çš„è¡Œæ•° â€“verbose æ˜¾ç¤ºè¾“å‡ºè¯¦ç»†ä¿¡æ¯ ç¤ºä¾‹ï¼š split -l --verbose 1000000 split.test -d -a 3 split.log â•°â”€$ ls split.test split.test008 split.test017 split.test026 split.test000 split.test009 split.test018 split.test027 split.test001 split.test010 split.test019 split.test028 split.test002 split.test011 split.test020 split.test029 split.test003 split.test012 split.test021 split.test030 split.test004 split.test013 split.test022 split.test031 split.test005 split.test014 split.test023 split.test032 split.test006 split.test015 split.test024 split.test033 split.test007 split.test016 split.test025 ... ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:1:0","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"Logrotate ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:0","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"ç®€ä»‹åŠè§£å†³æ–¹æ¡ˆ Logrotateï¼Œå³Log rotationæ—¥å¿—æ»šåŠ¨ï¼Œå±äºLinuxç³»ç»Ÿè‡ªå¸¦å·¥å…·ï¼ŒåŸºäºcrontabå®ç°æ—¶é—´ç‚¹æ»šåŠ¨æ—¥å¿—ï¼Œè®¡åˆ’æ¯å¤©è¿è¡Œçš„è„šæœ¬ä½äº /etc/cron.daily/logrotateã€‚ GitHub åœ°å€ï¼šhttps://github.com/logrotate/logrotate logrotate æ˜¯æ€ä¹ˆåšåˆ°æ»šåŠ¨æ—¥å¿—æ—¶ä¸å½±å“ç¨‹åºæ­£å¸¸çš„æ—¥å¿—è¾“å‡ºå‘¢ï¼Ÿlogrotate æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚ create copytruncate ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:1","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"create è¿™ä¹Ÿå°±æ˜¯é»˜è®¤çš„æ–¹æ¡ˆï¼Œå¯ä»¥é€šè¿‡ create å‘½ä»¤é…ç½®æ–‡ä»¶çš„æƒé™å’Œå±ç»„è®¾ç½®ï¼›è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯é‡å‘½ååŸæ—¥å¿—æ–‡ä»¶ï¼Œåˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š é‡å‘½åæ­£åœ¨è¾“å‡ºæ—¥å¿—æ–‡ä»¶ï¼Œå› ä¸ºé‡å‘½ååªä¿®æ”¹ç›®å½•ä»¥åŠæ–‡ä»¶çš„åç§°ï¼Œè€Œè¿›ç¨‹æ“ä½œæ–‡ä»¶ä½¿ç”¨çš„æ˜¯ inodeï¼Œæ‰€ä»¥å¹¶ä¸å½±å“åŸç¨‹åºç»§ç»­è¾“å‡ºæ—¥å¿—ã€‚ åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ï¼Œæ–‡ä»¶åå’ŒåŸæ—¥å¿—æ–‡ä»¶ä¸€æ ·ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶åªæ˜¯æ–‡ä»¶åç§°ä¸€æ ·ï¼Œè€Œ inode ç¼–å·ä¸åŒï¼ŒåŸç¨‹åºè¾“å‡ºçš„æ—¥å¿—è¿˜æ˜¯å¾€åŸæ—¥å¿—æ–‡ä»¶è¾“å‡ºã€‚ æœ€åé€šè¿‡æŸäº›æ–¹å¼é€šçŸ¥ç¨‹åºï¼Œé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼›ç”±äºé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ä¼šç”¨åˆ°æ–‡ä»¶è·¯å¾„è€Œé inode ç¼–å·ï¼Œæ‰€ä»¥æ‰“å¼€çš„æ˜¯æ–°çš„æ—¥å¿—æ–‡ä»¶ã€‚ å¦‚ä¸Šä¹Ÿå°±æ˜¯ logrotate çš„é»˜è®¤æ“ä½œæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ mv+create æ‰§è¡Œå®Œä¹‹åï¼Œé€šçŸ¥åº”ç”¨é‡æ–°åœ¨æ–°æ–‡ä»¶å†™å…¥å³å¯ã€‚mv+create æˆæœ¬éƒ½æ¯”è¾ƒä½ï¼Œå‡ ä¹æ˜¯åŸå­æ“ä½œï¼Œå¦‚æœåº”ç”¨æ”¯æŒé‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¦‚ syslog, nginx, mysql ç­‰ï¼Œé‚£ä¹ˆè¿™æ˜¯æœ€å¥½çš„æ–¹å¼ã€‚ ä¸è¿‡ï¼Œæœ‰äº›ç¨‹åºå¹¶ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼Œå‹æ ¹æ²¡æœ‰æä¾›é‡æ–°æ‰“å¼€æ—¥å¿—çš„æ¥å£ï¼›è€Œå¦‚æœé‡å¯åº”ç”¨ç¨‹åºï¼Œå¿…ç„¶ä¼šé™ä½å¯ç”¨æ€§ï¼Œä¸ºæ­¤å¼•å…¥äº†å¦‚ä¸‹æ–¹å¼ã€‚ ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:2","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"copytruncate è¯¥æ–¹æ¡ˆæ˜¯æŠŠæ­£åœ¨è¾“å‡ºçš„æ—¥å¿—æ‹· (copy) ä¸€ä»½å‡ºæ¥ï¼Œå†æ¸…ç©º (trucate) åŸæ¥çš„æ—¥å¿—ï¼›è¯¦ç»†æ­¥éª¤å¦‚ä¸‹ï¼š å°†å½“å‰æ­£åœ¨è¾“å‡ºçš„æ—¥å¿—æ–‡ä»¶å¤åˆ¶ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œæ­¤æ—¶ç¨‹åºä»ç„¶å°†æ—¥å¿—è¾“å‡ºåˆ°åŸæ¥æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶ï¼ŒåŸæ–‡ä»¶åä¹Ÿæ²¡æœ‰å˜ã€‚ æ¸…ç©ºæ—¥å¿—æ–‡ä»¶ï¼ŒåŸç¨‹åºä»ç„¶è¿˜æ˜¯è¾“å‡ºåˆ°é¢„æ¡ˆæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå› ä¸ºæ¸…ç©ºæ–‡ä»¶åªæŠŠæ–‡ä»¶çš„å†…å®¹åˆ é™¤äº†ï¼Œè€Œ inode å¹¶æ²¡æ”¹å˜ï¼Œåç»­æ—¥å¿—çš„è¾“å‡ºä»ç„¶å†™å…¥è¯¥æ–‡ä»¶ä¸­ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå¯¹äº copytruncate ä¹Ÿå°±æ˜¯å…ˆå¤åˆ¶ä¸€ä»½æ–‡ä»¶ï¼Œç„¶åæ¸…ç©ºåŸæœ‰æ–‡ä»¶ã€‚ é€šå¸¸æ¥è¯´ï¼Œæ¸…ç©ºæ“ä½œæ¯”è¾ƒå¿«ï¼Œä½†æ˜¯å¦‚æœæ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Œé‚£ä¹ˆå¤åˆ¶å°±ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œä»è€Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†æ—¥å¿—ä¸¢å¤±ã€‚ä¸è¿‡è¿™ç§æ–¹å¼ä¸éœ€è¦åº”ç”¨ç¨‹åºçš„æ”¯æŒå³å¯ã€‚ æ‰§è¡Œæ–‡ä»¶ï¼š /usr/sbin/logrotate ä¸»é…ç½®æ–‡ä»¶: /etc/logrotate.conf è‡ªå®šä¹‰é…ç½®æ–‡ä»¶: /etc/logrotate.d/*.conf æ‰§è¡ŒçŠ¶æ€æ–‡ä»¶ï¼š/var/lib/logrotate/logrotate.status ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:3","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"è¿è¡Œ logrotate logrotate å‘½ä»¤æ ¼å¼åŠå¸¸ç”¨å‚æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š logrotate [-dv] [-f|--force] [-s|--state file] config_file .. -d, --debug ï¼šdebug æ¨¡å¼ï¼Œæµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰é”™è¯¯ï¼Œå¹¶ä¸ä¼šçœŸæ­£æ‰§è¡Œ rorate å’Œ compose æ“ä½œï¼Œä½†æ˜¯ä¼šæ‰“å°å‡ºæ•´ä¸ªæ‰§è¡Œçš„æµç¨‹ï¼Œå’Œè°ƒç”¨çš„è„šæœ¬ç­‰è¯¦ç»†ä¿¡æ¯ã€‚ -f, --force ï¼šå¼ºåˆ¶è½¬å‚¨æ–‡ä»¶ã€‚ -m, --mail=command ï¼šå‹ç¼©æ—¥å¿—åï¼Œå‘é€æ—¥å¿—åˆ°æŒ‡å®šé‚®ç®±ã€‚ -s, --state=statefile ï¼šä½¿ç”¨æŒ‡å®šçš„çŠ¶æ€æ–‡ä»¶ã€‚ -v, --verbose ï¼šæ˜¾ç¤ºè¯¦ç»†è½¬å‚¨è¿‡ç¨‹ã€‚ é€šå¸¸ä½¿ç”¨çš„æ–¹æ³•æ˜¯é…åˆcrontabæ¥è¿è¡Œï¼š crontab -e */30 * * * * /usr/sbin/logrotate /etc/logrotate.d/rsyslog \u003e /dev/null 2\u003e\u00261 \u0026 æ‰‹åŠ¨è°ƒç”¨ logrotateï¼š # è°ƒç”¨ /etc/lograte.d/ ä¸‹é…ç½®çš„æ‰€æœ‰æ—¥å¿— logrotate /etc/logrotate.conf # è¦ä¸ºæŸä¸ªç‰¹å®šçš„é…ç½®è°ƒç”¨ logrotate logrotate -d /etc/logrotate.d/log_file # å¼€å¯debugæ¨¡å¼ï¼Œä¸å®é™…ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ã€‚ ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:4","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"é…ç½®æ–‡ä»¶è¯¦è§£ è¿™é‡Œä»¥ç³»ç»Ÿè‡ªå¸¦çš„éƒ¨åˆ†/etc/logrotate.d/rsyslogé…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼š /var/log/syslog { rotate 7 daily missingok notifempty delaycompress compress postrotate /usr/lib/rsyslog/rsyslog-rotate endscript } monthly: æ—¥å¿—æ–‡ä»¶å°†æŒ‰æœˆè½®å¾ªã€‚å…¶å®ƒå¯ç”¨å€¼ä¸º dailyï¼Œweekly æˆ–è€… yearlyã€‚ rotate 5: ä¸€æ¬¡å°†å­˜å‚¨ 5 ä¸ªå½’æ¡£æ—¥å¿—ã€‚å¯¹äºç¬¬å…­ä¸ªå½’æ¡£ï¼Œæ—¶é—´æœ€ä¹…çš„å½’æ¡£å°†è¢«åˆ é™¤ã€‚ compress: åœ¨è½®å¾ªä»»åŠ¡å®Œæˆåï¼Œå·²è½®å¾ªçš„å½’æ¡£å°†ä½¿ç”¨ gzip è¿›è¡Œå‹ç¼©ã€‚ delaycompress: æ€»æ˜¯ä¸ compress é€‰é¡¹ä¸€èµ·ç”¨ï¼Œdelaycompress é€‰é¡¹æŒ‡ç¤º logrotate ä¸è¦å°†æœ€è¿‘çš„å½’æ¡£å‹ç¼©ï¼Œå‹ç¼© å°†åœ¨ä¸‹ä¸€æ¬¡è½®å¾ªå‘¨æœŸè¿›è¡Œã€‚è¿™åœ¨ä½ æˆ–ä»»ä½•è½¯ä»¶ä»ç„¶éœ€è¦è¯»å–æœ€æ–°å½’æ¡£æ—¶å¾ˆæœ‰ç”¨ã€‚ missingok: åœ¨æ—¥å¿—è½®å¾ªæœŸé—´ï¼Œä»»ä½•é”™è¯¯å°†è¢«å¿½ç•¥ï¼Œä¾‹å¦‚ â€œæ–‡ä»¶æ— æ³•æ‰¾åˆ°â€ ä¹‹ç±»çš„é”™è¯¯ã€‚ notifempty: å¦‚æœæ—¥å¿—æ–‡ä»¶ä¸ºç©ºï¼Œè½®å¾ªä¸ä¼šè¿›è¡Œã€‚ create 644 root root: ä»¥æŒ‡å®šçš„æƒé™åˆ›å»ºå…¨æ–°çš„æ—¥å¿—æ–‡ä»¶ï¼ŒåŒæ—¶ logrotate ä¹Ÿä¼šé‡å‘½ååŸå§‹æ—¥å¿—æ–‡ä»¶ã€‚ postrotate/endscript: åœ¨æ‰€æœ‰å…¶å®ƒæŒ‡ä»¤å®Œæˆåï¼Œpostrotate å’Œ endscript é‡Œé¢æŒ‡å®šçš„å‘½ä»¤å°†è¢«æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œrsyslogd è¿›ç¨‹å°†ç«‹å³å†æ¬¡è¯»å–å…¶é…ç½®å¹¶ç»§ç»­è¿è¡Œã€‚ å…¶ä»–å¸¸ç”¨å‚æ•°ï¼š tabooext [+] list:è®© logrotate ä¸è½¬å‚¨æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶ï¼Œç¼ºçœçš„æ‰©å±•åæ˜¯.rpm-orig, .rpmsave, v, å’Œï½ missingok:åœ¨æ—¥å¿—è½®å¾ªæœŸé—´ï¼Œä»»ä½•é”™è¯¯å°†è¢«å¿½ç•¥ï¼Œä¾‹å¦‚ â€œæ–‡ä»¶æ— æ³•æ‰¾åˆ°â€ ä¹‹ç±»çš„é”™è¯¯ã€‚ size size:å½“æ—¥å¿—æ–‡ä»¶åˆ°è¾¾æŒ‡å®šçš„å¤§å°æ—¶æ‰è½¬å‚¨ï¼Œbytes (ç¼ºçœ) åŠ KB (sizek) æˆ– MB (sizem) copytruncate:ç”¨äºè¿˜åœ¨æ‰“å¼€ä¸­çš„æ—¥å¿—æ–‡ä»¶ï¼ŒæŠŠå½“å‰æ—¥å¿—å¤‡ä»½å¹¶æˆªæ–­ nocopytruncate: å¤‡ä»½æ—¥å¿—æ–‡ä»¶ä½†æ˜¯ä¸æˆªæ–­ create mode owner group : è½¬å‚¨æ–‡ä»¶ï¼Œä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶æ¨¡å¼åˆ›å»ºæ–°çš„æ—¥å¿—æ–‡ä»¶ nocreate: ä¸å»ºç«‹æ–°çš„æ—¥å¿—æ–‡ä»¶ nodelaycompress: è¦†ç›– delaycompress é€‰é¡¹ï¼Œè½¬å‚¨åŒæ—¶å‹ç¼©ã€‚ errors address : ä¸“å‚¨æ—¶çš„é”™è¯¯ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„ Email åœ°å€ ifempty :å³ä½¿æ˜¯ç©ºæ–‡ä»¶ä¹Ÿè½¬å‚¨ï¼Œè¿™ä¸ªæ˜¯ logrotate çš„ç¼ºçœé€‰é¡¹ã€‚ mail address : æŠŠè½¬å‚¨çš„æ—¥å¿—æ–‡ä»¶å‘é€åˆ°æŒ‡å®šçš„ E-mail åœ°å€ nomail : è½¬å‚¨æ—¶ä¸å‘é€æ—¥å¿—æ–‡ä»¶ olddir directory:å‚¨åçš„æ—¥å¿—æ–‡ä»¶æ”¾å…¥æŒ‡å®šçš„ç›®å½•ï¼Œå¿…é¡»å’Œå½“å‰æ—¥å¿—æ–‡ä»¶åœ¨åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ noolddir: è½¬å‚¨åçš„æ—¥å¿—æ–‡ä»¶å’Œå½“å‰æ—¥å¿—æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:5","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"logrotate æ—¥å¿—åˆ‡å‰²è½®è¯¢ ç”±äº logrotate æ˜¯åŸºäºcronè¿è¡Œçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¥å¿—è½®è½¬çš„æ—¶é—´æ˜¯ç”± cron æ§åˆ¶çš„ï¼Œå…·ä½“å¯ä»¥æŸ¥è¯¢ cron çš„é…ç½®æ–‡ä»¶ /etc/anacrontabï¼Œè¿‡å¾€çš„è€ç‰ˆæœ¬çš„æ–‡ä»¶ä¸ºï¼ˆ/etc/crontabï¼‰ ä½¿ç”¨ crontab æ¥ä½œä¸ºæ—¥å¿—è½®è½¬çš„è§¦å‘å®¹å™¨æ¥ä¿®æ”¹ logrotate é»˜è®¤æ‰§è¡Œæ—¶é—´ï¼š $ vim /etc/crontab # åˆ‡å‰²æ—¶é—´ä¸ºæ¯å¤©æ™šä¸Šçš„12ç‚¹é’Ÿ SHELL=/bin/bash PATH=/sbin:/bin:/usr/sbin:/usr/bin MAILTO=root HOME=/ # run-parts 01 * * * * root run-parts /etc/cron.hourly 59 23 * * * root run-parts /etc/cron.daily 22 4 * * 0 root run-parts /etc/cron.weekly 42 4 1 * * root run-parts /etc/cron.monthly ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:6","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"é™„ï¼šlogrotate é…ç½®æ–‡ä»¶ç¤ºä¾‹ syslog [root@gop-sg-192-168-56-103 logrotate.d]# cat syslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { missingok sharedscripts postrotate /bin/kill -HUP `cat /var/run/syslogd.pid 2\u003e /dev/null` 2\u003e /dev/null || true endscript } zabbix-agent [root@gop-sg-192-168-56-103 logrotate.d]# cat zabbix-agent /var/log/zabbix/zabbix_agentd.log { weekly rotate 12 compress delaycompress missingok notifempty create 0664 zabbix zabbix } nginx [root@gop-sg-192-168-56-103 logrotate.d]# cat nginx /var/log/nginx/*.log /var/log/nginx/*/*.log{ daily missingok rotate 14 compress delaycompress notifempty create 640 root adm sharedscripts postrotate [ ! -f /var/run/nginx.pid ] || kill -USR1 `cat /var/run/nginx.pid` endscript } influxdb [root@gop-sg-192-168-56-103 logrotate.d]# cat influxdb /var/log/influxdb/access.log { daily rotate 7 missingok dateext copytruncate compress } ","date":"2020-06-22","objectID":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/:2:7","tags":["Linux","æ—¥å¿—åˆ†å‰²","å·¥å…·"],"title":"Linux æ—¥å¿—åˆ†å‰²å·¥å…·-splitå’Œlogrotate","uri":"/myBlog-2/post/linux-%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2%E5%B7%A5%E5%85%B7/"},{"categories":["Linux","Tools"],"content":"WTFå’Œbashtopæ˜¯æˆ‘ä¸ªäººç›®å‰åœ¨ç”¨çš„ç³»ç»Ÿèµ„æºç®¡ç†é¢æ¿ï¼Œç•Œé¢éå¸¸çš„ç¾è§‚ï¼Œæå…·æå®¢é£èŒƒï¼Œåœ¨è¿™é‡Œæˆ‘åˆ†åˆ«åšç®€å•ä»‹ç»ã€‚ ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:0:0","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"WTF WTFï¼ˆåˆåâ€œwtfutilâ€ï¼‰æ˜¯ç»ˆç«¯çš„ä¸ªäººä¿¡æ¯ä»ªè¡¨æ¿ï¼Œå¯å¿«é€Ÿè®¿é—®æ‚¨éå¸¸é‡è¦ä½†ä¸å¸¸éœ€è¦çš„ç»Ÿè®¡ä¿¡æ¯å’Œæ•°æ®ã€‚ é¡¹ç›®åœ°å€ï¼šhttps://github.com/wtfutil/wtf å®˜æ–¹ç«™ç‚¹ï¼šhttps://wtfutil.com/ å…ˆæ”¾ä¸€å¼ æˆªå›¾å§ï¼š WTFæˆªå›¾\" WTFæˆªå›¾ é¢æ¿ä¸­æœ‰ä»¥ä¸‹å±•ç¤ºæ¨¡å—ï¼š ä¸–ç•Œæ—¶é—´ æˆ‘çš„IPåœ°å€ä¿¡æ¯ TODO Listï¼ˆå¾…åŠäº‹ä»¶ï¼‰ ç³»ç»Ÿå®‰å…¨çŠ¶æ€ å½“å‰åŸå¸‚å¤©æ°” ç”µæºä½¿ç”¨æƒ…å†µ docker è¿è¡ŒçŠ¶æ€ èµ„æºä½¿ç”¨æƒ…å†µ ç¡¬ç›˜å ç”¨æƒ…å†µ å¼€æœºæ—¶é•¿ å¥½äº†ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹å§ã€‚ ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:1:0","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"å®‰è£…ä¸ä½¿ç”¨ é¦–å…ˆæ‰“å¼€é¡¹ç›®çš„ releaseä»“åº“ ä¸‹è½½å¯ç›´æ¥ä½¿ç”¨çš„äºŒè¿›åˆ¶åŒ…. wget https://github.com/wtfutil/wtf/releases/download/v0.30.0/wtf_0.30.0_linux_amd64.tar.gz tar xf wtf_0.30.0_linux_amd64.tar.gz è§£å‹å®Œæˆä¹‹åï¼Œç›´æ¥è¿è¡Œ./wtfutilå³å¯ï¼Œä¸ºäº†æ—¥åæ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†è¯¥ç¨‹åºè½¯è¿æ¥åˆ°ç”¨æˆ·binç›®å½•è¿›è¡Œä½¿ç”¨ï¼š ln -sv /root/wtfutil /usr/bin/ ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:1:1","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"é…ç½®æ–‡ä»¶ ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶çš„ç›®å½•æ˜¯$HOME/.config/wtf/config.ymlï¼Œå¯ä»¥æ‹¿æ¥å‚è€ƒå‚è€ƒï¼š :information_source:æ–‡ä»¶æ¯”è¾ƒé•¿ï¼Œå•å‡»Â»\u003e è¿™é‡Œ Â«\u003cå¯ç›´æ¥è·³åˆ°ä¸‹ä¸€èŠ‚ wtf:colors:background:blackborder:focusable:darkslatebluefocused:orangenormal:graychecked:yellowhighlight:fore:blackback:grayrows:even:yellowodd:whitegrid:columns:[40,35,35,55]rows:[10,10,10,10,4]refreshInterval:1openFileUtil:\"open\"mods:digitalclock:color:redenabled:truefont:digitalfonthourFormat:24position:top:0left:0height:1width:1refreshInterval:1title:\"big clock\"type:\"digitalclock\"world_time:title:\"World Time\"type:clockscolors:rows:even:\"lightblue\"odd:\"white\"enabled:truelocations:UTC:\"Etc/UTC\"London:\"Europe/London\"Berlin:\"Europe/Berlin\"New_York:\"America/New_York\"China:\"Asia/Shanghai\"position:top:0left:1height:1width:1refreshInterval:15sort:\"alphabetical\"battery:type:powertitle:\"âš¡ï¸\"enabled:trueposition:top:1left:3height:1width:1refreshInterval:15todolist:type:todocheckedIcon:\"X\"colors:checked:grayhighlight:fore:\"black\"back:\"orange\"enabled:truefilename:\"todo.yml\"position:top:1left:0height:2width:1refreshInterval:3600ip:type:ipinfotitle:\"My IP\"colors:name:\"lightblue\"value:\"white\"enabled:trueposition:top:0left:2height:1width:2refreshInterval:150prettyweather:enabled:truecity:\"ä¸´æ²‚\"position:top:1left:2height:1width:1refreshInterval:300unit:\"m\"view:0language:\"en\"security:enabled:trueposition:top:1left:1height:1width:1refreshInterval:3600docker:type:dockerenabled:truelabelColor:lightblueposition:top:2left:1height:1width:3refreshInterval:1resources:type:resourceusageenabled:trueposition:top:3left:0height:2width:1refreshInterval:1uptime:type:cmdrunnerargs:[\"\"]cmd:\"uptime\"enabled:trueposition:top:4left:1height:1width:3refreshInterval:30disks:type:cmdrunnercmd:\"df\"args:[\"-h\"]enabled:trueposition:top:3left:1height:1width:3refreshInterval:3600 ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:1:2","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"å®˜æ–¹æ”¯æŒæ¨¡å— å•å‡»ä»¥å±•å¼€ Azure DevOps BambooHR Buildkite CDS CircleCI Clocks CmdRunner Crypto Currencies Datadog DEV (dev.to) Digital Clock DigitalOcean Docker Exchange Rates Feed Reader Gerrit Git GitHub GitLab Gitter Google Apps Hacker News Have I Been Pwned (HIBP) IP Addresses Jenkins Jira Kubernetes Logger Mercurial New Relic OpsGenie Pagerduty Pi-hole Power Resource Usage Rollbar Security Sports Spotify Subreddit Textfile Todo Todoist Transmission TravisCI Trello Twitter VictorOps OnCall Weather Services Zendesk ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:1:3","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"bashtop å®˜æ–¹å¼€æºä»“åº“ï¼šhttps://github.com/aristocratos/bashtos æˆªå›¾\" æˆªå›¾ ä¸»èœå•ï¼š ä¸»èœå•\" ä¸»èœå• é€‰é¡¹èœå•ï¼š é€‰é¡¹èœå•\" é€‰é¡¹èœå• ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:2:0","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"å®‰è£…ä¸ä½¿ç”¨ Add PPA repository and install bashtop sudo add-apt-repository ppa:bashtop-monitor/bashtop sudo apt update sudo apt install bashtop å®‰è£…å®Œæ¯•ä¹‹åï¼Œç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œbashtopå³å¯ã€‚ ä½¿ç”¨ESCé”®å¯ä»¥å‘¼å‡ºèœå•ï¼ŒæŒ‰ä¸‹qé”®é€€å‡ºã€‚ ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:2:1","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux","Tools"],"content":"é…ç½®æ–‡ä»¶ All options changeable from within UI. Config files stored in â€œ$HOME/.config/bashtopâ€ folder bashtop.cfg: (auto generated if not found) #? Config file for bashtop v. 0.9.9 #* Color theme, looks for a .theme file in \"$HOME/.config/bashtop/themes\" and \"$HOME/.config/bashtop/user_themes\", \"Default\" for builtin default theme color_theme=\"Default\" #* Update time in milliseconds, increases automatically if set below internal loops processing time, recommended 2000 ms or above for better sample times for graphs update_ms=\"2500\" #* Processes sorting, \"pid\" \"program\" \"arguments\" \"threads\" \"user\" \"memory\" \"cpu lazy\" \"cpu responsive\" \"tree\" #* \"cpu lazy\" updates sorting over time, \"cpu responsive\" updates sorting directly at a cpu usage cost proc_sorting=\"cpu lazy\" #* Reverse sorting order, \"true\" or \"false\" proc_reversed=\"false\" #* Check cpu temperature, only works if \"sensors\", \"vcgencmd\" or \"osx-cpu-temp\" commands is available check_temp=\"true\" #* Draw a clock at top of screen, formatting according to strftime, empty string to disable draw_clock=\"%X\" #* Update main ui when menus are showing, set this to false if the menus is flickering too much for comfort background_update=\"true\" #* Custom cpu model name, empty string to disable custom_cpu_name=\"\" #* Enable error logging to \"$HOME/.config/bashtop/error.log\", \"true\" or \"false\" error_logging=\"true\" #* Show color gradient in process list, \"true\" or \"false\" proc_gradient=\"true\" #* If process cpu usage should be of the core it's running on or usage of the total available cpu power proc_per_core=\"false\" #* Optional filter for shown disks, should be names of mountpoints, \"root\" replaces \"/\", separate multiple values with space disks_filter=\"\" #* Enable check for new version from github.com/aristocratos/bashtop at start update_check=\"true\" #* Enable graphs with double the horizontal resolution, increases cpu usage hires_graphs=\"false\" #* Enable the use of psutil python3 module for data collection, default on OSX use_psutil=\"true\" ","date":"2020-06-12","objectID":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/:2:2","tags":["Linux","ç›‘æ§"],"title":"Linux ç³»ç»Ÿèµ„æºç›‘æ§é¢æ¿","uri":"/myBlog-2/post/linux-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/"},{"categories":["Linux"],"content":"[TOC] ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:0:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"é€šè¿‡ openssl ç”Ÿæˆ [root@myhost ~]\\# openssl rand -base64 3 xsSp [root@myhost ~]\\# openssl rand -base64 8 8SlHCsBAiYw= [root@myhost ~]\\# openssl rand -base64 10 nUzBw8ngKGGqWw== `openssl rand -base64 32|tr A-Z a-z|cut -c 1-10` ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:1:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"ä½¿ç”¨ date å‘½ä»¤ç”Ÿæˆ [root@myhost ~]\\# date +%s 1539071518 [root@myhost ~]\\# date +%N 801398716 [root@myhost ~]\\# date +%s%N 1539071555311467855 `date +%s |sha256sum |base64 |head -c 10 ;echo` ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:2:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"ä½¿ç”¨ md5sum ç”Ÿæˆéšæœºæ•° date | md5sum ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:3:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"ä½¿ç”¨ dd å‘½ä»¤ç”Ÿæˆéšæœºæ•° dd if=/dev/urandom bs=1 count=15|base64 -w 0 ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:4:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"é€šè¿‡/dev/randomè®¾å¤‡äº§ç”Ÿuuid [root@myhost ~]\\# cat /proc/sys/kernel/random/uuid a3dfb0f2-f893-4e57-9d67-184a88d4cb5d [root@myhost ~]\\# cat /proc/sys/kernel/random/uuid |cut -c 1-8 b80c60d8 ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:5:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡ RANDOM [root@myhost ~]\\# echo $RANDOM 14535 ##è¯´æ˜ï¼šlinuxç³»ç»Ÿä¸‹çš„ç¯å¢ƒå˜é‡$RANDOMçš„å–å€¼èŒƒå›´æ˜¯ï¼š0â€“32767 ã€‚ äº§ç”Ÿ0-25èŒƒå›´å†…çš„æ•°ï¼Œç”¨è¿™ä¸ªç¯å¢ƒå˜é‡å¯¹26å–ä½™å³å¯ã€‚ [root@myhost ~]\\# echo $(($RANDOM%26)) 6 [root@myhost ~]\\# echo $((RANDOM%26)) 11 ##è¯´æ˜ï¼šç¬¬äºŒä¸ªè¡¨è¾¾å¼RANDOMå‰é¢æ— $ç¬¦å·å¥½åƒä¹Ÿå¯ä»¥ã€‚ äº§ç”Ÿ6ä½æ•°çš„æ•´æ•°ï¼Œç”¨è¿™ä¸ªç¯å¢ƒå˜é‡åŠ ä¸Š100000å³å¯ã€‚ [root@myhost ~]\\# echo $(($RANDOM+100000)) 117482 [root@myhost ~]\\# echo $((RANDOM+100000)) 126058 ##è¯´æ˜ï¼šç¬¬äºŒä¸ªè¡¨è¾¾å¼RANDOMå‰é¢æ— $ç¬¦å·å¥½åƒä¹Ÿå¯ä»¥ã€‚ äº§ç”ŸåŠ å¯†çš„éšæœºæ•°ç ï¼Œå°†éšæœºæ•°ç®¡é“ç»™å‘½ä»¤md5sumå‘½ä»¤å³å¯ã€‚ [root@myhost ~]\\# echo $RANDOM |md5sum 6ee8cd13547eb044ad13ba014573af6f - éœ€è¦å›ºå®šä½æ•°çš„éšæœºæ•°ç ï¼Œå°†éšæœºæ•°ç®¡é“ç»™å‘½ä»¤md5sumå‘½ä»¤å†ç®¡é“ç»™cutå‘½ä»¤å³å¯ã€‚ [root@myhost ~]\\# echo $RANDOM |md5sum|cut -c 1-8 de3cfe23 ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:6:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…· expect éäº¤äº’å¼ç¨‹åºæ§åˆ¶ä¸‹ç”¨mkpasswdå‘½ä»¤ï¼š yum install -y expect mkpasswd -l 7 # ç”Ÿæˆä¸ƒä½å¯†ç åŒ…å«å¤§å°å†™åŠ ç‰¹æ®Šå­—ç¬¦ ä½¿ç”¨pwgenç”Ÿæˆéšæœºå¯è¯»çš„å¯†ç ï¼š yum install pwgen # ç”Ÿæˆé•¿åº¦8ï¼Œå«æœ‰æ•°å­—ï¼Œå«æœ‰å¤§å°å†™å­—æ¯çš„å¯†ç 4ä¸ªï¼Œåˆ—æ‰“å° pwgen -ncC 8 4 # ç”Ÿæˆé•¿åº¦8ï¼Œå«æœ‰æ•°å­—ï¼Œå«æœ‰å°å†™å­—æ¯ï¼Œä¸åŒ…å«æ­§ä¹‰çš„å¯†ç 4ä¸ªï¼Œåˆ—æ‰“å° pwgen -nABC 8 4 # ç”Ÿæˆé•¿åº¦16ï¼Œå«æœ‰æ•°å­—ï¼Œå«æœ‰å¤§å°å†™å­—æ¯ï¼Œå«æœ‰ç‰¹æ®Šå­—ç¬¦çš„å¯†ç 8ä¸ªï¼Œè¡Œæ‰“å° pwgen -ncy1 16 8 å‚æ•°è¯´æ˜ï¼š -c or â€“capitalizeå¯†ç ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªå¤§å†™å­—æ¯ -A or â€“no-capitalizeå¯†ç ä¸­ä¸åŒ…å«å¤§å†™å­—æ¯ -n or â€“numeralså¯†ç ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªæ•°å­— -0 or â€“no-numeralså¯†ç ä¸­ä¸åŒ…å«æ•°å­— -y or â€“symbolså¯†ç ä¸­è‡³å°‘åŒ…å«ä¸€ä¸ªç‰¹æ®Šç¬¦å· -s or â€“secureç”Ÿæˆå®Œå…¨éšæœºå¯†ç  -B or â€“ambiguouså¯†ç ä¸­ä¸åŒ…å«æ­§ä¹‰å­—ç¬¦ï¼ˆä¾‹å¦‚1,l,O,0ï¼‰ -H or â€“sha1=path/to/file[#seed]ä½¿ç”¨SHA1 hashç»™å®šçš„æ–‡ä»¶ä½œä¸ºä¸€ä¸ªéšæœºç§å­ -Cåœ¨åˆ—ä¸­æ‰“å°ç”Ÿæˆçš„å¯†ç  -1ä¸è¦åœ¨åˆ—ä¸­æ‰“å°ç”Ÿæˆçš„å¯†ç ï¼Œå³ä¸€è¡Œä¸€ä¸ªå¯†ç  -v or â€“no-vowelsä¸è¦ä½¿ç”¨ä»»ä½•å…ƒéŸ³ï¼Œä»¥é¿å…å¶ç„¶çš„è„è¯ å…¶ä»–ç¬¬ä¸‰æ–¹å·¥å…·ï¼š randpwã€spwã€gpgã€xkcdpass ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:7:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Linux"],"content":"å‚è€ƒé“¾æ¥ https://blog.csdn.net/yuki5233/article/details/82997001 ","date":"2020-06-01","objectID":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/:8:0","tags":["Linux","éšæœºæ•°","openssl"],"title":"Linux ç”Ÿæˆéšæœºæ•°","uri":"/myBlog-2/post/linux%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0/"},{"categories":["Tools","Android","Ubuntu"],"content":"è·¨å¹³å°å®‰å“æŠ•å±ç¥å™¨","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"Scrcpy ç®€ä»‹ åº”ç”¨ç¨‹åºå¯æ˜¾ç¤ºå’Œæ§åˆ¶é€šè¿‡USBï¼ˆæˆ–é€šè¿‡TCP / IPï¼‰è¿æ¥çš„Androidè®¾å¤‡ã€‚å®ƒä¸éœ€è¦ä»»ä½•æ ¹è®¿é—®æƒé™ã€‚å®ƒé€‚ç”¨äºGNU / Linuxï¼ŒWindowså’ŒmacOSã€‚ githubåœ°å€ï¼šhttps://github.com/Genymobile/scrcpy ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:1:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"é…ç½®ç¯å¢ƒ å®‰è£…adbæœåŠ¡ï¼Œä½¿ç”¨æ•°æ®çº¿è¿æ¥è‡ªå·±çš„å®‰å“è®¾å¤‡ï¼Œå¹¶æŸ¥çœ‹è‡ªå·±çš„å®‰å“è®¾å¤‡ï¼š sudo apt-get install android-tools-adb adb start-server $ lsusb Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 001 Device 005: ID 0bda:0821 Realtek Semiconductor Corp. Bus 001 Device 004: ID 0bda:0129 Realtek Semiconductor Corp. RTS5129 Card Reader Controller Bus 001 Device 003: ID 13d3:a745 IMC Networks Bus 001 Device 054: ID `24ae:1813` ... æ‰¾åˆ°è‡ªå·±çš„å®‰å“è®¾å¤‡å“ªä¸€è¡Œï¼Œ24aeã€1813åœ¨ä¸‹é¢ä¼šç”¨åˆ°ã€‚ åˆ›å»ºè®¾å¤‡æ–‡ä»¶ï¼š ä¸‹é¢å‘½ä»¤ä¸­çš„åç§°71-androidæ˜¯è‡ªå®šä¹‰çš„ï¼Œæˆ‘çš„è¿™ä¸ªä»£è¡¨å®‰å“7.1çš„æ„æ€ã€‚ echo 0x12d1 \u003e ~/.android/adb_usb.ini touch /etc/udev/rules.d/71-android.rules gedit /etc/udev/rules.d/71-android.rules å°†ä»¥ä¸‹å†…å®¹å†™å…¥åˆšåˆšåˆ›å»ºçš„æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œä¸‹é¢çš„24aeã€1813è¦æ”¹æˆè‡ªå·±çš„å®‰å“è®¾å¤‡çš„idï¼ˆè§ä¸Šï¼‰ï¼š SUBSYSTEM\"usb\", ATTRS{idVendor}â€œ24aeâ€, ATTRS{idProduct}==â€œ1813â€, MODE=â€œ0666â€ æ›´æ”¹æ–‡ä»¶æƒé™ï¼š chmod 666 /etc/udev/rules.d/90-android.rules é‡å¯ ADB æœåŠ¡ï¼š service udev restart adb kill-server adb start-server ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:2:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"Scrcpy å®‰è£…ä¸ä½¿ç”¨ å®‰è£…ï¼š # ä½¿ç”¨snapå®‰è£… sudo snap install scrcpy # æˆ–è€… apt install scrcpy åˆ—å‡ºè®¾å¤‡ï¼š scrcpy.adb devices å¼€å§‹æŠ•å±ï¼š scrcpy ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:3:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"è®¾ç½®æ— çº¿è¿æ¥Androidè®¾å¤‡ :information_source:å…ˆä½¿ç”¨æ•°æ®çº¿å°†æ‰‹æœºå’Œç”µè„‘è¿æ¥å¹¶åœ¨æ‰‹æœºç«¯å¼€å¯ã€Œå¼€å‘è€…é€‰é¡¹ã€åŠã€ŒUSB è°ƒè¯•ã€ # å¼€å¯æ‰‹æœºç«¯å£ adb tcpip 6666 æ‹”å‡ºæ•°æ®çº¿ï¼Œå¼€å¯æ— çº¿è¿æ¥ï¼š adb connect 192.168.8.154:6666 192.168.8.154ä¸ºä½ Androidè®¾å¤‡çš„IPåœ°å€ï¼Œå¯ä»¥é€šè¿‡è·¯ç”±å™¨åå°è·å–æˆ–è€…åœ¨æ‰‹æœºä¸Šä½¿ç”¨ç›¸å…³è½¯ä»¶è¿›è¡Œè·å–ã€‚ å¯åŠ¨ scrcpy ï¼š scrcpy ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:4:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"Scrcpy å¿«æ·é”® Action Shortcut Shortcut (macOS) Switch fullscreen mode Ctrl+f Cmd+f Rotate display left Ctrl+â† (left) Cmd+â† (left) Rotate display right Ctrl+â†’ (right) Cmd+â†’ (right) Resize window to 1:1 (pixel-perfect) Ctrl+g Cmd+g Resize window to remove black borders Ctrl+x | Double-clickÂ¹ Cmd+x | Double-clickÂ¹ Click on HOME Ctrl+h | Middle-click Ctrl+h | Middle-click Click on BACK Ctrl+b | Right-clickÂ² Cmd+b | Right-clickÂ² Click on APP_SWITCH Ctrl+s Cmd+s Click on MENU Ctrl+m Ctrl+m Click on VOLUME_UP Ctrl+â†‘ (up) Cmd+â†‘ (up) Click on VOLUME_DOWN Ctrl+â†“ (down) Cmd+â†“ (down) Click on POWER Ctrl+p Cmd+p Power on Right-clickÂ² Right-clickÂ² Turn device screen off (keep mirroring) Ctrl+o Cmd+o Turn device screen on Ctrl+Shift+o Cmd+Shift+o Rotate device screen Ctrl+r Cmd+r Expand notification panel Ctrl+n Cmd+n Collapse notification panel Ctrl+Shift+n Cmd+Shift+n Copy device clipboard to computer Ctrl+c Cmd+c Paste computer clipboard to device Ctrl+v Cmd+v Copy computer clipboard to device and paste Ctrl+Shift+v Cmd+Shift+v Enable/disable FPS counter (on stdout) Ctrl+i Cmd+i Â¹Double-click on black borders to remove them. Â²Right-click turns the screen on if it was off, presses BACK otherwise. ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:5:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["Tools","Android","Ubuntu"],"content":"å‚è€ƒé“¾æ¥ Scrcpy Documentation: https://github.com/Genymobile/scrcpy ","date":"2020-05-28","objectID":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/:6:0","tags":["Scrcpy","Android"],"title":"Scrcpy AndroidæŠ•å±ç¥å™¨","uri":"/myBlog-2/post/scrcpy-android%E6%8A%95%E5%B1%8F%E7%A5%9E%E5%99%A8/"},{"categories":["VPN","CentOS"],"content":"OpenVPN ç®€ä»‹ OpenVPN æ˜¯ä¸€ä¸ªåŸºäº OpenSSL åº“çš„åº”ç”¨å±‚ VPN å®ç°ã€‚å’Œä¼ ç»Ÿ VPN ç›¸æ¯”ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ã€‚ [1] OpenVPNå…è®¸å‚ä¸å»ºç«‹VPNçš„å•ç‚¹ä½¿ç”¨å…±äº«é‡‘é’¥ï¼Œç”µå­è¯ä¹¦ï¼Œæˆ–è€…ç”¨æˆ·å/å¯†ç æ¥è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒå¤§é‡ä½¿ç”¨äº†OpenSSLåŠ å¯†åº“ä¸­çš„SSLv3/TLSv1 åè®®å‡½å¼åº“ã€‚OpenVPNèƒ½åœ¨Solarisã€Linuxã€OpenBSDã€FreeBSDã€NetBSDã€Mac OS Xä¸Windows 2000/XP/Vistaä¸Šè¿è¡Œï¼Œå¹¶åŒ…å«äº†è®¸å¤šå®‰å…¨æ€§çš„åŠŸèƒ½ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªåŸºäºWebçš„VPNè½¯ä»¶ï¼Œä¹Ÿä¸ä¸IPsecåŠå…¶ä»–VPNè½¯ä»¶åŒ…å…¼å®¹ã€‚ ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:1:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"OpenVPN å®‰è£… ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"ä½¿ç”¨EasyRSAæ„å»º CA é¦–å…ˆä»é¡¹ç›®Githubå­˜å‚¨åº“ä¸‹è½½EasyRSAçš„æœ€æ–°ç‰ˆæœ¬å¹¶è§£å‹ï¼š cd \u0026\u0026 wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz tar xzf EasyRSA-3.0.7.tgz å¤åˆ¶æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œé€‚å½“ä¿®æ”¹ï¼š mv EasyRSA-3.0.7 EasyRSA-CA; cd EasyRSA-CA cp vars.example vars # ---------- ç¼–è¾‘ vars æ–‡ä»¶å†…å®¹`95`è¡Œå·¦å³ ---------- set_var EASYRSA_REQ_COUNTRY \"CN\" set_var EASYRSA_REQ_PROVINCE \"Shandong\" set_var EASYRSA_REQ_CITY \"Jinan\" set_var EASYRSA_REQ_ORG \"AGou\" set_var EASYRSA_REQ_EMAIL \"AGou-ops@foxmail.com\" set_var EASYRSA_REQ_OU \"Community\" ä¿®æ”¹å®Œæˆä¹‹åä¿å­˜é€€å‡ºã€‚ åˆå§‹åŒ–PKIï¼š [root@test EasyRSA-CA]\\# ./easyrsa init-pki Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /root/EasyRSA-3.0.7/pki æ¥ä¸‹æ¥å»ºç«‹CAï¼š [root@test EasyRSA-CA]\\# ./easyrsa build-ca nopass Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars Using SSL: openssl OpenSSL 1.0.2k-fips 26 Jan 2017 Generating RSA private key, 2048 bit long modulus ...............+++ ............................................................................................................................+++ e is 65537 (0x10001) You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /root/EasyRSA-3.0.7/pki/ca.crt å®Œæˆåï¼Œè¯¥è„šæœ¬å°†åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶-CAå…¬å…±è¯ä¹¦PKI/ca.crtå’ŒCAç§é’¥PKI/private/ca.key ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:1","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"å®‰è£… OpenVPN å’Œ EasyRSA å¯ä»¥åœ¨ OpenVPN çš„å®˜æ–¹ github ä»“åº“ ä¸‹è½½æœ€æ–°æºç åŒ…è¿›è¡Œç¼–è¯‘å®‰è£…ï¼Œåœ¨è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä½¿ç”¨epelä»“åº“è¿›è¡Œå®‰è£…ï¼š yum install epel-release -y yum install openvpn -y è·å–æœ€æ–°ç‰ˆæœ¬çš„EasyRSAï¼š cd \u0026\u0026 wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz tar xzf EasyRSA-3.0.7.tgz mv EasyRSA-3.0.7 EasyRSA-Sever1 cd EasyRSA-Sever1 å°½ç®¡æˆ‘ä»¬å·²ç»åœ¨ CA ä¸»æœºä¸Šåˆå§‹åŒ–äº†PKIï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦åœ¨ OpenVPN æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„ PKI ï¼š [root@test EasyRSA-Server1]\\# ./easyrsa init-pki Note: using Easy-RSA configuration from: /root/EasyRSA-Server1/vars init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: /root/EasyRSA-Server1/pki ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:2","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"åˆ›å»ºDiffie-Hellmanå’ŒHMACå¯†é’¥ ç”Ÿæˆä¸€ä¸ªDiffie-Hellmanå¯†é’¥ï¼Œè¯¥å¯†é’¥å°†åœ¨å¯†é’¥äº¤æ¢æœŸé—´ä½¿ç”¨ï¼Œå¹¶ä½¿ç”¨HMACç­¾åæ–‡ä»¶ä¸ºè¿æ¥æ·»åŠ é™„åŠ çš„å®‰å…¨å±‚ã€‚ åœ¨OpenVPNæœåŠ¡å™¨ä¸Šï¼Œç”ŸæˆDiffie-Hellmanå¯†é’¥ï¼š cd ~/EasyRSA-Server1 ./easyrsa gen-dh å¤åˆ¶è¯¥æ–‡ä»¶åˆ°/etc/openvpnç›®å½•ä¸­å»ï¼š cp /root/EasyRSA-Server1/pki/dh.pem /etc/openvpn æ¥ä¸‹æ¥ï¼Œä½¿ç”¨openvpnäºŒè¿›åˆ¶æ–‡ä»¶ç”ŸæˆHMACç­¾åï¼š openvpn --genkey --secret ta.key ç„¶åå°†ç”Ÿæˆçš„ta.keyå¤åˆ¶åˆ°/etc/openvpnç›®å½•ä¸­å»ï¼š cp ta.key /etc/openvpn ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:3","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"åˆ›å»ºæœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥ è¿›å…¥OpenVPNæœåŠ¡å™¨ä¸Šçš„EasyRSAç›®å½•ï¼Œå¹¶ä¸ºæœåŠ¡å™¨å’Œè¯ä¹¦è¯·æ±‚æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥ï¼š cd ~/EasyRSA-Server1 ./easyrsa gen-req server1 nopass è¯¥å‘½ä»¤å°†åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªç§é’¥ï¼ˆserver1.keyï¼‰å’Œä¸€ä¸ªè¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼ˆserver1.reqï¼‰ å°†ç”Ÿæˆçš„ç§é’¥å¤åˆ¶åˆ°/etc/openvpnç›®å½•ï¼š cp /root/EasyRSA-Server1/pki/private/server1.key /etc/openvpn/ å°†è¯ä¹¦è¯·æ±‚å‘é€åˆ°CAä¸»æœºï¼ˆè¿™é‡Œæˆ‘CAä¸»æœºä¸OpenVPNä¸ºåŒä¸€ä¸»æœºï¼‰ï¼š cp ~/EasyRSA-Server1/pki/reqs/server1.req /tmp ç™»å½•CAä¸»æœºï¼Œåˆ‡æ¢åˆ° EasyRSA ç›®å½•å¹¶å¯¼å…¥è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼š cd ~/EasyRSA-CA ./easyrsa import-req /tmp/server1.req server1 æ­¤å‘½ä»¤åªæ˜¯å°†è¯·æ±‚æ–‡ä»¶å¤åˆ¶åˆ°pki/reqsç›®å½•ä¸­ã€‚ åœ¨CAä¸»æœºä¸Šï¼Œç­¾ç½²è¯ä¹¦ï¼š ./easyrsa sign-req server server1 ç¡®è®¤ä¿¡æ¯æ— è¯¯ä¹‹åï¼Œè¾“å…¥ yes ç„¶åç‚¹å‡»å›è½¦å³å¯ã€‚ åœ¨CAä¸»æœºä¸Šï¼Œå°†ç­¾åçš„è¯ä¹¦server1.crtå’Œca.crtæ–‡ä»¶ä¼ å‘é€å›OpenVPNä¸»æœºï¼š cp ~/EasyRSA-CA/pki/issued/server1.crt /etc/openvpn/ cp ~/EasyRSA-CA/pki/ca.crt /etc/openvpn/ :warning: è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šæˆ‘çš„CAä¸»æœºå’ŒOpenVPNä¸»æœºæ˜¯åŒä¸€ä¸»æœºï¼Œæ‰€ä»¥ä¸Šé¢çš„/etc/openvpnç›®å½•æ˜¯OpenVPNä¸»æœºçš„ã€‚ æ‰€æœ‰æ­¥éª¤éƒ½å®Œæˆä¹‹åï¼Œåœ¨/etc/openvpnç›®å½•ä¸‹åº”å½“æœ‰è¿™äº›æ–‡ä»¶å­˜åœ¨ï¼š [root@test EasyRSA-CA]\\# ls /etc/openvpn/ ca.crt client dh.pem server server1.crt server1.key ta.key ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:4","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"é…ç½®OpenVPNæœåŠ¡ å°† OpenVPN çš„æ¨¡æ¿é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°/etc/openvpnï¼š cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/server.conf /etc/openvpn/server1.conf ä¿®æ”¹server1.confï¼Œæ‰¾åˆ°è¯ä¹¦ï¼Œå¯†é’¥å’ŒDHå‚æ•°æŒ‡ä»¤å¹¶æ›´æ”¹æ–‡ä»¶åï¼š user nobody group nogroup # ---------- å¤§çº¦åœ¨78è¡Œå·¦å³ ---------- cert server1.crt key server1.key dh dh.pem # åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œã€‚è¯¥æŒ‡ä»¤ä¼šå°†æ¶ˆæ¯èº«ä»½éªŒè¯ç®—æ³•ï¼ˆHMACï¼‰ä»SHA1æ›´æ”¹ä¸ºSHA256 auth SHA256 :information_source:å¯é€‰ï¼š è¦é€šè¿‡VPNé‡å®šå‘å®¢æˆ·ç«¯æµé‡ï¼Œè¯·æ‰¾åˆ°å¹¶å–æ¶ˆæ³¨é‡Šredirect-gatewayå’Œdhcp-optioné€‰é¡¹ï¼š /etc/openvpn/server1.conf push \"redirect-gateway def1 bypass-dhcp\" push \"dhcp-option DNS 208.67.222.222\" push \"dhcp-option DNS 208.67.220.220\" é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨OpenDNSè§£æå™¨ã€‚æ‚¨å¯ä»¥æ›´æ”¹å®ƒå¹¶ä½¿ç”¨CloudFlareï¼ŒGoogleæˆ–æ‚¨æƒ³è¦çš„ä»»ä½•å…¶ä»–DNSè§£æå™¨ã€‚ å®Œæ•´é…ç½®æ–‡ä»¶å‚è€ƒï¼š port 1194 proto udp dev tun ca ca.crt cert server1.crt key server1.key # This file should be kept secret dh dh.pem server 10.8.0.0 255.255.255.0 ifconfig-pool-persist ipp.txt push \"redirect-gateway def1 bypass-dhcp\" push \"dhcp-option DNS 208.67.222.222\" push \"dhcp-option DNS 208.67.220.220\" keepalive 10 120 tls-auth ta.key 0 # This file is secret cipher AES-256-CBC user nobody group nobody persist-key persist-tun status openvpn-status.log verb 3 explicit-exit-notify 1 auth SHA256 ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:5","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"å¯åŠ¨ OpenVPN æœåŠ¡ systemctl start openvpn@server1 æˆåŠŸå¯åŠ¨ä¹‹åï¼ŒOpenVPN Server ä¼šåˆ›å»ºä¸€ä¸ª tun è®¾å¤‡ï¼Œå³tun0ï¼š [root@test openvpn]\\# ip a show tun0 3: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u003e mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100 link/none inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::afaa:c6f7:7ae8:3a76/64 scope link flags 800 valid_lft forever preferred_lft forever ä¸ºäº†æ­£ç¡®è½¬å‘ç½‘ç»œæ•°æ®åŒ…ï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨IPè½¬å‘ï¼š echo \"net.ipv4.ip_forward = 1\" \u003e\u003e /etc/sysctl.conf sysctl -p ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:2:6","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"é…ç½®å®¢æˆ·ç«¯æ¥å£ åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„SSLè¯ä¹¦ï¼Œå¹¶ä¸ºæ¯ä¸ªVPNå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªä¸åŒçš„é…ç½®æ–‡ä»¶ã€‚ å®¢æˆ·ç«¯ç§é’¥å’Œè¯ä¹¦è¯·æ±‚å¯ä»¥åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºæˆ–æœåŠ¡å™¨ä¸Šç”Ÿæˆã€‚ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨æœåŠ¡å™¨ä¸Šç”Ÿæˆè¯ä¹¦è¯·æ±‚ï¼Œç„¶åå°†å…¶å‘é€åˆ°CAè¿›è¡Œç­¾åã€‚ ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦å’Œé…ç½®æ–‡ä»¶çš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ï¼š åœ¨OpenVPNæœåŠ¡å™¨ä¸Šç”Ÿæˆç§é’¥å’Œè¯ä¹¦è¯·æ±‚ï¼› å°†è¯·æ±‚å‘é€åˆ°è¦ç­¾åçš„CAè®¡ç®—æœºï¼› å°†ç­¾åçš„SSLè¯ä¹¦å¤åˆ¶åˆ°OpenVPNæœåŠ¡å™¨å¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼› å°†é…ç½®æ–‡ä»¶å‘é€åˆ°VPNå®¢æˆ·ç«¯çš„è®¡ç®—æœºã€‚ é¦–å…ˆï¼Œåœ¨OpenVPNä¸»æœºä¸Šåˆ›å»ºä¸€ç»„ç›®å½•æ¥å­˜æ”¾å®¢æˆ·ç«¯æ–‡ä»¶ï¼š mkdir -p ~/openvpn-clients/{configs,base,files} base ç›®å½•å°†å­˜å‚¨å°†åœ¨æ‰€æœ‰å®¢æˆ·ç«¯æ–‡ä»¶ä¹‹é—´å…±äº«çš„åŸºæœ¬æ–‡ä»¶å’Œé…ç½®ï¼› configs ç›®å½•å°†å­˜å‚¨ç”Ÿæˆçš„å®¢æˆ·ç«¯é…ç½®ï¼› files ç›®å½•å°†å­˜å‚¨ç‰¹å®šäºå®¢æˆ·ç«¯çš„è¯ä¹¦/å¯†é’¥å¯¹ã€‚ å¤åˆ¶ca.crtå’Œta.keyæ–‡ä»¶åˆ°~/openvpn-clients/baseç›®å½•ï¼š cp ~/EasyRSA-Server1/ta.key ~/openvpn-clients/base/ cp /etc/openvpn/ca.crt ~/openvpn-clients/base/ å°†ç¤ºä¾‹å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°~/openvpn-clients/base/ç›®å½•ä¸‹ï¼š cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/client.conf ~/openvpn-clients/base/ ç¼–è¾‘client.confæ–‡ä»¶ä»¥åŒ¹é…æˆ‘ä»¬çš„æœåŠ¡å™¨é…ç½®ï¼š remote 172.16.1.131 1194 # åœ¨æ–‡ä»¶ç»“å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ auth SHA256 key-direction 1 å®Œæ•´é…ç½®æ–‡ä»¶å‚è€ƒå¦‚ä¸‹æ‰€ç¤ºï¼š client dev tun proto udp remote 172.16.1.131 1194 resolv-retry infinite nobind persist-key persist-tun remote-cert-tls server cipher AES-256-CBC verb 3 auth SHA256 key-direction 1 æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„bashè„šæœ¬ï¼Œå®ƒå°†åŸºæœ¬é…ç½®å’Œæ–‡ä»¶ä¸å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥åˆå¹¶ï¼Œå¹¶å°†ç”Ÿæˆçš„é…ç½®å­˜å‚¨åœ¨~/openvpn-clients/configsç›®å½•ä¸­ï¼š vim ~/openvpn-clients/gen_config.sh #!/bin/bash FILES_DIR=$HOME/openvpn-clients/files BASE_DIR=$HOME/openvpn-clients/base CONFIGS_DIR=$HOME/openvpn-clients/configs BASE_CONF=${BASE_DIR}/client.conf CA_FILE=${BASE_DIR}/ca.crt TA_FILE=${BASE_DIR}/ta.key CLIENT_CERT=${FILES_DIR}/${1}.crt CLIENT_KEY=${FILES_DIR}/${1}.key # Test for files for i in \"$BASE_CONF\" \"$CA_FILE\" \"$TA_FILE\" \"$CLIENT_CERT\" \"$CLIENT_KEY\"; do if [[ ! -f $i ]]; then echo \" The file $idoes not exist\" exit 1 fi if [[ ! -r $i ]]; then echo \" The file $iis not readable.\" exit 1 fi done # Generate client config cat \u003e ${CONFIGS_DIR}/${1}.ovpn \u003c\u003cEOF $(cat ${BASE_CONF}) \u003ckey\u003e $(cat ${CLIENT_KEY}) \u003c/key\u003e \u003ccert\u003e $(cat ${CLIENT_CERT}) \u003c/cert\u003e \u003cca\u003e $(cat ${CA_FILE}) \u003c/ca\u003e \u003ctls-auth\u003e $(cat ${TA_FILE}) \u003c/tls-auth\u003e EOF èµ‹äºˆæ‰§è¡Œæƒé™ï¼š chmod +x ~/openvpn-clients/gen_config.sh ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:3:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"åˆ›å»ºå®¢æˆ·ç«¯è¯ä¹¦ç§é’¥å’Œé…ç½® ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥å’Œè¯ä¹¦è¯·æ±‚çš„è¿‡ç¨‹ä¸ç”ŸæˆæœåŠ¡å™¨å¯†é’¥å’Œè¯ä¹¦è¯·æ±‚çš„è¿‡ç¨‹ç›¸åŒã€‚ ç™»å½•OpenVPNä¸»æœºä¸ºå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªæ–°çš„ç§é’¥å’Œä¸€ä¸ªè¯ä¹¦è¯·æ±‚ï¼š cd ~/EasyRSA-Server1 ./easyrsa gen-req client1 nopass å°†ç§é’¥client1.keyå¤åˆ¶åˆ°~/openvpn-clients/filesä¸­ï¼š cp ~/EasyRSA-Server1/pki/private/client1.key ~/openvpn-clients/files/ å°†è¯ä¹¦è¯·æ±‚æ–‡ä»¶ä¼ è¾“åˆ°CAä¸»æœºï¼š cp ~/EasyRSA-Server1/pki/reqs/client1.req /tmp è¿›å…¥CAä¸»æœºï¼Œå¯¼å…¥è¯ä¹¦è¯·æ±‚å¹¶è¿›è¡Œç­¾ç½²ï¼š cd ~/EasyRSA-CA ./easyrsa import-req /tmp/client1.req client1 ./easyrsa sign-req client client1 æ¥ä¸‹æ¥ï¼Œå°†ç­¾å¥½åçš„è¯ä¹¦client1.crtæ–‡ä»¶å‘é€å›OpenVPNä¸»æœºï¼š cp ~/EasyRSA-CA/pki/issued/client1.crt ~/openvpn-clients/files æœ€åä¸€æ­¥æ˜¯ä½¿ç”¨gen_config.shè„šæœ¬ç”Ÿæˆå®¢æˆ·ç«¯é…ç½®ï¼Œåˆ‡æ¢åˆ°~/openvpn-clientsç›®å½•å¹¶ä½¿ç”¨å®¢æˆ·ç«¯åç§°ä½œä¸ºå‚æ•°è¿è¡Œè„šæœ¬ï¼š cd ~/openvpn-clients ./gen_config.sh client1 è¯¥è„šæœ¬å°†åœ¨~/client-configs/configsç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºclient1.ovpnçš„æ–‡ä»¶ï¼š [root@test openvpn-clients]\\# ls ~/openvpn-clients/configs client1.ovpn æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯é…ç½®å·²åˆ›å»ºï¼Œå¯ä»¥ç›´æ¥å°†é…ç½®æ–‡ä»¶ä¼ è¾“åˆ°è¦ç”¨ä½œå®¢æˆ·ç«¯çš„è®¾å¤‡ä¸Šã€‚ å¦‚æœæƒ³è¦æ·»åŠ å…¶ä»–çš„å®¢æˆ·ç«¯ï¼Œé‡å¤è¿™äº›æ­¥éª¤å³å¯ã€‚ ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:4:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"ä½¿ç”¨ OpenVPN åœ¨Debianç³»ç³»ç»Ÿä¸‹ï¼š sudo apt update -y \u0026\u0026 sudo apt instal openvpn å®‰è£…å®Œè½¯ä»¶åŒ…ä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿æ¥åˆ°OpenVPNæœåŠ¡å™¨ï¼š sudo openvpn --config client1.ovpn ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:5:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","CentOS"],"content":"å¿«é€Ÿå®‰è£… OpenVPN sudo apt update -y sudo apt install -y openvpn ä» github è·å–ä¸€é”®å®‰è£…è„šæœ¬: git clone https://github.com/angristan/openvpn-install.git cd openvpn-install èµ‹äºˆè„šæœ¬å¯æ‰§è¡Œæƒé™: chmod +x openvpn-install æ‰§è¡Œè„šæœ¬: AUTO_INSTALL=y ./openvpn-install.sh :warning: æ³¨æ„: åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ OpenVPN æ—¶, è¦ç¡®ä¿æœåŠ¡å™¨ç«¯çš„ OpenVPN ç›‘å¬çš„ç«¯å£å¤„äºæ”¾è¡ŒçŠ¶æ€. Linux å®¢æˆ·ç«¯ä½¿ç”¨: sudo apt install network-manager-openvpn sudo openvpn ./client.ovpn Windows å®¢æˆ·ç«¯ä½¿ç”¨: ç›´æ¥å»OpenVPN å®˜æ–¹ä¸‹è½½ç«™ç‚¹ä¸‹è½½ç„¶åå¯¼å…¥å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ client.ovpn, ç„¶åå¯åŠ¨æœåŠ¡å³å¯. ","date":"2020-05-21","objectID":"/myBlog-2/post/openvpn-for-centos/:6:0","tags":["OpenVPN","CentOS"],"title":"OpenVPN for CentOS","uri":"/myBlog-2/post/openvpn-for-centos/"},{"categories":["VPN","Ubuntu"],"content":"WireGuard ç®€ä»‹ â€‹ WireGuardæ˜¯å…·æœ‰æœ€æ–°åŠ å¯†æŠ€æœ¯çš„ç°ä»£VPNï¼ˆè™šæ‹Ÿä¸“ç”¨ç½‘ï¼‰æŠ€æœ¯ã€‚ä¸IPsecå’ŒOpenVPNç­‰å…¶ä»–ç±»ä¼¼è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼ŒWireGuardæ›´å¿«ï¼Œæ›´æ˜“äºé…ç½®ä¸”æ€§èƒ½æ›´é«˜ã€‚å®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°ï¼Œå‡ ä¹å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œï¼ŒåŒ…æ‹¬Linuxï¼ŒWindowsï¼ŒAndroidå’ŒmacOSã€‚ Wireguardæ˜¯å¯¹ç­‰VPNã€‚å®ƒä¸ä½¿ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ã€‚æ ¹æ®å…¶é…ç½®ï¼Œå¯¹ç­‰æ–¹å¯ä»¥å……å½“ä¼ ç»Ÿçš„æœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ã€‚ WireGuardé€šè¿‡åœ¨å……å½“éš§é“çš„æ¯ä¸ªå¯¹ç­‰è®¾å¤‡ä¸Šåˆ›å»ºç½‘ç»œæ¥å£æ¥å·¥ä½œã€‚å¯¹ç­‰ä½“é€šè¿‡äº¤æ¢å’ŒéªŒè¯å…¬å…±å¯†é’¥ï¼ˆç±»ä¼¼äºSSHæ¨¡å‹ï¼‰æ¥ç›¸äº’è®¤è¯ã€‚å…¬é’¥ä¸éš§é“ä¸­å…è®¸çš„IPåœ°å€åˆ—è¡¨è¿›è¡Œæ˜ å°„ã€‚ VPNæµé‡å°è£…åœ¨UDPä¸­ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨å……å½“VPNæœåŠ¡å™¨çš„Ubuntu 18.04è®¡ç®—æœºä¸Šè®¾ç½®WireGuardã€‚æˆ‘ä»¬è¿˜å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†WireGuardé…ç½®ä¸ºå®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯çš„æµé‡å°†é€šè¿‡Ubuntu 18.04æœåŠ¡å™¨è¿›è¡Œè·¯ç”±ã€‚æ­¤è®¾ç½®å¯ç”¨äºé˜²å¾¡ä¸­é—´äººæ”»å‡»ï¼ŒåŒ¿åæµè§ˆç½‘ç»œï¼Œç»•è¿‡å—åœ°åŸŸé™åˆ¶çš„å†…å®¹ï¼Œæˆ–å…è®¸æ‚¨çš„åŒäº‹åœ¨è¿œç¨‹å·¥ä½œæ—¶å®‰å…¨åœ°è¿æ¥åˆ°å…¬å¸ç½‘ç»œã€‚ ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:1:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"WGå®‰è£… æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œå¹¶å®‰è£…ç®¡ç†ç³»ç»Ÿå­˜å‚¨åº“æ‰€éœ€çš„å·¥å…·ï¼š sudo apt update sudo apt install software-properties-common æ·»åŠ  WireGuard ä»“åº“ï¼š sudo add-apt-repository ppa:wireguard/wireguard å‡ºç°æç¤ºæ—¶ï¼ŒæŒ‰Enteré”®ç»§ç»­ã€‚ add-apt-repositoryä¹Ÿå°†è‡ªåŠ¨æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ã€‚ å®‰è£…WireGuardè½¯ä»¶åŒ…ï¼š sudo apt install wireguard WireGuardä½œä¸ºå†…æ ¸æ¨¡å—è¿è¡Œï¼Œè¯¥æ¨¡å—è¢«ç¼–è¯‘ä¸ºDKMSæ¨¡å—ã€‚æˆåŠŸå®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š wireguard: Running module version sanity check. - Original module - No original module exists within this kernel - Installation - Installing to /lib/modules/4.15.0-88-generic/updates/dkms/ depmod... DKMS: install completed. æ›´æ–°å†…æ ¸æ—¶ï¼Œéœ€è¦å°†é’ˆå¯¹æ–°å†…æ ¸ç¼–è¯‘WireGuardæ¨¡å—ã€‚ ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:2:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"é…ç½®WG WireGuard ç¨‹åºåŒ…é™„å¸¦äº†ä¸¤ä¸ªåä¸ºwgå’Œwg-quickçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ç”¨äºé…ç½®å’Œç®¡ç†WireGuardæ¥å£ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼š wg genkey | sudo tee /etc/wireguard/privatekey | wg pubkey | sudo tee /etc/wireguard/publickey :information_source: å…¬ç§é’¥æ”¾ç½®äº/etc/wireguardç›®å½•,å…¶ä¸­ç§é’¥ç»å¯¹ä¸èƒ½ä¸ä»»ä½•äººå…±äº« ç”Ÿæˆå¯†é’¥åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®è·¯ç”±VPNçš„éš§é“è®¾å¤‡ å¯ä»¥ä½¿ç”¨ipå’Œwgä»å‘½ä»¤è¡Œè®¾ç½®è®¾å¤‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚ åˆ›å»ºä¸€ä¸ªåä¸ºwg0.conf(æ–‡ä»¶åå¯ä»¥éšæ„)çš„æ–°æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š cat \u003e\u003e /etc/wireguard/wg0.conf \u003c\u003c EOF [Interface] Address = 192.168.159.0/24 # å¡«å†™ç½‘ç»œåœ°å€æ®µ SaveConfig = true # å…³é—­æ—¶ï¼Œæ¥å£çš„å½“å‰çŠ¶æ€å°†ä¿å­˜åˆ°é…ç½®æ–‡ä»¶ä¸­ ListenPort = 51820 # ç›‘å¬ç«¯å£ PrivateKey = QNKQCtPo2E5saDnXORaIORhZH6NtcvIJPHqF9EdEL1o= # ç§é’¥æ–‡ä»¶,å³/etc/wireguard/privatekey PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE # åœ¨å¯åŠ¨ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬,ä½¿ç”¨iptableså¯ç”¨ä¼ªè£…,å…è®¸æµé‡ç¦»å¼€æœåŠ¡å™¨ï¼Œä»è€Œä½¿VPNå®¢æˆ·ç«¯å¯ä»¥è®¿é—®Internetã€‚ PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -t nat -D POSTROUTING -o ens33 -j MASQUERADE # åœ¨å¯åŠ¨ä¹‹åæ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬,æ¥å£å…³é—­åï¼Œiptablesè§„åˆ™å°†è¢«åˆ é™¤ EOF ä¿®æ”¹privatekeyå’Œwg0.confçš„æƒé™, ä¿è¯å…¶å®‰å…¨æ€§ï¼š sudo chmod 600 /etc/wireguard/{privatekey,wg0.conf} å®Œæˆåï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„å±æ€§å¯åŠ¨wg0æ¥å£ï¼š $ sudo wg-quick up wg0 * è¾“å‡ºå†…å®¹å¦‚ä¸‹æ‰€ç¤º: [#] ip link add wg0 type wireguard [#] wg setconf wg0 /dev/fd/63 [#] ip -4 address add 192.168.159.0/24 dev wg0 [#] ip link set mtu 1420 up dev wg0 [#] iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens33 -j MASQUERADE è¿è¡Œwg show wg0æ£€æŸ¥æ¥å£çŠ¶æ€å’Œé…ç½®ï¼š $ sudo wg show wg0 * è¾“å‡ºå†…å®¹å¦‚ä¸‹æ‰€ç¤º: interface: wg0 public key: uD6Xex2eP5CEUVcVP3EZB5csh2JReWXthoVZMzURwCQ= private key: (hidden) listening port: 51820 ä¹Ÿå¯ä»¥è¿è¡Œip a show wg0æ¥éªŒè¯æ¥å£çŠ¶æ€ï¼š $ ip a show wg0 * è¾“å‡ºå†…å®¹å¦‚ä¸‹æ‰€ç¤º: 4: wg0: \u003cPOINTOPOINT,NOARP,UP,LOWER_UP\u003e mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000 link/none inet 192.168.159.0/24 scope global wg0 valid_lft forever preferred_lft forever è®¾ç½®wireguard å¼€æœºè‡ªå¯: sudo systemctl enable wg-quick@wg0 ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:3:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"æœåŠ¡å™¨ç½‘ç»œå’Œé˜²ç«å¢™é…ç½® ä¸ºäº†ä½¿NATæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨IPè½¬å‘ï¼Œæ‰“å¼€/etc/sysctl.confæ–‡ä»¶ï¼Œå¹¶æ·»åŠ æˆ–å–æ¶ˆæ³¨é‡Šä»¥ä¸‹è¡Œï¼š ... net.ipv4.ip_forward=1 ... ä¿®æ”¹å®Œæˆä¹‹å, æ‰§è¡Œsudo sysctl -pä½¿é…ç½®æ°¸ä¹…ç”Ÿæ•ˆ å¦‚æœä½ ä½¿ç”¨UFWæ¥ç®¡ç†é˜²ç«å¢™ï¼Œåˆ™éœ€è¦åœ¨ç«¯å£51820ä¸Šæ‰“å¼€UDPé€šä¿¡ï¼š sudo ufw allow 51820/udp è‡³æ­¤,WG SERVER å·²å®Œæˆé…ç½® ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:4:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"å®¢æˆ·ç«¯é…ç½® ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:5:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"Linux \u0026 macOS å»å¾€å®˜æ–¹ä¸‹è½½ç«™ç‚¹(https://wireguard.com/install/), æŸ¥çœ‹å¦‚ä½•å®‰è£…WireGuard macOS App Store: https://apps.apple.com/us/app/wireguard/id1441195209?ls=1 Ubuntu â‰¤ 19.04 [module â€“ v1.0.20200413 \u0026 tools â€“ v1.0.20200319] $ sudo add-apt-repository ppa:wireguard/wireguard $ sudo apt-get update $ sudo apt-get install wireguard è®¾ç½®Linuxå’ŒmacOSå®¢æˆ·ç«¯è¿‡ç¨‹åŸºæœ¬ç›¸åŒ, é¦–å…ˆç”Ÿæˆå…¬é’¥ä¸ç§é’¥ wg genkey | sudo tee /etc/wireguard/privatekey | wg pubkey | sudo tee /etc/wireguard/publickey åˆ›å»º/etc/wireguard/wg0.confå¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹: [Interface] PrivateKey = CLIENT_PRIVATE_KEY # /etc/wireguard/privatekey Address = 192.168.43.0/24 [Peer] PublicKey = SERVER_PUBLIC_KEY # /etc/wireguard/publickey Endpoint = SERVER_IP_ADDRESS:51820 # å¯¹æ–¹wireguard serverçš„ipå’Œç«¯å£ AllowedIPs = 0.0.0.0/0 ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:5:1","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"Windows ç›´æ¥ä¸‹è½½å®¢æˆ·ç«¯å·¥å…·: https://download.wireguard.com/windows-client/wireguard-amd64-0.1.0.msi å®‰è£…å¥½è½¯ä»¶ä¹‹å, ç‚¹å‡»å·¦ä¸‹è§’çš„Add Tunnel, åˆ›å»ºä¸€ä¸ªæ–°çš„éš§é“Create new tunnel nameéšä¾¿èµ·å–½, å†…å®¹å¦‚ä¸‹: [Interface] PrivateKey = MOeXEby5OG1xQBCP9AJEJEsxmxYDG1FHHzlcOgi/ClI= Address = 192.168.43.0/24 [Peer] PublicKey = uD6Xex2eP5CEUVcVP3EZB5csh2JReWXthoVZMzURwCQ= # æœåŠ¡å™¨ç«¯å…¬é’¥ Endpoint = 192.168.159.132:51820 # æœåŠ¡å™¨ipä»¥åŠç«¯å£ AllowedIPs = 0.0.0.0/0 ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:5:2","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"å°†å®¢æˆ·ç«¯å¯¹ç­‰æ–¹æ·»åŠ åˆ°æœåŠ¡å™¨ æœ€åä¸€æ­¥æ˜¯å°†å®¢æˆ·ç«¯å…¬é’¥å’ŒIPåœ°å€æ·»åŠ åˆ°æœåŠ¡å™¨ï¼š # sudo wg set wg0 peer CLIENT_PUBLIC_KEY allowed-ips 10.0.0.2 sudo wg set wg0 peer T5ZTibLaWh9/3EzA1ZfCdiojM0HfXvh99mfVlqHpaU0= allowed-ips 192.168.43.0/24 sudo wg set wg0 peer UqF/BDwShHFulAUN4yx0latMIiIW0Cbb+IuNHEYEBj0= allowed-ips 192.168.43.0/24 ç¡®ä¿ä½¿ç”¨åœ¨å®¢æˆ·ç«¯è®¡ç®—æœºä¸Šç”Ÿæˆçš„å…¬ç”¨å¯†é’¥Â·ï¼ˆsudo cat /etc/wireguard/publickeyï¼‰Â·æ›´æ”¹CLIENT_PUBLIC_KEYå¹¶è°ƒæ•´å®¢æˆ·ç«¯IPåœ°å€ï¼ˆå¦‚æœä¸åŒçš„è¯ï¼‰ï¼ŒWindowsç”¨æˆ·å¯ä»¥ä»WireGuardè½¯ä»¶å½“ä¸­å¤åˆ¶å…¬é’¥ ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:6:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"Linux å’Œ macos å®¢æˆ·ç«¯ åœ¨Linuxå®¢æˆ·ç«¯ä¸Šï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ‰“å¼€ç•Œé¢ï¼š sudo wg-quick up wg0 ç°åœ¨ï¼Œåº”è¯¥å·²è¿æ¥åˆ°UbuntuæœåŠ¡å™¨ï¼Œå¹¶ä¸”æ¥è‡ªå®¢æˆ·ç«¯è®¡ç®—æœºçš„æµé‡åº”é€šè¿‡è¯¥æœåŠ¡å™¨è¿›è¡Œè·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ£€æŸ¥è¿æ¥ï¼š $ sudo wg * è¾“å‡ºå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š interface: wg0 public key: sZThYo/0oECwzUsIKTa6LYXLhk+Jb/nqK4kCCP2pyFg= private key: (hidden) listening port: 48052 fwmark: 0xca6c peer: r3imyh3MCYggaZACmkx+CxlD6uAmICI8pe/PGq8+qCg= endpoint: XXX.XXX.XXX.XXX:51820 allowed ips: 0.0.0.0/0 latest handshake: 1 minute, 22 seconds ago transfer: 58.43 KiB received, 70.82 KiB sent åœæ­¢å’Œå…³é—­éš§é“ï¼š sudo wg-quick down wg0 ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:6:1","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"Windows å®¢æˆ·ç«¯ ç‚¹å‡»è½¯ä»¶ä¸Šçš„Activate å³å¯ ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:6:2","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"ä¸€é”®å®‰è£… wireguard https://github.com/angristan/wireguard-install https://github.com/l-n-s/wireguard-install ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:7:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":["VPN","Ubuntu"],"content":"å‚è€ƒé“¾æ¥ wireguard Quick Start : https://www.wireguard.com/quickstart/ wireguard Install : https://www.wireguard.com/install/ ","date":"2020-05-19","objectID":"/myBlog-2/post/wireguard-vpn-for-ubuntu/:8:0","tags":["VPN","WireGuard","Ubuntu"],"title":"WireGuard VPN for Ubuntu","uri":"/myBlog-2/post/wireguard-vpn-for-ubuntu/"},{"categories":[],"content":"Markdown is created by Daring Fireball, the original guideline is here. Its syntax, however, varies between different parsers or editors. Please note that HTML fragments in markdown source will be recognized but not parsed or rendered. Also, there may be small reformatting on the original markdown source code after saving. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:0:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Paragraph and line breaks(æ®µè½ä¸æ¢è¡Œ) A paragraph is simply one or more consecutive lines of text. In markdown source code, paragraphs are separated by more than one blank lines. In Typora, you only need to press Return to create a new paragraph. Press Shift + Return to create a single line break. However, most markdown parser will ignore single line break, to make other markdown parsers recognize your line break, you can leave two whitespace at the end of the line, or insert \u003cbr/\u003e. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:1:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Headers(æ ‡é¢˜) Headers use 1-6 hash characters at the start of the line, corresponding to header levels 1-6. For example: # This is an H1 ## This is an H2 ###### This is an H6 In typora, input â€˜#â€™s followed by title content, and press Return key will create a header. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:2:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Blockquotes(å¼•è¨€) Markdown uses email-style \u003e characters for block quoting. They are presented as: This is a blockquote with two paragraphs. This is first paragraph. This is second pragraph.Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus. This is another blockquote with one paragraph. There is three empty line to seperate two blockquote. è¿™æ˜¯ä¸€æ®µä¸­æ–‡æµ‹è¯•ã€‚ In typora, just input â€˜\u003eâ€™ followed by quote contents a block quote is generated. Typora will insert proper â€˜\u003eâ€™ or line break for you. Block quote inside anther block quote is allowed by adding additional levels of â€˜\u003eâ€™. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:3:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Lists(æœ‰åºæ— åºåˆ—è¡¨) Input * list item 1 will create an un-ordered list, the * symbol can be replace with + or -. Input 1. list item 1 will create an ordered list, their markdown source code is like: Red Green Blue Red Green Blue ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:4:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Task List(ä»»åŠ¡åˆ—è¡¨) Task lists are lists with items marked as either [ ] or [x] (incomplete or complete). For example: a task list item list syntax required normal formatting, @mentions, #1234 refs incomplete completed You can change the complete/incomplete state by click the checkbox before the item. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:5:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Syntax Highlighting(ä»£ç é«˜äº®) function helloWorld () { alert(\"Hello, World!\") } public class HelloWorld { public static void main(String[] args) { System.out.println(\"Hello, World!\"); } } ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:6:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Math Blocks(æ•°å­¦å—) You can renderÂ LaTeXÂ mathematical expressions usingÂ MathJax. Input $$, then press â€˜Returnâ€™ key will trigger an input field which accept Tex/LaTex source. Following is an example: $$ \\mathbf{V}_1 \\times \\mathbf{V}_2 = \\begin{vmatrix} \\mathbf{i} \u0026 \\mathbf{j} \u0026 \\mathbf{k} \\ \\frac{\\partial X}{\\partial u} \u0026 \\frac{\\partial Y}{\\partial u} \u0026 0 \\ \\frac{\\partial X}{\\partial v} \u0026 \\frac{\\partial Y}{\\partial v} \u0026 0 \\ \\end{vmatrix} $$ In markdown source file, math block is LaTeX expression wrapped by â€˜$$â€™ mark: $$ \\mathbf{V}_1 \\times \\mathbf{V}_2 = \\begin{vmatrix} \\mathbf{i} \u0026 \\mathbf{j} \u0026 \\mathbf{k} \\\\ \\frac{\\partial X}{\\partial u} \u0026 \\frac{\\partial Y}{\\partial u} \u0026 0 \\\\ \\frac{\\partial X}{\\partial v} \u0026 \\frac{\\partial Y}{\\partial v} \u0026 0 \\\\ \\end{vmatrix} $$ ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:7:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Tables(è¡¨æ ¼) Input | First Header | Second Header | and press return key will create a table with two column. After table is created, focus on that table will pop up a toolbar for table, where you can resize, align, or delete table. You can also use context menu to copy and add/delete column/row. Following descriptions can be skipped, as markdown source code for tables are generated by typora automatically. In markdown source code, they look like: | Name | Markdown | HTML tag | | ----------------- | ------------------- | -------------------- | | *Emphasis* | `*Emphasis*` | `\u003cem\u003e\u003c/em\u003e` | | **Strong** | `**Strong**` | `\u003cstrong\u003e\u003c/strong\u003e` | | `code` | ``code`` | `\u003ccode\u003e\u003c/code\u003e` | | ~~Strikethrough~~ | `~~Strikethrough~~` | `\u003cdel\u003e\u003c/del` | | \u003cu\u003eUnderline\u003c/u\u003e | `\u003cu\u003eunderline\u003c/u\u003e` | `\u003cu\u003e\u003c/u\u003e` | Name Markdown HTML tag Emphasis *Emphasis* \u003cem\u003e\u003c/em\u003e Strong **Strong** \u003cstrong\u003e\u003c/strong\u003e code `code` \u003ccode\u003e\u003c/code\u003e Strikethrough ~~Strikethrough~~ \u003cdel\u003e\u003c/del Underline \u003cu\u003eunderline\u003c/u\u003e \u003cu\u003e\u003c/u\u003e ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:8:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Footnotes(æ³¨é‡Š) You can create footnotes like this[^footnote]. [^footnote]: Here is the *text* of the **footnote**. will produce: You can create footnotes like this1. Mouse on the â€˜footnoteâ€™ superscript to see content of the footnote. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:9:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Horizontal Rules(æ°´å¹³çº¿) Input *** or --- on a blank line and press return will draw a horizontal line. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:10:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Links(è¶…é“¾æ¥) Markdown supports two style of links: inline and reference. In both styles, the link text is delimited by [square brackets]. To create an inline link, use a set of regular parentheses immediately after the link textâ€™s closing square bracket. Inside the parentheses, put the URL where you want the link to point, along with an optional title for the link, surrounded in quotes. For example: This is [an example](http://example.com/ \"Title\") inline link. [This link](http://example.net/) has no title attribute. will produce: This is an example inline link. (\u003cp\u003eThis is \u003ca href=\"http://example.com/\" title=\"Title\"\u003e) This link has no title attribute. (\u003cp\u003e\u003ca href=\"http://example.net/\"\u003eThis link\u003c/a\u003e has no) ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:11:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Internal Links(é¡µå†…é“¾æ¥) You can set the href to headers, which will create a bookmark that allow you to jump to that section after clicking. For example: Command(on Windows: Ctrl) + Click This link will jump to header Block Elements. To see how to write that, please move cursor or click that link with âŒ˜ key pressed to expand the element into markdown source. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:11:1","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Reference Links(å‚è€ƒé“¾æ¥) Reference-style links use a second set of square brackets, inside which you place a label of your choosing to identify the link: This is [an example][id] reference-style link. Then, anywhere in the document, you define your link label like this, on a line by itself: [id]: http://example.com/ \"Optional Title Here\" In typora, they will be rendered like: This is an example reference-style link. The implicit link name shortcut allows you to omit the name of the link, in which case the link text itself is used as the name. Just use an empty set of square brackets â€” e.g., to link the word â€œGoogleâ€ to the google.com web site, you could simply write: [Google][] And then define the link: [Google]: http://google.com/ In typora click link will expand it for editing, command+click will open the hyperlink in web browser. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:11:2","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"URLs Typora allows you to insert urls as links, wrapped by \u003cbrackets\u003e. \u003ci@typora.io\u003e becomes i@typora.io. Typora will aslo auto link standard URLs. e.g: www.google.com. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:12:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Images(å›¾ç‰‡) Image looks similar with links, but it requires an additional ! char before the start of link. Image syntax looks like this: ![Alt text](/path/to/img.jpg) ![Alt text](/path/to/img.jpg \"Optional title\") You are able to use drag \u0026 drop to insert image from image file or we browser. And modify the markdown source code by clicking on the image. Relative path will be used if image is in same directory or sub-directory with current editing document when drag \u0026 drop. For more tips on images, please read http://support.typora.io//Images/ ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:13:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Emphasis(çªå‡ºå¼ºè°ƒ) Markdown treats asterisks (*) and underscores (_) as indicators of emphasis. Text wrapped with one * or _ will be wrapped with an HTML \u003cem\u003e tag. E.g: *single asterisks* _single underscores_ output: single asterisks single underscores GFM will ignores underscores in words, which is commonly used in code and names, like this: wow_great_stuff do_this_and_do_that_and_another_thing. To produce a literal asterisk or underscore at a position where it would otherwise be used as an emphasis delimiter, you can backslash escape it: \\*this text is surrounded by literal asterisks\\* Typora recommends to use * symbol. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:14:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Strong(åŠ ç²—) double *â€™s or _â€™s will be wrapped with an HTML \u003cstrong\u003e tag, e.g: **double asterisks** __double underscores__ output: double asterisks double underscores Typora recommends to use ** symbol. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:15:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Code(ä»£ç å—) To indicate a span of code, wrap it with backtick quotes (`). Unlike a pre-formatted code block, a code span indicates code within a normal paragraph. For example: Use the `printf()` function. will produce: Use the printf() function. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:16:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"highlight shortcode(é«˜äº®ä»£ç å—) example: {{\u003c highlight go \"linenos=table,hl_lines=8 15-17,linenostart=199\" \u003e}} // ... code {{\u003c /highlight \u003e}} result: // GetTitleFunc returns a func that can be used to transform a string to // title case. // // The supported styles are // // - \"Go\" (strings.Title) // - \"AP\" (see https://www.apstylebook.com/) // - \"Chicago\" (see http://www.chicagomanualofstyle.org/home.html) // // If an unknown or empty style is provided, AP style is what you get. func GetTitleFunc(style string) func(s string) string { switch strings.ToLower(style) { case \"go\": return strings.Title case \"chicago\": tc := transform.NewTitleConverter(transform.ChicagoStyle) return tc.Title default: tc := transform.NewTitleConverter(transform.APStyle) return tc.Title } } ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:17:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Strikethrough(åˆ é™¤çº¿) GFM adds syntax to create strikethrough text, which is missing from standard Markdown. ~~Mistaken text.~~ becomes Mistaken text. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:18:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Underline(ä¸‹åˆ’çº¿) Underline is powered by raw HTML. \u003cu\u003eUnderline\u003c/u\u003e becomes Underline. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:19:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Emoji :happy:(è¡¨æƒ…) Input emoji with syntax :smile:. User can trigger auto-complete suggestions for emoji by pressing ESC key, or trigger it automatically after enable it on preference panel. Also, input UTF8 emoji char directly from Edit -\u003e Emoji \u0026 Symbols from menu bar is also supported. ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:20:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":[],"content":"Inline Math To use this feature, first, please enable it in Preference Panel -\u003e Markdown Tab. Then use $ to wrap TeX command, for example: $\\lim_{x \\to \\infty} \\exp(-x) = 0$ will be rendered as LaTeX command. To trigger inline preview for inline math: input â€œ$â€, then press ESC key, then input TeX command, a preview tooltip will be visible like below: Here is the text of the footnote. â†©ï¸ ","date":"2020-04-16","objectID":"/myBlog-2/post/hello-world/:21:0","tags":[],"title":"Hello World","uri":"/myBlog-2/post/hello-world/"},{"categories":["Markdown"],"content":"è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†åŸºæœ¬çš„ Markdown è¯­æ³•å’Œæ ¼å¼.","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"è¿™ç¯‡æ–‡ç« æä¾›äº†å¯ä»¥åœ¨ Hugo çš„æ–‡ç« ä¸­ä½¿ç”¨çš„åŸºæœ¬ Markdown è¯­æ³•ç¤ºä¾‹. æ³¨æ„ è¿™ç¯‡æ–‡ç« å€Ÿé‰´äº†ä¸€ç¯‡å¾ˆæ£’çš„æ¥è‡ª Grav çš„æ–‡ç« . å¦‚æœä½ æƒ³äº†è§£ Loveit ä¸»é¢˜çš„æ‰©å±• Markdown è¯­æ³•, è¯·é˜…è¯»æ‰©å±• Markdown è¯­æ³•é¡µé¢. äº‹å®ä¸Š, ç¼–å†™ Web å†…å®¹å¾ˆéº»çƒ¦. WYSIWYGæ‰€è§å³æ‰€å¾— ç¼–è¾‘å™¨å¸®åŠ©å‡è½»äº†è¿™ä¸€ä»»åŠ¡. ä½†é€šå¸¸ä¼šå¯¼è‡´ä»£ç å¤ªç³Ÿ, æˆ–æ›´ç³Ÿç³•çš„æ˜¯, ç½‘é¡µä¹Ÿä¼šå¾ˆä¸‘. æ²¡æœ‰é€šå¸¸ä¼´éšçš„æ‰€æœ‰å¤æ‚å’Œä¸‘é™‹çš„é—®é¢˜, Markdown æ˜¯ä¸€ç§æ›´å¥½çš„ç”Ÿæˆ HTML å†…å®¹çš„æ–¹å¼. ä¸€äº›ä¸»è¦å¥½å¤„æ˜¯: Markdown ç®€å•æ˜“å­¦, å‡ ä¹æ²¡æœ‰å¤šä½™çš„å­—ç¬¦, å› æ­¤ç¼–å†™å†…å®¹ä¹Ÿæ›´å¿«. ç”¨ Markdown ä¹¦å†™æ—¶å‡ºé”™çš„æœºä¼šæ›´å°‘. å¯ä»¥äº§ç”Ÿæœ‰æ•ˆçš„ XHTML è¾“å‡º. å°†å†…å®¹å’Œè§†è§‰æ˜¾ç¤ºä¿æŒåˆ†å¼€, è¿™æ ·å°±ä¸ä¼šæ‰“ä¹±ç½‘ç«™çš„å¤–è§‚. å¯ä»¥åœ¨ä½ å–œæ¬¢çš„ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨æˆ– Markdown åº”ç”¨ç¨‹åºä¸­ç¼–å†™å†…å®¹. Markdown ä½¿ç”¨èµ·æ¥å¾ˆæœ‰è¶£! John Gruber, Markdown çš„ä½œè€…å¦‚æ˜¯è¯´: Markdown æ ¼å¼çš„é¦–è¦è®¾è®¡ç›®æ ‡æ˜¯æ›´å…·å¯è¯»æ€§. æœ€åˆçš„æƒ³æ³•æ˜¯ Markdown æ ¼å¼çš„æ–‡æ¡£åº”å½“ä»¥çº¯æ–‡æœ¬å½¢å¼å‘å¸ƒ, è€Œä¸ä¼šçœ‹èµ·æ¥åƒè¢«æ ‡ç­¾æˆ–æ ¼å¼è¯´æ˜æ‰€æ ‡è®°. è™½ç„¶ Markdown çš„è¯­æ³•å—åˆ°å‡ ç§ç°æœ‰çš„æ–‡æœ¬åˆ° HTML è½¬æ¢å·¥å…·çš„å½±å“, ä½† Markdown è¯­æ³•çš„æœ€å¤§çµæ„Ÿæ¥æºæ˜¯çº¯æ–‡æœ¬ç”µå­é‚®ä»¶çš„æ ¼å¼. â€“ John Gruber è¯ä¸å¤šè¯´, æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ Markdown çš„ä¸»è¦è¯­æ³•ä»¥åŠç”Ÿæˆçš„ HTML æ ·å¼! æŠ€å·§ Â å°†æ­¤é¡µä¿å­˜ä¸ºä¹¦ç­¾ï¼Œä»¥å¤‡å°†æ¥å‚è€ƒ! ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:0:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"1 æ ‡é¢˜ ä» h2 åˆ° h6 çš„æ ‡é¢˜åœ¨æ¯ä¸ªçº§åˆ«ä¸Šéƒ½åŠ ä¸Šä¸€ä¸ª ï¼ƒ: ## h2 æ ‡é¢˜ ### h3 æ ‡é¢˜ #### h4 æ ‡é¢˜ ##### h5 æ ‡é¢˜ ###### h6 æ ‡é¢˜ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ch2\u003eh2 æ ‡é¢˜\u003c/h2\u003e \u003ch3\u003eh3 æ ‡é¢˜\u003c/h3\u003e \u003ch4\u003eh4 æ ‡é¢˜\u003c/h4\u003e \u003ch5\u003eh5 æ ‡é¢˜\u003c/h5\u003e \u003ch6\u003eh6 æ ‡é¢˜\u003c/h6\u003e æ ‡é¢˜ ID è¦æ·»åŠ è‡ªå®šä¹‰æ ‡é¢˜ ID, è¯·åœ¨ä¸æ ‡é¢˜ç›¸åŒçš„è¡Œä¸­å°†è‡ªå®šä¹‰ ID æ”¾åœ¨èŠ±æ‹¬å·ä¸­: ### ä¸€ä¸ªå¾ˆæ£’çš„æ ‡é¢˜ {#custom-id} è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ch3 id=\"custom-id\"\u003eä¸€ä¸ªå¾ˆæ£’çš„æ ‡é¢˜\u003c/h3\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:1:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"2 æ³¨é‡Š æ³¨é‡Šæ˜¯å’Œ HTML å…¼å®¹çš„ï¼š \u003c!-- è¿™æ˜¯ä¸€æ®µæ³¨é‡Š --\u003e ä¸èƒ½çœ‹åˆ°ä»¥ä¸‹çš„æ³¨é‡Š: ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:2:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"3 æ°´å¹³çº¿ HTML ä¸­çš„ \u003chr\u003e æ ‡ç­¾æ˜¯ç”¨æ¥åœ¨æ®µè½å…ƒç´ ä¹‹é—´åˆ›å»ºä¸€ä¸ª â€œä¸“é¢˜é—´éš”â€ çš„. ä½¿ç”¨ Markdown, ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ª \u003chr\u003e æ ‡ç­¾: ___: ä¸‰ä¸ªè¿ç»­çš„ä¸‹åˆ’çº¿ ---: ä¸‰ä¸ªè¿ç»­çš„ç ´æŠ˜å· ***: ä¸‰ä¸ªè¿ç»­çš„æ˜Ÿå· å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:3:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"4 æ®µè½ æŒ‰ç…§çº¯æ–‡æœ¬çš„æ–¹å¼ä¹¦å†™æ®µè½, çº¯æ–‡æœ¬åœ¨å‘ˆç°çš„ HTML ä¸­å°†ç”¨ \u003cp\u003e/\u003c/p\u003e æ ‡ç­¾åŒ…è£¹. å¦‚ä¸‹æ®µè½: Lorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cp\u003eLorem ipsum dolor sit amet, graecis denique ei vel, at duo primis mandamus. Et legere ocurreret pri, animal tacimates complectitur ad cum. Cu eum inermis inimicus efficiendi. Labore officiis his ex, soluta officiis concludaturque ei qui, vide sensibus vim ad.\u003c/p\u003e å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç©ºç™½è¡Œè¿›è¡Œæ¢è¡Œ. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:4:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"5 å†…è” HTML å…ƒç´  å¦‚æœä½ éœ€è¦æŸä¸ª HTML æ ‡ç­¾ (å¸¦æœ‰ä¸€ä¸ªç±»), åˆ™å¯ä»¥ç®€å•åœ°åƒè¿™æ ·ä½¿ç”¨: Markdown æ ¼å¼çš„æ®µè½. \u003cdiv class=\"class\"\u003e è¿™æ˜¯ \u003cb\u003eHTML\u003c/b\u003e \u003c/div\u003e Markdown æ ¼å¼çš„æ®µè½. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:5:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"6 å¼ºè°ƒ ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:6:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"åŠ ç²— ç”¨äºå¼ºè°ƒå¸¦æœ‰è¾ƒç²—å­—ä½“çš„æ–‡æœ¬ç‰‡æ®µ. ä»¥ä¸‹æ–‡æœ¬ç‰‡æ®µä¼šè¢« æ¸²æŸ“ä¸ºç²—ä½“. **æ¸²æŸ“ä¸ºç²—ä½“** __æ¸²æŸ“ä¸ºç²—ä½“__ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cstrong\u003eæ¸²æŸ“ä¸ºç²—ä½“\u003c/strong\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:6:1","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"æ–œä½“ ç”¨äºå¼ºè°ƒå¸¦æœ‰æ–œä½“çš„æ–‡æœ¬ç‰‡æ®µ. ä»¥ä¸‹æ–‡æœ¬ç‰‡æ®µè¢« æ¸²æŸ“ä¸ºæ–œä½“. *æ¸²æŸ“ä¸ºæ–œä½“* _æ¸²æŸ“ä¸ºæ–œä½“_ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cem\u003eæ¸²æŸ“ä¸ºæ–œä½“\u003c/em\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:6:2","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"åˆ é™¤çº¿ æŒ‰ç…§ GFMGitHub flavored Markdown ä½ å¯ä»¥ä½¿ç”¨åˆ é™¤çº¿. ~~è¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿.~~ å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: è¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cdel\u003eè¿™æ®µæ–‡æœ¬å¸¦æœ‰åˆ é™¤çº¿.\u003c/del\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:6:3","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"ç»„åˆ åŠ ç²—, æ–œä½“, å’Œåˆ é™¤çº¿å¯ä»¥ ç»„åˆä½¿ç”¨. ***åŠ ç²—å’Œæ–œä½“*** ~~**åˆ é™¤çº¿å’ŒåŠ ç²—**~~ ~~*åˆ é™¤çº¿å’Œæ–œä½“*~~ ~~***åŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿***~~ å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: åŠ ç²—å’Œæ–œä½“ åˆ é™¤çº¿å’ŒåŠ ç²— åˆ é™¤çº¿å’Œæ–œä½“ åŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿ è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cem\u003e\u003cstrong\u003eåŠ ç²—å’Œæ–œä½“\u003c/strong\u003e\u003c/em\u003e \u003cdel\u003e\u003cstrong\u003eåˆ é™¤çº¿å’ŒåŠ ç²—\u003c/strong\u003e\u003c/del\u003e \u003cdel\u003e\u003cem\u003eåˆ é™¤çº¿å’Œæ–œä½“\u003c/em\u003e\u003c/del\u003e \u003cdel\u003e\u003cem\u003e\u003cstrong\u003eåŠ ç²—, æ–œä½“å’Œåˆ é™¤çº¿\u003c/strong\u003e\u003c/em\u003e\u003c/del\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:6:4","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"7 å¼•ç”¨ ç”¨äºåœ¨æ–‡æ¡£ä¸­å¼•ç”¨å…¶ä»–æ¥æºçš„å†…å®¹å—. åœ¨è¦å¼•ç”¨çš„ä»»ä½•æ–‡æœ¬ä¹‹å‰æ·»åŠ  \u003e: \u003e **Fusion Drive** combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Fusion Drive combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cblockquote\u003e \u003cp\u003e \u003cstrong\u003eFusion Drive\u003c/strong\u003e combines a hard drive with a flash storage (solid-state drive) and presents it as a single logical volume with the space of both drives combined. \u003c/p\u003e \u003c/blockquote\u003e å¼•ç”¨ä¹Ÿå¯ä»¥åµŒå¥—: \u003e Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. \u003e\u003e Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Donec massa lacus, ultricies a ullamcorper in, fermentum sed augue. Nunc augue augue, aliquam non hendrerit ac, commodo vel nisi. Sed adipiscing elit vitae augue consectetur a gravida nunc vehicula. Donec auctor odio non est accumsan facilisis. Aliquam id turpis in dolor tincidunt mollis ac eu diam. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:7:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"8 åˆ—è¡¨ ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:8:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"æ— åºåˆ—è¡¨ ä¸€ç³»åˆ—é¡¹çš„åˆ—è¡¨, å…¶ä¸­é¡¹çš„é¡ºåºæ²¡æœ‰æ˜æ˜¾å…³ç³». ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä½•ç¬¦å·æ¥è¡¨ç¤ºæ— åºåˆ—è¡¨ä¸­çš„é¡¹: * ä¸€é¡¹å†…å®¹ - ä¸€é¡¹å†…å®¹ + ä¸€é¡¹å†…å®¹ ä¾‹å¦‚: * Lorem ipsum dolor sit amet * Consectetur adipiscing elit * Integer molestie lorem at massa * Facilisis in pretium nisl aliquet * Nulla volutpat aliquam velit * Phasellus iaculis neque * Purus sodales ultricies * Vestibulum laoreet porttitor sem * Ac tristique libero volutpat at * Faucibus porta lacus fringilla vel * Aenean sit amet erat nunc * Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Phasellus iaculis neque Purus sodales ultricies Vestibulum laoreet porttitor sem Ac tristique libero volutpat at Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cul\u003e \u003cli\u003eLorem ipsum dolor sit amet\u003c/li\u003e \u003cli\u003eConsectetur adipiscing elit\u003c/li\u003e \u003cli\u003eInteger molestie lorem at massa\u003c/li\u003e \u003cli\u003eFacilisis in pretium nisl aliquet\u003c/li\u003e \u003cli\u003eNulla volutpat aliquam velit \u003cul\u003e \u003cli\u003ePhasellus iaculis neque\u003c/li\u003e \u003cli\u003ePurus sodales ultricies\u003c/li\u003e \u003cli\u003eVestibulum laoreet porttitor sem\u003c/li\u003e \u003cli\u003eAc tristique libero volutpat at\u003c/li\u003e \u003c/ul\u003e \u003c/li\u003e \u003cli\u003eFaucibus porta lacus fringilla vel\u003c/li\u003e \u003cli\u003eAenean sit amet erat nunc\u003c/li\u003e \u003cli\u003eEget porttitor lorem\u003c/li\u003e \u003c/ul\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:8:1","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"æœ‰åºåˆ—è¡¨ ä¸€ç³»åˆ—é¡¹çš„åˆ—è¡¨, å…¶ä¸­é¡¹çš„é¡ºåºç¡®å®å¾ˆé‡è¦. 1. Lorem ipsum dolor sit amet 2. Consectetur adipiscing elit 3. Integer molestie lorem at massa 4. Facilisis in pretium nisl aliquet 5. Nulla volutpat aliquam velit 6. Faucibus porta lacus fringilla vel 7. Aenean sit amet erat nunc 8. Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003col\u003e \u003cli\u003eLorem ipsum dolor sit amet\u003c/li\u003e \u003cli\u003eConsectetur adipiscing elit\u003c/li\u003e \u003cli\u003eInteger molestie lorem at massa\u003c/li\u003e \u003cli\u003eFacilisis in pretium nisl aliquet\u003c/li\u003e \u003cli\u003eNulla volutpat aliquam velit\u003c/li\u003e \u003cli\u003eFaucibus porta lacus fringilla vel\u003c/li\u003e \u003cli\u003eAenean sit amet erat nunc\u003c/li\u003e \u003cli\u003eEget porttitor lorem\u003c/li\u003e \u003c/ol\u003e æŠ€å·§ å¦‚æœä½ å¯¹æ¯ä¸€é¡¹ä½¿ç”¨ 1., Markdown å°†è‡ªåŠ¨ä¸ºæ¯ä¸€é¡¹ç¼–å·. ä¾‹å¦‚: 1. Lorem ipsum dolor sit amet 1. Consectetur adipiscing elit 1. Integer molestie lorem at massa 1. Facilisis in pretium nisl aliquet 1. Nulla volutpat aliquam velit 1. Faucibus porta lacus fringilla vel 1. Aenean sit amet erat nunc 1. Eget porttitor lorem å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Lorem ipsum dolor sit amet Consectetur adipiscing elit Integer molestie lorem at massa Facilisis in pretium nisl aliquet Nulla volutpat aliquam velit Faucibus porta lacus fringilla vel Aenean sit amet erat nunc Eget porttitor lorem ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:8:2","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"ä»»åŠ¡åˆ—è¡¨ ä»»åŠ¡åˆ—è¡¨ä½¿ä½ å¯ä»¥åˆ›å»ºå¸¦æœ‰å¤é€‰æ¡†çš„åˆ—è¡¨. è¦åˆ›å»ºä»»åŠ¡åˆ—è¡¨, è¯·åœ¨ä»»åŠ¡åˆ—è¡¨é¡¹ä¹‹å‰æ·»åŠ ç ´æŠ˜å· (-) å’Œå¸¦æœ‰ç©ºæ ¼çš„æ–¹æ‹¬å· ([ ]). è¦é€‰æ‹©ä¸€ä¸ªå¤é€‰æ¡†ï¼Œè¯·åœ¨æ–¹æ‹¬å·ä¹‹é—´æ·»åŠ  x ([x]). - [x] Write the press release - [ ] Update the website - [ ] Contact the media å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Write the press release Update the website Contact the media ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:8:3","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"9 ä»£ç  ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:9:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"è¡Œå†…ä»£ç  ç”¨ ` åŒ…è£…è¡Œå†…ä»£ç æ®µ. åœ¨è¿™ä¸ªä¾‹å­ä¸­, `\u003csection\u003e\u003c/section\u003e` ä¼šè¢«åŒ…è£¹æˆ **ä»£ç **. å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: åœ¨è¿™ä¸ªä¾‹å­ä¸­, \u003csection\u003e\u003c/section\u003e ä¼šè¢«åŒ…è£¹æˆ ä»£ç . è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cp\u003e åœ¨è¿™ä¸ªä¾‹å­ä¸­, \u003ccode\u003e\u0026lt;section\u0026gt;\u0026lt;/section\u0026gt;\u003c/code\u003e ä¼šè¢«åŒ…è£¹æˆ \u003cstrong\u003eä»£ç \u003c/strong\u003e. \u003c/p\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:9:1","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"ç¼©è¿›ä»£ç  å°†å‡ è¡Œä»£ç ç¼©è¿›è‡³å°‘å››ä¸ªç©ºæ ¼ï¼Œä¾‹å¦‚: // Some comments line 1 of code line 2 of code line 3 of code å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: // Some comments line 1 of code line 2 of code line 3 of code è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cpre\u003e \u003ccode\u003e // Some comments line 1 of code line 2 of code line 3 of code \u003c/code\u003e \u003c/pre\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:9:2","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"å›´æ ä»£ç å— ä½¿ç”¨ â€œå›´æ â€ ``` æ¥ç”Ÿæˆä¸€æ®µå¸¦æœ‰è¯­è¨€å±æ€§çš„ä»£ç å—. ```markdown Sample text here... ``` è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003cpre language-html\u003e \u003ccode\u003eSample text here...\u003c/code\u003e \u003c/pre\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:9:3","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"è¯­æ³•é«˜äº® GFMGitHub Flavored Markdown ä¹Ÿæ”¯æŒè¯­æ³•é«˜äº®. è¦æ¿€æ´»å®ƒï¼Œåªéœ€åœ¨ç¬¬ä¸€ä¸ªä»£ç  â€œå›´æ â€ ä¹‹åç›´æ¥æ·»åŠ ä½ è¦ä½¿ç”¨çš„è¯­è¨€çš„æ–‡ä»¶æ‰©å±•å, ```js, è¯­æ³•é«˜äº®æ˜¾ç¤ºå°†è‡ªåŠ¨åº”ç”¨äºæ¸²æŸ“çš„ HTML ä¸­. ä¾‹å¦‚, åœ¨ä»¥ä¸‹ JavaScript ä»£ç ä¸­åº”ç”¨è¯­æ³•é«˜äº®: ```js grunt.initConfig({ assemble: { options: { assets: 'docs/assets', data: 'src/data/*.{json,yml}', helpers: 'src/custom-helpers.js', partials: ['src/partials/**/*.{hbs,md}'] }, pages: { options: { layout: 'default.hbs' }, files: { './': ['src/templates/pages/index.hbs'] } } } }; ``` å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: grunt.initConfig({ assemble: { options: { assets: 'docs/assets', data: 'src/data/*.{json,yml}', helpers: 'src/custom-helpers.js', partials: ['src/partials/**/*.{hbs,md}'] }, pages: { options: { layout: 'default.hbs' }, files: { './': ['src/templates/pages/index.hbs'] } } } }; æ³¨æ„ Hugo æ–‡æ¡£ä¸­çš„ è¯­æ³•é«˜äº®é¡µé¢ ä»‹ç»äº†æœ‰å…³è¯­æ³•é«˜äº®çš„æ›´å¤šä¿¡æ¯, åŒ…æ‹¬è¯­æ³•é«˜äº®çš„ shortcode. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:9:4","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"10 è¡¨æ ¼ é€šè¿‡åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¹‹é—´æ·»åŠ ç«–çº¿ä½œä¸ºåˆ†éš”çº¿, å¹¶åœ¨æ ‡é¢˜ä¸‹æ·»åŠ ä¸€è¡Œç ´æŠ˜å· (ä¹Ÿç”±ç«–çº¿åˆ†éš”) æ¥åˆ›å»ºè¡¨æ ¼. æ³¨æ„, ç«–çº¿ä¸éœ€è¦å‚ç›´å¯¹é½. | Option | Description | | ------ | ----------- | | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. | å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Option Description data path to data files to supply the data that will be passed into templates. engine engine to be used for processing templates. Handlebars is the default. ext extension to be used for dest files. è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ctable\u003e \u003cthead\u003e \u003ctr\u003e \u003cth\u003eOption\u003c/th\u003e \u003cth\u003eDescription\u003c/th\u003e \u003c/tr\u003e \u003c/thead\u003e \u003ctbody\u003e \u003ctr\u003e \u003ctd\u003edata\u003c/td\u003e \u003ctd\u003epath to data files to supply the data that will be passed into templates.\u003c/td\u003e \u003c/tr\u003e \u003ctr\u003e \u003ctd\u003eengine\u003c/td\u003e \u003ctd\u003eengine to be used for processing templates. Handlebars is the default.\u003c/td\u003e \u003c/tr\u003e \u003ctr\u003e \u003ctd\u003eext\u003c/td\u003e \u003ctd\u003eextension to be used for dest files.\u003c/td\u003e \u003c/tr\u003e \u003c/tbody\u003e \u003c/table\u003e æ–‡æœ¬å³å¯¹é½æˆ–å±…ä¸­å¯¹é½ åœ¨ä»»ä½•æ ‡é¢˜ä¸‹æ–¹çš„ç ´æŠ˜å·å³ä¾§æ·»åŠ å†’å·å°†ä½¿è¯¥åˆ—çš„æ–‡æœ¬å³å¯¹é½. åœ¨ä»»ä½•æ ‡é¢˜ä¸‹æ–¹çš„ç ´æŠ˜å·ä¸¤è¾¹æ·»åŠ å†’å·å°†ä½¿è¯¥åˆ—çš„å¯¹é½æ–‡æœ¬å±…ä¸­. | Option | Description | |:------:| -----------:| | data | path to data files to supply the data that will be passed into templates. | | engine | engine to be used for processing templates. Handlebars is the default. | | ext | extension to be used for dest files. | å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹: Option Description data path to data files to supply the data that will be passed into templates. engine engine to be used for processing templates. Handlebars is the default. ext extension to be used for dest files. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:10:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"11 é“¾æ¥ ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:11:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"åŸºæœ¬é“¾æ¥ \u003chttps://assemble.io\u003e \u003ccontact@revolunet.com\u003e [Assemble](https://assemble.io) å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹ (å°†é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šï¼Œæ²¡æœ‰æç¤º): https://assemble.io contact@revolunet.com Assemble è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ca href=\"https://assemble.io\"\u003ehttps://assemble.io\u003c/a\u003e \u003ca href=\"mailto:contact@revolunet.com\"\u003econtact@revolunet.com\u003c/a\u003e \u003ca href=\"https://assemble.io\"\u003eAssemble\u003c/a\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:11:1","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"æ·»åŠ ä¸€ä¸ªæ ‡é¢˜ [Upstage](https://github.com/upstage/ \"Visit Upstage!\") å‘ˆç°çš„è¾“å‡ºæ•ˆæœå¦‚ä¸‹ (å°†é¼ æ ‡æ‚¬åœåœ¨é“¾æ¥ä¸Šï¼Œä¼šæœ‰ä¸€è¡Œæç¤º): Upstage è¾“å‡ºçš„ HTML çœ‹èµ·æ¥åƒè¿™æ ·: \u003ca href=\"https://github.com/upstage/\" title=\"Visit Upstage!\"\u003eUpstage\u003c/a\u003e ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:11:2","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"å®šä½æ ‡è®° å®šä½æ ‡è®°ä½¿ä½ å¯ä»¥è·³è‡³åŒä¸€é¡µé¢ä¸Šçš„æŒ‡å®šé”šç‚¹. ä¾‹å¦‚, æ¯ä¸ªç« èŠ‚: ## Table of Contents * [Chapter 1](#chapter-1) * [Chapter 2](#chapter-2) * [Chapter 3](#chapter-3) å°†è·³è½¬åˆ°è¿™äº›éƒ¨åˆ†: ## Chapter 1 \u003ca id=\"chapter-1\"\u003e\u003c/a\u003e Content for chapter one. ## Chapter 2 \u003ca id=\"chapter-2\"\u003e\u003c/a\u003e Content for chapter one. ## Chapter 3 \u003ca id=\"chapter-3\"\u003e\u003c/a\u003e Content for chapter one. æ³¨æ„ å®šä½æ ‡è®°çš„ä½ç½®å‡ ä¹æ˜¯ä»»æ„çš„. å› ä¸ºå®ƒä»¬å¹¶ä¸å¼•äººæ³¨ç›®, æ‰€ä»¥å®ƒä»¬é€šå¸¸è¢«æ”¾åœ¨åŒä¸€è¡Œäº†. ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:11:3","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"12 è„šæ³¨ è„šæ³¨ä½¿ä½ å¯ä»¥æ·»åŠ æ³¨é‡Šå’Œå‚è€ƒ, è€Œä¸ä¼šä½¿æ–‡æ¡£æ­£æ–‡æ··ä¹±. å½“ä½ åˆ›å»ºè„šæ³¨æ—¶, ä¼šåœ¨æ·»åŠ è„šæ³¨å¼•ç”¨çš„ä½ç½®å‡ºç°å¸¦æœ‰é“¾æ¥çš„ä¸Šæ ‡ç¼–å·. è¯»è€…å¯ä»¥å•å‡»é“¾æ¥ä»¥è·³è‡³é¡µé¢åº•éƒ¨çš„è„šæ³¨å†…å®¹. è¦åˆ›å»ºè„šæ³¨å¼•ç”¨, è¯·åœ¨æ–¹æ‹¬å·ä¸­æ·»åŠ æ’å…¥ç¬¦å·å’Œæ ‡è¯†ç¬¦ ([^1]). æ ‡è¯†ç¬¦å¯ä»¥æ˜¯æ•°å­—æˆ–å•è¯, ä½†ä¸èƒ½åŒ…å«ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦. æ ‡è¯†ç¬¦ä»…å°†è„šæ³¨å¼•ç”¨ä¸è„šæ³¨æœ¬èº«ç›¸å…³è” - åœ¨è„šæ³¨è¾“å‡ºä¸­, è„šæ³¨æŒ‰é¡ºåºç¼–å·. åœ¨ä¸­æ‹¬å·å†…ä½¿ç”¨æ’å…¥ç¬¦å·å’Œæ•°å­—ä»¥åŠç”¨å†’å·å’Œæ–‡æœ¬æ¥æ·»åŠ è„šæ³¨å†…å®¹ ([^1]ï¼šè¿™æ˜¯ä¸€æ®µè„šæ³¨). ä½ ä¸ä¸€å®šè¦åœ¨æ–‡æ¡£æœ«å°¾æ·»åŠ è„šæ³¨. å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨é™¤åˆ—è¡¨, å¼•ç”¨å’Œè¡¨æ ¼ç­‰å…ƒç´ ä¹‹å¤–çš„ä»»ä½•ä½ç½®. è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨[^1]. è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨[^label] [^1]: è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨ [^label]: è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨ è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨1. è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨2 ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:12:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["Markdown"],"content":"13 å›¾ç‰‡ å›¾ç‰‡çš„è¯­æ³•ä¸é“¾æ¥ç›¸ä¼¼, ä½†åŒ…å«ä¸€ä¸ªåœ¨å‰é¢çš„æ„Ÿå¹å·. ![Minion](https://octodex.github.com/images/minion.png) æˆ–è€…: ![Alt text](https://octodex.github.com/images/stormtroopocat.jpg \"The Stormtroopocat\") The StormtroopocatAlt text \" The Stormtroopocat åƒé“¾æ¥ä¸€æ ·, å›¾ç‰‡ä¹Ÿå…·æœ‰è„šæ³¨æ ·å¼çš„è¯­æ³•: ![Alt text][id] The DojocatAlt text \" The Dojocat ç¨ååœ¨æ–‡æ¡£ä¸­æä¾›å‚è€ƒå†…å®¹, ç”¨æ¥å®šä¹‰ URL çš„ä½ç½®: [id]: https://octodex.github.com/images/dojocat.jpg \"The Dojocat\" æŠ€å·§ LoveIt ä¸»é¢˜æä¾›äº†ä¸€ä¸ªåŒ…å«æ›´å¤šåŠŸèƒ½çš„ å›¾ç‰‡çš„ shortcode. è¿™æ˜¯ä¸€ä¸ªæ•°å­—è„šæ³¨ â†©ï¸ è¿™æ˜¯ä¸€ä¸ªå¸¦æ ‡ç­¾çš„è„šæ³¨ â†©ï¸ ","date":"2019-12-01","objectID":"/myBlog-2/post/basic-markdown-syntax/:13:0","tags":["Markdown","HTML"],"title":"Markdown åŸºæœ¬è¯­æ³•","uri":"/myBlog-2/post/basic-markdown-syntax/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ å‰é¢çš„kubernetsç³»åˆ—æ–‡ç« ä»‹ç»äº†é€šè¿‡å‘½ä»¤è¡Œå’Œyamlæ–‡ä»¶çš„æ–¹å¼å¯¹kubernetesä¸­èµ„æºçš„ç®¡ç†ï¼Œå‘½ä»¤è¡Œå’Œyamlæ–‡ä»¶æ–¹å¼ç®¡ç†å¯¹äºç®¡ç†å‘˜æ¥è¯´æ— ç–‘æ˜¯åˆ©å™¨ï¼Œè€Œå¯¹äºæ™®é€šå¤§ä¼—æ¥è¯´ï¼Œå›¾å½¢ç®¡ç†ç•Œé¢éœ€æ±‚åˆ™ä¸ºæ›´è¿«åˆ‡çš„æ–¹å¼ï¼Œæœ¬ç« ä»‹ç»kubernetesç¤¾åŒºæä¾›çš„ä¸€ä¸ªå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·ï¼škubernetes-dashboardï¼Œé€šè¿‡ä¸€ä¸ªWebUIç®¡ç†kubernetesçš„èµ„æºã€‚ 1. kubernetes-dashboardç®€ä»‹ kubernetesä¸­ç®¡ç†é›†ç¾¤ä¸­èµ„æºçš„æ–¹å¼é€šå¸¸æœ‰å››ç§ï¼šå‘½ä»¤è¡Œã€YAMLã€APIå’Œå›¾å½¢ç•Œé¢ï¼Œå››ç§ä¸åŒçš„æ–¹å¼é€‚ç”¨äºä¸åŒçš„äººç¾¤å’Œåœºæ™¯ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š å‘½ä»¤è¡Œkubectlï¼Œkubectlæä¾›äº†å‘½ä»¤è¡Œç®¡ç†kubernetesèµ„æº ä¼˜ç‚¹ï¼šä½¿ç”¨æ–¹ä¾¿ã€ä¾¿æ·ã€å¿«é€Ÿç®¡ç†é›†ç¾¤èµ„æº ç¼ºç‚¹ï¼šåŠŸèƒ½ç›¸å¯¹æœ‰é™ï¼Œéƒ¨åˆ†æ“ä½œæ— æ³•æ”¯æŒï¼Œæœ‰ä¸€å®šçš„é—¨æ§› YAMLèµ„æºå®šä¹‰ï¼Œkubernetesä¸­æœ€ç»ˆè½¬æ¢å½¢å¼ï¼Œæ¨èä½¿ç”¨æ–¹å¼ ä¼˜ç‚¹ï¼šåŠŸèƒ½é½å¤‡ï¼Œèƒ½å¤Ÿå®šä¹‰kubernetesçš„æ‰€æœ‰å¯¹è±¡å’Œèµ„æº ç¼ºç‚¹ï¼šé—¨æ§›è¾ƒé«˜ï¼Œéœ€è¦å…·å¤‡ä¸“ä¸šæŠ€æœ¯èƒ½åŠ›ï¼Œä½¿ç”¨æ’éšœéš¾åº¦å¤§ APIç®¡ç†æ¥å…¥ï¼Œæä¾›å„ç§ç¼–ç¨‹è¯­è¨€SDKæ¥å£ï¼Œæ–¹ä¾¿å„ç§ç¼–ç¨‹è¯­è¨€åº”ç”¨ç¨‹åºæ¥å…¥ ä¼˜ç‚¹ï¼šé€‚é…å„ç§ç¼–ç¨‹è¯­è¨€ï¼Œå¦‚Javaï¼ŒGoï¼ŒPythonï¼ŒCç­‰ï¼Œæ–¹ä¾¿å¼€å‘kubernetes ç¼ºç‚¹ï¼šé—¨æ§›è¾ƒé«˜ï¼Œé€‚ç”¨äºå¼€å‘äººå‘˜ å›¾å½¢kubernetes-dashboardï¼Œæä¾›å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ï¼Œèƒ½å¤Ÿåˆ©ç”¨metric-serverå®ç°nodeå’Œpodçš„ç›‘æ§ ä¼˜ç‚¹ï¼šä½¿ç”¨ç®€å•ï¼Œä¾¿æ·ï¼Œé€‚åˆå¤§ä¼—ã€‚ ç¼ºç‚¹ï¼šåŠŸèƒ½ç›¸å¯¹ç®€å•ï¼ŒåŠŸèƒ½åŸç”Ÿï¼Œé€‚ç”¨äºdemo 2. **kubernetes-**dashboardå®‰è£… ç¤¾åŒºæä¾›äº†kubernetes-dashbaordçš„YAMLèµ„æºå®šä¹‰æ–‡ä»¶ï¼Œç›´æ¥ä¸‹è½½YAMLæ–‡ä»¶å®‰è£…å³å¯å®ç°dashboardçš„å®‰è£…æ¥å…¥ï¼Œéœ€è¦å‡†å¤‡æ¡ä»¶å¦‚ä¸‹ï¼š å·²å®‰è£…å¥½çš„kubernetesé›†ç¾¤ï¼Œæœ¬æ–‡ç¯å¢ƒä¸º1.15.3 metric-serverç›‘æ§ï¼Œnodeç›‘æ§å’Œpodç›‘æ§è§†å›¾éœ€ä¾èµ–äºç›‘æ§ç³»ç»Ÿ RBACè®¤è¯æˆæƒï¼Œè®¾ç½®å¥½è´¦æˆ·å¹¶æˆäºˆè®¿é—®æƒé™ 1ã€ä¸‹è½½kubernetes-dashboardå®‰è£…æ–‡ä»¶å¹¶åº”ç”¨YAMLèµ„æºå®šä¹‰ [root@node-1 ~]# kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml namespace/kubernetes-dashboard created serviceaccount/kubernetes-dashboard created service/kubernetes-dashboard created secret/kubernetes-dashboard-certs created secret/kubernetes-dashboard-csrf created secret/kubernetes-dashboard-key-holder created configmap/kubernetes-dashboard-settings created role.rbac.authorization.k8s.io/kubernetes-dashboard created clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard configured rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard unchanged deployment.apps/kubernetes-dashboard created service/dashboard-metrics-scraper created deployment.apps/dashboard-metrics-scraper created å®‰è£…æ–‡ä»¶ä¸­å®šä¹‰äº†dashboardç›¸å…³çš„èµ„æºï¼Œå¯ä»¥æŸ¥é˜…YAMLæ–‡ä»¶ï¼Œèµ„æºåŒ…å«æœ‰ï¼š kubernetes-dashboardå‘½åç©ºé—´ ServiceAccountè®¿é—®ç”¨æˆ· ServiceæœåŠ¡è®¿é—®åº”ç”¨ï¼Œé»˜è®¤ä¸ºClusterIP Secretsï¼Œå­˜æ”¾æœ‰kubernetes-dashboard-certsï¼Œkubernetes-dashboard-csrfï¼Œkubernetes-dashboard-key-holderè¯ä¹¦ ConfigMapé…ç½®æ–‡ä»¶ RBACè®¤è¯æˆæƒï¼ŒåŒ…å«æœ‰Roleï¼ŒClusterRoleï¼ŒRoleBindingï¼ŒClusterRoleBinding Deploymentsåº”ç”¨ï¼Œkubernetes-dashboardæ ¸å¿ƒé•œåƒï¼Œè¿˜æœ‰ä¸€ä¸ªå’Œç›‘æ§é›†æˆçš„dashboard-metrics-scraper 2ã€æ ¡éªŒèµ„æºçš„å®‰è£…æƒ…å†µï¼Œkubernetes-dashbaordçš„èµ„æºéƒ½å®‰è£…åœ¨kubernetes-dashboardå‘½åç©ºé—´ä¸‹,åŒ…å«æœ‰Deploymentsï¼ŒServicesï¼ŒSecretsï¼ŒConfigMapç­‰ 3ã€kubernetes-dashbaordå®‰è£…å®Œæ¯•åï¼Œkubernetes-dashboardé»˜è®¤serviceçš„ç±»å‹ä¸ºClusterIPï¼Œä¸ºäº†ä»å¤–éƒ¨è®¿é—®æ§åˆ¶é¢æ¿ï¼Œå¼€æ”¾ä¸ºNodePortç±»å‹ 4ã€æ­¤æ—¶é€šè¿‡httpsåè®®è®¿é—®30433ç«¯å£å³å¯æ‰“å¼€dashboardçš„æ§åˆ¶å°ï¼Œä¸ºäº†ä¿æŠ¤æ•°æ®å®‰å…¨æ€§ï¼Œé›†ç¾¤é»˜è®¤å¼€å¯äº†RBACè®¤è¯æˆæƒï¼Œéœ€è¦æˆäºˆæƒé™çš„ç”¨æˆ·æ‰å¯ä»¥è®¿é—®åˆ°kubernetesé›†ç¾¤ï¼Œå› æ­¤éœ€è¦æˆæƒç”¨æˆ·è®¿é—®é›†ç¾¤ï¼Œé›†ç¾¤ä¸­å·²å®šæœ‰äº†cluster-adminçš„è§’è‰²å’Œç›¸å…³çš„Roleï¼ŒClusterRoleå’ŒClusterRoleBindingè§’è‰²ï¼Œå®šä¹‰ServiceAccountå°†å…¶å…³è”å³å¯ï¼Œå¦‚ä¸‹: [root@node-1 ~]# cat dashboard-rbac.yaml --- apiVersion: v1 kind: ServiceAccount metadata: name: happylau namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: happylau roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: happylau namespace: kubernetes-dashboard 5ã€åº”ç”¨RBACè§„åˆ™ï¼Œåˆ›å»ºä¸€ä¸ªhappylauçš„ç”¨æˆ·ï¼Œå¹¶å’Œcluster-adminçš„è§’è‰²å…³è” [root@node-1 ~]# kubectl apply -f dashboard-rbac.yaml serviceaccount/happylau created clusterrolebinding.rbac.authorization.k8s.io/happylau created [root@node-1 ~]# kubectl get serviceaccounts -n kubernetes-dashboard NAME SECRETS AGE default 1 114m happylau 1 8s kubernetes-dashboard 1 114m 6ã€æ­¤æ—¶é€šè¿‡kubernetes-dashboard-csrfæœåŠ¡ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå’Œç”¨æˆ·åå…³è”çš„Secretsï¼Œé€šè¿‡tokenå­—æ®µæ¥ç™»é™†ï¼Œtokené€šè¿‡base64åŠ å¯†ï¼Œè§£å¯†åå³å¯ç™»å½•ï¼Œå¦‚ä¸‹æ¼”ç¤ºç™»å½•çš„è¿‡ç¨‹ è‡ªæ­¤ï¼Œkubernetes-dashboardå®‰è£…å®Œæ¯•ï¼Œé€šè¿‡RBACè®¤è¯æˆæƒç‰¹å®šç”¨æˆ·è®¿é—®é›†ç¾¤æƒé™ï¼Œæ¥ä¸‹æ¥ä¸€èµ·æ¢ç´¢dashboardå¸¦æ¥çš„é­”åŠ›å§ã€‚ 3. æ¢ç´¢kubernetes-dashboard kubernetes-dashboardå›¾å½¢å·¥å…·èƒ½æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š æŸ¥çœ‹kubernetesä¸­çš„èµ„æºå¯¹è±¡ï¼ŒåŒ…å«kubernetesä¸­å„ç§èµ„æº Cluster é›†ç¾¤çº§åˆ«çš„èµ„æºï¼Œå¦‚å‘½åç©ºé—´ï¼ŒèŠ‚ç‚¹ï¼ŒPVï¼ŒStorageClassï¼ŒClusterRoleç­‰ Workloadsï¼Œä¸åŒç±»å‹çš„å·¥ä½œè´Ÿè½½ï¼ŒåŒ…å«Deploymentsï¼ŒStatefulSetsï¼ŒDaemonSetsï¼ŒJobsç­‰ Discovery and LoadBalancingï¼ŒæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼ŒåŒ…å«serviceå’Œingress ConfigMap and Storageï¼ŒåŒ…å«ConfigMapï¼ŒSecretså’ŒPVC Costom Resource Definitionï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ kubernetesèµ„æºç›‘æ§ï¼Œè°ƒç”¨metric-serverç›‘æ§ç³»ç»Ÿï¼Œå®ç°Clusteré›†ç¾¤ï¼ŒWorkloadsåº”ç”¨è´Ÿè½½ï¼Œå­˜å‚¨ç­‰èµ„æºçš„ç›‘æ§ ç®¡ç†èµ„æºå¯¹è±¡ï¼ŒåŒ…å«åˆ›å»ºï¼Œç¼–è¾‘yamlï¼Œåˆ é™¤è´Ÿè½½ç­‰ï¼Œä¸»è¦æ˜¯ä»¥Deploymentsç­‰åº”ç”¨ä¸ºä¸»çš„ç®¡ç† 1ã€æŸ¥çœ‹é›†ç¾¤æ•´ä½“æ¦‚è§ˆèµ„æºï¼Œå¯ä»¥çœ‹åˆ°æ•´ä½“é›†ç¾¤ï¼Œåº”ç”¨è´Ÿè½½ï¼ŒPodèµ„æºçš„èµ„æºä½¿ç”¨æƒ…å†µ 2ã€Clusteré›†ç¾¤èµ„æºç®¡ç†ï¼ŒåŒ…å«è¿˜æœ‰Nodesï¼ŒNamespaceï¼ŒStorageClassç­‰ï¼Œæä¾›åœ¨çº¿ç¼–è¾‘yamlæ–¹å¼ 3ã€æŸ¥çœ‹åº”ç”¨å·¥ä½œè´Ÿè½½Wor","date":"2019-08-04","objectID":"/myBlog-2/post/19-dashboard%E4%BD%BFk8s%E6%99%AE%E5%8F%8A%E5%A4%A7%E4%BC%97/:0:0","tags":["kubernetes"],"title":"19 Dashboardä½¿k8sæ™®åŠå¤§ä¼—","uri":"/myBlog-2/post/19-dashboard%E4%BD%BFk8s%E6%99%AE%E5%8F%8A%E5%A4%A7%E4%BC%97/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆä¸ƒï¼‰æ·±å…¥ç©è½¬podè°ƒåº¦ä»‹ç»äº†kubernetesä¸­Podçš„è°ƒåº¦æœºåˆ¶ï¼Œé€šè¿‡å®æˆ˜æ¼”ç»ƒä»‹ç»Podè°ƒåº¦åˆ°nodeçš„å‡ ç§æ–¹æ³•ï¼š1. é€šè¿‡nodeNameå›ºå®šé€‰æ‹©è°ƒåº¦ï¼Œ2. é€šè¿‡nodeSelectorå®šå‘é€‰æ‹©è°ƒåº¦ï¼Œ3. é€šè¿‡node Affinityäº²å’ŒåŠ›è°ƒåº¦ï¼Œæ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹podçš„å¥åº·æ£€æŸ¥æœºåˆ¶ã€‚ 1. å¥åº·æ£€æŸ¥ ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:0:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 å¥åº·æ£€æŸ¥æ¦‚è¿° åº”ç”¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­éš¾å…ä¼šå‡ºç°é”™è¯¯ï¼Œå¦‚ç¨‹åºå¼‚å¸¸ï¼Œè½¯ä»¶å¼‚å¸¸ï¼Œç¡¬ä»¶æ•…éšœï¼Œç½‘ç»œæ•…éšœç­‰ï¼Œkubernetesæä¾›Health Checkå¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå½“å‘ç°åº”ç”¨å¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ï¼Œå°†åº”ç”¨ä»serviceæœåŠ¡ä¸­å‰”é™¤ï¼Œä¿éšœåº”ç”¨çš„é«˜å¯ç”¨æ€§ã€‚k8så®šä¹‰äº†ä¸‰ç§æ¢é’ˆProbeï¼š readiness probes å‡†å¤‡å°±ç»ªæ£€æŸ¥ï¼Œé€šè¿‡readinessæ˜¯å¦å‡†å¤‡æ¥å—æµé‡ï¼Œå‡†å¤‡å®Œæ¯•åŠ å…¥åˆ°endpointï¼Œå¦åˆ™å‰”é™¤ liveness probes åœ¨çº¿æ£€æŸ¥æœºåˆ¶ï¼Œæ£€æŸ¥åº”ç”¨æ˜¯å¦å¯ç”¨ï¼Œå¦‚æ­»é”ï¼Œæ— æ³•å“åº”ï¼Œå¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡å¯å®¹å™¨ startup probes å¯åŠ¨æ£€æŸ¥æœºåˆ¶ï¼Œåº”ç”¨ä¸€äº›å¯åŠ¨ç¼“æ…¢çš„ä¸šåŠ¡ï¼Œé¿å…ä¸šåŠ¡é•¿æ—¶é—´å¯åŠ¨è€Œè¢«å‰é¢çš„æ¢é’ˆkillæ‰ æ¯ç§æ¢æµ‹æœºåˆ¶æ”¯æŒä¸‰ç§å¥åº·æ£€æŸ¥æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯å‘½ä»¤è¡Œexecï¼ŒhttpGetå’ŒtcpSocketï¼Œå…¶ä¸­execé€šç”¨æ€§æœ€å¼ºï¼Œé€‚ç”¨ä¸å¤§éƒ¨åˆ†åœºæ™¯ï¼ŒtcpSocketé€‚ç”¨äºTCPä¸šåŠ¡ï¼ŒhttpGeté€‚ç”¨äºwebä¸šåŠ¡ã€‚ exec æä¾›å‘½ä»¤æˆ–shellçš„æ£€æµ‹ï¼Œåœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤æ£€æŸ¥ï¼Œè¿”å›ç ä¸º0å¥åº·ï¼Œé0å¼‚å¸¸ httpGet httpåè®®æ¢æµ‹ï¼Œåœ¨å®¹å™¨ä¸­å‘é€httpè¯·æ±‚ï¼Œæ ¹æ®httpè¿”å›ç åˆ¤æ–­ä¸šåŠ¡å¥åº·æƒ…å†µ tcpSocket tcpåè®®æ¢æµ‹ï¼Œå‘å®¹å™¨å‘é€tcpå»ºç«‹è¿æ¥ï¼Œèƒ½å»ºç«‹åˆ™è¯´æ˜æ­£å¸¸ æ¯ç§æ¢æµ‹æ–¹æ³•èƒ½æ”¯æŒå‡ ä¸ªç›¸åŒçš„æ£€æŸ¥å‚æ•°ï¼Œç”¨äºè®¾ç½®æ§åˆ¶æ£€æŸ¥æ—¶é—´ï¼š initialDelaySeconds åˆå§‹ç¬¬ä¸€æ¬¡æ¢æµ‹é—´éš”ï¼Œç”¨äºåº”ç”¨å¯åŠ¨çš„æ—¶é—´ï¼Œé˜²æ­¢åº”ç”¨è¿˜æ²¡å¯åŠ¨è€Œå¥åº·æ£€æŸ¥å¤±è´¥ periodSeconds æ£€æŸ¥é—´éš”ï¼Œå¤šä¹…æ‰§è¡Œprobeæ£€æŸ¥ï¼Œé»˜è®¤ä¸º10s timeoutSeconds æ£€æŸ¥è¶…æ—¶æ—¶é•¿ï¼Œæ¢æµ‹åº”ç”¨timeoutåä¸ºå¤±è´¥ successThreshold æˆåŠŸæ¢æµ‹é˜ˆå€¼ï¼Œè¡¨ç¤ºæ¢æµ‹å¤šå°‘æ¬¡ä¸ºå¥åº·æ­£å¸¸ï¼Œé»˜è®¤æ¢æµ‹1æ¬¡ ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:1:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 execå‘½ä»¤è¡Œå¥åº·æ£€æŸ¥ è®¸å¤šåº”ç”¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ— æ³•æ£€æµ‹åˆ°å†…éƒ¨æ•…éšœï¼Œå¦‚æ­»é”ï¼Œå‡ºç°æ•…éšœæ—¶é€šè¿‡é‡å¯ä¸šåŠ¡å¯ä»¥æ¢å¤ï¼Œkubernetesæä¾›livenessåœ¨çº¿å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œæˆ‘ä»¬ä»¥execä¸ºä¾‹ï¼Œåˆ›å»ºä¸€ä¸ªå®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶/tmp/liveness-probe.logï¼Œ10såå°†å…¶åˆ é™¤ï¼Œå®šä¹‰livenesså¥åº·æ£€æŸ¥æœºåˆ¶åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ls -l /tmp/liveness-probe.logï¼Œé€šè¿‡æ–‡ä»¶çš„è¿”å›ç åˆ¤æ–­å¥åº·çŠ¶æ€ï¼Œå¦‚æœè¿”å›ç é0ï¼Œæš‚åœ20såkubeletä¼šè‡ªåŠ¨å°†è¯¥å®¹å™¨é‡å¯ã€‚ å®šä¹‰ä¸€ä¸ªå®¹å™¨ï¼Œå¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¥åº·æ£€æŸ¥æ—¶ls -l /tmp/liveness-probe.logè¿”å›ç ä¸º0ï¼Œå¥åº·æ£€æŸ¥æ­£å¸¸ï¼Œ10såå°†å…¶åˆ é™¤ï¼Œè¿”å›ç ä¸ºé0ï¼Œå¥åº·æ£€æŸ¥å¼‚å¸¸ [root@node-1 demo]# cat centos-exec-liveness-probe.yaml apiVersion: v1 kind: Pod metadata: name: exec-liveness-probe annotations: kubernetes.io/description: \"exec-liveness-probe\" spec: containers: - name: exec-liveness-probe image: centos:latest imagePullPolicy: IfNotPresent args: #å®¹å™¨å¯åŠ¨å‘½ä»¤ï¼Œç”Ÿå‘½å‘¨æœŸä¸º30s - /bin/sh - -c - touch /tmp/liveness-probe.log \u0026\u0026 sleep 10 \u0026\u0026 rm -f /tmp/liveness-probe.log \u0026\u0026 sleep 20 livenessProbe: exec: #å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œé€šè¿‡ls -l /tmp/liveness-probe.logè¿”å›ç åˆ¤æ–­å®¹å™¨çš„å¥åº·çŠ¶æ€ command: - ls - l - /tmp/liveness-probe.log initialDelaySeconds: 1 periodSeconds: 5 timeoutSeconds: 1 åº”ç”¨é…ç½®ç”Ÿæˆå®¹å™¨ [root@node-1 demo]# kubectl apply -f centos-exec-liveness-probe.yaml pod/exec-liveness-probe created æŸ¥çœ‹å®¹å™¨çš„eventæ—¥å¿—ï¼Œå®¹å™¨å¯åŠ¨åï¼Œ10sä»¥å†…å®¹å™¨çŠ¶æ€æ­£å¸¸ï¼Œ11så¼€å§‹æ‰§è¡Œlivenesså¥åº·æ£€æŸ¥ï¼Œæ£€æŸ¥å¼‚å¸¸ï¼Œè§¦å‘å®¹å™¨é‡å¯ [root@node-1 demo]# kubectl describe pods exec-liveness-probe | tail Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 28s default-scheduler Successfully assigned default/exec-liveness-probe to node-3 Normal Pulled 27s kubelet, node-3 Container image \"centos:latest\" already present on machine Normal Created 27s kubelet, node-3 Created container exec-liveness-probe Normal Started 27s kubelet, node-3 Started container exec-liveness-probe #å®¹å™¨å·²å¯åŠ¨ Warning Unhealthy 20s (x2 over 25s) kubelet, node-3 Liveness probe failed: /tmp/liveness-probe.log ls: cannot access l: No such file or directory #æ‰§è¡Œå¥åº·æ£€æŸ¥ï¼Œæ£€æŸ¥å¼‚å¸¸ Warning Unhealthy 15s kubelet, node-3 Liveness probe failed: ls: cannot access l: No such file or directory ls: cannot access /tmp/liveness-probe.log: No such file or directory Normal Killing 15s kubelet, node-3 Container exec-liveness-probe failed liveness probe, will be restarted #é‡å¯å®¹å™¨ æŸ¥çœ‹å®¹å™¨é‡å¯æ¬¡æ•°ï¼Œå®¹å™¨ä¸åœçš„æ‰§è¡Œï¼Œé‡å¯æ¬¡æ•°ä¼šå“åº”å¢åŠ ï¼Œå¯ä»¥çœ‹åˆ°RESTARTSçš„æ¬¡æ•°åœ¨æŒç»­å¢åŠ  [root@node-1 demo]# kubectl get pods exec-liveness-probe NAME READY STATUS RESTARTS AGE exec-liveness-probe 1/1 Running 6 5m19s ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:2:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 httpGetå¥åº·æ£€æŸ¥ httpGet probeä¸»è¦ä¸»è¦ç”¨äºwebåœºæ™¯ï¼Œé€šè¿‡å‘å®¹å™¨å‘é€httpè¯·æ±‚ï¼Œæ ¹æ®è¿”å›ç åˆ¤æ–­å®¹å™¨çš„å¥åº·çŠ¶æ€ï¼Œè¿”å›ç å°äº4xxå³è¡¨ç¤ºå¥åº·ï¼Œå¦‚ä¸‹å®šä¹‰ä¸€ä¸ªnginxåº”ç”¨ï¼Œé€šè¿‡æ¢æµ‹http://:port/index.htmlçš„æ–¹å¼åˆ¤æ–­å¥åº·çŠ¶æ€ [root@node-1 demo]# cat nginx-httpGet-liveness-readiness.yaml apiVersion: v1 kind: Pod metadata: name: nginx-httpget-livess-readiness-probe annotations: kubernetes.io/description: \"nginx-httpGet-livess-readiness-probe\" spec: containers: - name: nginx-httpget-livess-readiness-probe image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 livenessProbe: #å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œé€šè¿‡httpGetå®ç°å®ç°æ£€æŸ¥ httpGet: port: 80 scheme: HTTP path: /index.html initialDelaySeconds: 3 periodSeconds: 10 timeoutSeconds: 3 ç”Ÿæˆpodå¹¶æŸ¥çœ‹å¥åº·çŠ¶æ€ [root@node-1 demo]# kubectl apply -f nginx-httpGet-liveness-readiness.yaml pod/nginx-httpget-livess-readiness-probe created [root@node-1 demo]# kubectl get pods nginx-httpget-livess-readiness-probe NAME READY STATUS RESTARTS AGE nginx-httpget-livess-readiness-probe 1/1 Running 0 6s æ¨¡æ‹Ÿæ•…éšœï¼Œå°†podä¸­çš„pathæ–‡ä»¶æ‰€å±æ–‡ä»¶åˆ é™¤ï¼Œæ­¤æ—¶å‘é€httpè¯·æ±‚æ—¶ä¼šå¥åº·æ£€æŸ¥å¼‚å¸¸ï¼Œä¼šè§¦å‘å®¹å™¨è‡ªåŠ¨é‡å¯ æŸ¥è¯¢podæ‰€å±çš„èŠ‚ç‚¹ [root@node-1 demo]# kubectl get pods nginx-httpget-livess-readiness-probe -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-httpget-livess-readiness-probe 1/1 Running 1 3m9s 10.244.2.19 node-3 \u003cnone\u003e \u003cnone\u003e ç™»å½•åˆ°podä¸­å°†æ–‡ä»¶åˆ é™¤ [root@node-1 demo]# kubectl exec -it nginx-httpget-livess-readiness-probe /bin/bash root@nginx-httpget-livess-readiness-probe:/# ls -l /usr/share/nginx/html/index.html -rw-r--r-- 1 root root 612 Sep 24 14:49 /usr/share/nginx/html/index.html root@nginx-httpget-livess-readiness-probe:/# rm -f /usr/share/nginx/html/index.html å†æ¬¡æŸ¥çœ‹podçš„åˆ—è¡¨ï¼Œæ­¤æ—¶ä¼šRESTARTçš„æ¬¡æ•°ä¼šå¢åŠ 1ï¼Œè¡¨ç¤ºé‡å¯é‡å¯è¿‡ä¸€æ¬¡ï¼ŒAGEåˆ™å¤šä¹…å‰é‡å¯çš„æ—¶é—´ [root@node-1 demo]# kubectl get pods nginx-httpget-livess-readiness-probe NAME READY STATUS RESTARTS AGE nginx-httpget-livess-readiness-probe 1/1 Running 1 4m22s æŸ¥çœ‹podçš„è¯¦æƒ…ï¼Œè§‚å¯Ÿå®¹å™¨é‡å¯çš„æƒ…å†µï¼Œé€šè¿‡Liveness æ£€æŸ¥å®¹å™¨å‡ºç°404é”™è¯¯ï¼Œè§¦å‘é‡å¯ã€‚ [root@node-1 demo]# kubectl describe pods nginx-httpget-livess-readiness-probe | tail Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 5m45s default-scheduler Successfully assigned default/nginx-httpget-livess-readiness-probe to node-3 Normal Pulling 3m29s (x2 over 5m45s) kubelet, node-3 Pulling image \"nginx:latest\" Warning Unhealthy 3m29s (x3 over 3m49s) kubelet, node-3 Liveness probe failed: HTTP probe failed with statuscode: 404 Normal Killing 3m29s kubelet, node-3 Container nginx-httpget-livess-readiness-probe failed liveness probe, will be restarted Normal Pulled 3m25s (x2 over 5m41s) kubelet, node-3 Successfully pulled image \"nginx:latest\" Normal Created 3m25s (x2 over 5m40s) kubelet, node-3 Created container nginx-httpget-livess-readiness-probe Normal Started 3m25s (x2 over 5m40s) kubelet, node-3 Started container nginx-httpget-livess-readiness-probe ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:3:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 tcpSocketå¥åº·æ£€æŸ¥ tcpsocketå¥åº·æ£€æŸ¥é€‚ç”¨äºTCPä¸šåŠ¡ï¼Œé€šè¿‡å‘æŒ‡å®šå®¹å™¨å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ï¼Œå¯ä»¥å»ºç«‹è¿æ¥åˆ™å¥åº·æ£€æŸ¥æ­£å¸¸ï¼Œå¦åˆ™å¥åº·æ£€æŸ¥å¼‚å¸¸ï¼Œä¾æ—§ä»¥nignxä¸ºä¾‹ä½¿ç”¨tcpå¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œæ¢æµ‹80ç«¯å£çš„è¿é€šæ€§ [root@node-1 demo]# cat nginx-tcp-liveness.yaml apiVersion: v1 kind: Pod metadata: name: nginx-tcp-liveness-probe annotations: kubernetes.io/description: \"nginx-tcp-liveness-probe\" spec: containers: - name: nginx-tcp-liveness-probe image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 livenessProbe: #å¥åº·æ£€æŸ¥ä¸ºtcpSocketï¼Œæ¢æµ‹TCP 80ç«¯å£ tcpSocket: port: 80 initialDelaySeconds: 3 periodSeconds: 10 timeoutSeconds: 3 åº”ç”¨é…ç½®åˆ›å»ºå®¹å™¨ [root@node-1 demo]# kubectl apply -f nginx-tcp-liveness.yaml pod/nginx-tcp-liveness-probe created [root@node-1 demo]# kubectl get pods nginx-tcp-liveness-probe NAME READY STATUS RESTARTS AGE nginx-tcp-liveness-probe 1/1 Running 0 6s æ¨¡æ‹Ÿæ•…éšœï¼Œè·å–podæ‰€å±èŠ‚ç‚¹ï¼Œç™»å½•åˆ°podä¸­ï¼Œå®‰è£…æŸ¥çœ‹è¿›ç¨‹å·¥å…·htop è·å–podæ‰€åœ¨node [root@node-1 demo]# kubectl get pods nginx-tcp-liveness-probe -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-tcp-liveness-probe 1/1 Running 0 99s 10.244.2.20 node-3 \u003cnone\u003e \u003cnone\u003e ç™»å½•åˆ°podä¸­ [root@node-1 demo]# kubectl exec -it nginx-httpget-livess-readiness-probe /bin/bash #æ‰§è¡Œapt-get updateæ›´æ–°å’Œapt-get install htopå®‰è£…å·¥å…· root@nginx-httpget-livess-readiness-probe:/# apt-get update Get:1 http://cdn-fastly.deb.debian.org/debian buster InRelease [122 kB] Get:2 http://security-cdn.debian.org/debian-security buster/updates InRelease [39.1 kB] Get:3 http://cdn-fastly.deb.debian.org/debian buster-updates InRelease [49.3 kB] Get:4 http://security-cdn.debian.org/debian-security buster/updates/main amd64 Packages [95.7 kB] Get:5 http://cdn-fastly.deb.debian.org/debian buster/main amd64 Packages [7899 kB] Get:6 http://cdn-fastly.deb.debian.org/debian buster-updates/main amd64 Packages [5792 B] Fetched 8210 kB in 3s (3094 kB/s) Reading package lists... Done root@nginx-httpget-livess-readiness-probe:/# apt-get install htop Reading package lists... Done Building dependency tree Reading state information... Done Suggested packages: lsof strace The following NEW packages will be installed: htop 0 upgraded, 1 newly installed, 0 to remove and 5 not upgraded. Need to get 92.8 kB of archives. After this operation, 230 kB of additional disk space will be used. Get:1 http://cdn-fastly.deb.debian.org/debian buster/main amd64 htop amd64 2.2.0-1+b1 [92.8 kB] Fetched 92.8 kB in 0s (221 kB/s) debconf: delaying package configuration, since apt-utils is not installed Selecting previously unselected package htop. (Reading database ... 7203 files and directories currently installed.) Preparing to unpack .../htop_2.2.0-1+b1_amd64.deb ... Unpacking htop (2.2.0-1+b1) ... Setting up htop (2.2.0-1+b1) ... è¿è¡ŒhtopæŸ¥çœ‹è¿›ç¨‹ï¼Œå®¹å™¨è¿›ç¨‹é€šå¸¸ä¸º1 killæ‰è¿›ç¨‹è§‚å¯Ÿå®¹å™¨çŠ¶æ€ï¼Œè§‚å¯ŸRESTARTæ¬¡æ•°é‡å¯æ¬¡æ•°å¢åŠ  root@nginx-httpget-livess-readiness-probe:/# kill 1 root@nginx-httpget-livess-readiness-probe:/# command terminated with exit code 137 æŸ¥çœ‹podæƒ…å†µ [root@node-1 demo]# kubectl get pods nginx-tcp-liveness-probe NAME READY STATUS RESTARTS AGE nginx-tcp-liveness-probe 1/1 Running 1 13m æŸ¥çœ‹å®¹å™¨è¯¦æƒ…ï¼Œå‘ç°å®¹å™¨æœ‰é‡å¯çš„è®°å½• [root@node-1 demo]# kubectl describe pods nginx-tcp-liveness-probe | tail Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 14m default-scheduler Successfully assigned default/nginx-tcp-liveness-probe to node-3 Normal Pulling 44s (x2 over 14m) kubelet, node-3 Pulling image \"nginx:latest\" Normal Pulled 40s (x2 over 14m) kubelet, node-3 Successfully pulled image \"nginx:latest\" Normal Created 40s (x2 over 14m) kubelet, node-3 Created container nginx-tcp-liveness-probe Normal Started 40s (x2 over 14m) kubelet, node-3 Started container nginx-tcp-liveness-probe ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:4:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.5 readinesså¥åº·å°±ç»ª å°±ç»ªæ£€æŸ¥ç”¨äºåº”ç”¨æ¥å…¥åˆ°serviceçš„åœºæ™¯ï¼Œç”¨äºåˆ¤æ–­åº”ç”¨æ˜¯å¦å·²ç»å°±ç»ªå®Œæ¯•ï¼Œå³æ˜¯å¦å¯ä»¥æ¥å—å¤–éƒ¨è½¬å‘çš„æµé‡ï¼Œå¥åº·æ£€æŸ¥æ­£å¸¸åˆ™å°†podåŠ å…¥åˆ°serviceçš„endpointsä¸­ï¼Œå¥åº·æ£€æŸ¥å¼‚å¸¸åˆ™ä»serviceçš„endpointsä¸­åˆ é™¤ï¼Œé¿å…å½±å“ä¸šåŠ¡çš„è®¿é—®ã€‚ åˆ›å»ºä¸€ä¸ªpodï¼Œä½¿ç”¨httpGetçš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå®šä¹‰readinesså°±ç»ªæ£€æŸ¥æ¢é’ˆæ£€æŸ¥è·¯å¾„/test.html [root@node-1 demo]# cat httpget-liveness-readiness-probe.yaml apiVersion: v1 kind: Pod metadata: name: nginx-tcp-liveness-probe annotations: kubernetes.io/description: \"nginx-tcp-liveness-probe\" labels: #éœ€è¦å®šä¹‰labelsï¼Œåé¢å®šä¹‰çš„serviceéœ€è¦è°ƒç”¨ app: nginx spec: containers: - name: nginx-tcp-liveness-probe image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 livenessProbe: #å­˜æ´»æ£€æŸ¥æ¢é’ˆ httpGet: port: 80 path: /index.html scheme: HTTP initialDelaySeconds: 3 periodSeconds: 10 timeoutSeconds: 3 readinessProbe: #å°±ç»ªæ£€æŸ¥æ¢é’ˆ httpGet: port: 80 path: /test.html scheme: HTTP initialDelaySeconds: 3 periodSeconds: 10 timeoutSeconds: 3 å®šä¹‰ä¸€ä¸ªserviceï¼Œå°†ä¸Šè¿°çš„podåŠ å…¥åˆ°serviceä¸­ï¼Œæ³¨æ„ä½¿ç”¨ä¸Šè¿°å®šä¹‰çš„labelsï¼Œapp=nginx [root@node-1 demo]# cat nginx-service.yaml apiVersion: v1 kind: Service metadata: labels: app: nginx name: nginx-service spec: ports: - name: http port: 80 protocol: TCP targetPort: 80 selector: app: nginx type: ClusterIP ç”Ÿæˆé…ç½® [root@node-1 demo]# kubectl apply -f httpget-liveness-readiness-probe.yaml pod/nginx-tcp-liveness-probe created [root@node-1 demo]# kubectl apply -f nginx-service.yaml service/nginx-service created æ­¤æ—¶podçŠ¶æ€æ­£å¸¸ï¼Œæ­¤æ—¶readinesså¥åº·æ£€æŸ¥å¼‚å¸¸ [root@node-1 ~]# kubectl get pods nginx-httpget-livess-readiness-probe NAME READY STATUS RESTARTS AGE nginx-httpget-livess-readiness-probe 1/1 Running 2 153m #readinesså¥åº·æ£€æŸ¥å¼‚å¸¸ï¼Œ404æŠ¥é”™ï¼ˆæœ€åä¸€è¡Œï¼‰ [root@node-1 demo]# kubectl describe pods nginx-tcp-liveness-probe | tail node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 2m6s default-scheduler Successfully assigned default/nginx-tcp-liveness-probe to node-3 Normal Pulling 2m5s kubelet, node-3 Pulling image \"nginx:latest\" Normal Pulled 2m1s kubelet, node-3 Successfully pulled image \"nginx:latest\" Normal Created 2m1s kubelet, node-3 Created container nginx-tcp-liveness-probe Normal Started 2m1s kubelet, node-3 Started container nginx-tcp-liveness-probe Warning Unhealthy 2s (x12 over 112s) kubelet, node-3 Readiness probe failed: HTTP probe failed with statuscode: 404 æŸ¥çœ‹servicesçš„endpointsï¼Œå‘ç°æ­¤æ—¶endpointsä¸ºç©º,å› ä¸ºreadinesså°±ç»ªæ£€æŸ¥å¼‚å¸¸ï¼Œkubeletè®¤ä¸ºæ­¤æ—¶podå¹¶æœªå°±ç»ªï¼Œå› æ­¤å¹¶æœªå°†å…¶åŠ å…¥åˆ°endpointsä¸­ã€‚ [root@node-1 ~]# kubectl describe services nginx-service Name: nginx-service Namespace: default Labels: app=nginx Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{},\"labels\":{\"app\":\"nginx\"},\"name\":\"nginx-service\",\"namespace\":\"default\"},\"s... Selector: app=nginx Type: ClusterIP IP: 10.110.54.40 Port: http 80/TCP TargetPort: 80/TCP Endpoints: \u003cnone\u003e #Endpointså¯¹è±¡ä¸ºç©º Session Affinity: None Events: \u003cnone\u003e #endpointsçŠ¶æ€ [root@node-1 demo]# kubectl describe endpoints nginx-service Name: nginx-service Namespace: default Labels: app=nginx Annotations: endpoints.kubernetes.io/last-change-trigger-time: 2019-09-30T14:27:37Z Subsets: Addresses: \u003cnone\u003e NotReadyAddresses: 10.244.2.22 #podå¤„äºNotReadyçŠ¶æ€ Ports: Name Port Protocol ---- ---- -------- http 80 TCP Events: \u003cnone\u003e è¿›å…¥åˆ°podä¸­æ‰‹åŠ¨åˆ›å»ºç½‘ç«™æ–‡ä»¶ï¼Œä½¿readinesså¥åº·æ£€æŸ¥æ­£å¸¸ [root@node-1 ~]# kubectl exec -it nginx-httpget-livess-readiness-probe /bin/bash root@nginx-httpget-livess-readiness-probe:/# echo \"readiness probe demo\" \u003e/usr/share/nginx/html/test.html æ­¤æ—¶readinesså¥åº·æ£€æŸ¥æ­£å¸¸ï¼Œkubeletæ£€æµ‹åˆ°podå°±ç»ªä¼šå°†å…¶åŠ å…¥åˆ°endpointsä¸­ å¥åº·æ£€æŸ¥æ­£å¸¸ [root@node-1 demo]# curl http://10.244.2.22/test.html æŸ¥çœ‹endpointsæƒ…å†µ readines[root@node-1 demo]# kubectl describe endpoints nginx-service Name: nginx-service Namespace: default Labels: app=nginx Annotations: endpoints.kubernetes.io/last-change-trigger-time: 2019-09-30T14:33:01Z Subsets: Addresses: 10.244.2.22 #å°±ç»ªåœ°å€ï¼Œå·²ä»NotReadyä¸­æå‡ºï¼ŒåŠ å…¥åˆ°æ­£å¸¸çš„Addressåˆ—è¡¨ä¸­ NotReadyAddresses: \u003cnone\u003e Ports: Name Port Protocol ---- ---- -------- http 80 TCP æŸ¥çœ‹serviceçŠ¶æ€ [root@node-1 demo]# kubectl describe services nginx-service Name: nginx-service Namespace: default L","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:5:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.6 TKEè®¾ç½®å¥åº·æ£€æŸ¥ TKEä¸­å¯ä»¥è®¾å®šåº”ç”¨çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¥åº·æ£€æŸ¥æœºåˆ¶åŒ…å«åœ¨ä¸åŒçš„Workloadä¸­ï¼Œå¯ä»¥é€šè¿‡æ¨¡æ¿ç”Ÿæˆå¥åº·ç›‘æµ‹æœºåˆ¶ï¼Œå®šä¹‰è¿‡ç¨‹ä¸­å¯ä»¥é€‰æ‹©é«˜çº§é€‰é¡¹ï¼Œé»˜è®¤å¥åº·æ£€æŸ¥æœºåˆ¶æ˜¯å…³é—­çŠ¶æ€ï¼ŒåŒ…å«å‰é¢ä»‹ç»çš„ä¸¤ç§æ¢é’ˆï¼šå­˜æ´»æ¢é’ˆlivenessProbeå’Œå°±ç»ªæ¢é’ˆreadinessProbeï¼Œæ ¹æ®éœ€è¦åˆ†åˆ«å¼€å¯ TKEå¥åº·æ£€æŸ¥ å¼€å¯æ¢é’ˆä¹‹åè¿›å…¥è®¾ç½®å¥åº·æ£€æŸ¥ï¼Œæ”¯æŒä¸Šè¿°ä»‹ç»çš„ä¸‰ç§æ–¹æ³•ï¼šæ‰§è¡Œå‘½ä»¤æ£€æŸ¥ã€TCPç«¯å£æ£€æŸ¥ï¼ŒHTTPè¯·æ±‚æ£€æŸ¥ TKEå¥åº·æ£€æŸ¥æ–¹æ³• é€‰æ‹©ä¸åŒçš„æ£€æŸ¥æ–¹æ³•å¡«å†™ä¸åŒçš„å‚æ•°å³å¯ï¼Œå¦‚å¯åŠ¨é—´éš”ï¼Œæ£€æŸ¥é—´éš”ï¼Œå“åº”è¶…æ—¶ï¼Œç­‰å‚æ•°ï¼Œä»¥HTTPè¯·æ±‚æ£€æŸ¥æ–¹æ³•ä¸ºä¾‹ï¼š TKE httpå¥åº·æ£€æŸ¥æ–¹æ³• è®¾ç½®å®Œæˆååˆ›å»ºworkloadæ—¶å€™ä¼šè‡ªåŠ¨ç”Ÿæˆyamlæ–‡ä»¶ï¼Œä»¥åˆšåˆ›å»ºçš„deploymentä¸ºä¾‹ï¼Œç”Ÿæˆå¥åº·æ£€æŸ¥yamlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š apiVersion: apps/v1beta2 kind: Deployment metadata: annotations: deployment.kubernetes.io/revision: \"1\" description: tke-health-check-demo creationTimestamp: \"2019-09-30T12:28:42Z\" generation: 1 labels: k8s-app: tke-health-check-demo qcloud-app: tke-health-check-demo name: tke-health-check-demo namespace: default resourceVersion: \"2060365354\" selfLink: /apis/apps/v1beta2/namespaces/default/deployments/tke-health-check-demo uid: d6cf1f25-e37d-11e9-87fd-567eb17a3218 spec: minReadySeconds: 10 progressDeadlineSeconds: 600 replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: k8s-app: tke-health-check-demo qcloud-app: tke-health-check-demo strategy: rollingUpdate: maxSurge: 1 maxUnavailable: 0 type: RollingUpdate template: metadata: creationTimestamp: null labels: k8s-app: tke-health-check-demo qcloud-app: tke-health-check-demo spec: containers: - image: nginx:latest imagePullPolicy: Always livenessProbe: #é€šè¿‡æ¨¡æ¿ç”Ÿæˆçš„å¥åº·æ£€æŸ¥æœºåˆ¶ failureThreshold: 1 httpGet: path: / port: 80 scheme: HTTP periodSeconds: 3 successThreshold: 1 timeoutSeconds: 2 name: tke-health-check-demo resources: limits: cpu: 500m memory: 1Gi requests: cpu: 250m memory: 256Mi securityContext: privileged: false procMount: Default terminationMessagePath: /dev/termination-log terminationMessagePolicy: File dnsPolicy: ClusterFirst imagePullSecrets: - name: qcloudregistrykey - name: tencenthubkey restartPolicy: Always schedulerName: default-scheduler securityContext: {} terminationGracePeriodSeconds: 30 å†™åœ¨æœ€å æœ¬ç« ä»‹ç»kubernetesä¸­å¥åº·æ£€æŸ¥ä¸¤ç§Probeï¼šlivenessProbeå’ŒreadinessProbeï¼ŒlivenessProbeä¸»è¦ç”¨äºå­˜æ´»æ£€æŸ¥ï¼Œæ£€æŸ¥å®¹å™¨å†…éƒ¨è¿è¡ŒçŠ¶æ€ï¼Œreadinessä¸»è¦ç”¨äºå°±ç»ªæ£€æŸ¥ï¼Œæ˜¯å¦å¯ä»¥æ¥å—æµé‡ï¼Œé€šå¸¸éœ€è¦å’Œserviceçš„endpointsç»“åˆï¼Œå½“å°±ç»ªå‡†å¤‡å¦¥å½“æ—¶åŠ å…¥åˆ°endpointsä¸­ï¼Œå½“å°±ç»ªå¼‚å¸¸æ—¶ä»endpointsä¸­åˆ é™¤ï¼Œä»è€Œå®ç°äº†servicesçš„å¥åº·æ£€æŸ¥å’ŒæœåŠ¡æ¢æµ‹æœºåˆ¶ã€‚å¯¹äºProbeæœºåˆ¶æä¾›äº†ä¸‰ç§æ£€æµ‹çš„æ–¹æ³•ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒçš„åœºæ™¯ï¼š1. execå‘½ä»¤è¡Œï¼Œé€šè¿‡å‘½ä»¤æˆ–shellå®ç°å¥åº·æ£€æŸ¥ï¼Œ2. tcpSocketé€šè¿‡TCPåè®®æ¢æµ‹ç«¯å£ï¼Œå»ºç«‹tcpè¿æ¥ï¼Œ3. httpGeté€šè¿‡å»ºç«‹httpè¯·æ±‚æ¢æµ‹ï¼Œè¯»è€…å¯å¤šå®æ“æŒæ¡å…¶ç”¨æ³•ã€‚ é™„å½• å¥åº·æ£€æŸ¥ï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/ TKEå¥åº·æ£€æŸ¥è®¾ç½®æ–¹æ³•ï¼šhttps://cloud.tencent.com/document/product/457/32815 ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/:6:0","tags":["kubernetes"],"title":"08 Podå¥åº·æ£€æŸ¥æœºåˆ¶","uri":"/myBlog-2/post/08-pod%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%E6%9C%BA%E5%88%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆå…«ï¼‰Podå¥åº·æ£€æŸ¥æœºåˆ¶ä»‹ç»äº†kubernetesä¸­Podå¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œé€šè¿‡å®æˆ˜ä»‹ç»äº†kubernetesä¸­ä¸¤ç§å¥åº·æ£€æŸ¥æ¢é’ˆï¼šlivenessProbeå­˜æ´»æ£€æŸ¥ï¼ŒreadinessProbeå°±ç»ªæ£€æŸ¥ï¼Œå­˜æ´»æ£€æŸ¥ç”¨äºæ£€æŸ¥åº”ç”¨çš„å¯ç”¨æ€§ï¼Œå°±ç»ªæ£€æŸ¥ç”¨äºæ£€æŸ¥å®¹å™¨æ˜¯å¦å‡†å¤‡æ¥å—æµé‡ï¼Œå¥åº·æ£€æŸ¥åŒ…å«ä¸‰ç§æ¢æµ‹çš„æ–¹æ³•ï¼šexecå‘½ä»¤è¡Œæ¢æµ‹ï¼ŒtcpSocketç«¯å£æ£€æµ‹ï¼ŒhttpGetè¯·æ±‚æ£€æµ‹ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒåœºæ™¯ä¸‹çš„å¥åº·æ£€æŸ¥ã€‚æ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹podçš„å­˜å‚¨ç®¡ç†ã€‚ kuberneteså­˜å‚¨ç®¡ç†æŒ‰ç…§å‘å±•çš„å†ç¨‹ï¼Œæ¶‰åŠåˆ°æœ‰Volumeï¼ŒPV(Persistent Volume)å’ŒPVC(PersistentVolumeClaims),å’ŒStorageClassï¼ŒVolumeæ˜¯æœ€æ—©æå‡ºçš„å­˜å‚¨å·ï¼Œä¸»è¦è§£å†³å®¹å™¨å’Œæ•°æ®å­˜å‚¨çš„ä¾èµ–å…³ç³»ï¼ŒæŠ½è±¡åº•å±‚é©±åŠ¨ä»¥æ”¯æŒä¸åŒçš„å­˜å‚¨ç±»å‹ï¼›ä½¿ç”¨Volumeéœ€è¦äº†è§£åº•å±‚å­˜å‚¨ç»†èŠ‚ï¼Œå› æ­¤æå‡ºäº†PVï¼ŒPersistent Volumeæ˜¯ç”±k8sç®¡ç†å‘˜å®šä¹‰çš„å­˜å‚¨å•å…ƒï¼Œåº”ç”¨ç«¯ä½¿ç”¨PersistentVolumeClaimså£°æ˜å»è°ƒç”¨PVå­˜å‚¨ï¼Œè¿›ä¸€æ­¥æŠ½è±¡äº†åº•å±‚å­˜å‚¨ï¼›éšç€PVæ•°é‡çš„å¢åŠ ï¼Œç®¡ç†å‘˜éœ€è¦ä¸åœçš„å®šä¹‰PVçš„æ•°é‡ï¼Œè¡ç”Ÿäº†é€šè¿‡StorageClassåŠ¨æ€ç”ŸæˆPVï¼ŒStorageClassé€šè¿‡PVCä¸­å£°æ˜å­˜å‚¨çš„å®¹é‡ï¼Œä¼šè°ƒç”¨åº•å±‚çš„æä¾›å•†ç”ŸæˆPVã€‚æœ¬æ–‡ä»‹ç»Volumeçš„ä½¿ç”¨ï¼Œä¸‹ç¯‡æ–‡ç« ä»‹ç»PVï¼ŒPVCå’ŒStorageClassã€‚ Volume å­˜å‚¨å·ï¼Œç‹¬ç«‹äºå®¹å™¨ï¼Œåç«¯å’Œä¸åŒçš„å­˜å‚¨é©±åŠ¨å¯¹æ¥ PV Persistent VolumeæŒä¹…åŒ–å­˜å‚¨å·ï¼Œå’Œnodeç±»ä¼¼ï¼Œæ˜¯ä¸€ç§é›†ç¾¤èµ„æºï¼Œç”±ç®¡ç†å‘˜å®šä¹‰ï¼Œå¯¹æ¥ä¸åŒçš„å­˜å‚¨ PVC PersistentVolumeClaimsæŒä¹…åŒ–å­˜å‚¨å£°æ˜ï¼Œå’Œpodç±»ä¼¼ï¼Œä½œä¸ºPVçš„ä½¿ç”¨è€… StorageClass åŠ¨æ€å­˜å‚¨ç±»å‹ï¼Œåˆ†ä¸ºé™æ€å’ŒåŠ¨æ€ä¸¤ç§ç±»å‹ï¼Œé€šè¿‡åœ¨PVCä¸­å®šä¹‰å­˜å‚¨ç±»å‹ï¼Œè‡ªåŠ¨åˆ›å»ºæ‰€éœ€PV 1. kuberneteså­˜å‚¨ç®¡ç† ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:0:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 å­˜å‚¨æ¦‚è¿° kuberneteså®¹å™¨ä¸­çš„æ•°æ®æ˜¯ä¸´æ—¶çš„ï¼Œå³å½“é‡å¯é‡å¯æˆ–crashåå®¹å™¨çš„æ•°æ®å°†ä¼šä¸¢å¤±ï¼Œæ­¤å¤–å®¹å™¨ä¹‹é—´æœ‰å…±äº«å­˜å‚¨çš„éœ€æ±‚ï¼Œæ‰€ä»¥kubernetesä¸­æä¾›äº†volumeå­˜å‚¨çš„æŠ½è±¡ï¼Œvolumeåç«¯èƒ½å¤Ÿæ”¯æŒå¤šç§ä¸åŒçš„pluginé©±åŠ¨ï¼Œé€šè¿‡.spec.volumesä¸­å®šä¹‰ä¸€ä¸ªå­˜å‚¨ï¼Œç„¶ååœ¨å®¹å™¨ä¸­.spec.containers.volumeMountsè°ƒç”¨ï¼Œæœ€ç»ˆåœ¨å®¹å™¨å†…éƒ¨ä»¥ç›®å½•çš„å½¢å¼å‘ˆç°ã€‚ kuberneteså†…ç½®èƒ½æ”¯æŒå¤šç§ä¸åŒçš„é©±åŠ¨ç±»å‹ï¼Œå¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºå››ç§ç±»å‹ï¼š1. å…¬/ç§æœ‰äº‘é©±åŠ¨æ¥å£ï¼Œå¦‚awsElasticBlockStoreå®ç°ä¸aws EBSé›†æˆï¼Œ2. å¼€æºå­˜å‚¨é©±åŠ¨æ¥å£ï¼Œå¦‚ceph rbdï¼Œå®ç°ä¸ceph rbå—å­˜å‚¨å¯¹æ¥ï¼Œ3. æœ¬åœ°ä¸´æ—¶å­˜å‚¨ï¼Œå¦‚hostPathï¼Œ4. kuberneteså¯¹è±¡APIé©±åŠ¨æ¥å£ï¼Œå®ç°å…¶ä»–å¯¹è±¡è°ƒç”¨ï¼Œå¦‚configmapï¼Œæ¯ç§å­˜å‚¨æ”¯æŒä¸åŒçš„é©±åŠ¨ï¼Œå¦‚ä¸‹ä»‹ç»ï¼š å…¬/ç§æœ‰äº‘é©±åŠ¨æ¥å£ awsElasticBlockStore AWSçš„EBSäº‘ç›˜ azureDisk å¾®è½¯azureäº‘ç›˜ azureFile å¾®è½¯NASå­˜å‚¨ gcePersistentDisk googleäº‘ç›˜ cinder openstack cinderäº‘ç›˜ vsphereVolume VMwareçš„VMFSå­˜å‚¨ scaleIO EMCåˆ†å¸ƒå¼å­˜å‚¨ å¼€æºå­˜å‚¨é©±åŠ¨æ¥å£ ceph rbd cephå—å­˜å‚¨ cephfs cephæ–‡ä»¶å­˜å‚¨ glusterfs glusterfså­˜å‚¨ nfs nfsæ–‡ä»¶ iscsi flexvolume csi ç¤¾åŒºæ ‡å‡†åŒ–é©±åŠ¨ flocker æœ¬åœ°ä¸´æ—¶å­˜å‚¨ hostpath å®¿ä¸»æœºæ–‡ä»¶ emptyDir ä¸´æ—¶ç›®å½• kuberneteså¯¹è±¡APIé©±åŠ¨æ¥å£ configMap è°ƒç”¨configmapå¯¹è±¡ï¼Œæ³¨å…¥é…ç½®æ–‡ä»¶ secrets è°ƒç”¨secretså¯¹è±¡ï¼Œæ³¨å…¥ç§˜æ–‡é…ç½®æ–‡ä»¶ persistentVolumeClaim é€šè¿‡pvcè°ƒç”¨å­˜å‚¨ downloadAPI ä¸‹è½½URL projected ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:1:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 emptyDirä¸´æ—¶å­˜å‚¨ emptyDiræ˜¯ä¸€ç§ä¸´æ—¶å­˜å‚¨ï¼Œpodåˆ›å»ºçš„æ—¶å€™ä¼šåœ¨nodeèŠ‚ç‚¹ä¸Šä¸ºå®¹å™¨ç”³è¯·ä¸€ä¸ªä¸´æ—¶çš„ç›®å½•ï¼Œè·Ÿéšå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚å®¹å™¨åˆ é™¤ï¼ŒemptyDirå®šä¹‰çš„ä¸´æ—¶å­˜å‚¨ç©ºé—´ä¹Ÿä¼šéšä¹‹åˆ é™¤ï¼Œå®¹å™¨å‘ç”Ÿæ„å¤–crashåˆ™ä¸å—å½±å“ï¼ŒåŒæ—¶å¦‚æœå®¹å™¨å‘ç”Ÿäº†è¿ç§»ï¼Œå…¶ä¸Šçš„æ•°æ®ä¹Ÿä¼šä¸¢å¤±ï¼ŒemptyDirä¸€èˆ¬ç”¨äºæµ‹è¯•ï¼Œæˆ–è€…ç¼“å­˜åœºæ™¯ã€‚ å®šä¹‰ä¸€ä¸ªemptyDirå­˜å‚¨å¤§å°ä¸º1Gï¼Œå°†å…¶æŒ‚è½½åˆ°redisçš„/dataç›®å½•ä¸­ [root@node-1 happylau]# cat emptydir-redis.yaml apiVersion: v1 kind: Pod metadata: name: emptydir-redis labels: volume: emptydir annotations: kubernetes.io/storage: emptyDir spec: containers: - name: emptydir-redis image: redis:latest imagePullPolicy: IfNotPresent ports: - name: redis-6379-port protocol: TCP containerPort: 6379 volumeMounts: #å°†å®šä¹‰çš„é©±åŠ¨emptydir-redisæŒ‚è½½åˆ°å®¹å™¨çš„/dataç›®å½•ï¼Œé€šè¿‡åå­—æ–¹å¼å…³è” - name: emptydir-redis mountPath: /data volumes: #å®šä¹‰ä¸€ä¸ªå­˜å‚¨ï¼Œé©±åŠ¨ç±»å‹ä¸ºemptyDirï¼Œå¤§å°1G - name: emptydir-redis emptyDir: sizeLimit: 1Gi ç”Ÿæˆredis pod,å¹¶æŸ¥çœ‹describe podçš„è¯¦æƒ…ä¿¡æ¯ [root@node-1 happylau]# kubectl apply -f emptydir-redis.yaml pod/emptydir-redis created æ‰§è¡Œkubectl describe pods emptydir-redisæŸ¥çœ‹å®¹å™¨çš„å­˜å‚¨æŒ‚è½½ä¿¡æ¯ Containers: emptydir-redis: Container ID: docker://dddd9f3d0e395d784c08b712631d2b0c259bfdb30b0c655a0fc8021492f1ecf9 Image: redis:latest Image ID: docker-pullable://redis@sha256:cb379e1a076fcd3d3f09e10d7b47ca631fb98fb33149ab559fa02c1b11436345 Port: 6379/TCP Host Port: 0/TCP State: Running Started: Tue, 01 Oct 2019 11:04:30 +0800 Ready: True Restart Count: 0 Environment: \u003cnone\u003e Mounts: #æŒ‚è½½ä¿¡æ¯ï¼Œå°†emptydir-redisæŒ‚è½½åˆ°/dataç›®å½•ï¼Œä¸”æ˜¯rwè¯»å†™çŠ¶æ€ /data from emptydir-redis (rw) /var/run/secrets/kubernetes.io/serviceaccount from default-token-5qwmc (ro) Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled True Volumes: #å®šä¹‰äº†ä¸€ä¸ªEmptyDirç±»å‹çš„å­˜å‚¨ï¼Œå¤§å°ä¸º1Gi emptydir-redis: Type: EmptyDir (a temporary directory that shares a pod's lifetime) Medium: SizeLimit: 1Gi default-token-5qwmc: Type: Secret (a volume populated by a Secret) SecretName: default-token-5qwmc Optional: false å‘redisä¸­å†™å…¥æ•°æ® è·å–podçš„ipåœ°å€ [root@node-1 happylau]# kubectl get pods emptydir-redis -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES emptydir-redis 1/1 Running 1 17m 10.244.1.27 node-2 \u003cnone\u003e \u003cnone\u003e å®‰è£…å®¢æˆ·ç«¯redis-cli [root@node-1 ~]# yum install redis å‘redisä¸­å†™å…¥ä¸¤ä¸ªkey 10.244.1.27:6379\u003e set volume emptydir OK 10.244.1.27:6379\u003e set username happylauliu OK 10.244.1.27:6379\u003e get volume \"emptydir\" 10.244.1.27:6379\u003e get username \"happylauliu\" ç™»é™†åˆ°podä¸­å®‰è£…ä¸€ä¸ªæŸ¥çœ‹è¿›ç¨‹çš„å·¥å…·procpsï¼Œè¿›ç¨‹ä¸€èˆ¬ä¸º1ï¼Œå¦‚ä¸‹å›¾redis-serverè¿›ç¨‹ï¼Œå¯ä»¥ç›´æ¥killï¼Œè¿›ç¨‹è¢«killåkubeletä¼šè‡ªåŠ¨å°†è¿›ç¨‹é‡å¯ ç™»é™†å®¹å™¨ [root@node-1 ~]# kubectl exec -it emptydir-redis /bin/bash å®‰è£…è½¯ä»¶ root@emptydir-redis:/data# apt-get update ; apt-get install procps å¯ä»¥é€šè¿‡topæŸ¥çœ‹è¿›ç¨‹ï¼Œè¿›ç¨‹å·ä¸€èˆ¬ä¸º1 root@emptydir-redis:/data# kill 1 podå¼‚å¸¸é‡å¯åï¼Œå†æ¬¡ç™»å½•rediså¹¶æŸ¥çœ‹redisä¸­çš„æ•°æ®å†…å®¹ï¼Œå‘ç°æ•°æ®æ²¡æœ‰ä¸¢å¤±ã€‚ [root@node-1 ~]# redis-cli -h 10.244.1.27 10.244.1.27:6379\u003e get volume \"emptydir\" 10.244.1.27:6379\u003e get username \"happylauliu\" emptyDirå®é™…æ˜¯å®¿ä¸»æœºä¸Šåˆ›å»ºçš„ä¸€ä¸ªç›®å½•ï¼Œå°†ç›®å½•ä»¥bind mountçš„å½¢åŠ¿æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œè·Ÿéšå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ [root@node-2 ~]# docker container list |grep redis e0e9a6b0ed77 01a52b3b5cd1 \"docker-entrypoint.sâ€¦\" 20 minutes ago Up 20 minutes k8s_emptydir-redis_emptydir-redis_default_4baadb25-1e62-4cf5-9724-821d04dcdd44_2 dfef32905fe5 k8s.gcr.io/pause:3.1 \"/pause\" 45 minutes ago Up 45 minutes k8s_POD_emptydir-redis_default_4baadb25-1e62-4cf5-9724-821d04dcdd44_0 docker container inspect e0e9a6b0ed77æŸ¥çœ‹å­˜å‚¨å†…å®¹å¦‚ä¸‹å›¾ï¼š æŸ¥çœ‹ç›®å½•çš„ä¿¡æ¯ï¼š [root@node-2 ~]# ls -l /var/lib/kubelet/pods/4baadb25-1e62-4cf5-9724-821d04dcdd44/volumes/kubernetes.io~empty-dir/emptydir-redis æ€»ç”¨é‡ 4 -rw-r--r-- 1 polkitd input 156 10æœˆ 8 14:55 dump.rdb Podåˆ é™¤åï¼Œvolumeçš„ä¿¡æ¯ä¹Ÿéšä¹‹åˆ é™¤ [root@node-1 ~]# kubectl delete pods emptydir-redis pod \"emptydir-redis\" deleted [root@node-1 ~]# ssh node-2 Last login: Tue Oct 8 15:15:41 2019 from 10.254.100.101 [root@node-2 ~]# ls -l /var/lib/kubelet/pods/4baadb25-1e62-4cf5-9724-821d04dcdd44/volumes/kubernetes.io~empty-dir/emptydir-redis ls: æ— æ³•è®¿é—®/var/lib/kubelet/pods/4baadb25-1e62-4cf5-9724-821d04dcdd44/volumes/kubernetes.io~empty-dir/emptydir-redis: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½• å°ç»“ï¼šemptyDiræ˜¯hostä¸Šå®šä¹‰çš„ä¸€å—ä¸´æ—¶å­˜å‚¨ï¼Œé€šè¿‡bind mountçš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­ä½¿ç”¨ï¼Œå®¹å™¨é‡å¯æ•°æ®ä¼šä¿ç•™ï¼Œå®¹å™¨åˆ é™¤åˆ™volumeä¼šéšä¹‹åˆ é™¤ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:2:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 hostPathä¸»æœºå­˜å‚¨ ä¸emptyDirç±»ä¼¼ï¼Œhostpathæ”¯æŒå°†nodeèŠ‚ç‚¹çš„ç›®å½•æˆ–æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­ä½¿ç”¨ï¼Œç”¨äºå•æœºæµ‹è¯•åœºæ™¯ï¼Œæ­¤å¤–é€‚ç”¨äºä¸€äº›å®¹å™¨ä¸šåŠ¡éœ€è¦è®¿é—®å®¿ä¸»æœºç›®å½•ï¼Œå¦‚ç›‘æ§ç³»ç»Ÿè®¿é—®/procå’Œ/sysç›®å½•ï¼Œæ—¥å¿—ç³»ç»Ÿè®¿é—®/var/lib/dockerç›®å½•çš„ä¸€äº›åœºæ™¯ã€‚æ”¯æŒè®¾ç½®ä¸åŒçš„typeç±»å‹ Directory æœ¬åœ°å­˜åœ¨çš„ç›®å½• DirectoryOrCreate ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œæƒé™è®¾ç½®ä¸º755ï¼Œå±ä¸»å’Œç»„è®¾ç½®å’Œkubeletä¸€è‡´ File æœ¬åœ°å­˜åœ¨æ–‡ä»¶ FileOrCreate æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œæƒé™è®¾ç½®ä¸º644ï¼Œå±ä¸»å’Œç»„è®¾ç½®å’Œkubeletä¸€è‡´ Socket æœ¬åœ°å·²å­˜åœ¨Socketæ–‡ä»¶ CharDevice æœ¬åœ°å·²å­˜åœ¨çš„Charå­—ç¬¦è®¾å¤‡ BlockDevice æœ¬åœ°å·²å­˜åœ¨çš„Blockå—è®¾å¤‡ æŒ‚è½½æœ¬åœ°/mntç›®å½•åˆ°å®¹å™¨ä¸­ [root@node-1 happylau]# cat hostpath-demo.yaml apiVersion: v1 kind: Pod metadata: name: hostpath-demo labels: storage: hostpath annotations: kubernetes.io/storage: hostpath spec: containers: - name: nginx image: nginx:latest imagePullPolicy: IfNotPresent ports: - name: nginx-http-port protocol: TCP containerPort: 80 volumeMounts: #æŒ‚è½½åˆ°nginxçš„webç«™ç‚¹ç›®å½•ä¸‹ - name: hostpath-demo mountPath: /usr/share/nginx/html volumes: #å®šä¸€ä¸ªhostPathæœ¬åœ°çš„å­˜å‚¨ - name: hostpath-demo hostPath: type: DirectoryOrCreate path: /mnt/data ç”Ÿæˆnginxå®¹å™¨å’Œwebç«™ç‚¹æ•°æ® [root@node-1 happylau]# kubectl apply -f hostpath-demo.yaml pod/hostpath-demo created è·å–podæ‰€åœ¨çš„nodeèŠ‚ç‚¹ [root@node-1 happylau]# kubectl get pods hostpath-demo -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES hostpath-demo 1/1 Running 0 31s 10.244.2.24 node-3 \u003cnone\u003e \u003cnone\u003e ç”Ÿæˆwebç«™ç‚¹çš„æ•°æ® [root@node-1 happylau]# ssh node-3 Last login: Tue Oct 8 22:49:14 2019 from 10.254.100.101 [root@node-3 ~]# echo \"hostPath test page\" \u003e/mnt/data/index.html [root@node-3 ~]# curl http://10.244.2.24 hostPath test page æŸ¥çœ‹å®¹å™¨æŒ‚è½½å­˜å‚¨çš„æƒ…å†µï¼Œä»¥bind mountçš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨ä¸­ æ¨¡æ‹Ÿå®¹å™¨é‡å¯çš„çš„æ•…éšœï¼Œå®¹å™¨é‡å¯åvolumeä¸­çš„æ•°æ®ä¾ä¿ç•™ #dockerå±‚é¢killæ‰è¿›ç¨‹ [root@node-3 ~]# docker container list |grep hostpath 39a7e21afebb f949e7d76d63 \"nginx -g 'daemon ofâ€¦\" 11 minutes ago Up 11 minutes k8s_nginx_hostpath-demo_default_6da41e3d-8585-4997-bf90-255ca0948030_0 490f50108e41 k8s.gcr.io/pause:3.1 \"/pause\" 11 minutes ago Up 11 minutes k8s_POD_hostpath-demo_default_6da41e3d-8585-4997-bf90-255ca0948030_0 [root@node-3 ~]# docker container kill 39a7e21afebb 39a7e21afebb [root@node-3 ~]# exit ç™»å‡º #è·å–podçš„åœ°å€ï¼Œé€šè¿‡RESTARTå¯çŸ¥ï¼Œå®¹å™¨é‡å¯è¿‡ä¸€æ¬¡ï¼Œæµ‹è¯•æ•°æ®ä¾æ—§ä¿ç•™ [root@node-1 happylau]# kubectl get pods -o wide hostpath-demo NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES hostpath-demo 1/1 Running 1 12m 10.244.2.24 node-3 \u003cnone\u003e \u003cnone\u003e [root@node-1 happylau]# curl http://10.244.2.24 hostPath test page å°ç»“ï¼šhostPathä¸emptyDirç±»ä¼¼æä¾›ä¸´æ—¶çš„å­˜å‚¨ï¼ŒhostPathé€‚ç”¨äºä¸€äº›å®¹å™¨éœ€è¦è®¿é—®å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶çš„åœºæ™¯ï¼Œå¯¹äºæ•°æ®æŒä¹…åŒ–è€Œè¨€éƒ½ä¸æ˜¯å¾ˆå¥½çš„å®ç°æ–¹æ¡ˆã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:3:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 NFSå­˜å‚¨å¯¹æ¥ NFSæ˜¯å®ç°Network File Systemç½‘ç»œæ–‡ä»¶å…±äº«çš„NASå­˜å‚¨ï¼Œkubernetesä¸NFSå¯¹æ¥å®ç°å­˜å‚¨çš„å…±äº«ï¼Œå½“å®¹å™¨åˆ é™¤ä¸å½±å“å­˜å‚¨ä¸”å¯ä»¥å®ç°è·¨æœºå­˜å‚¨å…±äº«ï¼Œæœ¬æ–‡ä»¥æ­å»ºä¸€ä¸ªNFSå­˜å‚¨å®ç°kuberneteså¯¹æ¥ã€‚ å‡†å¤‡ä¸€ä¸ªnfs serverå…±äº«ï¼Œå°†node-1çš„/mnt/dataç›®å½•å…±äº« å®‰è£…nfsæœåŠ¡ [root@node-1 ~]# yum install nfs-utils -y é…ç½®nfså…±äº«,æå‰åˆ›å»ºå¥½ç›®å½• [root@node-1 ~]# cat /etc/exports /mnt/data 10.254.100.0/24(rw) é‡å¯å¹¶éªŒè¯ [root@node-1 ~]# systemctl restart nfs [root@node-1 ~]# showmount -e node-1 Export list for node-1: /mnt/data 10.254.100.0/24 kubernetsä½¿ç”¨nfsçš„é©±åŠ¨å¯¹æ¥ [root@node-1 happylau]# cat nfs-demo.yaml apiVersion: v1 kind: Pod metadata: name: nfs-demo labels: storage: nfs annotations: kubernetes.io/storage: nfs spec: containers: - name: nginx image: nginx:latest imagePullPolicy: IfNotPresent ports: - name: nginx-http-port protocol: TCP containerPort: 80 volumeMounts: #æŒ‚è½½åˆ°nfsçš„ç›®å½•ä¸‹ - name: nfs-demo mountPath: /usr/share/nginx/html volumes: #å®šä¹‰ä¸€ä¸ªnfsé©±åŠ¨çš„å­˜å‚¨ - name: nfs-demo nfs: server: 10.254.100.101 path: /mnt/data ç”Ÿæˆpodï¼Œä½¿ç”¨kubectl get podsçš„æ—¶å€™æç¤ºeventsä¸­æŠ¥é”™ä¿¡æ¯ï¼ŒæŒ‚è½½å¤±è´¥ Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 40s default-scheduler Successfully assigned default/nfs-demo to node-2 Warning FailedMount 39s kubelet, node-2 MountVolume.SetUp failed for volume \"nfs-demo\" : mount failed: exit status 32 Mounting command: systemd-run Mounting arguments: --description=Kubernetes transient mount for /var/lib/kubelet/pods/78bf6a81-082d-4d6c-a163-75241bf21cde/volumes/kubernetes.io~nfs/nfs-demo --scope -- mount -t nfs 10.254.100.101:/mnt/data /var/lib/kubelet/pods/78bf6a81-082d-4d6c-a163-75241bf21cde/volumes/kubernetes.io~nfs/nfs-demo Output: Running scope as unit run-29843.scope. mount: wrong fs type, bad option, bad superblock on 10.254.100.101:/mnt/data, missing codepage or helper program, or other error (for several filesystems (e.g. nfs, cifs) you might need a /sbin/mount.\u003ctype\u003e helper program) ä»ä¸Šé¢çš„æ­¥éª¤ä¸­å¾—çŸ¥ï¼Œå®¿ä¸»æœºæŒ‚è½½nfsçš„æ—¶å€™æç¤ºæ²¡æœ‰mount.nfsçš„å‘½ä»¤ï¼Œå› æ­¤éœ€è¦åœ¨æ‰€æœ‰çš„nodeèŠ‚ç‚¹ä¸Šå®‰è£…ä¸Šnfsçš„å®¢æˆ·ç«¯è½¯ä»¶nfs-utils,ä»¥node-2ä¸ºä¾‹ï¼Œå…¶ä»–èŠ‚ç‚¹ç±»ä¼¼ [root@node-1 happylau]# ssh node-2 Last login: Tue Oct 8 15:22:04 2019 from 10.254.100.101 [root@node-2 ~]# yum install nfs-utils -y æµ‹è¯•ç«™ç‚¹æ•°æ® [root@node-1 happylau]# kubectl get pods nfs-demo -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nfs-demo 1/1 Running 0 4m41s 10.244.1.28 node-2 \u003cnone\u003e \u003cnone\u003e [root@node-1 happylau]# echo \"nfs test age\" \u003e/mnt/data/index.html [root@node-1 happylau]# curl http://10.244.1.28 nfs test age åˆ é™¤podåæŸ¥çœ‹nfså…±äº«çš„æ•°æ®æƒ…å†µ,åŸæœ‰æ•°æ®ä¾æ—§ä¿ç•™ [root@node-1 happylau]# kubectl delete pods nfs-demo pod \"nfs-demo\" deleted [root@node-1 happylau]# mount.nfs node-1:/mnt/data/ /media/ [root@node-1 happylau]# ls -l /media/ æ€»ç”¨é‡ 4 -rw-r--r-- 1 root root 13 10æœˆ 8 23:26 index.html ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:4:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.5 TKEä½¿ç”¨volumeå­˜å‚¨ TKEæ”¯æŒåœ¨åˆ›å»ºWorkloadæ—¶å¦‚Deploymentsï¼ŒDaemonSetsï¼ŒStatefulSetsç­‰æŒ‡å®šå­˜å‚¨å·ï¼Œæ”¯æŒä¸´æ—¶ç›®å½•emptyDirï¼Œä¸»æœºè·¯å¾„hostPathï¼Œnfsç›˜ï¼Œpvcï¼Œäº‘ç¡¬ç›˜ï¼Œconfigmapï¼Œsecretsï¼Œæ­¤å¤„ä»¥è…¾è®¯äº‘CFSä¸ºä¾‹ï¼ˆæå‰åœ¨CFSä¸­åˆ›å»ºå¥½å­˜å‚¨ï¼Œç¡®ä¿CFSå’Œå®¹å™¨å®¿ä¸»æœºåœ¨åŒä¸€ä¸ªVPCç½‘ç»œå†…ï¼‰ã€‚ åˆ›å»ºå­˜å‚¨å·ï¼Œä½¿ç”¨NFSæŒ‚è½½è…¾è®¯äº‘CFSå­˜å‚¨ Podä¸­ä½¿ç”¨å­˜å‚¨ï¼Œé€šè¿‡volume-nfs-demoåå­—è°ƒç”¨å­˜å‚¨å· å¯¹åº”ç”Ÿæˆçš„yamlæ–‡ä»¶å†…å®¹å¦‚ä¸‹ apiVersion: apps/v1beta2 kind: Deployment metadata: annotations: deployment.kubernetes.io/revision: \"1\" description: demo creationTimestamp: \"2019-10-08T15:45:18Z\" generation: 1 labels: k8s-app: the-volume-demo qcloud-app: the-volume-demo name: the-volume-demo namespace: default resourceVersion: \"618380753\" selfLink: /apis/apps/v1beta2/namespaces/default/deployments/the-volume-demo uid: a0fc4600-e9e2-11e9-b3f4-decf0ef369cf spec: minReadySeconds: 10 progressDeadlineSeconds: 600 replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: k8s-app: the-volume-demo qcloud-app: the-volume-demo strategy: rollingUpdate: maxSurge: 1 maxUnavailable: 0 type: RollingUpdate template: metadata: creationTimestamp: null labels: k8s-app: the-volume-demo qcloud-app: the-volume-demo spec: containers: - image: nginx:latest imagePullPolicy: Always name: nginx-demo resources: limits: cpu: 500m memory: 1Gi requests: cpu: 250m memory: 256Mi securityContext: privileged: false terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMounts: #æŒ‚è½½åˆ°podä¸­ - mountPath: /usr/share/nginx/html name: volume-nfs-demo dnsPolicy: ClusterFirst imagePullSecrets: - name: qcloudregistrykey - name: tencenthubkey restartPolicy: Always schedulerName: default-scheduler securityContext: {} terminationGracePeriodSeconds: 30 volumes: #CFSå­˜å‚¨ - name: volume-nfs-demo nfs: path: / server: 10.66.200.7 å†™åœ¨æœ€å æœ¬æ–‡ä»‹ç»äº†kuberneteså­˜å‚¨ä¸­æœ€åŸºæœ¬volumeçš„ä½¿ç”¨ï¼Œä»‹ç»äº†volumeæ”¯æŒå¤šç§ä¸åŒé©±åŠ¨ï¼Œä»¥å®é™…æ¡ˆä¾‹ä»‹ç»emptyDirï¼ŒhostPathï¼Œnfsé©±åŠ¨çš„å¯¹æ¥ï¼Œå¹¶ä»‹ç»äº†TKEä¸‹volumeåŠŸèƒ½çš„ä½¿ç”¨ã€‚ç”±äºvolumeéœ€è¦çŸ¥é“åº•å±‚å­˜å‚¨çš„ç»†èŠ‚ï¼Œä¸ä¾¿äºå¹¿æ³›ä½¿ç”¨ï¼Œåæ¥è¡ç”Ÿä¸ºPVï¼Œç®¡ç†å‘˜å®šä¹‰PVå®ç°å’Œåº•å±‚å­˜å‚¨å¯¹æ¥ï¼Œç”¨æˆ·é€šè¿‡PVCä½¿ç”¨PVï¼Œä¸‹èŠ‚æˆ‘ä»¬å°†ä»‹ç»PV/PVCå’ŒStorageClassçš„ä½¿ç”¨ã€‚ å‚è€ƒæ–‡çŒ® volumeç®¡ç†ï¼šhttps://kubernetes.io/docs/concepts/storage/volumes/ podä¸­ä½¿ç”¨volumeï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/configure-volume-storage/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/:5:0","tags":["kubernetes"],"title":"09 åˆè¯†Podå­˜å‚¨ç®¡ç†","uri":"/myBlog-2/post/09-%E5%88%9D%E8%AF%86pod%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆä¹ï¼‰åˆè¯†Podå­˜å‚¨ç®¡ç†ä»‹ç»äº†kubernetesä¸­å­˜å‚¨Volumeçš„ä½¿ç”¨ï¼Œvolumeæ”¯æŒå¤šç§ä¸åŒçš„å†…ç½®é©±åŠ¨ï¼Œä½¿ç”¨volumeséœ€è¦çŸ¥é“åç«¯é©±åŠ¨çš„ç»†èŠ‚ï¼Œä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ï¼Œå› æ­¤ç¤¾åŒºæå‡ºäº†PVæ¦‚å¿µï¼Œå³é€šè¿‡ç®¡ç†å‘˜å®šä¹‰å¥½PVï¼Œé€šè¿‡PVCä½¿ç”¨PVï¼›éšç€PVæ•°é‡çš„ä¸æ–­å¢åŠ ï¼Œç®¡ç†å‘˜éœ€è¦é¢‘ç¹å®šä¹‰PVï¼Œå› æ­¤æå‡ºäº†åŠ¨æ€å­˜å‚¨StorageClassï¼Œé€šè¿‡PVCä¸­è°ƒç”¨StorageClassåŠ¨æ€åˆ›å»ºPVï¼Œæ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹é«˜çº§è¿›é˜¶PV/PVCã€‚ 1. PVä¸PVCå­˜å‚¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/:0:0","tags":["kubernetes"],"title":"10 æ·±å…¥å­¦ä¹ æŒä¹…åŒ–å­˜å‚¨PVå’ŒPVC","uri":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 PVæ¦‚å¿µä»‹ç» PVå³PersistentVolumeæŒä¹…åŒ–å­˜å‚¨ï¼Œæ˜¯ç®¡ç†å‘˜å®šä¹‰çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œèƒ½æŠ½è±¡åŒ–åº•å±‚å­˜å‚¨ç»†èŠ‚ï¼Œå’Œnodeç±»ä¼¼ï¼ŒPVæ˜¯é›†ç¾¤çº§åˆ«çš„èµ„æºï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºPodï¼Œæ”¯æŒé™æ€åˆ›å»ºå’ŒåŠ¨æ€åˆ›å»ºï¼ŒåŠ¨æ€åˆ›å»ºéœ€é€šè¿‡StorageClassã€‚ PVCå³PersistentVolumeClaimæŒä¹…åŒ–å­˜å‚¨ç”³æ˜ï¼Œä½œä¸ºPVèµ„æºçš„ä½¿ç”¨æ–¹ï¼Œå¯ä»¥æŒ‡å®šè¯·æ±‚å­˜å‚¨å®¹é‡å¤§å°å’Œè®¿é—®æ¨¡å¼ StorageClassï¼Œå­˜å‚¨ç±»å‹æ”¯æŒåˆ›å»ºPVï¼Œé€šè¿‡åœ¨PVCä¸­æŒ‡å®šStorageClasså¯åŠ¨æ€åˆ›å»ºPVï¼Œä¸”æ”¯æŒæŒ‡å®šä¸åŒçš„å­˜å‚¨ PVæ”¯æŒè®¾ç½®å­—æ®µä»‹ç»ï¼š Capacity å­˜å‚¨çš„ç‰¹æ€§ï¼Œå½“å‰åªæ”¯æŒé€šè¿‡capacityæŒ‡å®šå­˜å‚¨å¤§å°ï¼Œæœªæ¥ä¼šæ”¯æŒIOPSï¼Œååé‡ç­‰æŒ‡æ ‡ VolumeMode å­˜å‚¨å·çš„ç±»å‹ï¼Œé»˜è®¤ä¸ºfilesystemï¼Œå¦‚æœæ˜¯å—è®¾å¤‡æŒ‡å®šä¸ºblock Class é€šè¿‡storageClassNameæŒ‡å®šé™æ€StorageClassçš„åç§° Reclaim Policy å›æ”¶ç­–ç•¥ï¼Œæ”¯æŒRetainä¿ç•™ï¼ŒRecycleå›æ”¶ï¼ŒDELETEåˆ é™¤ Volumeé©±åŠ¨ç±»å‹ï¼Œå’Œä¸Šä¸€ç¯‡æ–‡ç« ä»‹ç»çš„ç±»ä¼¼ï¼Œæ”¯æŒä¸åŒçš„pluginé©±åŠ¨å¦‚RBDï¼ŒNFS Mount Options æŒ‚è½½æ¨¡å¼ï¼Œæ”¯æŒç®¡ç†å‘˜å®šä¹‰ä¸åŒçš„æŒ‚è½½é€‰é¡¹ AccessMode è®¿é—®æ¨¡å¼ï¼ŒæŒ‡å®šnodeçš„æŒ‚è½½æ–¹å¼ï¼Œæ”¯æŒReadWriteOnceè¯»å†™æŒ‚è½½ä¸€æ¬¡ï¼ŒReadOnlyManyå¤šä¸ªèŠ‚ç‚¹æŒ‚è½½åªè¯»æ¨¡å¼ï¼ŒReadWriteManyå¤šä¸ªèŠ‚ç‚¹æŒ‚è½½è¯»å†™æ¨¡å¼ï¼Œä¸åŒçš„volumeé©±åŠ¨ç±»å‹æ”¯æŒçš„æ¨¡å¼æœ‰æ‰€ä¸åŒï¼Œå¦‚ä¸‹ ","date":"2019-08-04","objectID":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/:1:0","tags":["kubernetes"],"title":"10 æ·±å…¥å­¦ä¹ æŒä¹…åŒ–å­˜å‚¨PVå’ŒPVC","uri":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 å®šä¹‰PVå­˜å‚¨ æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å­¦ä¹ PVçš„ä½¿ç”¨ï¼Œä½¿ç”¨é˜¶æ®µåˆ†ä¸ºï¼š1. é¢„å…ˆåˆ›å»ºå¥½PVï¼Œ2. ç”¨æˆ·é€šè¿‡PVCè°ƒç”¨PVï¼Œ3. Podä¸­åº”ç”¨PVCï¼Œåˆ›å»ºæµç¨‹å‚è€ƒä¸‹å›¾ï¼š \\1. å®šä¹‰ä¸€ä¸ªPVï¼ŒæŒ‡å®šå¤§å°ä¸º10Gï¼Œè¯»å†™æ¨¡å¼ä¸ºå•ä¸ªnodeè¯»å†™ï¼Œå›æ”¶æ¨¡å¼ä¸ºRetainï¼Œåç«¯é©±åŠ¨pluginä¸ºNFS [root@node-1 happylau]# cat pv-nfs-storage.yaml apiVersion: v1 kind: PersistentVolume metadata: name: pv-nfs-storage labels: storage: nfs annotations: kubernetes.io.description: pv-storage spec: storageClassName: nfs #é™æ€æŒ‡å®šå­˜å‚¨ç±»StorageClassåç§° capacity: #capacityæŒ‡å®šå­˜å‚¨å®¹é‡å¤§å° storage: 10Gi accessModes: #è®¿é—®æ¨¡å¼ä¸ºå•ä¸ªèŠ‚ç‚¹è¯»å†™æ¨¡å¼ - ReadWriteOnce persistentVolumeReclaimPolicy: Retain #å›æ”¶æ¨¡å¼ä¸ºä¿ç•™ nfs: #åç«¯pluginé©±åŠ¨ç±»å‹ä¸ºNFSï¼ŒæŒ‡å®šserverå’Œpathè·¯å¾„ server: 10.254.100.101 path: /mnt/data \\2. åˆ›å»ºPersistentVolumes [root@node-1 happylau]# kubectl apply -f pv-nfs-storage.yaml persistentvolume/pv-nfs-storage unchanged \\3. æŸ¥çœ‹PersistentVolumesåˆ—è¡¨ [root@node-1 happylau]# kubectl get persistentvolumes NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE pv-nfs-storage 10Gi RWO Retain Available nfs 43m å…³äºPVè¾“å‡ºè§£é‡Šè¯´æ˜ï¼š ACCESS MODES æŒ‡å®šçš„æ˜¯è¯»å†™æ¨¡å¼ï¼ŒRWOä»£è¡¨ReadWriteOnceï¼ŒROMä»£è¡¨ReadOnlyManyï¼ŒRWXä»£è¡¨ReadWriteMany STATUSä»£è¡¨PVçŠ¶æ€ï¼ŒAvailableåˆšåˆ›å»ºæœªç»‘å®šçŠ¶æ€ï¼ŒBoundä¸ºä¸PVCç»‘å®šï¼ŒReleasedä¸ºPVCåˆ é™¤PVæœªé‡Šæ”¾ï¼ŒFailedçŠ¶æ€å¼‚å¸¸ã€‚ \\4. æŸ¥çœ‹PVè¯¦ç»†ä¿¡æ¯,å‘ˆç°çš„ä¿¡æ¯ä¼šæ›´è¯¦ç»† [root@node-1 ~]# kubectl describe persistentvolumes pv-nfs-storage Name: pv-nfs-storage Labels: storage=nfs Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"PersistentVolume\",\"metadata\":{\"annotations\":{\"kubernetes.io.description\":\"pv-storage\"},\"labels\":{\"storage\":\"nfs... kubernetes.io.description: pv-storage Finalizers: [kubernetes.io/pv-protection] StorageClass: nfs Status: Available Claim: Reclaim Policy: Retain Access Modes: RWO VolumeMode: Filesystem Capacity: 10Gi Node Affinity: \u003cnone\u003e Message: Source: Type: NFS (an NFS mount that lasts the lifetime of a pod) Server: 10.254.100.101 Path: /mnt/data ReadOnly: false Events: \u003cnone\u003e ","date":"2019-08-04","objectID":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/:2:0","tags":["kubernetes"],"title":"10 æ·±å…¥å­¦ä¹ æŒä¹…åŒ–å­˜å‚¨PVå’ŒPVC","uri":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3. PVCå¼•ç”¨PV \\1. é€šè¿‡å®šä¹‰PVCï¼Œé€šè¿‡selectorå’ŒPVå®ç°å…³è”ï¼ŒæŒ‡å®šåˆ°ç›¸åŒçš„StorageClass [root@node-1 happylau]# cat pvc-nfs-storage.yaml apiVersion: v1 kind: PersistentVolumeClaim metadata: name: pvc-nfs-storage labels: storage: pvc annotations: kubernetes.io/description: \"PersistentVolumeClaim for PV\" spec: accessModes: - ReadWriteOnce volumeMode: Filesystem storageClassName: nfs resources: requests: storage: 1Gi limits: storage: 10Gi selector: matchLabels: storage: nfs \\2. ç”ŸæˆPersistentVolumeClaim [root@node-1 happylau]# kubectl apply -f pvc-nfs-storage.yaml persistentvolumeclaim/pvc-nfs-storage created \\3. æŸ¥çœ‹PersistentVolumeClaimåˆ—è¡¨,é€šè¿‡STATUSå¯ä»¥çŸ¥é“ï¼Œå½“å‰PVCå’ŒPVå·²ç»Bondå…³è” [root@node-1 happylau]# kubectl get persistentvolumeclaims NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE pvc-nfs-storage Bound pv-nfs-storage 10Gi RWO nfs æŸ¥çœ‹PVCè¯¦æƒ…ï¼š [root@node-1 happylau]# kubectl describe persistentvolumeclaims pvc-nfs-storage Name: pvc-nfs-storage Namespace: default StorageClass: nfs Status: Bound Volume: pv-nfs-storage Labels: storage=pvc Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"PersistentVolumeClaim\",\"metadata\":{\"annotations\":{\"kubernetes.io/description\":\"PersistentVolumeClaim for PV\"},\"... kubernetes.io/description: PersistentVolumeClaim for PV pv.kubernetes.io/bind-completed: yes pv.kubernetes.io/bound-by-controller: yes Finalizers: [kubernetes.io/pvc-protection] Capacity: 10Gi Access Modes: RWO VolumeMode: Filesystem Mounted By: \u003cnone\u003e Events: \u003cnone\u003e \\4. å†æ¬¡æŸ¥çœ‹PVçš„çŠ¶æ€ï¼Œæ­¤æ—¶çŠ¶æ€ä¸ºBondï¼Œå’Œdefaultå‘½åç©ºé—´ä¸‹çš„PVC pvc-nfs-storageå…³è”,æ­¤æ—¶PVCå·²ç»å®šä¹‰å¥½ ","date":"2019-08-04","objectID":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/:3:0","tags":["kubernetes"],"title":"10 æ·±å…¥å­¦ä¹ æŒä¹…åŒ–å­˜å‚¨PVå’ŒPVC","uri":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 Podå¼•ç”¨PVC PVå’ŒPVCå®šä¹‰å¥½åï¼Œéœ€è¦åœ¨Podä¸­å¼•ç”¨å®šä¹‰çš„å­˜å‚¨ï¼Œå¼•ç”¨æ–¹å¼å’Œä¹‹å‰å®šä¹‰çš„ç±»ä¼¼ï¼Œspec.containers.volumeMountsåœ¨Podä¸­å¼•ç”¨å®šä¹‰çš„å­˜å‚¨ï¼Œå‰é¢çš„æ–‡ç« ä¸­æˆ‘ä»¬ç›´æ¥é€šè¿‡Podè°ƒç”¨ï¼Œæœ¬æ–‡æ¡ˆä¾‹é€šè¿‡å°†Podä»¥Templateçš„å½¢å¼å®šä¹‰å°è£…åœ¨Deploymentçš„æ§åˆ¶å™¨ä¸­ï¼Œä¸‹ç¯‡æ–‡ç« æˆ‘ä»¬å†æ·±å…¥ä»‹ç»Deploymentï¼ŒReplicaSetï¼ŒStatefulSetç­‰å‰¯æœ¬æ§åˆ¶å™¨ã€‚ \\1. å®šä¹‰ä¸€ä¸ªDeploymentsï¼Œé€šè¿‡deployment.spec.template.specåº”ç”¨Pod,åœ¨volumesä¸­è°ƒç”¨PVCå­˜å‚¨ï¼ŒvolumeMountså°†å­˜å‚¨æŒ‚è½½åˆ°æŒ‡å®šç›®å½•ã€‚ [root@node-1 happylau]# cat pvc-nfs-deployments.yaml apiVersion: apps/v1 kind: Deployment metadata: #deploymentçš„å…ƒæ•°æ® name: pvc-nfs-deployment labels: app: pvc-nfs-deployment spec: #deploymentçš„å±æ€§ä¿¡æ¯ replicas: 1 #å‰¯æœ¬æ§åˆ¶æ•° selector: matchLabels: app: pvc-nfs-deployment template: #é€šè¿‡å®šä¹‰æ¨¡æ¿å¼•ç”¨Podï¼Œtemplateä¸­çš„ä¿¡æ¯å’ŒPodå®šä¹‰çš„ä¿¡æ¯ä¸€è‡´ï¼ŒåŒ…å«metadata,specä¿¡æ¯ metadata: #å®šä¹‰Podçš„labels labels: app: pvc-nfs-deployment spec: containers: - name: nginx-web image: nginx:latest imagePullPolicy: IfNotPresent ports: - name: nginx-http-80 protocol: TCP containerPort: 80 volumeMounts: #å°†PVCå­˜å‚¨æŒ‚è½½åˆ°ç›®å½• - name: pvc-nfs-storage mountPath: /usr/share/nginx/html volumes: #é€šè¿‡volumeså¼•ç”¨persistentVolumeClaimå­˜å‚¨ - name: pvc-nfs-storage persistentVolumeClaim: claimName: pvc-nfs-storage \\2. åˆ›å»ºDeploymentså¹¶æŸ¥çœ‹åˆ›å»ºæƒ…å†µå’ŒPodæƒ…å†µ åˆ›å»ºDeployments [root@node-1 happylau]# kubectl apply -f pvc-nfs-deployments.yaml deployment.apps/pvc-nfs-deployment created æŸ¥çœ‹Deploymentsåˆ—è¡¨ [root@node-1 happylau]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE pvc-nfs-deployment 1/1 1 1 16s æŸ¥çœ‹Deploymentsä¸­çš„Pod [root@node-1 happylau]# kubectl get pods -l app=pvc-nfs-deployment -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pvc-nfs-deployment-7467b9fbfc-xwdpr 1/1 Running 0 106s 10.244.1.29 node-2 \u003cnone\u003e \u003cnone\u003e \\3. Podä¸­æŸ¥çœ‹å­˜å‚¨æŒ‚è½½ä¿¡æ¯ï¼Œå¹¶åšæ•°æ®è¯»å†™ã€‚ [root@node-1 happylau]# kubectl exec -it pvc-nfs-deployment-7467b9fbfc-xwdpr /bin/bash root@pvc-nfs-deployment-7467b9fbfc-xwdpr:/# df -h Filesystem Size Used Avail Use% Mounted on overlay 50G 4.3G 43G 10% / tmpfs 64M 0 64M 0% /dev tmpfs 920M 0 920M 0% /sys/fs/cgroup /dev/vda1 50G 4.3G 43G 10% /etc/hosts shm 64M 0 64M 0% /dev/shm 10.254.100.101:/mnt/data 50G 9.9G 37G 22% /usr/share/nginx/html #æŒ‚è½½æˆåŠŸ tmpfs 920M 12K 920M 1% /run/secrets/kubernetes.io/serviceaccount tmpfs 920M 0 920M 0% /proc/acpi tmpfs 920M 0 920M 0% /proc/scsi tmpfs 920M 0 920M 0% /sys/firmware å†™å…¥ç«™ç‚¹æ•°æ®å†…å®¹ root@pvc-nfs-deployment-7467b9fbfc-xwdpr:~# echo \"pvc index by happylau\" \u003e/usr/share/nginx/html/index.html root@pvc-nfs-deployment-7467b9fbfc-xwdpr:~# ls -l /usr/share/nginx/html/ total 4 -rw-r--r-- 1 nobody nogroup 22 Oct 12 02:00 index.html \\4. æµ‹è¯•è®¿é—®ï¼Œç›´æ¥è®¿é—®Podçš„IPï¼Œä¸€èˆ¬é€šè¿‡serviceæ¥è°ƒç”¨ï¼Œåç»­å†ä»‹ç»service [root@node-1 ~]# kubectl get pods -l app=pvc-nfs-deployment -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES pvc-nfs-deployment-7467b9fbfc-xwdpr 1/1 Running 0 14m 10.244.1.29 node-2 \u003cnone\u003e \u003cnone\u003e [root@node-1 ~]# curl http://10.244.1.29 pvc index by happylau å†™åœ¨æœ€å æœ¬æ–‡é€šè¿‡ä»‹ç»äº†æŒä¹…åŒ–å­˜å‚¨PVå’ŒæŒä¹…åŒ–å­˜å‚¨å£°æ˜PVCçš„ä½¿ç”¨åœºæ™¯å’Œç›¸å…³æ¦‚å¿µï¼Œå¹¶é€šè¿‡å®ä¾‹æ¼”ç¤ºPVå’ŒPVCçš„ä½¿ç”¨ï¼Œç”±äºPVéœ€è¦ç®¡ç†å‘˜é¢„å…ˆå®šä¹‰ï¼Œå¯¹äºå¤§è§„æ¨¡ç¯å¢ƒä¸‹ä½¿ç”¨ä¸ä¾¿åˆ©ï¼Œå› æ­¤æœ‰äº†åŠ¨æ€PVï¼Œå³é€šè¿‡StorageClasså®ç°ï¼Œä¸‹ç« èŠ‚æˆ‘ä»¬å°†ä»‹ç»StorageClassçš„ä½¿ç”¨ã€‚ å‚è€ƒæ–‡çŒ® PVå’ŒPVCä»‹ç»ï¼šhttps://kubernetes.io/docs/concepts/storage/persistent-volumes/ æœ‰çŠ¶æ€åŒ–åº”ç”¨ï¼šhttps://kubernetes.io/docs/tasks/run-application/run-single-instance-stateful-application/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/:4:0","tags":["kubernetes"],"title":"10 æ·±å…¥å­¦ä¹ æŒä¹…åŒ–å­˜å‚¨PVå’ŒPVC","uri":"/myBlog-2/post/10-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8pv%E5%92%8Cpvc/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ å‰é¢çš„æ–‡ç« æˆ‘ä»¬æ·±å…¥ä»‹ç»äº†Podçš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬Podå®šä¹‰ï¼ŒPodèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡ï¼ŒPodå¥åº·æ£€æŸ¥ï¼ŒPodå­˜å‚¨ç®¡ç†ï¼ŒPodè°ƒåº¦ï¼Œå½“Podæ‰€åœ¨çš„nodeå¼‚å¸¸æ—¶ï¼ŒPodæ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œå› æ­¤Podå¾ˆå°‘å•ç‹¬ä½¿ç”¨ï¼Œä¸€èˆ¬ä»¥templateçš„å½¢å¼åµŒå¥—åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ï¼Œä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹å‰¯æœ¬æ§åˆ¶å™¨Deploymentï¼ŒReplicaSetï¼ŒReplicationControllerçš„ä½¿ç”¨ã€‚ 1. æ·±å…¥å­¦ä¹ æ§åˆ¶å™¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:0:0","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 æ§åˆ¶å™¨æ¦‚è¿° Podæ˜¯kubernetesæ‰€æœ‰è¿è¡Œåº”ç”¨æˆ–éƒ¨ç½²æœåŠ¡çš„åŸºç¡€ï¼Œå¯ä»¥çœ‹ä½œæ˜¯k8sä¸­è¿è¡Œçš„æœºå™¨äººï¼Œåº”ç”¨å•ç‹¬è¿è¡Œåœ¨Podä¸­ä¸å…·å¤‡é«˜çº§çš„ç‰¹æ€§ï¼Œæ¯”å¦‚èŠ‚ç‚¹æ•…éšœæ—¶Podæ— æ³•è‡ªåŠ¨è¿ç§»ï¼ŒPodå¤šå‰¯æœ¬æ¨ªå‘æ‰©å±•ï¼Œåº”ç”¨æ»šåŠ¨å‡çº§RollingUpdateç­‰ï¼Œå› æ­¤Podä¸€èˆ¬ä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨æ§åˆ¶å™¨æ¥å®ç°ã€‚ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªæ¦‚å¿µReplicationControllerå‰¯æœ¬æ§åˆ¶å™¨ï¼Œç®€ç§°RCï¼Œå‰¯æœ¬æ§åˆ¶æ˜¯å®ç°Podé«˜å¯ç”¨çš„åŸºç¡€ï¼Œå…¶é€šè¿‡å®šä¹‰å‰¯æœ¬çš„å‰¯æœ¬æ•°replicasï¼Œå½“è¿è¡Œçš„Podæ•°é‡å°‘äºreplicasæ—¶RCä¼šè‡ªåŠ¨åˆ›å»ºPodï¼Œå½“Podæ•°é‡å¤šäºreplicasæ—¶RCä¼šè‡ªåŠ¨åˆ é™¤å¤šä½™çš„Podï¼Œç¡®ä¿å½“å‰è¿è¡Œçš„Podå’ŒRCå®šä¹‰çš„å‰¯æœ¬æ•°ä¿æŒä¸€è‡´ã€‚ å‰¯æœ¬æ§åˆ¶å™¨åŒ…æ‹¬Deploymentï¼ŒReplicaSetï¼ŒReplicationControllerï¼ŒStatefulSetç­‰ã€‚å…¶ä¸­å¸¸ç”¨æœ‰ä¸¤ä¸ªï¼šDeploymentå’ŒStatefulSetï¼ŒDeploymentç”¨äºæ— çŠ¶æ€æœåŠ¡ï¼ŒStatefulSetç”¨äºæœ‰çŠ¶æ€æœåŠ¡ï¼ŒReplicaSetä½œä¸ºDeploymentåç«¯å‰¯æœ¬æ§åˆ¶å™¨ï¼ŒReplicationControlleråˆ™æ˜¯æ—§ä½¿ç”¨çš„å‰¯æœ¬æ§åˆ¶å™¨ã€‚ ä¸ºäº†å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œkubernetesä¸­æä¾›å¤šç§ä¸åŒçš„æ§åˆ¶å™¨æ»¡è¶³ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯ä»¥åˆ†ä¸ºå››ç±»ï¼š Stateless applicationæ— çŠ¶æ€åŒ–åº”ç”¨ï¼Œå¦‚Deploymentï¼ŒReplicaSetï¼ŒRCç­‰ï¼› Stateful applicationæœ‰çŠ¶æ€åŒ–åº”ç”¨ï¼Œéœ€è¦ä¿å­˜æ•°æ®çŠ¶æ€ï¼Œå¦‚æ•°æ®åº“ï¼Œæ•°æ®åº“é›†ç¾¤ï¼› Node daemonèŠ‚ç‚¹æ”¯æ’‘å®ˆæŠ¤ï¼Œé€‚ç”¨äºåœ¨æ‰€æœ‰æˆ–éƒ¨åˆ†èŠ‚ç‚¹è¿è¡ŒDaemonï¼Œå¦‚æ—¥å¿—ï¼Œç›‘æ§é‡‡é›†ï¼› Batchæ‰¹å¤„ç†ä»»åŠ¡ï¼Œéé•¿æœŸè¿è¡ŒæœåŠ¡ï¼Œåˆ†ä¸ºä¸€æ¬¡æ€§è¿è¡ŒJobå’Œè®¡åˆ’è¿è¡ŒCronJobä¸¤ç§ã€‚ æœ¬æ–‡æˆ‘ä»¬ä¸»è¦ä»‹ç»æ— çŠ¶æ€æœåŠ¡å‰¯æœ¬æ§åˆ¶å™¨çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬Deploymentï¼ŒReplicaSetå’ŒReplicationControllerã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:1:0","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 Deployment Deploymentæ˜¯å®ç°æ— çŠ¶æ€åº”ç”¨å‰¯æœ¬æ§åˆ¶å™¨ï¼Œå…¶é€šè¿‡declarativeç”³æ˜å¼çš„æ–¹å¼å®šä¹‰Podçš„å‰¯æœ¬æ•°ï¼ŒDeploymentçš„å‰¯æœ¬æœºåˆ¶æ˜¯é€šè¿‡ReplicaSetå®ç°ï¼Œreplicaså‰¯æœ¬çš„ç®¡ç†é€šè¿‡åœ¨ReplicaSetä¸­æ·»åŠ å’Œåˆ é™¤Podï¼ŒRollingUpdateé€šè¿‡æ–°å»ºReplicaSetï¼Œç„¶åé€æ­¥ç§»é™¤å’Œæ·»åŠ ReplicaSetä¸­çš„Podæ•°é‡ï¼Œä»è€Œå®ç°æ»šåŠ¨æ›´æ–°ï¼Œä½¿ç”¨Deploymentçš„åœºæ™¯å¦‚ä¸‹ï¼š æ»šåŠ¨å‡çº§RollingUpdateï¼Œåå°é€šè¿‡ReplicaSetå®ç° å¤šå‰¯æœ¬replicaså®ç°ï¼Œå¢åŠ å‰¯æœ¬(é«˜è´Ÿè½½)æˆ–å‡å°‘å‰¯æœ¬(ä½è´Ÿè½½) åº”ç”¨å›æ»šRolloutï¼Œç‰ˆæœ¬æ›´æ–°æ”¯æŒå›é€€ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:2:0","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2.1 Deploymentå®šä¹‰ \\1. æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªDeploymentï¼Œå‰¯æœ¬æ•°ä¸º3ï¼ŒPodä»¥æ¨¡ç‰ˆTemplateçš„å½¢å¼å°è£…åœ¨Deploymentä¸­ï¼Œä¸ºäº†ç»“åˆä¹‹å‰Podå­¦ä¹ å†…å®¹ï¼Œæˆ‘ä»¬å¢åŠ äº†resourceå’Œå¥åº·æ£€æŸ¥çš„å®šä¹‰ï¼Œå…·ä½“å®ç°å‚è€ƒå‰é¢ä»‹ç»çš„æ–‡ç« ã€‚ [root@node-1 happylau]# cat deployment-demo.yaml apiVersion: apps/v1 kind: Deployment metadata: #Deploymentçš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…å«åå­—ï¼Œæ ‡ç­¾ name: deployment-nginx-demo labels: app: nginx rc: deployment annotations: kubernetes.io/replicationcontroller: Deployment kubernetes.io/description: \"ReplicationController Deployment Demo\" spec: replicas: 3 #å‰¯æœ¬æ•°é‡ï¼ŒåŒ…å«æœ‰3ä¸ªPodå‰¯æœ¬ selector: #æ ‡ç­¾é€‰æ‹©å™¨ï¼Œé€‰æ‹©ç®¡ç†åŒ…å«æŒ‡å®šæ ‡ç­¾çš„Pod matchLabels: app: nginx rc: deployment template: #å¦‚ä¸‹æ˜¯Podçš„æ¨¡æ¿å®šä¹‰ï¼Œæ²¡æœ‰apiVersionï¼ŒKindå±æ€§ï¼Œéœ€åŒ…å«metadataå®šä¹‰ metadata: #Podçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¿…é¡»åŒ…å«æœ‰labels labels: app: nginx rc: deployment spec: #specæŒ‡å®šå®¹å™¨çš„å±æ€§ä¿¡æ¯ containers: - name: nginx-deployment image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: #å®¹å™¨ç«¯å£ä¿¡æ¯ - name: http-80-port protocol: TCP containerPort: 80 resources: #èµ„æºç®¡ç†,requestsè¯·æ±‚èµ„æºï¼Œlimitsé™åˆ¶èµ„æº requests: cpu: 100m memory: 128Mi limits: cpu: 200m memory: 256Mi livenessProbe: #å¥åº·æ£€æŸ¥å™¨livenessProbeï¼Œå­˜æ´»æ£€æŸ¥ httpGet: path: /index.html port: 80 scheme: HTTP initialDelaySeconds: 3 periodSeconds: 5 timeoutSeconds: 2 readinessProbe: #å¥åº·æ£€æŸ¥å™¨readinessProbeï¼Œå°±ç»ªæ£€æŸ¥ httpGet: path: /index.html port: 80 scheme: HTTP initialDelaySeconds: 3 periodSeconds: 5 timeoutSeconds: 2 Deploymentå­—æ®µè¯´æ˜ï¼š deploymentåŸºæœ¬å±æ€§ï¼ŒåŒ…æ‹¬apiVersion,Kind,metadataå’Œspecï¼Œå…¶ä¸­ï¼Œdeployment.metdataæŒ‡å®šåç§°å’Œæ ‡ç­¾å†…å®¹ï¼Œdeployment.specæŒ‡å®šéƒ¨ç½²ç»„çš„å±æ€§ä¿¡æ¯ï¼› deploymentå±æ€§ä¿¡æ¯åŒ…å«æœ‰replicasï¼ŒSelectorå’Œtemplateï¼Œå…¶ä¸­replicasæŒ‡å®šå‰¯æœ¬æ•°ç›®ï¼ŒSelectoræŒ‡å®šç®¡ç†çš„Podæ ‡ç­¾ï¼Œtemplateä¸ºå®šä¹‰Podçš„æ¨¡æ¿ï¼ŒDeploymenté€šè¿‡æ¨¡æ¿åˆ›å»ºPodï¼› deployment.spec.templateä¸ºPodå®šä¹‰çš„æ¨¡æ¿ï¼Œå’ŒPodå®šä¹‰ä¸å¤ªä¸€æ ·ï¼Œtemplateä¸­ä¸åŒ…å«apiVersionå’ŒKindå±æ€§ï¼Œè¦æ±‚å¿…é¡»æœ‰metadataï¼Œdeployment.spec.template.specä¸ºå®¹å™¨çš„å±æ€§ä¿¡æ¯ï¼Œå…¶ä»–å®šä¹‰å†…å®¹å’ŒPodä¸€è‡´ã€‚ \\2. ç”ŸæˆDeploymentï¼Œåˆ›å»ºæ—¶åŠ ä¸€ä¸ªâ€“recordå‚æ•°,ä¼šåœ¨annotationä¸­è®°å½•deployment.kubernetes.io/revisionç‰ˆæœ¬ [root@node-1 happylau]# kubectl apply -f deployment-demo.yaml --record deployment.apps/deployment-nginx-demo created \\3. æŸ¥çœ‹Deploymentåˆ—è¡¨ï¼Œè¿è¡Œæ—¶è‡ªåŠ¨ä¸‹è½½é•œåƒï¼Œå¦‚ä¸‹å·²è¿è¡Œäº†3ä¸ªå‰¯æœ¬ [root@node-1 happylau]# kubectl get deployments deployment-nginx-demo NAME READY UP-TO-DATE AVAILABLE AGE deployment-nginx-demo 3/3 3 3 2m37s NAMEä»£è¡¨åç§°,metadata.nameå­—æ®µå®šä¹‰ READYä»£è¡¨Podçš„å¥åº·çŠ¶æ€ï¼Œå‰é¢å€¼æ˜¯readinessï¼Œåé¢æ˜¯liveness UP-TO-DATEä»£è¡¨æ›´æ–°ï¼Œç”¨äºæ»šåŠ¨å‡çº§ AVAILABLEä»£è¡¨å¯ç”¨ AGEåˆ›å»ºè‡³ä»Šè¿è¡Œçš„æ—¶é•¿ \\4. æŸ¥çœ‹Deploymentçš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°Deploymenté€šè¿‡ä¸€ä¸ªdeployment-nginx-demo-866bb6cf78 replicasetå‰¯æœ¬æ§åˆ¶å™¨æ§åˆ¶Podçš„å‰¯æœ¬æ•°é‡ \\5. æŸ¥çœ‹replicasetçš„è¯¦æƒ…ä¿¡æ¯ï¼Œé€šè¿‡Eventså¯æŸ¥çœ‹åˆ°deployment-nginx-demo-866bb6cf78åˆ›å»ºäº†ä¸‰ä¸ªPod \\6. æŸ¥çœ‹Podè¯¦æƒ…ï¼Œæœ€ç»ˆé€šè¿‡Podå®šä¹‰çš„æ¨¡ç‰ˆåˆ›å»ºcontainerï¼Œèµ„æºå®šä¹‰ï¼Œå¥åº·æ£€æŸ¥ç­‰åŒ…å«åœ¨Podå®šä¹‰çš„æ¨¡ç‰ˆä¸­ é€šè¿‡ä¸Šé¢çš„å®æˆ˜æ¼”ç»ƒæˆ‘ä»¬å¯å¾—çŸ¥Deploymentçš„å‰¯æœ¬æ§åˆ¶åŠŸèƒ½æ˜¯ç”±replicasetå®ç°ï¼Œreplicasetç”ŸæˆDeploymentä¸­å®šä¹‰çš„replicaså‰¯æœ¬çš„æ•°é‡ï¼Œå³åˆ›å»ºå¤šä¸ªå‰¯æœ¬ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:2:1","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2.2 Deploymentæ‰©å®¹ å½“ä¸šåŠ¡æ¯”è¾ƒç¹å¿™æ—¶å¯ä»¥é€šè¿‡å¢åŠ å‰¯æœ¬æ•°ï¼Œå¢åŠ å‰¯æœ¬æ•°æ˜¯é€šè¿‡yamlæ–‡ä»¶ä¸­çš„replicasæ§åˆ¶çš„ï¼Œå½“è®¾ç½®äº†repliasåï¼ŒDeploymentæ§åˆ¶å™¨ä¼šè‡ªåŠ¨æ ¹æ®å½“å‰å‰¯æœ¬æ•°ç›®åˆ›å»ºæ‰€éœ€çš„Podæ•°ï¼Œè¿™äº›podä¼šè‡ªåŠ¨åŠ å…¥åˆ°serviceä¸­å®ç°è´Ÿè½½å‡è¡¡ï¼Œç›¸åå‡å°‘å‰¯æœ¬æ•°ï¼Œè¿™äº›podä¼šè‡ªåŠ¨ä»serviceä¸­åˆ é™¤ã€‚ \\1. å°†deploymentçš„å‰¯æœ¬æ•°æ‰©å®¹è‡³4ä¸ªï¼Œå¯é€šè¿‡ä¿®æ”¹yamlæ–‡ä»¶çš„replicasä¸ªæ•°æˆ–è€…é€šè¿‡scaleå‘½ä»¤æ‰©å±•ã€‚ [root@node-1 ~]# kubectl scale --replicas=4 deployment deployment-nginx-demo deployment.extensions/deployment-nginx-demo scaled \\2. æŸ¥çœ‹Deploymentå‰¯æœ¬æ•°é‡,å·²å¢åŠ è‡³4ä¸ªå‰¯æœ¬ [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE deployment-nginx-demo 4/4 4 4 77m \\3. å‰¯æœ¬çš„æ‰©å®¹æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹replicasetçš„è¯¦æƒ…ä¿¡æ¯è§‚å¯Ÿï¼Œå¢åŠ å‰¯æœ¬çš„ä¸ªæ•°æ˜¯é€šè¿‡replicasetæ¥æ‰©å®¹ï¼Œé€šè¿‡æ¨¡ç‰ˆå¤åˆ¶æ–°çš„Pod \\4. å‰¯æœ¬ç¼©å®¹ [root@node-1 ~]# kubectl scale --replicas=2 deployment deployment-nginx-demo deployment.extensions/deployment-nginx-demo scaled [root@node-1 ~]# kubectl get deployments deployment-nginx-demo NAME READY UP-TO-DATE AVAILABLE AGE deployment-nginx-demo 2/2 2 2 7h41m é€šè¿‡ä¸Šé¢çš„æ“ä½œæ¼”ç»ƒæˆ‘ä»¬å¯ä»¥å¾—çŸ¥:Deploymentçš„æ‰©å®¹æ˜¯é€šè¿‡ReplicaSetçš„æ¨¡ç‰ˆåˆ›å»ºPodæˆ–åˆ é™¤Podå®ç°ï¼Œscaleæ˜¯æ‰‹åŠ¨æ‰©å±•å®ç°å‰¯æœ¬çš„æœºåˆ¶ï¼Œkubernetesè¿˜æä¾›äº†å¦å¤–ä¸€ç§å‰¯æœ¬è‡ªåŠ¨æ‰©å®¹æœºåˆ¶horizontalpodautoscalers(Horizontal Pod Autoscaling),å³é€šè¿‡å®šä¹‰CPUçš„åˆ©ç”¨ç‡å®ç°è‡ªåŠ¨çš„æ¨ªå‘æ‰©å±•ï¼Œç”±äºéœ€è¦ä¾èµ–äºç›‘æ§ç»„ä»¶ï¼Œåç»­æˆ‘ä»¬å†åšä»‹ç»ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:2:2","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2.3 æ»šåŠ¨æ›´æ–° Deploymentæ”¯æŒæ»šåŠ¨æ›´æ–°ï¼Œé»˜è®¤åˆ›å»ºDeploymentåä¼šå¢åŠ æ»šåŠ¨æ›´æ–°çš„ç­–ç•¥ï¼Œé€šè¿‡é€æ­¥æ›¿ä»£replicasä¸­çš„podå®ç°æ›´æ–°æ— æœåŠ¡ä¸­æ–­ï¼ˆéœ€è¦ç»“åˆserviceï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šå°†ä¸€ä¸ªdeploymentå‰¯æœ¬æ•°ä¸º3çš„åº”ç”¨æ›´æ–°ï¼Œå…ˆæ›´æ–°10.0.0.6 podï¼Œæ›´æ–°podåº”ç”¨ï¼Œæ›¿æ¢æ–°çš„ipï¼Œç„¶ååŠ å…¥åˆ°serviceä¸­ï¼Œä»¥æ­¤ç±»æ¨å†ç»§ç»­æ›´æ–°å…¶ä»–podï¼Œä»è€Œå®ç°æ»šåŠ¨æ›´æ–°ï¼Œä¸å½±å“æœåŠ¡çš„å‡çº§ã€‚ é€šè¿‡ç±»å‹ä¸ºï¼šRollingUpdateï¼Œæ¯æ¬¡æ›´æ–°æœ€å¤§çš„æ•°é‡maxSurgeæ˜¯replicasæ€»æ•°çš„25%,æœ€å¤§ä¸å¯ç”¨çš„æ•°é‡maxUnavailableä¸º25%ï¼Œå¦‚ä¸‹æ˜¯é€šè¿‡kubectl get deployments deployment-nginx-demo -o yamlæŸ¥çœ‹æ»šåŠ¨æ›´æ–°ç›¸å…³çš„ç­–ç•¥ã€‚ spec: progressDeadlineSeconds: 600 replicas: 3 revisionHistoryLimit: 10 selector: matchLabels: app: nginx rc: deployment strategy: #strategyå®šä¹‰çš„æ˜¯å‡çº§çš„ç­–ç•¥ï¼Œç±»å‹ä¸ºRollingUpdate rollingUpdate: maxSurge: 25% maxUnavailable: 25% type: RollingUpdate \\1. æ»šåŠ¨æ›´æ–°æ˜¯å½“pod.templateä¸­å®šä¹‰çš„ç›¸å…³å±æ€§å˜åŒ–ï¼Œå¦‚ä¸‹å°†é•œåƒæ›´æ–°åˆ°1.9.1ï¼Œé€šè¿‡â€“recordä¼šè®°å½•æ“ä½œå‘½ä»¤ [root@node-1 ~]# kubectl set image deployments deployment-nginx-demo nginx-deployment=nginx:1.9.1 --record deployment.extensions/deployment-nginx-demo image updated \\2. æŸ¥çœ‹æ»šåŠ¨å‡çº§çš„çŠ¶æ€ï¼ˆç”±äºç¬¬ä¸€æ¬¡nginxçš„é•œåƒå†™é”™äº†ï¼Œå®¹å™¨ä¸‹è½½é•œåƒå¤±è´¥ï¼Œå†™æˆnignxï¼Œå¯¼è‡´ä¿®æ”¹åæœ‰ä¸¤æ¬¡recordï¼‰ [root@node-1 happylau]# kubectl rollout status deployment deployment-nginx-demo deployment \"deployment-nginx-demo\" successfully rolled out æŸ¥çœ‹æ»šåŠ¨å‡çº§ç‰ˆæœ¬ï¼ŒREVSISIONä»£è¡¨ç‰ˆæœ¬å·ï¼š [root@node-1 happylau]# kubectl rollout history deployment deployment-nginx-demo deployment.extensions/deployment-nginx-demo REVISION CHANGE-CAUSE 1 \u003cnone\u003e 2 kubectl set image deployments deployment-nginx-demo nginx-deployment=nignx:1.9.1 --record=true 3 kubectl set image deployments deployment-nginx-demo nginx-deployment=nignx:1.9.1 --record=true \\3. è§‚å¯ŸDeploymentçš„å‡çº§è¿‡ç¨‹ï¼Œæ–°åˆ›å»ºä¸€ä¸ªRS deployment-nginx-demo-65c8c98c7bï¼Œé€æ¸å°†æ—§RSä¸­çš„podæ›¿æ¢ï¼Œç›´è‡³æ—§çš„RS deployment-nginx-demo-866bb6cf78ä¸Šçš„å‰¯æœ¬æ•°ä¸º0. \\4. æŸ¥çœ‹RSçš„åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æ–°çš„RSçš„å‰¯æœ¬æ•°ä¸º2ï¼Œå…¶ä»–RSå‰¯æœ¬æ•°ä¸º0 [root@node-1 ~]# kubectl get replicasets NAME DESIRED CURRENT READY AGE deployment-nginx-demo-65c8c98c7b 2 2 2 21m #æ–°çš„RSï¼ŒREVSIONä¸º3 deployment-nginx-demo-6cb65f58c6 0 0 0 22m #é•œåƒå†™é”™çš„RSï¼ŒREVISONä¸º2 deployment-nginx-demo-866bb6cf78 0 0 0 40m #æ—§çš„RSï¼Œå¯¹åº”REVSIONä¸º1 \\5. æµ‹è¯•ç‰ˆæœ¬å‡çº§æ˜¯å¦æˆåŠŸ [root@node-1 ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES deployment-nginx-demo-65c8c98c7b-bzql9 1/1 Running 0 25m 10.244.1.58 node-2 \u003cnone\u003e \u003cnone\u003e deployment-nginx-demo-65c8c98c7b-vrjhp 1/1 Running 0 25m 10.244.2.72 node-3 \u003cnone\u003e \u003cnone\u003e [root@node-1 ~]# curl -I http://10.244.2.72 HTTP/1.1 200 OK Server: nginx/1.9.1 #é•œåƒçš„ç‰ˆæœ¬æˆåŠŸæ›´æ–° Date: Mon, 28 Oct 2019 15:28:49 GMT Content-Type: text/html Content-Length: 612 Last-Modified: Tue, 26 May 2015 15:02:09 GMT Connection: keep-alive ETag: \"55648af1-264\" Accept-Ranges: bytes ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:2:3","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2.4 ç‰ˆæœ¬å›é€€ å¦‚æœç‰ˆæœ¬ä¸ç¬¦åˆé¢„æœŸï¼Œkubernetesæä¾›å›é€€çš„åŠŸèƒ½ï¼Œå’Œæ»šåŠ¨æ›´æ–°ä¸€æ ·ï¼Œå›é€€çš„åŠŸèƒ½Deploymentå°†æ›¿æ¢åˆ°åŸå§‹çš„RSä¸Šï¼Œå³é€æ­¥å°†Podçš„å‰¯æœ¬æ›¿æ¢åˆ°æ—§çš„RSä¸Š. \\1. æ‰§è¡Œå›æ»šï¼Œå›é€€åˆ°REVISONç‰ˆæœ¬ä¸º1 [root@node-1 ~]# kubectl rollout undo deployment deployment-nginx-demo --to-revision=1 deployment.extensions/deployment-nginx-demo rolled back \\2. æŸ¥çœ‹Deploymentçš„å›é€€çŠ¶æ€å’Œå†å²ç‰ˆæœ¬ [root@node-1 ~]# kubectl rollout status deployment deployment-nginx-demo deployment \"deployment-nginx-demo\" successfully rolled out [root@node-1 ~]# kubectl rollout history deployment deployment-nginx-demo deployment.extensions/deployment-nginx-demo REVISION CHANGE-CAUSE 2 kubectl set image deployments deployment-nginx-demo nginx-deployment=nignx:1.9.1 --record=true 3 kubectl set image deployments deployment-nginx-demo nginx-deployment=nignx:1.9.1 --record=true 4 \u003cnone\u003e \\3. æŸ¥çœ‹Deploymentçš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°RSå·²ç»ä¼šé€€åˆ°åŸå§‹çš„RSäº† \\4. æµ‹è¯•nginxçš„ç‰ˆæœ¬ [root@node-1 ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES deployment-nginx-demo-866bb6cf78-9thtn 1/1 Running 0 3m42s 10.244.1.59 node-2 \u003cnone\u003e \u003cnone\u003e deployment-nginx-demo-866bb6cf78-ws2hx 1/1 Running 0 3m48s 10.244.2.73 node-3 \u003cnone\u003e \u003cnone\u003e #æµ‹è¯•ç‰ˆæœ¬ [root@node-1 ~]# curl -I http://10.244.1.59 HTTP/1.1 200 OK Server: nginx/1.7.9 #å›é€€åˆ°1.7.9ç‰ˆæœ¬ Date: Mon, 28 Oct 2019 15:36:07 GMT Content-Type: text/html Content-Length: 612 Last-Modified: Tue, 23 Dec 2014 16:25:09 GMT Connection: keep-alive ETag: \"54999765-264\" Accept-Ranges: bytes å°ç»“ï¼šé€šè¿‡ä¸Šé¢çš„æ“ä½œæ¼”ç»ƒå¯çŸ¥ï¼ŒDeploymentæ˜¯é€šè¿‡ReplicaSetå®ç°Podå‰¯æœ¬æ•°çš„ç®¡ç†ï¼ˆæ‰©å®¹æˆ–å‡å°‘å‰¯æœ¬æ•°ï¼‰ï¼Œæ»šåŠ¨æ›´æ–°æ˜¯é€šè¿‡æ–°å»ºRSï¼Œå°†Podä»æ—§çš„RSé€æ­¥æ›´æ–°åˆ°æ–°çš„RSä¸Šï¼›ç›¸åï¼Œå›æ»šç‰ˆæœ¬å°†ä¼šé€€åˆ°æŒ‡å®šç‰ˆæœ¬çš„ReplicaSetä¸Šã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:2:4","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 ReplicaSet ReplicaSetå‰¯æœ¬é›†ç®€ç§°RSï¼Œç”¨äºå®ç°å‰¯æœ¬æ•°çš„æ§åˆ¶ï¼Œé€šè¿‡ä¸Šé¢çš„å­¦ä¹ æˆ‘ä»¬å¯ä»¥çŸ¥é“Deploymentå®é™…æ˜¯è°ƒç”¨ReplicaSetå®ç°å‰¯æœ¬çš„æ§åˆ¶ï¼ŒRSä¸å…·å¤‡æ»šåŠ¨å‡çº§å’Œå›æ»šçš„ç‰¹æ€§ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨Deploymentï¼ŒReplicaSetçš„å®šä¹‰å’ŒDeploymentå·®ä¸å¤šï¼Œå¦‚ä¸‹ï¼š \\1. å®šä¹‰ReplicaSet [root@node-1 happylau]# cat replicaset-demo.yaml apiVersion: extensions/v1beta1 kind: ReplicaSet metadata: name: replicaset-demo labels: controller: replicaset annotations: kubernetes.io/description: \"Kubernetes Replication Controller Replication\" spec: replicas: 3 #å‰¯æœ¬æ•° selector: #Podæ ‡ç­¾é€‰æ‹©å™¨ matchLabels: controller: replicaset template: #åˆ›å»ºPodçš„æ¨¡æ¿ metadata: labels: controller: replicaset spec: #å®¹å™¨ä¿¡æ¯ containers: - name: nginx-replicaset-demo image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: http-80-port protocol: TCP containerPort: 80 \\2. åˆ›å»ºRSå¹¶æŸ¥çœ‹RSåˆ—è¡¨ [root@node-1 happylau]# kubectl apply -f replicaset-demo.yaml replicaset.extensions/replicaset-demo created [root@node-1 happylau]# kubectl get replicasets replicaset-demo NAME DESIRED CURRENT READY AGE replicaset-demo 3 3 3 15s \\3. æ‰©å±•å‰¯æœ¬æ•°è‡³4ä¸ª [root@node-1 happylau]# kubectl scale --replicas=4 replicaset replicaset-demo replicaset.extensions/replicaset-demo scaled [root@node-1 happylau]# kubectl get replicasets replicaset-demo NAME DESIRED CURRENT READY AGE replicaset-demo 4 4 4 76s \\4. å‡å°‘å‰¯æœ¬æ•°è‡³2ä¸ª [root@node-1 happylau]# kubectl scale --replicas=2 replicaset replicaset-demo replicaset.extensions/replicaset-demo scaled [root@node-1 happylau]# kubectl get replicasets replicaset-demo NAME DESIRED CURRENT READY AGE replicaset-demo 2 2 2 114s \\5. é•œåƒç‰ˆæœ¬å‡çº§ï¼ŒéªŒè¯å¾—çŸ¥ä¸å…·å¤‡ç‰ˆæœ¬å‡çº§çš„èƒ½åŠ› [root@node-1 happylau]# kubectl set image replicasets replicaset-demo nginx-replicaset-demo=nginx:1.9.1 replicaset.extensions/replicaset-demo image updated #å‘½ä»¤æ‰§è¡ŒæˆåŠŸäº† ReplicaSetå°ç»“ï¼šé€šè¿‡ä¸Šé¢çš„æ¼”ç¤ºå¯ä»¥çŸ¥é“ï¼ŒRSå®šä¹‰å’ŒDeploymentç±»ä¼¼ï¼Œèƒ½å®ç°å‰¯æœ¬çš„æ§åˆ¶ï¼Œæ‰©å±•å’Œç¼©å‡ï¼ŒDeploymentæ˜¯æ›´é«˜å±‚æ¬¡çš„å‰¯æœ¬æ§åˆ¶å™¨ï¼ŒReplicaSetä¸»è¦ä¸ºDeploymentçš„å‰¯æœ¬æ§åˆ¶å™¨å’Œæ»šåŠ¨æ›´æ–°æœºåˆ¶ï¼ŒReplicaSetæœ¬èº«æ— æ³•æä¾›æ»šåŠ¨æ›´æ–°çš„èƒ½åŠ›ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:3:0","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 ReplicationController ReplicationControllerå‰¯æœ¬æ§åˆ¶å™¨ç®€ç§°RCï¼Œæ˜¯kubernetesä¸­æœ€æ—©çš„å‰¯æœ¬æ§åˆ¶å™¨ï¼ŒRCæ˜¯ReplicaSetä¹‹å‰çš„ç‰ˆæœ¬ï¼ŒReplicationControlleræä¾›å‰¯æœ¬æ§åˆ¶èƒ½åŠ›ï¼Œå…¶å®šä¹‰æ–¹å¼å’ŒDeploymentï¼ŒReplicaSetç›¸ç±»ä¼¼ï¼Œå¦‚ä¸‹ï¼š \\1. å®šä¹‰ReplicationController [root@node-1 happylau]# cat rc-demo.yaml apiVersion: v1 kind: ReplicationController metadata: name: rc-demo labels: controller: replicationcontroller annotations: kubernetes.io/description: \"Kubernetes Replication Controller Replication\" spec: replicas: 3 selector: #ä¸èƒ½ä½¿ç”¨matchLableså­—ç¬¦é›†æ¨¡å¼ controller: replicationcontroller template: metadata: labels: controller: replicationcontroller spec: containers: - name: nginx-rc-demo image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: http-80-port protocol: TCP containerPort: 80 \\2. ç”ŸæˆRCå¹¶æŸ¥çœ‹åˆ—è¡¨ [root@node-1 happylau]# kubectl apply -f rc-demo.yaml replicationcontroller/rc-demo created [root@node-1 happylau]# kubectl get replicationcontrollers NAME DESIRED CURRENT READY AGE rc-demo 3 3 3 103s #æŸ¥çœ‹è¯¦æƒ… [root@node-1 happylau]# kubectl describe replicationcontrollers rc-demo Name: rc-demo Namespace: default Selector: controller=replicationcontroller Labels: controller=replicationcontroller Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"ReplicationController\",\"metadata\":{\"annotations\":{\"kubernetes.io/description\":\"Kubernetes Replication Controlle... kubernetes.io/description: Kubernetes Replication Controller Replication Replicas: 3 current / 3 desired Pods Status: 3 Running / 0 Waiting / 0 Succeeded / 0 Failed Pod Template: Labels: controller=replicationcontroller Containers: nginx-rc-demo: Image: nginx:1.7.9 Port: 80/TCP Host Port: 0/TCP Environment: \u003cnone\u003e Mounts: \u003cnone\u003e Volumes: \u003cnone\u003e Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal SuccessfulCreate 113s replication-controller Created pod: rc-demo-hm8s9 Normal SuccessfulCreate 113s replication-controller Created pod: rc-demo-xnfht Normal SuccessfulCreate 113s replication-controller Created pod: rc-demo-lfhc9 3.å‰¯æœ¬æ‰©å®¹è‡³4ä¸ª [root@node-1 happylau]# kubectl scale --replicas=4 replicationcontroller rc-demo replicationcontroller/rc-demo scaled [root@node-1 happylau]# kubectl get replicationcontrollers NAME DESIRED CURRENT READY AGE rc-demo 4 4 4 3m23s \\4. å‰¯æœ¬ç¼©å®¹è‡³2ä¸ª [root@node-1 happylau]# kubectl scale --replicas=2 replicationcontroller rc-demo replicationcontroller/rc-demo scaled [root@node-1 happylau]# kubectl get replicationcontrollers NAME DESIRED CURRENT READY AGE rc-demo 2 2 2 3m51s å†™åœ¨æœ€å æœ¬æ–‡ä»‹ç»äº†kubernetesä¸­ä¸‰ä¸ªå‰¯æœ¬æ§åˆ¶å™¨ï¼šDeploymentï¼ŒReplicaSetå’ŒReplicationControllerï¼Œå½“å‰ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯Deploymentï¼ŒReplicaSetä¸ºDeploymentæä¾›æ»šåŠ¨æ›´æ–°æœºåˆ¶ï¼ŒRCå½“å‰æ˜¯æ—§ç‰ˆçš„å‰¯æœ¬æ§åˆ¶å™¨ï¼Œå½“å‰å·²åºŸå¼ƒï¼Œæ¨èä½¿ç”¨Deploymentæ§åˆ¶å™¨ï¼Œå…·å¤‡å‰¯æœ¬æ§åˆ¶å™¨ï¼Œæ‰©å±•å‰¯æœ¬ï¼Œç¼©å‡å‰¯æœ¬ï¼Œæ»šåŠ¨å‡çº§å’Œå›æ»šç­‰é«˜çº§èƒ½åŠ›ã€‚ å‚è€ƒæ–‡çŒ® Deploymentï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/deployment/ ReplicaSetï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/replicaset/ ReplicationControllerï¼š[https://kubernetes.io/docs/concepts/workloads/controllers/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/:4:0","tags":["kubernetes"],"title":"11 æ·±å…¥å­¦ä¹ Deploymentæ§åˆ¶å™¨","uri":"/myBlog-2/post/11-%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0deployment%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šç« èŠ‚ä¸­ä»‹ç»äº†Deploymentï¼ŒReplicaSetï¼ŒReplicationControllerç­‰å‰¯æœ¬æ§åˆ¶å™¨çš„ä½¿ç”¨å’Œåœºæ™¯ï¼Œæ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹æ§åˆ¶å™¨DaemonSetä½¿ç”¨ã€‚ 1. DaemonSetæ§åˆ¶å™¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/:0:0","tags":["kubernetes"],"title":"12 è¯¦è§£DaemonSetæ§åˆ¶å™¨","uri":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 DaemonSetç®€ä»‹ ä»‹ç»DaemonSetæ—¶æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šç›¸ä¿¡å¤§å®¶éƒ½æ¥è§¦è¿‡ç›‘æ§ç³»ç»Ÿæ¯”å¦‚zabbixï¼Œç›‘æ§ç³»ç»Ÿéœ€è¦åœ¨è¢«ç›‘æ§æœºå®‰è£…ä¸€ä¸ªagentï¼Œå®‰è£…agenté€šå¸¸ä¼šæ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªåœºæ™¯ï¼š æ‰€æœ‰èŠ‚ç‚¹éƒ½å¿…é¡»å®‰è£…agentä»¥ä¾¿é‡‡é›†ç›‘æ§æ•°æ® æ–°åŠ å…¥çš„èŠ‚ç‚¹éœ€è¦é…ç½®agentï¼Œæ‰‹åŠ¨æˆ–è€…è¿è¡Œè„šæœ¬ èŠ‚ç‚¹ä¸‹çº¿åéœ€è¦æ‰‹åŠ¨åœ¨ç›‘æ§ç³»ç»Ÿä¸­åˆ é™¤ kubernetesä¸­ç»å¸¸æ¶‰åŠåˆ°åœ¨nodeä¸Šå®‰è£…éƒ¨ç½²åº”ç”¨ï¼Œå®ƒæ˜¯å¦‚ä½•è§£å†³ä¸Šè¿°çš„é—®é¢˜çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯DaemonSetã€‚DaemonSetå®ˆæŠ¤è¿›ç¨‹ç®€ç§°DSï¼Œé€‚ç”¨äºåœ¨æ‰€æœ‰èŠ‚ç‚¹æˆ–éƒ¨åˆ†èŠ‚ç‚¹è¿è¡Œä¸€ä¸ªdaemonå®ˆæŠ¤è¿›ç¨‹ï¼Œå¦‚ç›‘æ§æˆ‘ä»¬å®‰è£…éƒ¨ç½²æ—¶ç½‘ç»œæ’ä»¶kube-flannelå’Œkube-proxyï¼ŒDaemonSetå…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š DaemonSetç¡®ä¿æ‰€æœ‰èŠ‚ç‚¹è¿è¡Œä¸€ä¸ªPodå‰¯æœ¬ æŒ‡å®šèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªPodå‰¯æœ¬ï¼Œé€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨æˆ–è€…èŠ‚ç‚¹äº²å’Œæ€§ æ–°å¢èŠ‚ç‚¹ä¼šè‡ªåŠ¨åœ¨èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªPod ç§»é™¤èŠ‚ç‚¹æ—¶åƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨æ¸…ç†Pod DaemonSeté€‚ç”¨äºæ¯ä¸ªnodeèŠ‚ç‚¹å‡éœ€è¦éƒ¨ç½²ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹çš„åœºæ™¯ï¼Œå¸¸è§çš„åœºæ™¯ä¾‹å¦‚ï¼š æ—¥å¿—é‡‡é›†agentï¼Œå¦‚fluentdæˆ–logstash ç›‘æ§é‡‡é›†agentï¼Œå¦‚Prometheus Node Exporter,Sysdig Agent,Ganglia gmond åˆ†å¸ƒå¼é›†ç¾¤ç»„ä»¶ï¼Œå¦‚Ceph MONï¼ŒCeph OSDï¼Œglusterdï¼ŒHadoop Yarn NodeManagerç­‰ k8så¿…è¦è¿è¡Œç»„ä»¶ï¼Œå¦‚ç½‘ç»œflannelï¼Œweaveï¼Œcalicoï¼Œkube-proxyç­‰ å®‰è£…k8sæ—¶é»˜è®¤åœ¨kube-systemå‘½åç©ºé—´å·²ç»å®‰è£…äº†æœ‰ä¸¤ä¸ªDaemonSetï¼Œåˆ†åˆ«ä¸ºkube-flannel-ds-amd64å’Œkube-proxyï¼Œåˆ†åˆ«è´Ÿè´£flannel overlayç½‘ç»œçš„äº’é€šå’Œserviceä»£ç†çš„å®ç°ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š \\1. æŸ¥çœ‹kube-systemå‘½ä»¤ç©ºé—´çš„DaemonSetåˆ—è¡¨ï¼Œå½“å‰é›†ç¾¤æœ‰ä¸‰ä¸ªnodeèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ¯ä¸ªDSä¼šè¿è¡Œä¸‰ä¸ªPodå‰¯æœ¬ [root@node-1 ~]# kubectl get ds -n kube-system NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE kube-flannel-ds-amd64 3 3 3 3 3 beta.kubernetes.io/arch=amd64 46d kube-proxy 3 3 3 3 3 beta.kubernetes.io/os=linux 46d \\2. æŸ¥çœ‹Podçš„å‰¯æœ¬æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°DaemonSetåœ¨æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªPod ","date":"2019-08-04","objectID":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/:1:0","tags":["kubernetes"],"title":"12 è¯¦è§£DaemonSetæ§åˆ¶å™¨","uri":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 DaemonSetå®šä¹‰ DaemonSetçš„å®šä¹‰å’ŒDeploymentå®šä¹‰ä½¿ç”¨ç›¸ç±»ä¼¼ï¼Œéœ€è¦å®šä¹‰apiVersionï¼ŒKindï¼Œmetadataå’Œspecå±æ€§ä¿¡æ¯ï¼Œspecä¸­ä¸éœ€è¦å®šä¹‰replicasä¸ªæ•°ï¼Œspec.templateå³å®šä¹‰DSç”Ÿæˆå®¹å™¨çš„æ¨¡ç‰ˆä¿¡æ¯ï¼Œå¦‚ä¸‹æ˜¯è¿è¡Œä¸€ä¸ªfluentd-elasticsearché•œåƒå®¹å™¨çš„daemonå®ˆæŠ¤è¿›ç¨‹ï¼Œè¿è¡Œåœ¨æ¯ä¸ªnodeä¸Šé€šè¿‡fluentdé‡‡é›†æ—¥å¿—ä¸ŠæŠ¥åˆ°ElasticSearchã€‚ \\1. é€šè¿‡yamlæ–‡ä»¶å®šä¹‰DaemonSet [root@node-1 happylau]# cat fluentd-es-daemonset.yaml apiVersion: apps/v1 #apiç‰ˆæœ¬ä¿¡æ¯ kind: DaemonSet #ç±»å‹ä¸ºDaemonSet metadata: #å…ƒæ•°æ®ä¿¡æ¯ name: fluentd-elasticsearch namespace: kube-system #è¿è¡Œçš„å‘½åç©ºé—´ labels: k8s-app: fluentd-logging spec: #DSæ¨¡ç‰ˆ selector: matchLabels: name: fluentd-elasticsearch template: metadata: labels: name: fluentd-elasticsearch spec: tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: #å®¹å™¨ä¿¡æ¯ - name: fluentd-elasticsearch image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2 resources: #resourceèµ„æº limits: memory: 200Mi requests: cpu: 100m memory: 200Mi volumeMounts: #æŒ‚è½½å­˜å‚¨ï¼Œagentéœ€è¦åˆ°è¿™äº›ç›®å½•é‡‡é›†æ—¥å¿— - name: varlog mountPath: /var/log - name: varlibdockercontainers mountPath: /var/lib/docker/containers readOnly: true terminationGracePeriodSeconds: 30 volumes: #å°†ä¸»æœºçš„ç›®å½•ä»¥hostPathçš„å½¢å¼æŒ‚è½½åˆ°å®¹å™¨Podä¸­ã€‚ - name: varlog hostPath: path: /var/log - name: varlibdockercontainers hostPath: path: /var/lib/docker/containers DaemonSetå®šä¹‰æ³¨æ„äº‹é¡¹ï¼š daemonset.spec.templateå®šä¹‰Podçš„æ¨¡æ¿ä¿¡æ¯ï¼ŒåŒ…å«çš„metadataä¿¡æ¯éœ€è¦å’Œselectorä¿æŒä¸€è‡´ templateå¿…é¡»å®šä¹‰RestartPolicyçš„ç­–ç•¥ï¼Œåˆ‡ç­–ç•¥å€¼ä¸ºAlwaysï¼Œä¿éšœæœåŠ¡å¼‚å¸¸æ—¶èƒ½è‡ªåŠ¨é‡å¯æ¢å¤ Podè¿è¡Œåœ¨ç‰¹å®šèŠ‚ç‚¹ï¼Œæ”¯æŒæŒ‡å®šè°ƒåº¦ç­–ç•¥ï¼Œå¦‚nodeSelectorï¼ŒNode affinityï¼Œå®ç°çµæ´»è°ƒåº¦ \\2. ç”ŸæˆDaemonSet [root@node-1 happylau]# kubectl apply -f fluentd-es-daemonset.yaml daemonset.apps/fluentd-elasticsearch created \\3. æŸ¥çœ‹DaemonSetåˆ—è¡¨ [root@node-1 happylau]# kubectl get daemonsets -n kube-system fluentd-elasticsearch NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE fluentd-elasticsearch 3 3 3 3 3 \u003cnone\u003e 16s \\4. æŸ¥çœ‹nodeä¸Šè¿è¡ŒPodçš„æƒ…å†µ,åœ¨NODEåˆ—å¯ä»¥çœ‹åˆ°æ¯ä¸ªnodeéƒ½è¿è¡Œäº†ä¸€ä¸ªPod [root@node-1 happylau]# kubectl get pods -n kube-system -o wide |grep fluentd fluentd-elasticsearch-blpqb 1/1 Running 0 3m7s 10.244.2.79 node-3 \u003cnone\u003e \u003cnone\u003e fluentd-elasticsearch-ksdlt 1/1 Running 0 3m7s 10.244.0.11 node-1 \u003cnone\u003e \u003cnone\u003e fluentd-elasticsearch-shtkh 1/1 Running 0 3m7s 10.244.1.64 node-2 \u003cnone\u003e \u003cnone\u003e \\5. æŸ¥çœ‹DaemonSetè¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°DaemonSetæ”¯æŒRollingUpdateæ»šåŠ¨æ›´æ–°ç­–ç•¥ [root@node-1 happylau]# kubectl get daemonsets -n kube-system fluentd-elasticsearch -o yaml apiVersion: extensions/v1beta1 kind: DaemonSet metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\"apiVersion\":\"apps/v1\",\"kind\":\"DaemonSet\",\"metadata\":{\"annotations\":{},\"labels\":{\"k8s-app\":\"fluentd-logging\"},\"name\":\"fluentd-elasticsearch\",\"namespace\":\"kube-system\"},\"spec\":{\"selector\":{\"matchLabels\":{\"name\":\"fluentd-elasticsearch\"}},\"template\":{\"metadata\":{\"labels\":{\"name\":\"fluentd-elasticsearch\"}},\"spec\":{\"containers\":[{\"image\":\"quay.io/fluentd_elasticsearch/fluentd:v2.5.2\",\"name\":\"fluentd-elasticsearch\",\"resources\":{\"limits\":{\"memory\":\"200Mi\"},\"requests\":{\"cpu\":\"100m\",\"memory\":\"200Mi\"}},\"volumeMounts\":[{\"mountPath\":\"/var/log\",\"name\":\"varlog\"},{\"mountPath\":\"/var/lib/docker/containers\",\"name\":\"varlibdockercontainers\",\"readOnly\":true}]}],\"terminationGracePeriodSeconds\":30,\"tolerations\":[{\"effect\":\"NoSchedule\",\"key\":\"node-role.kubernetes.io/master\"}],\"volumes\":[{\"hostPath\":{\"path\":\"/var/log\"},\"name\":\"varlog\"},{\"hostPath\":{\"path\":\"/var/lib/docker/containers\"},\"name\":\"varlibdockercontainers\"}]}}}} creationTimestamp: \"2019-10-30T15:19:20Z\" generation: 1 labels: k8s-app: fluentd-logging name: fluentd-elasticsearch namespace: kube-system resourceVersion: \"6046222\" selfLink: /apis/extensions/v1beta1/namespaces/kube-system/daemonsets/fluentd-elasticsearch uid: c2c02c48-9f93-48f3-9d6c-32bfa671db0e spec: revisionHistoryLimit: 10 selector: matchLabels: name: fluentd-elasticsearch template: metadata: creationTimestamp: null labels: name: fluentd-elasticsearch spec: containers: - image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2 imagePullPolicy: IfNotPresent name: fluentd-elasticsearch resources: limits: memory: 200Mi requests: cpu: 100m memory: 200Mi terminationMessagePath: /dev/termination-log terminationMessagePolicy: File volumeMoun","date":"2019-08-04","objectID":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/:2:0","tags":["kubernetes"],"title":"12 è¯¦è§£DaemonSetæ§åˆ¶å™¨","uri":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 æ»šåŠ¨æ›´æ–°ä¸å›æ»š \\1. æ›´æ–°é•œåƒè‡³æœ€æ–°ç‰ˆæœ¬ [root@node-1 ~]# kubectl set image daemonsets fluentd-elasticsearch fluentd-elasticsearch=quay.io/fluentd_elasticsearch/fluentd:latest -n kube-system daemonset.extensions/fluentd-elasticsearch image updated \\2. æŸ¥çœ‹æ»šåŠ¨æ›´æ–°çŠ¶æ€ [root@node-1 ~]# kubectl rollout status daemonset -n kube-system fluentd-elasticsearch Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 1 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 1 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 1 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 2 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 2 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 2 out of 3 new pods have been updated... Waiting for daemon set \"fluentd-elasticsearch\" rollout to finish: 2 of 3 updated pods are available... daemon set \"fluentd-elasticsearch\" successfully rolled out \\3. æŸ¥çœ‹DaemonSetè¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°DSæ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼šDaemonSetå…ˆå°†nodeä¸Šçš„podåˆ é™¤ç„¶åå†åˆ›å»º \\4. æŸ¥çœ‹DaemonSetæ»šåŠ¨æ›´æ–°ç‰ˆæœ¬ï¼ŒREVSION 1ä¸ºåˆå§‹çš„ç‰ˆæœ¬ [root@node-1 ~]# kubectl rollout history daemonset -n kube-system fluentd-elasticsearch daemonset.extensions/fluentd-elasticsearch REVISION CHANGE-CAUSE 1 \u003cnone\u003e 2 \u003cnone\u003e \\5. æ›´æ–°å›é€€ï¼Œå¦‚æœé…ç½®æ²¡æœ‰ç¬¦åˆåˆ°é¢„æœŸå¯ä»¥å›æ»šåˆ°åŸå§‹çš„ç‰ˆæœ¬ [root@node-1 ~]# kubectl rollout undo daemonset -n kube-system fluentd-elasticsearch --to-revision=1 daemonset.extensions/fluentd-elasticsearch rolled back \\6. ç¡®è®¤ç‰ˆæœ¬å›é€€æƒ…å†µ \\7. è§‚å¯Ÿç‰ˆæœ¬å›é€€çš„è¿‡ç¨‹ï¼Œå›é€€çš„è¿‡ç¨‹å’Œå’Œæ»šåŠ¨æ›´æ–°è¿‡ç¨‹ç±»ä¼¼ï¼Œå…ˆåˆ é™¤Podå†åˆ›å»º \\8. åˆ é™¤DaemonSet [root@node-1 ~]# kubectl delete daemonsets -n kube-system fluentd-elasticsearch daemonset.extensions \"fluentd-elasticsearch\" deleted [root@node-1 ~]# kubectl get pods -n kube-system |grep fluentd fluentd-elasticsearch-d6f6f 0/1 Terminating 0 110m ","date":"2019-08-04","objectID":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/:3:0","tags":["kubernetes"],"title":"12 è¯¦è§£DaemonSetæ§åˆ¶å™¨","uri":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 DaemonSetè°ƒåº¦ å‰é¢kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆä¸ƒï¼‰æ·±å…¥ç©è½¬podè°ƒåº¦æ–‡ç« ä»‹ç»äº†Podçš„è°ƒåº¦æœºåˆ¶ï¼ŒDaemonSeté€šè¿‡kubernetesé»˜è®¤çš„è°ƒåº¦å™¨schedulerä¼šåœ¨æ‰€æœ‰çš„nodeèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªPodå‰¯æœ¬ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸‰ç§æ–¹å¼å°†Podè¿è¡Œåœ¨éƒ¨åˆ†èŠ‚ç‚¹ä¸Šï¼š æŒ‡å®šnodeNameèŠ‚ç‚¹è¿è¡Œ é€šè¿‡æ ‡ç­¾è¿è¡ŒnodeSelector é€šè¿‡äº²å’ŒåŠ›è°ƒåº¦node Affinityå’Œnode Anti-affinity DaemonSetè°ƒåº¦ç®—æ³•ç”¨äºå®ç°å°†Podè¿è¡Œåœ¨ç‰¹å®šçš„nodeèŠ‚ç‚¹ä¸Šï¼Œå¦‚ä¸‹ä»¥é€šè¿‡node affinityäº²å’ŒåŠ›å°†Podè°ƒåº¦åˆ°éƒ¨åˆ†çš„èŠ‚ç‚¹ä¸Šnode-2ä¸Šä¸ºä¾‹ã€‚ \\1. ä¸ºnodeæ·»åŠ ä¸€ä¸ªapp=webçš„labels [root@node-1 happylau]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS node-1 Ready master 47d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-1,kubernetes.io/os=linux,node-role.kubernetes.io/master= node-2 Ready \u003cnone\u003e 47d v1.15.3 app=web,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-2,kubernetes.io/os=linux node-3 Ready \u003cnone\u003e 47d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-3,kubernetes.io/os=linux \\2. æ·»åŠ node affinityäº²å’ŒåŠ›è°ƒåº¦ç®—æ³•ï¼ŒrequiredDuringSchedulingIgnoredDuringExecutionè®¾ç½®åŸºæœ¬éœ€è¦æ»¡è¶³æ¡ä»¶ï¼ŒpreferredDuringSchedulingIgnoredDuringExecutionè®¾ç½®ä¼˜é€‰æ»¡è¶³æ¡ä»¶ [root@node-1 happylau]# cat fluentd-es-daemonset.yaml apiVersion: apps/v1 kind: DaemonSet metadata: name: fluentd-elasticsearch namespace: kube-system labels: k8s-app: fluentd-logging spec: selector: matchLabels: name: fluentd-elasticsearch template: metadata: labels: name: fluentd-elasticsearch spec: tolerations: - key: node-role.kubernetes.io/master effect: NoSchedule containers: - name: fluentd-elasticsearch image: quay.io/fluentd_elasticsearch/fluentd:v2.5.2 resources: limits: memory: 200Mi requests: cpu: 100m memory: 200Mi volumeMounts: - name: varlog mountPath: /var/log - name: varlibdockercontainers mountPath: /var/lib/docker/containers readOnly: true affinity: nodeAffinity: preferredDuringSchedulingIgnoredDuringExecution: #ä¼˜å…ˆæ»¡è¶³æ¡ä»¶ - weight: 1 preference: matchExpressions: - key: app operator: In values: - web requiredDuringSchedulingIgnoredDuringExecution: #è¦æ±‚æ»¡è¶³æ¡ä»¶ nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - node-2 - node-3 terminationGracePeriodSeconds: 30 volumes: - name: varlog hostPath: path: /var/log - name: varlibdockercontainers hostPath: path: /var/lib/docker/containers \\3. ç”ŸæˆDSï¼Œå¹¶æŸ¥çœ‹åˆ—è¡¨ [root@node-1 happylau]# kubectl delete ds -n kube-system fluentd-elasticsearch daemonset.extensions \"fluentd-elasticsearch\" deleted [root@node-1 happylau]# kubectl get daemonsets -n kube-system fluentd-elasticsearch NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE fluentd-elasticsearch 1 1 1 1 1 \u003cnone\u003e 112s \\4. æ ¡éªŒPodè¿è¡Œçš„æƒ…å†µï¼ŒDaemonSetçš„Podè°ƒåº¦åˆ°node-2èŠ‚ç‚¹ä¸Š [root@node-1 happylau]# kubectl get pods -n kube-system -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES \u003cnone\u003e fluentd-elasticsearch-9kngs 1/1 Running 0 2m39s 10.244.1.82 node-2 \u003cnone\u003e \u003cnone\u003e å†™åœ¨æœ€å æœ¬æ–‡ä»‹ç»äº†kubernetesä¸­DaemonSetæ§åˆ¶å™¨ï¼ŒDSæ§åˆ¶å™¨èƒ½ç¡®ä¿æ‰€æœ‰çš„èŠ‚ç‚¹è¿è¡Œä¸€ä¸ªç‰¹å®šçš„daemonå®ˆæŠ¤è¿›ç¨‹ï¼Œæ­¤å¤–é€šè¿‡nodeSelectoræˆ–node Affinityèƒ½å¤Ÿå®ç°å°†Podè°ƒåº¦åˆ°ç‰¹å®šçš„nodeèŠ‚ç‚¹ã€‚ å‚è€ƒæ–‡æ¡£ DaemonSet**ï¼š**https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/:4:0","tags":["kubernetes"],"title":"12 è¯¦è§£DaemonSetæ§åˆ¶å™¨","uri":"/myBlog-2/post/12-%E8%AF%A6%E8%A7%A3daemonset%E6%8E%A7%E5%88%B6%E5%99%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1. Jobsè®©å•æ¬¡ä»»åŠ¡è·‘èµ·æ¥ ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:0:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 Jobsç®€ä»‹ Windowsä¸‹å¯ä»¥é€šè¿‡æ‰¹å¤„ç†è„šæœ¬å®Œæˆæ‰¹å¤„ç†ä»»åŠ¡ï¼Œè„šæœ¬è¿è¡Œå®Œæ¯•åä»»åŠ¡å³å¯ç»ˆæ­¢ï¼Œä»è€Œå®ç°æ‰¹å¤„ç†ä»»åŠ¡è¿è¡Œå·¥ä½œï¼Œç±»ä¼¼çš„ä»»åŠ¡å¦‚ä½•åœ¨kubernetesä¸­è¿è¡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯Jobsï¼ŒJobsæ˜¯kubernetesä¸­å®ç°ä¸€æ¬¡æ€§è®¡åˆ’ä»»åŠ¡çš„Podæ§åˆ¶å™¨â€”JobControllerï¼Œé€šè¿‡æ§åˆ¶Podæ¥æ‰§è¡Œä»»åŠ¡ï¼Œå…¶ç‰¹ç‚¹ä¸ºï¼š åˆ›å»ºPodè¿è¡Œç‰¹å®šä»»åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡è¿è¡Œå®Œæˆ ä»»åŠ¡è¿è¡ŒæœŸé—´èŠ‚ç‚¹å¼‚å¸¸æ—¶ä¼šè‡ªåŠ¨é‡æ–°åˆ›å»ºPod æ”¯æŒå¹¶å‘åˆ›å»ºPodä»»åŠ¡æ•°å’ŒæŒ‡å®šä»»åŠ¡æ•° Jobsä»»åŠ¡è¿è¡Œæ–¹å¼æœ‰å¦‚ä¸‹ä¸‰ç§ï¼š è¿è¡Œå•ä¸ªJobsä»»åŠ¡ï¼Œä¸€èˆ¬è¿è¡Œä¸€ä¸ªpodï¼Œpodè¿è¡Œç»“æŸä»»åŠ¡è¿è¡Œå®Œæˆï¼› è¿è¡Œç‰¹å®šæ•°é‡çš„ä»»åŠ¡ï¼Œé€šè¿‡completionæŒ‡å®šæ€»è®¡è¿è¡Œä»»åŠ¡ï¼› å¹¶å‘è¿è¡Œä»»åŠ¡ï¼Œé€šè¿‡parallelismæŒ‡å®šå¹¶å‘æ•° ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:1:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 è¿è¡Œå•ä¸ªJobsä»»åŠ¡ 1ã€ å®šä¹‰ä¸€ä¸ªjobsä»»åŠ¡ï¼Œé€šè¿‡åœ¨commandä¸­è¿è¡Œç‰¹å®šä¸€ä¸ªè„šæœ¬ï¼Œå°†å½“å‰çš„æ—¶é—´æ‰“å°100æ¬¡ apiVersion: batch/v1 kind: Job metadata: name: jobs-demo labels: controller: jobs spec: parallelism: 1 #å¹¶å‘æ•°ï¼Œé»˜è®¤ä¸º1ï¼Œå³åˆ›å»ºpodå‰¯æœ¬çš„æ•°é‡ template: metadata: name: jobs-demo labels: controller: jobs spec: containers: - name: echo-time image: centos:latest imagePullPolicy: IfNotPresent command: - /bin/sh - -c - \"for i in `seq 0 100`;do echo ${date} \u0026\u0026 sleep 1;done\" restartPolicy: Never #è®¾ç½®ä¸ºNeverï¼Œjobsä»»åŠ¡è¿è¡Œå®Œæ¯•å³å¯å®Œæˆ 2ã€ è¿è¡ŒJobsä»»åŠ¡ [root@node-1 happylau]# kubectl apply -f job-demo.yaml job.batch/job-demo created [root@node-1 happylau]# kubectl get jobs job-demo NAME COMPLETIONS DURATION AGE job-demo 0/1 41s 41s 3ã€ æ­¤æ—¶jobsæ§åˆ¶å™¨åˆ›å»ºäº†ä¸€ä¸ªpodå®¹å™¨è¿è¡Œä»»åŠ¡,æ­¤æ—¶å¤„äºRunningçŠ¶æ€ï¼Œä»»åŠ¡å¤„åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¦‚æœè¿è¡Œå®Œæ¯•åˆ™ä¼šå˜ä¸ºcompletedçŠ¶æ€ [root@node-1 happylau]# kubectl get pods |grep job job-demo-ssrk7 1/1 Running 0 97s 4ã€æŸ¥çœ‹jobsæ—¥å¿—æ—¥å¿—æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°å½“å‰jobsåˆ›å»ºçš„ä»»åŠ¡æ˜¯æŒç»­åœ¨ç»ˆç«¯ä¸­æ‰“å°æ•°å­—ï¼Œä¸”æ¯æ¬¡æ‰“å°æš‚åœ1sé’Ÿ 5ã€å†æ¬¡æŸ¥çœ‹jobsçš„ä»»åŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ä»»åŠ¡å·²ç»completionsï¼Œè¿è¡Œæ—¶é•¿ä¸º103s,å¯¹åº”çš„podçŠ¶æ€å¤„äºcompletedçŠ¶æ€ [root@node-1 ~]# kubectl get jobs NAME COMPLETIONS DURATION AGE job-demo 1/1 103s 5m12s ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:2:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 Jobsè¿è¡Œå¤šä¸ªä»»åŠ¡ Jobsæ§åˆ¶å™¨æä¾›äº†ä¸¤ä¸ªæ§åˆ¶å¹¶å‘æ•°çš„å‚æ•°ï¼šcompletionså’Œparallelismï¼Œcompletionsè¡¨ç¤ºéœ€è¦è¿è¡Œä»»åŠ¡æ•°çš„æ€»æ•°ï¼Œparallelismè¡¨ç¤ºå¹¶å‘è¿è¡Œçš„ä¸ªæ•°ï¼Œå¦‚è®¾ç½®ä¸º1åˆ™ä¼šä¾æ¬¡è¿è¡Œä»»åŠ¡ï¼Œå‰é¢ä»»åŠ¡è¿è¡Œå†è¿è¡Œåé¢çš„ä»»åŠ¡ï¼Œå¦‚ä¸‹ä»¥åˆ›å»º5ä¸ªä»»åŠ¡æ•°ä¸ºä¾‹æ¼”ç¤ºJobsæ§åˆ¶å™¨å®ç°å¹¶å‘æ•°çš„æœºåˆ¶ã€‚ 1ã€ å®šä¹‰è®¡ç®—åœ†å‘¨ç‡çš„Jobsä»»åŠ¡ apiVersion: batch/v1 kind: Job metadata: name: pi spec: template: spec: containers: - name: pi image: perl command: [\"perl\", \"-Mbignum=bpi\", \"-wle\", \"print bpi(100)\"] restartPolicy: Never parallelism: 1 completions: 5 2ã€è¿è¡Œjobsä»»åŠ¡ï¼Œå¹¶ç”¨kubectl get jobs â€“watchæŸ¥çœ‹jobsåˆ›å»ºè¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°podä»»åŠ¡æ˜¯ä¾æ¬¡è¿è¡Œï¼Œç›´è‡³è¾¾åˆ°completionsæ‰€å®šä¹‰çš„æ•°é‡ 3ã€Jobsä»»åŠ¡éƒ½å·²è¿è¡Œå®Œæ¯•ï¼ŒæŸ¥çœ‹Jobsåˆ—è¡¨å¯ä»¥çœ‹åˆ°ä»»åŠ¡éƒ½å¤„äºCompletedçŠ¶æ€ï¼ŒæŸ¥çœ‹podæ—¥å¿—å¯ä»¥çœ‹åˆ°Piåœ†å‘¨ç‡è®¡ç®—çš„ç»“æœ ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:3:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 Jobsè¿è¡Œå¹¶å‘ä»»åŠ¡ Jobsæ§åˆ¶å™¨æ”¯æŒè¿è¡Œå¹¶å‘ä»»åŠ¡ï¼Œå¹¶å‘ä»»åŠ¡å³Jobsæ§åˆ¶å™¨ä¸€æ¬¡è¿è¡Œå¤šä¸ªPodæ‰§è¡Œä»»åŠ¡å¤„ç†ï¼Œå¦‚ä¸‹ä»¥ä¸€æ¬¡æ€§è¿è¡Œ3ä¸ªPodå¹¶å‘æ•°ä¸ºä¾‹æ¼”ç¤ºé€šè¿‡Jobsæ§åˆ¶å™¨å®ç°å¹¶å‘ä»»åŠ¡ 1ã€å®šä¹‰Jobsä»»åŠ¡ï¼Œè®¾ç½®3ä¸ªå¹¶å‘æ•°ä»»åŠ¡ apiVersion: batch/v1 kind: Job metadata: name: jobs-demo labels: controller: jobs spec: parallelism: 3 #è¿è¡Œå¹¶å‘æ•°ä¸º3ï¼Œä¸€æ¬¡æ€§åˆ›å»º3ä¸ªpod template: metadata: name: jobs-demo labels: controller: jobs spec: containers: - name: echo-time image: centos:latest imagePullPolicy: IfNotPresent command: - /bin/sh - -c - \"for i in `seq 0 10`;do echo `date` \u0026\u0026 sleep 1;done\" restartPolicy: Never 2ã€è¿è¡ŒJobsä»»åŠ¡å¹¶æŸ¥çœ‹,Jobsæ§åˆ¶å™¨åŒæ—¶åˆ›å»ºäº†3ä¸ªå¹¶å‘ä»»åŠ¡ 3ã€é€šè¿‡ä¸Šé¢çš„æ¼”ç¤ºå¯çŸ¥ï¼Œé€šè¿‡parallelismæŒ‡å®šå¹¶å‘æ•°é‡ï¼ŒJobsæ§åˆ¶å™¨ä¼šåˆ›å»ºå‡ºå¤šä¸ªPodå‰¯æœ¬å¹¶è¿è¡Œç›´è‡³ä»»åŠ¡completedï¼ŒåŒæ—¶parallelismå¯ä»¥é…åˆcompletionsä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡å¹¶å‘åˆ›å»ºç‰¹å®šæ•°é‡çš„ä»»åŠ¡ï¼Œå¦‚ä¸‹ä»¥å•æ¬¡è¿è¡Œ3ä¸ªå¹¶å‘ä»»åŠ¡å®ç°9ä¸ªä»»åŠ¡çš„Jobsä»»åŠ¡ apiVersion: batch/v1 kind: Job metadata: name: jobs-demo labels: controller: jobs spec: parallelism: 3 #å¹¶å‘ä»»åŠ¡ä¸º3 completions: 9 #ä»»åŠ¡æ•°ä¸º9 template: metadata: name: jobs-demo labels: controller: jobs spec: containers: - name: echo-time image: centos:latest imagePullPolicy: IfNotPresent command: - /bin/sh - -c - \"for i in `seq 0 10`;do echo `date` \u0026\u0026 sleep 1;done\" restartPolicy: Never 4ã€è¿è¡ŒJobsä»»åŠ¡å¹¶è§‚å¯Ÿåˆ›å»ºè¿‡ç¨‹,åœ¨describe jobsçš„è¯¦æƒ…eventsæ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°ä¸€å…±åˆ›å»ºäº†9ä¸ªä»»åŠ¡ï¼Œæ¯3ä¸ªä»»åŠ¡åˆ›å»ºæ—¶é—´ä¸€æ ·ï¼Œå³å¹¶å‘åˆ›å»ºçš„ä»»åŠ¡ æ€»ç»“ï¼šé€šè¿‡å‰é¢çš„ä¾‹å­è§£æå¯å¾—çŸ¥ï¼ŒJobsèƒ½åœ¨kubernetesä¸­å®ç°ç±»ä¼¼Windowsä¸‹æ‰¹å¤„ç†æˆ–Linuxä¸‹shellä»»åŠ¡çš„åŠŸèƒ½ï¼Œé€šè¿‡è¿è¡Œç‰¹å®šä»»åŠ¡æ•°+å¹¶å‘æ•°æ§åˆ¶åˆ›å»ºPodä»»åŠ¡ã€‚éœ€è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼ŒJobsæ§åˆ¶å™¨å’ŒDeploymentså‰¯æœ¬æ§åˆ¶å™¨ä¸ä¸€æ ·ï¼Œå…¶ä¸æ”¯æŒä¿®æ”¹Jobsçš„yamlæ–‡ä»¶ï¼Œå¦‚æœæœ‰éœ€è¦ä¿®æ”¹åˆ™éœ€è¦æå‰å°†Jobsä»»åŠ¡åˆ é™¤ï¼Œç„¶åå†å°†ä¿®æ”¹åçš„yamlæäº¤ä»»åŠ¡ã€‚ 2. CronJobså‘¨æœŸæ€§è¿è½¬ ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:4:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 CronJobsç®€ä»‹ CronJobsç”¨äºå®ç°ç±»ä¼¼Linuxä¸‹çš„cronjobå‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡ï¼ŒCronJobsæ§åˆ¶å™¨é€šè¿‡æ—¶é—´çº¿åˆ›å»ºJobsä»»åŠ¡ï¼Œä»è€Œå®Œæˆä»»åŠ¡çš„æ‰§è¡Œå¤„ç†ï¼Œå…¶å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š å®ç°å‘¨æœŸæ€§è®¡åˆ’ä»»åŠ¡ è°ƒç”¨Jobsæ§åˆ¶å™¨åˆ›å»ºä»»åŠ¡ CronJobsä»»åŠ¡åç§°å°äº52ä¸ªå­—ç¬¦ åº”ç”¨åœºæ™¯å¦‚ï¼šå®šæœŸå¤‡ä»½ï¼Œå‘¨æœŸæ€§å‘é€é‚®ä»¶ CronJobså¯é€šè¿‡scheduleæŒ‡å®šä»»åŠ¡è¿è¡Œçš„å‘¨æœŸï¼Œå…¶ä½¿ç”¨å‚æ•°å’Œcronjobç±»ä¼¼ï¼Œåˆ†åˆ«ä½¿ç”¨ï¼šåˆ†æ—¶æ—¥æœˆæ˜Ÿ5ä¸ªå‚æ•°è¡¨ç¤ºå‘¨æœŸæ€§ï¼Œå…¶ä¸­*è¡¨ç¤ºä»»æ„æ—¶é—´ç‚¹ï¼Œ/è¡¨ç¤ºæ¯éš”å¤šä¹…ï¼Œ-è¡¨ç¤ºèŒƒå›´ åˆ†é’Ÿ èŒƒå›´ä¸º0-59 å°æ—¶ èŒƒå›´ä¸º0-23 æ—¥æœŸ èŒƒå›´ä¸º1-31 æœˆä»½ èŒƒå›´ä¸º1-12 æ˜ŸæœŸ èŒƒå›´ä¸º0-7ï¼Œå…¶ä¸­0å’Œ7è¡¨ç¤ºæ˜ŸæœŸæ—¥ ä¸¾ä¾‹å­è¯´æ˜ï¼š 1ã€ /1 * * * è¡¨ç¤ºæ¯éš”1åˆ†é’Ÿè¿è¡Œä»»åŠ¡ 2ã€ 1 0 * * 6-7 è¡¨ç¤ºæ¯å‘¨å…­æ—¥çš„0ç‚¹01åˆ†è¿è¡Œä»»åŠ¡ ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:5:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 è¿è¡ŒCronjobsä»»åŠ¡ CronJobsä»»åŠ¡æ˜¯ç¼–å†™å’ŒDeploymentsç±»ä¼¼ï¼Œéœ€å•Šå“Ÿä¸€ä¸ªscheduleå®šæœŸä»»åŠ¡è°ƒåº¦å‘¨æœŸï¼Œé€šè¿‡jobTemplateå®šä¹‰ç”ŸæˆJobsä»»åŠ¡çš„æ¨¡ç‰ˆï¼Œå®šä¹‰ä¸€ä¸ªä»»åŠ¡ä¸ºä¾‹ï¼š 1ã€ å®šä¹‰ä¸€ä¸ªCronJobsä»»åŠ¡ï¼Œæ¯éš”5åˆ†é’Ÿè¿è¡Œä¸€ä¸ªä»»åŠ¡ apiVersion: batch/v1beta1 kind: CronJob metadata: name: cronjob-demo labels: jobgroup: cronjob-demo spec: schedule: \"*/5 * * * *\" #è°ƒåº¦ä»»åŠ¡å‘¨æœŸ jobTemplate: #åˆ›å»ºJobsä»»åŠ¡æ¨¡ç‰ˆ spec: template: spec: containers: - name: cronjob-demo image: busybox:latest imagePullPolicy: IfNotPresent command: - /bin/sh - -c - \"for i in `seq 0 100`;do echo ${i} \u0026\u0026 sleep 1;done\" restartPolicy: Never 2ã€ è¿è¡ŒCronJobså¹¶æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ 3ã€æ ¡éªŒCronJobsä»»åŠ¡è¿è¡Œçš„æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°CronJobsä»»åŠ¡è°ƒç”¨Jobsæ§åˆ¶å™¨åˆ›å»ºPodï¼ŒPodåˆ›å»ºå‘¨æœŸå’Œscheduleä¸­å®šä¹‰çš„å‘¨æœŸä¸€è‡´ å½“ç„¶ï¼ŒCronJobsä¸­é€šè¿‡Jobsçš„æ¨¡ç‰ˆä¹Ÿå¯ä»¥å®šä¹‰è¿è¡Œä»»åŠ¡çš„æ•°é‡å’Œå¹¶å‘æ•°ï¼Œå®ç°è®¡åˆ’æ—¶é—´èŒƒå›´å†…å¹¶å‘è¿è¡Œå¤šä¸ªä»»åŠ¡çš„éœ€æ±‚ã€‚ å†™åœ¨æœ€å æ–‡ç« æ€»ç»“äº†åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡ŒJobsæ‰¹å¤„ç†ä»»åŠ¡å’ŒCronJobsä¸¤ç§æ§åˆ¶å™¨çš„åŠŸèƒ½ä½¿ç”¨ï¼Œé€‚ç”¨äºç‰¹å®šåœºæ™¯ä¸‹ä»»åŠ¡ï¼ŒJobsä»»åŠ¡æ‰§è¡Œå®Œæ¯•å³completedï¼ŒCronJobså‘¨æœŸæ€§è°ƒç”¨Jobsæ§åˆ¶å™¨å®Œæˆä»»åŠ¡çš„åˆ›å»ºæ‰§è¡Œã€‚ å‚è€ƒæ–‡ç«  ä¸é”™çš„åšå®¢ï¼šhttps://draveness.me/kubernetes-job-cronjob è¿è¡ŒJobsä»»åŠ¡ï¼šhttps://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/ è®¡åˆ’ä»»åŠ¡ConJobs:https://kubernetes.io/docs/concepts/workloads/controllers/cron-jobs/ è‡ªåŠ¨è¿è¡Œä»»åŠ¡ï¼šhttps://kubernetes.io/docs/tasks/job/automated-tasks-with-cron-jobs/ TKEåˆ›å»ºJobsä»»åŠ¡ï¼šhttps://cloud.tencent.com/document/product/457/31708 TKEåˆ›å»ºCronJobsï¼š[https://cloud.tencent.com/document/product/457/31709 ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/:6:0","tags":["kubernetes"],"title":"13 ä¸€æ¬¡æ€§ä»»åŠ¡Jobå’Œå‘¨æœŸä»»åŠ¡","uri":"/myBlog-2/post/13-%E4%B8%80%E6%AC%A1%E6%80%A7%E4%BB%BB%E5%8A%A1job%E5%92%8C%E5%91%A8%E6%9C%9F%E4%BB%BB%E5%8A%A1/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ æœ¬ç« ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹çš„ingressæ¦‚å¿µï¼Œåœ¨kubernetesä¸­å¯¹å¤–æš´éœ²æœåŠ¡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼šserviceï¼ˆNodePortæˆ–è€…å¤–éƒ¨LoadBalancerï¼‰å’Œingressï¼Œå…¶ä¸­serviceæ˜¯æä¾›å››å±‚çš„è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡iptables DNATæˆ–lvs natæ¨¡å¼å®ç°åç«¯Podçš„ä»£ç†è¯·æ±‚ã€‚å¦‚éœ€å®ç°httpï¼ŒåŸŸåï¼ŒURIï¼Œè¯ä¹¦ç­‰è¯·æ±‚æ–¹å¼ï¼Œserviceæ˜¯æ— æ³•å®ç°çš„ï¼Œéœ€è¦å€ŸåŠ©äºingressæ¥æ¥å®ç°ï¼Œæœ¬æ–‡å°†æ¥ä»‹ç»ingressç›¸å…³çš„å†…å®¹ã€‚ 1. Ingressç®€ä»‹ An API object that manages external access to the services in a cluster, typically HTTP. Ingress can provide load balancing, SSL termination and name-based virtual hosting. å¼•ç”¨å®˜æ–¹å…³äºingressçš„ä»‹ç»æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œingressæ˜¯ä¸€ç§é€šè¿‡httpåè®®æš´éœ²kuberneteså†…éƒ¨æœåŠ¡çš„apiå¯¹è±¡ï¼Œå³å……å½“Edge Routerè¾¹ç•Œè·¯ç”±å™¨çš„è§’è‰²å¯¹å¤–åŸºäºä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡è°ƒåº¦æœºåˆ¶ï¼Œèƒ½å¤Ÿæä¾›ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚è‡ªåŠ¨è´Ÿè½½å‡è¡¡åˆ°åç«¯çš„Podä¸Šï¼› SSLåŠ å¯†ï¼Œå®¢æˆ·ç«¯åˆ°Ingress Controllerä¸ºhttpsåŠ å¯†ï¼Œåˆ°åç«¯Podä¸ºæ˜æ–‡çš„httpï¼› åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºï¼Œæä¾›åŸºäºåŸŸåæˆ–URIæ›´çµæ´»çš„è·¯ç”±æ–¹å¼ å®ç°IngressåŒ…å«çš„ç»„ä»¶æœ‰ï¼š Ingressï¼Œå®¢æˆ·ç«¯ï¼Œè´Ÿè´£å®šä¹‰ingressé…ç½®ï¼Œå°†è¯·æ±‚è½¬å‘ç»™Ingress Controllerï¼› Ingress Controllerï¼ŒIngressæ§åˆ¶å™¨ï¼Œå®ç°ä¸ƒå±‚è½¬å‘çš„Edge Routerï¼Œé€šè¿‡è°ƒç”¨k8sçš„apiåŠ¨æ€æ„ŸçŸ¥é›†ç¾¤ä¸­Podçš„å˜åŒ–è€ŒåŠ¨æ€æ›´æ–°é…ç½®æ–‡ä»¶å¹¶é‡è½½ï¼Œ Controlleréœ€è¦éƒ¨ç½²åœ¨k8sé›†ç¾¤ä¸­ä»¥å®ç°å’Œé›†ç¾¤ä¸­çš„podé€šä¿¡ï¼Œé€šå¸¸ä»¥DaemonSetsæˆ–Deploymentsçš„å½¢å¼éƒ¨ç½²ï¼Œå¹¶å¯¹å¤–æš´éœ²80å’Œ443ç«¯å£ï¼Œå¯¹äºDaemonSetsæ¥è¯´ï¼Œä¸€èˆ¬æ˜¯ä»¥hostNetworkæˆ–è€…hostPortçš„å½¢å¼æš´éœ²ï¼ŒDeploymentsåˆ™ä»¥NodePortçš„æ–¹å¼æš´éœ²ï¼Œæ§åˆ¶å™¨çš„å¤šä¸ªèŠ‚ç‚¹åˆ™å€ŸåŠ©å¤–éƒ¨è´Ÿè½½å‡è¡¡ExternalLBä»¥å®ç°ç»Ÿä¸€æ¥å…¥ï¼› Ingressé…ç½®è§„åˆ™ï¼ŒControlleræ§åˆ¶å™¨é€šè¿‡serviceæœåŠ¡å‘ç°æœºåˆ¶åŠ¨æ€å®ç°åç«¯Podè·¯ç”±è½¬å‘è§„åˆ™çš„å®ç°ï¼› Serviceï¼Œkuberntesä¸­å››å±‚çš„è´Ÿè½½å‡è¡¡è°ƒåº¦æœºåˆ¶ï¼ŒIngresså€ŸåŠ©serviceçš„æœåŠ¡å‘ç°æœºåˆ¶å®ç°é›†ç¾¤ä¸­Podèµ„æºçš„åŠ¨æ€æ„ŸçŸ¥ï¼› Podï¼Œåç«¯å®é™…è´Ÿè´£å“åº”è¯·æ±‚å®¹å™¨ï¼Œç”±æ§åˆ¶å™¨å¦‚Deploymentåˆ›å»ºï¼Œé€šè¿‡æ ‡ç­¾Labelså’Œserviceå…³è”ï¼ŒæœåŠ¡å‘ç°ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œingressæ§åˆ¶å™¨å€ŸåŠ©serviceçš„æœåŠ¡å‘ç°æœºåˆ¶å®ç°é…ç½®çš„åŠ¨æ€æ›´æ–°ä»¥å®ç°Podçš„è´Ÿè½½å‡è¡¡æœºåˆ¶å®ç°ï¼Œç”±äºæ¶‰åŠåˆ°Ingress Controllerçš„åŠ¨æ€æ›´æ–°ï¼Œç›®å‰ç¤¾åŒºIngress Controllerå¤§ä½“åŒ…å«ä¸¤ç§ç±»å‹çš„æ§åˆ¶å™¨ï¼š ä¼ ç»Ÿçš„ä¸ƒå±‚è´Ÿè½½å‡è¡¡å¦‚Nginxï¼ŒHAproxyï¼Œå¼€å‘äº†é€‚åº”å¾®æœåŠ¡åº”ç”¨çš„æ’ä»¶ï¼Œå…·æœ‰æˆç†Ÿï¼Œé«˜æ€§èƒ½ç­‰ä¼˜ç‚¹ï¼› æ–°å‹å¾®æœåŠ¡è´Ÿè½½å‡è¡¡å¦‚Traefikï¼ŒEnvoyï¼ŒIstioï¼Œä¸“é—¨é€‚ç”¨äºå¾®æœåŠ¡+å®¹å™¨åŒ–åº”ç”¨åœºæ™¯ï¼Œå…·æœ‰åŠ¨æ€æ›´æ–°ç‰¹ç‚¹ï¼› ç±»å‹ å¸¸è§ç±»å‹ ä¼˜ç‚¹ ç¼ºç‚¹ ä¼ ç»Ÿè´Ÿè½½å‡è¡¡ nginxï¼Œhaproxy æˆç†Ÿï¼Œç¨³å®šï¼Œé«˜æ€§èƒ½ åŠ¨æ€æ›´æ–°éœ€reloadé…ç½®æ–‡ä»¶ å¾®æœåŠ¡è´Ÿè½½å‡è¡¡ Traefikï¼ŒEnvoyï¼ŒIstio å¤©ç”Ÿä¸ºå¾®æœåŠ¡è€Œç”Ÿï¼ŒåŠ¨æ€æ›´æ–° æ€§èƒ½è¿˜æœ‰å¾…æå‡ 2. Nginx Ingress ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:0:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 Nginx ingressä»‹ç» By default, pods of Kubernetes services are not accessible from the external network, but only by other pods within the Kubernetes cluster. Kubernetes has a builtâ€‘in configuration for HTTP load balancing, called Ingress, that defines rules for external connectivity to Kubernetes services. Users who need to provide external access to their Kubernetes services create an Ingress resource that defines rules, including the URI path, backing service name, and other information. The Ingress controller can then automatically program a frontend load balancer to enable Ingress configuration. The NGINX Ingress Controller for Kubernetes is what enables Kubernetes to configure NGINX and NGINX Plus for load balancing Kubernetes services. Nginx Ingress Controlleræ˜¯å®ç°ingressçš„å…·ä½“å®ç°ï¼ŒåŒ…å«æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šNgnix OSSå’ŒNginx Plusç‰ˆï¼Œåè€…æ˜¯å•†ä¸šåŒ–å¢å¼ºç‰ˆï¼Œæ”¯æŒæ›´å¤šçš„åŠŸèƒ½ï¼Œè¯¦æƒ…å‚è€ƒå®˜æ–¹æ–‡æ¡£ä»‹ç»https://www.nginx.com/products/nginx/kubernetes-ingress-controller#compare-versions ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:1:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 Nginx ingresså®‰è£… é¦–å…ˆéœ€è¦å®‰è£…Nginx Ingress Controlleræ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨å®‰è£…æ–¹å¼åŒ…å«ä¸¤ç§ï¼šDaemonSetså’ŒDeploymentsã€‚ DaemonSetsé€šè¿‡hostPortçš„æ–¹å¼æš´éœ²80å’Œ443ç«¯å£ï¼Œå¯é€šè¿‡Nodeçš„è°ƒåº¦ç”±ä¸“é—¨çš„èŠ‚ç‚¹å®ç°éƒ¨ç½² Deploymentsåˆ™é€šè¿‡NodePortçš„æ–¹å¼å®ç°æ§åˆ¶å™¨ç«¯å£çš„æš´éœ²ï¼Œå€ŸåŠ©å¤–éƒ¨è´Ÿè½½å‡è¡¡å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦éƒ¨ç½²Namespaceï¼ŒServiceAccountï¼ŒRBACï¼ŒSecretsï¼ŒCustom Resource Definitionsç­‰èµ„æºï¼Œå¦‚ä¸‹å¼€å§‹éƒ¨ç½²ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:2:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2.1 åŸºç¡€ä¾èµ–ç¯å¢ƒå‡†å¤‡ 1ã€githubä¸­ä¸‹è½½æºç åŒ…,å®‰è£…éƒ¨ç½²æ–‡ä»¶åœ¨kubernetes-ingress/deployments/ç›®å½•ä¸‹ [root@node-1 ~]# git clone https://github.com/nginxinc/kubernetes-ingress.git [root@node-1 ~]# tree kubernetes-ingress/deployments/ kubernetes-ingress/deployments/ â”œâ”€â”€ common â”‚ â”œâ”€â”€ custom-resource-definitions.yaml è‡ªå®šä¹‰èµ„æº â”‚ â”œâ”€â”€ default-server-secret.yaml Secrets â”‚ â”œâ”€â”€ nginx-config.yaml â”‚ â””â”€â”€ ns-and-sa.yaml Namspace+ServiceAccount â”œâ”€â”€ daemon-set â”‚ â”œâ”€â”€ nginx-ingress.yaml DaemonSetsæ§åˆ¶å™¨ â”‚ â””â”€â”€ nginx-plus-ingress.yaml â”œâ”€â”€ deployment â”‚ â”œâ”€â”€ nginx-ingress.yaml Deploymentsæ§åˆ¶å™¨ â”‚ â””â”€â”€ nginx-plus-ingress.yaml â”œâ”€â”€ helm-chart Helmå®‰è£…åŒ… â”‚ â”œâ”€â”€ chart-icon.png â”‚ â”œâ”€â”€ Chart.yaml â”‚ â”œâ”€â”€ README.md â”‚ â”œâ”€â”€ templates â”‚ â”‚ â”œâ”€â”€ controller-configmap.yaml â”‚ â”‚ â”œâ”€â”€ controller-custom-resources.yaml â”‚ â”‚ â”œâ”€â”€ controller-daemonset.yaml â”‚ â”‚ â”œâ”€â”€ controller-deployment.yaml â”‚ â”‚ â”œâ”€â”€ controller-leader-election-configmap.yaml â”‚ â”‚ â”œâ”€â”€ controller-secret.yaml â”‚ â”‚ â”œâ”€â”€ controller-serviceaccount.yaml â”‚ â”‚ â”œâ”€â”€ controller-service.yaml â”‚ â”‚ â”œâ”€â”€ controller-wildcard-secret.yaml â”‚ â”‚ â”œâ”€â”€ _helpers.tpl â”‚ â”‚ â”œâ”€â”€ NOTES.txt â”‚ â”‚ â””â”€â”€ rbac.yaml â”‚ â”œâ”€â”€ values-icp.yaml â”‚ â”œâ”€â”€ values-plus.yaml â”‚ â””â”€â”€ values.yaml â”œâ”€â”€ rbac RBACè®¤è¯æˆæƒ â”‚ â””â”€â”€ rbac.yaml â”œâ”€â”€ README.md â””â”€â”€ service Serviceå®šä¹‰ â”œâ”€â”€ loadbalancer-aws-elb.yaml â”œâ”€â”€ loadbalancer.yaml DaemonSetsæš´éœ²æœåŠ¡æ–¹å¼ â””â”€â”€ nodeport.yaml Deploymentsæš´éœ²æœåŠ¡æ–¹å¼ 2ã€åˆ›å»ºNamespaceå’ŒServiceAccount, kubectl apply -f common/default-server-secret.yaml apiVersion: v1 kind: Namespace metadata: name: nginx-ingress --- apiVersion: v1 kind: ServiceAccount metadata: name: nginx-ingress namespace: nginx-ingress 3ã€åˆ›å»ºSecretsè‡ªç­¾åè¯ä¹¦ï¼Œkubectl apply -f common/default-server-secret.yaml apiVersion: v1 kind: Secret metadata: name: default-server-secret namespace: nginx-ingress type: Opaque data: tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN2akNDQWFZQ0NRREFPRjl0THNhWFhEQU5CZ2txaGtpRzl3MEJBUXNGQURBaE1SOHdIUVlEVlFRRERCWk8KUjBsT1dFbHVaM0psYzNORGIyNTBjbTlzYkdWeU1CNFhEVEU0TURreE1qRTRNRE16TlZvWERUSXpNRGt4TVRFNApNRE16TlZvd0lURWZNQjBHQTFVRUF3d1dUa2RKVGxoSmJtZHlaWE56UTI5dWRISnZiR3hsY2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUwvN2hIUEtFWGRMdjNyaUM3QlBrMTNpWkt5eTlyQ08KR2xZUXYyK2EzUDF0azIrS3YwVGF5aGRCbDRrcnNUcTZzZm8vWUk1Y2Vhbkw4WGM3U1pyQkVRYm9EN2REbWs1Qgo4eDZLS2xHWU5IWlg0Rm5UZ0VPaStlM2ptTFFxRlBSY1kzVnNPazFFeUZBL0JnWlJVbkNHZUtGeERSN0tQdGhyCmtqSXVuektURXUyaDU4Tlp0S21ScUJHdDEwcTNRYzhZT3ExM2FnbmovUWRjc0ZYYTJnMjB1K1lYZDdoZ3krZksKWk4vVUkxQUQ0YzZyM1lma1ZWUmVHd1lxQVp1WXN2V0RKbW1GNWRwdEMzN011cDBPRUxVTExSakZJOTZXNXIwSAo1TmdPc25NWFJNV1hYVlpiNWRxT3R0SmRtS3FhZ25TZ1JQQVpQN2MwQjFQU2FqYzZjNGZRVXpNQ0F3RUFBVEFOCkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQWpLb2tRdGRPcEsrTzhibWVPc3lySmdJSXJycVFVY2ZOUitjb0hZVUoKdGhrYnhITFMzR3VBTWI5dm15VExPY2xxeC9aYzJPblEwMEJCLzlTb0swcitFZ1U2UlVrRWtWcitTTFA3NTdUWgozZWI4dmdPdEduMS9ienM3bzNBaS9kclkrcUI5Q2k1S3lPc3FHTG1US2xFaUtOYkcyR1ZyTWxjS0ZYQU80YTY3Cklnc1hzYktNbTQwV1U3cG9mcGltU1ZmaXFSdkV5YmN3N0NYODF6cFErUyt1eHRYK2VBZ3V0NHh3VlI5d2IyVXYKelhuZk9HbWhWNThDd1dIQnNKa0kxNXhaa2VUWXdSN0diaEFMSkZUUkk3dkhvQXprTWIzbjAxQjQyWjNrN3RXNQpJUDFmTlpIOFUvOWxiUHNoT21FRFZkdjF5ZytVRVJxbStGSis2R0oxeFJGcGZnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo= tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdi91RWM4b1JkMHUvZXVJTHNFK1RYZUprckxMMnNJNGFWaEMvYjVyYy9XMlRiNHEvClJOcktGMEdYaVN1eE9ycXgrajlnamx4NXFjdnhkenRKbXNFUkJ1Z1B0ME9hVGtIekhvb3FVWmcwZGxmZ1dkT0EKUTZMNTdlT1l0Q29VOUZ4amRXdzZUVVRJVUQ4R0JsRlNjSVo0b1hFTkhzbysyR3VTTWk2Zk1wTVM3YUhudzFtMApxWkdvRWEzWFNyZEJ6eGc2clhkcUNlUDlCMXl3VmRyYURiUzc1aGQzdUdETDU4cGszOVFqVUFQaHpxdmRoK1JWClZGNGJCaW9CbTVpeTlZTW1hWVhsMm0wTGZzeTZuUTRRdFFzdEdNVWozcGJtdlFmazJBNnljeGRFeFpkZFZsdmwKMm82MjBsMllxcHFDZEtCRThCay90elFIVTlKcU56cHpoOUJUTXdJREFRQUJBb0lCQVFDZklHbXowOHhRVmorNwpLZnZJUXQwQ0YzR2MxNld6eDhVNml4MHg4Mm15d1kxUUNlL3BzWE9LZlRxT1h1SENyUlp5TnUvZ2IvUUQ4bUFOCmxOMjRZTWl0TWRJODg5TEZoTkp3QU5OODJDeTczckM5bzVvUDlkazAvYzRIbjAzSkVYNzZ5QjgzQm9rR1FvYksKMjhMNk0rdHUzUmFqNjd6Vmc2d2szaEhrU0pXSzBwV1YrSjdrUkRWYmhDYUZhNk5nMUZNRWxhTlozVDhhUUtyQgpDUDNDeEFTdjYxWTk5TEI4KzNXWVFIK3NYaTVGM01pYVNBZ1BkQUk3WEh1dXFET1lvMU5PL0JoSGt1aVg2QnRtCnorNTZud2p","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:2:1","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2.2 éƒ¨ç½²Ingressæ§åˆ¶å™¨ 1ã€ éƒ¨ç½²æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨å¯ä»¥DaemonSetså’ŒDeploymentçš„å½¢å¼éƒ¨ç½²ï¼Œå¦‚ä¸‹æ˜¯DaemonSetsçš„é…ç½®æ–‡ä»¶ apiVersion: apps/v1 kind: DaemonSet metadata: name: nginx-ingress namespace: nginx-ingress spec: selector: matchLabels: app: nginx-ingress template: metadata: labels: app: nginx-ingress #annotations: #prometheus.io/scrape: \"true\" #prometheus.io/port: \"9113\" spec: serviceAccountName: nginx-ingress containers: - image: nginx/nginx-ingress:edge imagePullPolicy: Always name: nginx-ingress ports: - name: http containerPort: 80 hostPort: 80 #é€šè¿‡hostPortçš„æ–¹å¼æš´éœ²ç«¯å£ - name: https containerPort: 443 hostPort: 443 #- name: prometheus #containerPort: 9113 securityContext: allowPrivilegeEscalation: true runAsUser: 101 #nginx capabilities: drop: - ALL add: - NET_BIND_SERVICE env: - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name args: - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret #- -v=3 # Enables extensive logging. Useful for troubleshooting. #- -report-ingress-status #- -external-service=nginx-ingress #- -enable-leader-election #- -enable-prometheus-metrics Deploymentsçš„é…ç½®æ–‡ä»¶ apiVersion: apps/v1 kind: Deployment metadata: name: nginx-ingress namespace: nginx-ingress spec: replicas: 1 #å‰¯æœ¬çš„ä¸ªæ•° selector: matchLabels: app: nginx-ingress template: metadata: labels: app: nginx-ingress #annotations: #prometheus.io/scrape: \"true\" #prometheus.io/port: \"9113\" spec: serviceAccountName: nginx-ingress containers: - image: nginx/nginx-ingress:edge imagePullPolicy: Always name: nginx-ingress ports: #å†…éƒ¨æš´éœ²çš„æœåŠ¡ç«¯å£ï¼Œéœ€è¦é€šè¿‡NodePortçš„æ–¹å¼æš´éœ²ç»™å¤–éƒ¨ - name: http containerPort: 80 - name: https containerPort: 443 #- name: prometheus #containerPort: 9113 securityContext: allowPrivilegeEscalation: true runAsUser: 101 #nginx capabilities: drop: - ALL add: - NET_BIND_SERVICE env: - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name args: - -nginx-configmaps=$(POD_NAMESPACE)/nginx-config - -default-server-tls-secret=$(POD_NAMESPACE)/default-server-secret #- -v=3 # Enables extensive logging. Useful for troubleshooting. #- -report-ingress-status #- -external-service=nginx-ingress #- -enable-leader-election #- -enable-prometheus-metrics 2ã€æˆ‘ä»¬ä»¥DaemonSetsçš„æ–¹å¼éƒ¨ç½²ï¼ŒDaemonSetéƒ¨ç½²é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¯¹ç­‰ï¼Œå¦‚æœæœ‰å¤–éƒ¨LoadBalanceråˆ™é€šè¿‡å¤–éƒ¨è´Ÿè½½å‡è¡¡è·¯ç”±è‡³Ingressä¸­ [root@node-1 deployments]# kubectl apply -f daemon-set/nginx-ingress.yaml daemonset.apps/nginx-ingress created [root@node-1 deployments]# kubectl get daemonsets -n nginx-ingress NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE nginx-ingress 3 3 3 3 3 \u003cnone\u003e 15s [root@node-1 ~]# kubectl get pods -n nginx-ingress -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-ingress-7mpfc 1/1 Running 0 2m44s 10.244.0.50 node-1 \u003cnone\u003e \u003cnone\u003e nginx-ingress-l2rtj 1/1 Running 0 2m44s 10.244.1.144 node-2 \u003cnone\u003e \u003cnone\u003e nginx-ingress-tgf6r 1/1 Running 0 2m44s 10.244.2.160 node-3 \u003cnone\u003e \u003cnone\u003e 3ã€æ ¡éªŒNginx Ingresså®‰è£…æƒ…å†µï¼Œæ­¤æ—¶ä¸‰ä¸ªèŠ‚ç‚¹å‡æ˜¯å¯¹ç­‰ï¼Œå³è®¿é—®ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å‡èƒ½å®ç°ç›¸åŒçš„æ•ˆæœï¼Œç»Ÿä¸€å…¥å£åˆ™é€šè¿‡å¤–éƒ¨è´Ÿè½½å‡è¡¡ï¼Œå¦‚æœåœ¨äº‘ç¯å¢ƒä¸‹æ‰§è¡Œkubectl apply -f service/loadbalancer.yamlåˆ›å»ºå¤–éƒ¨è´Ÿè½½å‡è¡¡å®ç°å…¥å£è°ƒåº¦ï¼Œè‡ªå»ºçš„å¯ä»¥é€šè¿‡lvsæˆ–nginxç­‰è´Ÿè½½å‡è¡¡å®ç°æ¥å…¥ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œç ”ç©¶ã€‚ å¤‡æ³¨è¯´æ˜ï¼šå¦‚æœä»¥Deploymentsçš„æ–¹å¼éƒ¨ç½²ï¼Œåˆ™éœ€è¦æ‰§è¡Œservice/nodeport.yamlåˆ›å»ºNodePortç±»å‹çš„Serviceï¼Œå®ç°çš„æ•ˆæœå’ŒDaemonSetsç±»ä¼¼ã€‚ 3. Ingressèµ„æºå®šä¹‰ ä¸Šé¢çš„ç« èŠ‚å·²å®‰è£…äº†ä¸€ä¸ªNginx Ingress Controlleræ§åˆ¶å™¨ï¼Œæœ‰äº†Ingressæ§åˆ¶å™¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰Ingressèµ„æºæ¥å®ç°ä¸ƒå±‚è´Ÿè½½è½¬å‘äº†ï¼Œå¤§ä½“ä¸ŠIngressæ”¯æŒä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š1. åŸºäºè™šæ‹Ÿä¸»æœºè½¬å‘ï¼Œ2. åŸºäºè™šæ‹Ÿæœºä¸»æœºURIè½¬å‘ï¼Œ3. æ”¯æŒTLSåŠ å¯†è½¬å‘ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:2:2","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.1 Ingresså®šä¹‰ 1ã€ç¯å¢ƒå‡†å¤‡ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªnginxçš„Deploymentåº”ç”¨ï¼ŒåŒ…å«2ä¸ªå‰¯æœ¬ [root@node-1 ~]# kubectl run ingress-demo --image=nginx:1.7.9 --port=80 --replicas=2 [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE ingress-demo 2/2 2 2 116s 2ã€ä»¥serviceæ–¹å¼æš´éœ²æœåŠ¡ç«¯å£ [root@node-1 ~]# kubectl expose deployment ingress-demo --port=80 --protocol=TCP --target-port=80 service/ingress-demo exposed [root@node-1 ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-demo ClusterIP 10.109.33.91 \u003cnone\u003e 80/TCP 2m15s 3ã€ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤å·²åˆ›å»ºäº†ä¸€ä¸ªserviceï¼Œå¦‚ä¸‹æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªingresså¯¹è±¡å°†èµ·è½¬å‘è‡³ingress-demoè¿™ä¸ªserviceï¼Œé€šè¿‡ingress.classæŒ‡å®šæ§åˆ¶å™¨çš„ç±»å‹ä¸ºnginx [root@node-1 nginx-ingress]# cat nginx-ingress-demo.yaml apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-ingress-demo labels: ingres-controller: nginx annotations: kubernets.io/ingress.class: nginx spec: rules: - host: www.happylau.cn http: paths: - path: / backend: serviceName: ingress-demo servicePort: 80 4ã€åˆ›å»ºingresså¯¹è±¡ [root@node-1 nginx-ingress]# kubectl apply -f nginx-ingress-demo.yaml ingress.extensions/nginx-ingress-demo created æŸ¥çœ‹ingressèµ„æºåˆ—è¡¨ [root@node-1 nginx-ingress]# kubectl get ingresses NAME HOSTS ADDRESS PORTS AGE nginx-ingress-demo www.happylau.cn 80 4m4s 5ã€æŸ¥çœ‹ingressè¯¦æƒ…ï¼Œå¯ä»¥åœ¨Rulesè§„åˆ™ä¸­çœ‹åˆ°åç«¯Podçš„åˆ—è¡¨ï¼Œè‡ªåŠ¨å‘ç°å’Œå…³è”ç›¸å…³Pod [root@node-1 ~]# kubectl describe ingresses nginx-ingress-demo Name: nginx-ingress-demo Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: Host Path Backends ---- ---- -------- www.happylau.cn / ingress-demo:80 (10.244.1.146:80,10.244.2.162:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernets.io/ingress.class\":\"nginx\"},\"labels\":{\"ingres-controller\":\"nginx\"},\"name\":\"nginx-ingress-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"www.happylaulab.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"ingress-demo\",\"servicePort\":80},\"path\":\"/\"}]}}]}} kubernets.io/ingress.class: nginx Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal AddedOrUpdated 9m7s nginx-ingress-controller Configuration for default/nginx-ingress-demo was added or updated Normal AddedOrUpdated 9m7s nginx-ingress-controller Configuration for default/nginx-ingress-demo was added or updated Normal AddedOrUpdated 9m7s nginx-ingress-controller Configuration for default/nginx-ingress-demo was added or updated 6ã€æµ‹è¯•éªŒè¯ï¼Œingressè§„åˆ™çš„é…ç½®ä¿¡æ¯å·²æ³¨å…¥åˆ°Ingress Controllerä¸­ï¼Œç¯å¢ƒä¸­Ingress Controlleræ˜¯ä»¥DaemonSetsçš„æ–¹å¼éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼Œå¦‚æœæœ‰å¤–éƒ¨çš„è´Ÿè½½å‡è¡¡ï¼Œåˆ™å°†www.happylau.cnåŸŸåçš„åœ°å€è§£æä¸ºè´Ÿè½½å‡è¡¡VIPã€‚ç”±äºæµ‹è¯•ç¯å¢ƒæ²¡æœ‰æ­å»ºè´Ÿè½½å‡è¡¡ï¼Œå°†hostsè§£ææ‰§è¡Œnode-1ï¼Œnode-2æˆ–è€…node-3ä»»æ„ä¸€ä¸ªIPéƒ½èƒ½å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚ ä¸Šè¿°æµ‹è¯•è§£ææ­£å¸¸ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è§£æä¸ºnode-1å’Œnode-2çš„IPï¼Œå¦‚ä¸‹ï¼š [root@node-1 ~]# curl -I http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.101 HTTP/1.1 200 OK Server: nginx/1.17.6 Date: Tue, 24 Dec 2019 10:32:22 GMT Content-Type: text/html Content-Length: 612 Connection: keep-alive Last-Modified: Tue, 23 Dec 2014 16:25:09 GMT ETag: \"54999765-264\" Accept-Ranges: bytes [root@node-1 ~]# curl -I http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.102 HTTP/1.1 200 OK Server: nginx/1.17.6 Date: Tue, 24 Dec 2019 10:32:24 GMT Content-Type: text/html Content-Length: 612 Connection: keep-alive Last-Modified: Tue, 23 Dec 2014 16:25:09 GMT ETag: \"54999765-264\" Accept-Ranges: bytes ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:3:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.2 IngressåŠ¨æ€é…ç½® ä¸Šé¢çš„ç« èŠ‚ä»‹ç»äº†ingressèµ„æºå¯¹è±¡çš„ç”³æ˜é…ç½®ï¼Œåœ¨è¿™ä¸ªç« èŠ‚ä¸­æˆ‘ä»¬æ¢ç©¶ä¸€ä¸‹Nginx Ingress Controllerçš„å®ç°æœºåˆ¶å’ŒåŠ¨æ€é…ç½®æ›´æ–°æœºåˆ¶ï¼Œä»¥æ–¹ä¾¿äº†è§£Ingressæ§åˆ¶å™¨çš„å·¥ä½œæœºåˆ¶ã€‚ 1ã€ æŸ¥çœ‹Nginx Controlleræ§åˆ¶å™¨çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨nginx-ingress podä¸­å­˜å‚¨ç€ingressçš„é…ç½®æ–‡ä»¶ [root@node-1 ~]# kubectl get pods -n nginx-ingress NAME READY STATUS RESTARTS AGE nginx-ingress-7mpfc 1/1 Running 0 6h15m nginx-ingress-l2rtj 1/1 Running 0 6h15m nginx-ingress-tgf6r 1/1 Running 0 6h15m #æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªingressç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶åä¸ºï¼šå‘½åç©ºé—´-ingresåç§°.conf [root@node-1 ~]# kubectl exec -it nginx-ingress-7mpfc -n nginx-ingress -- ls -l /etc/nginx/conf.d total 4 -rw-r--r-- 1 nginx nginx 1005 Dec 24 10:06 default-nginx-ingress-demo.conf #æŸ¥çœ‹é…ç½®æ–‡ä»¶ [root@node-1 ~]# kubectl exec -it nginx-ingress-7mpfc -n nginx-ingress -- cat /etc/nginx/conf.d/default-nginx-ingress-demo.conf # configuration for default/nginx-ingress-demo #upstreamçš„é…ç½®ï¼Œä¼šç”¨least_connç®—æ³•ï¼Œé€šè¿‡serviceæœåŠ¡å‘ç°æœºåˆ¶åŠ¨æ€è¯†åˆ«åˆ°åç«¯çš„Pod upstream default-nginx-ingress-demo-www.happylau.cn-ingress-demo-80 { zone default-nginx-ingress-demo-www.happylau.cn-ingress-demo-80 256k; random two least_conn; server 10.244.1.146:80 max_fails=1 fail_timeout=10s max_conns=0; server 10.244.2.162:80 max_fails=1 fail_timeout=10s max_conns=0; } server { listen 80; server_tokens on; server_name www.happylau.cn; location / { proxy_http_version 1.1; proxy_connect_timeout 60s; proxy_read_timeout 60s; proxy_send_timeout 60s; client_max_body_size 1m; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_buffering on; proxy_pass http://default-nginx-ingress-demo-www.happylau.cn-ingress-demo-80; #è°ƒç”¨upstreamå®ç°ä»£ç† } } é€šè¿‡ä¸Šè¿°æŸ¥çœ‹é…ç½®æ–‡ä»¶å¯å¾—çŸ¥ï¼ŒNginx Ingress Controllerå®é™…æ˜¯æ ¹æ®ingressè§„åˆ™ç”Ÿæˆå¯¹åº”çš„nginxé…ç½®æ–‡ä»¶ï¼Œä»¥å®ç°ä»£ç†è½¬å‘çš„åŠŸèƒ½ï¼ŒåŠ å…¥Deploymentsçš„å‰¯æœ¬æ•°å˜æ›´ånginxçš„é…ç½®æ–‡ä»¶ä¼šå‘ç”Ÿä»€ä¹ˆæ”¹å˜å‘¢ï¼Ÿ 2ã€æ›´æ–°æ§åˆ¶å™¨çš„å‰¯æœ¬æ•°ï¼Œç”±2ä¸ªPodå‰¯æœ¬æ‰©å®¹è‡³3ä¸ª [root@node-1 ~]# kubectl scale --replicas=3 deployment ingress-demo deployment.extensions/ingress-demo scaled [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE ingress-demo 3/3 3 3 123m 3ã€å†æ¬¡æŸ¥çœ‹nginxçš„é…ç½®æ–‡ä»¶ï¼Œingresså€ŸåŠ©äºserviceçš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå°†åŠ å…¥çš„Podè‡ªåŠ¨åŠ å…¥åˆ°nginx upstreamä¸­ 4ã€æŸ¥çœ‹nginx podçš„æ—¥å¿—ï¼ˆkubectl logs nginx-ingress-7mpfc -n nginx-ingressï¼‰ï¼Œæœ‰reloadä¼˜é›…é‡å¯çš„è®°å½•ï¼Œå³é€šè¿‡æ›´æ–°é…ç½®æ–‡ä»¶+reloadå®ç°é…ç½®åŠ¨æ€æ›´æ–°ã€‚ é€šè¿‡ä¸Šè¿°çš„é…ç½®å¯çŸ¥ï¼Œingressè°ƒç”¨kubernetes apiå»æ„ŸçŸ¥kubernetesé›†ç¾¤ä¸­çš„å˜åŒ–æƒ…å†µï¼ŒPodçš„å¢åŠ æˆ–å‡å°‘è¿™äº›å˜åŒ–ï¼Œç„¶ååŠ¨æ€æ›´æ–°nginx ingress controllerçš„é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°è½½å…¥é…ç½®ã€‚å½“é›†ç¾¤è§„æ¨¡è¶Šå¤§æ—¶ï¼Œä¼šé¢‘ç¹æ¶‰åŠåˆ°é…ç½®æ–‡ä»¶çš„å˜åŠ¨å’Œé‡è½½ï¼Œå› æ­¤nginxè¿™æ–¹é¢ä¼šå­˜åœ¨å…ˆå¤©çš„åŠ£åŠ¿ï¼Œä¸“é—¨ä¸ºå¾®æœåŠ¡è´Ÿè½½å‡è¡¡åº”è¿è€Œç”Ÿï¼Œå¦‚Traefikï¼ŒEnvoyï¼ŒIstioï¼Œè¿™äº›è´Ÿè½½å‡è¡¡å·¥å…·èƒ½å¤Ÿæä¾›å¤§è§„æ¨¡ï¼Œé¢‘ç¹åŠ¨æ€æ›´æ–°çš„åœºæ™¯ï¼Œä½†æ€§èƒ½ç›¸æ¯”Nginxï¼ŒHAproxyè¿˜å­˜åœ¨ä¸€å®šçš„åŠ£åŠ¿ã€‚å¾€åçš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å†å¯¹å…¶ä»–çš„Ingressæ§åˆ¶å™¨åšä»‹ç»ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:4:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.3 Ingressè·¯å¾„è½¬å‘ Ingressæ”¯æŒURIæ ¼å¼çš„è½¬å‘æ–¹å¼ï¼ŒåŒæ—¶æ”¯æŒURLé‡å†™ï¼Œå¦‚ä¸‹ä»¥ä¸¤ä¸ªserviceä¸ºä¾‹æ¼”ç¤ºï¼Œservice-1å®‰è£…nginxï¼Œservice-2å®‰è£…httpdï¼Œåˆ†åˆ«ç”¨http://demo.happylau.cn/newså’Œhttp://demo.happylau.cn/sportsè½¬å‘åˆ°ä¸¤ä¸ªä¸åŒçš„service 1ã€ç¯å¢ƒå‡†å¤‡ï¼Œåˆ›å»ºä¸¤ä¸ªåº”ç”¨å¹¶å®ç°serviceæš´éœ²ï¼Œåˆ›å»ºdeploymentsæ—¶æŒ‡å®šâ€“exploseåˆ›å»ºservice [root@node-1 ~]# kubectl run service-1 --image=nginx:1.7.9 --port=80 --replicas=1 --expose=true service/service-1 created deployment.apps/service-1 created [root@node-1 ~]# kubectl run service-2 --image=httpd --port=80 --replicas=1 --expose=true service/service-2 created deployment.apps/service-2 created æŸ¥çœ‹deploymentçŠ¶æ€ [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE ingress-demo 4/4 4 4 4h36m service-1 1/1 1 1 65s service-2 1/1 1 1 52s æŸ¥çœ‹serviceçŠ¶æ€ï¼ŒæœåŠ¡å·²ç»æ­£å¸¸ [root@node-1 ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-demo ClusterIP 10.109.33.91 \u003cnone\u003e 80/TCP 4h36m kubernetes ClusterIP 10.96.0.1 \u003cnone\u003e 443/TCP 101d service-1 ClusterIP 10.106.245.71 \u003cnone\u003e 80/TCP 68s service-2 ClusterIP 10.104.204.158 \u003cnone\u003e 80/TCP 55s 2ã€åˆ›å»ºingresså¯¹è±¡ï¼Œé€šè¿‡ä¸€ä¸ªåŸŸåå°†è¯·æ±‚è½¬å‘è‡³åç«¯ä¸¤ä¸ªservice [root@node-1 nginx-ingress]# cat nginx-ingress-uri-demo.yaml apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-ingress-uri-demo labels: ingres-controller: nginx annotations: kubernets.io/ingress.class: nginx nginx.ingress.kubernetes.io/rewrite-target: / spec: rules: - host: demo.happylau.cn http: paths: - path: /news backend: serviceName: service-1 servicePort: 80 - path: /sports backend: serviceName: service-2 servicePort: 80 3ã€åˆ›å»ºingressè§„åˆ™ï¼ŒæŸ¥çœ‹è¯¦æƒ… [root@node-1 nginx-ingress]# kubectl apply -f nginx-ingress-uri-demo.yaml ingress.extensions/nginx-ingress-uri-demo created #æŸ¥çœ‹è¯¦æƒ… [root@node-1 nginx-ingress]# kubectl get ingresses. NAME HOSTS ADDRESS PORTS AGE nginx-ingress-demo www.happylau.cn 80 4h35m nginx-ingress-uri-demo demo.happylau.cn 80 4s [root@node-1 nginx-ingress]# kubectl describe ingresses nginx-ingress-uri-demo Name: nginx-ingress-uri-demo Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: #å¯¹åº”çš„è½¬å‘urlè§„åˆ™ Host Path Backends ---- ---- -------- demo.happylau.cn /news service-1:80 (10.244.2.163:80) /sports service-2:80 (10.244.1.148:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernets.io/ingress.class\":\"nginx\",\"nginx.ingress.kubernetes.io/rewrite-target\":\"/\"},\"labels\":{\"ingres-controller\":\"nginx\"},\"name\":\"nginx-ingress-uri-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"demo.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"service-1\",\"servicePort\":80},\"path\":\"/news\"},{\"backend\":{\"serviceName\":\"service-2\",\"servicePort\":80},\"path\":\"/sports\"}]}}]}} kubernets.io/ingress.class: nginx nginx.ingress.kubernetes.io/rewrite-target: / Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal AddedOrUpdated 11s nginx-ingress-controller Configuration for default/nginx-ingress-uri-demo was added or updated Normal AddedOrUpdated 11s nginx-ingress-controller Configuration for default/nginx-ingress-uri-demo was added or updated Normal AddedOrUpdated 11s nginx-ingress-controller Configuration for default/nginx-ingress-uri-demo was added or updated 4ã€å‡†å¤‡æµ‹è¯•ï¼Œç«™ç‚¹ä¸­åˆ›å»ºå¯¹åº”çš„è·¯å¾„ [root@node-1 ~]# kubectl exec -it service-1-7b66bf758f-xj9jh /bin/bash root@service-1-7b66bf758f-xj9jh:/# echo \"service-1 website page\" \u003e/usr/share/nginx/html/news [root@node-1 ~]# kubectl exec -it service-2-7c7444684d-w9cv9 /bin/bash root@service-2-7c7444684d-w9cv9:/usr/local/apache2# echo \"service-2 website page\" \u003e/usr/local/apache2/htdocs/sports 5ã€æµ‹è¯•éªŒè¯ [root@node-1 ~]# curl http://demo.happylau.cn/news --resolve demo.happylau.cn:80:10.254.100.101 service-1 website page [root@node-1 ~]# curl http://demo.happylau.cn/sports --resolve demo.happylau.cn:80:10.254.100.101 service-2 website page 6ã€é€šè¿‡ä¸Šè¿°çš„éªŒè¯æµ‹è¯•å¯ä»¥å¾—çŸ¥ï¼Œingressæ”¯æŒURIçš„è·¯ç”±æ–¹å¼è½¬å‘ï¼Œå…¶å¯¹åº”åœ¨ingressä¸­çš„é…ç½®æ–‡ä»¶å†…å®¹æ˜¯æ€æ ·çš„å‘¢ï¼Œæˆ‘ä»¬çœ‹ä¸‹ingress controllerç”Ÿæˆå¯¹åº”çš„nginxé…ç½®æ–‡ä»¶å†…å®¹ï¼Œå®é™…æ˜¯é€šè¿‡ingressçš„locationæ¥å®ç°ï¼Œå°†ä¸åŒçš„localtionè½¬å‘è‡³ä¸åŒçš„upstreamä»¥å®ç°serviceçš„å…³è”ï¼Œé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š [roo","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:5:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.4 Ingressè™šæ‹Ÿä¸»æœº ingressæ”¯æŒåŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºï¼Œå®ç°å•ä¸ªIPå¤šä¸ªåŸŸåè½¬å‘çš„éœ€æ±‚ï¼Œé€šè¿‡è¯·æ±‚å¤´éƒ¨æºå¸¦ä¸»æœºåæ–¹å¼åŒºåˆ†å¼€ï¼Œå°†ä¸Šä¸ªç« èŠ‚çš„ingressåˆ é™¤ï¼Œä½¿ç”¨service-1å’Œservice-2ä¸¤ä¸ªserviceæ¥åšæ¼”ç¤ºã€‚ 1ã€åˆ›å»ºingressè§„åˆ™ï¼Œé€šè¿‡ä¸»æœºåå®ç°è½¬å‘è§„åˆ™ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-ingress-virtualname-demo labels: ingres-controller: nginx annotations: kubernets.io/ingress.class: nginx spec: rules: - host: news.happylau.cn http: paths: - path: / backend: serviceName: service-1 servicePort: 80 - host: sports.happylau.cn http: paths: - path: / backend: serviceName: service-2 servicePort: 80 2ã€ç”Ÿæˆingressè§„åˆ™å¹¶æŸ¥çœ‹è¯¦æƒ…ï¼Œä¸€ä¸ªingresså¯¹åº”ä¸¤ä¸ªHOSTS [root@node-1 nginx-ingress]# kubectl apply -f nginx-ingress-virtualname.yaml ingress.extensions/nginx-ingress-virtualname-demo created #æŸ¥çœ‹åˆ—è¡¨ [root@node-1 nginx-ingress]# kubectl get ingresses nginx-ingress-virtualname-demo NAME HOSTS ADDRESS PORTS AGE nginx-ingress-virtualname-demo news.happylau.cn,sports.happylau.cn 80 12s #æŸ¥çœ‹è¯¦æƒ… [root@node-1 nginx-ingress]# kubectl describe ingresses nginx-ingress-virtualname-demo Name: nginx-ingress-virtualname-demo Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: Host Path Backends ---- ---- -------- news.happylau.cn / service-1:80 (10.244.2.163:80) sports.happylau.cn / service-2:80 (10.244.1.148:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernets.io/ingress.class\":\"nginx\"},\"labels\":{\"ingres-controller\":\"nginx\"},\"name\":\"nginx-ingress-virtualname-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"news.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"service-1\",\"servicePort\":80},\"path\":\"/\"}]}},{\"host\":\"sports.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"service-2\",\"servicePort\":80},\"path\":\"/\"}]}}]}} kubernets.io/ingress.class: nginx Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal AddedOrUpdated 28s nginx-ingress-controller Configuration for default/nginx-ingress-virtualname-demo was added or updated Normal AddedOrUpdated 28s nginx-ingress-controller Configuration for default/nginx-ingress-virtualname-demo was added or updated Normal AddedOrUpdated 28s nginx-ingress-controller Configuration for default/nginx-ingress-virtualname-demo was added or updated 3ã€å‡†å¤‡æµ‹è¯•æ•°æ®å¹¶æµ‹è¯• [root@node-1 ~]# kubectl exec -it service-1-7b66bf758f-xj9jh /bin/bash root@service-1-7b66bf758f-xj9jh:/# echo \"news demo\" \u003e/usr/share/nginx/html/index.html [root@node-1 ~]# kubectl exec -it service-2-7c7444684d-w9cv9 /bin/bash root@service-2-7c7444684d-w9cv9:/usr/local/apache2# echo \"sports demo\" \u003e/usr/local/apache2/htdocs/index.html æµ‹è¯•ï¼š [root@node-1 ~]# curl http://news.happylau.cn --resolve news.happylau.cn:80:10.254.100.102 news demo [root@node-1 ~]# curl http://sports.happylau.cn --resolve sports.happylau.cn:80:10.254.100.102 sports demo 4ã€æŸ¥çœ‹nginxçš„é…ç½®æ–‡ä»¶å†…å®¹ï¼Œé€šè¿‡åœ¨serverä¸­å®šä¹‰ä¸åŒçš„server_nameä»¥åŒºåˆ†ï¼Œä»£ç†åˆ°ä¸åŒçš„upstreamä»¥å®ç°serviceçš„ä»£ç†ã€‚ # configuration for default/nginx-ingress-virtualname-demo upstream default-nginx-ingress-virtualname-demo-news.happylau.cn-service-1-80 { zone default-nginx-ingress-virtualname-demo-news.happylau.cn-service-1-80 256k; random two least_conn; server 10.244.2.163:80 max_fails=1 fail_timeout=10s max_conns=0; } upstream default-nginx-ingress-virtualname-demo-sports.happylau.cn-service-2-80 { zone default-nginx-ingress-virtualname-demo-sports.happylau.cn-service-2-80 256k; random two least_conn; server 10.244.1.148:80 max_fails=1 fail_timeout=10s max_conns=0; } server { listen 80; server_tokens on; server_name news.happylau.cn; location / { proxy_http_version 1.1; proxy_connect_timeout 60s; proxy_read_timeout 60s; proxy_send_timeout 60s; client_max_body_size 1m; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_buffering on; proxy_pass http://default-nginx-ingress-virtu","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:6:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.5 Ingress TLSåŠ å¯† å››å±‚çš„è´Ÿè½½å‡è¡¡æ— æ³•æ”¯æŒhttpsè¯·æ±‚ï¼Œå½“å‰å¤§éƒ¨åˆ†ä¸šåŠ¡éƒ½è¦æ±‚ä»¥httpsæ–¹å¼æ¥å…¥ï¼ŒIngressèƒ½æ”¯æŒhttpsçš„æ–¹å¼æ¥å…¥ï¼Œé€šè¿‡Secretså­˜å‚¨è¯ä¹¦+ç§é’¥ï¼Œå®ç°httpsæ¥å…¥ï¼ŒåŒæ—¶è¿˜èƒ½æ”¯æŒhttpè·³è½¬åŠŸèƒ½ã€‚å¯¹äºç”¨æˆ·çš„è¯·æ±‚æµé‡æ¥è¯´ï¼Œå®¢æˆ·ç«¯åˆ°ingress controlleræ˜¯httpsæµé‡ï¼Œingress controlleråˆ°åç«¯serviceåˆ™æ˜¯httpï¼Œæé«˜ç”¨æˆ·è®¿é—®æ€§èƒ½ï¼Œå¦‚ä¸‹ä»‹ç»ingress TLSåŠŸèƒ½å®ç°æ­¥éª¤ã€‚ 1ã€ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥ [root@node-1 ~]# openssl req -x509 -newkey rsa:2048 -nodes -days 365 -keyout tls.key -out tls.crt Generating a 2048 bit RSA private key ....................................................+++ ........................................+++ writing new private key to 'tls.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [XX]:CN #å›½å®¶ State or Province Name (full name) []:GD #çœä»½ Locality Name (eg, city) [Default City]:ShenZhen #åŸå¸‚ Organization Name (eg, company) [Default Company Ltd]:Tencent #å…¬å¸ Organizational Unit Name (eg, section) []:HappyLau #ç»„ç»‡ Common Name (eg, your name or your server's hostname) []:www.happylau.cn #åŸŸå Email Address []:573302346@qq.com #é‚®ç®±åœ°å€ #tls.crtä¸ºè¯ä¹¦ï¼Œtls.keyä¸ºç§é’¥ [root@node-1 ~]# ls tls.* -l -rw-r--r-- 1 root root 1428 12æœˆ 26 13:21 tls.crt -rw-r--r-- 1 root root 1708 12æœˆ 26 13:21 tls.key 2ã€é…ç½®Secretsï¼Œå°†è¯ä¹¦å’Œç§é’¥é…ç½®åˆ°Secretsä¸­ [root@node-1 ~]# kubectl create secret tls happylau-sslkey --cert=tls.crt --key=tls.key secret/happylau-sslkey created æŸ¥çœ‹Secretsè¯¦æƒ…,è¯ä¹¦å’Œç§è¦åŒ…å«åœ¨dataä¸­ï¼Œæ–‡ä»¶åä¸ºä¸¤ä¸ªä¸åŒçš„keyï¼štls.crtå’Œtls.key [root@node-1 ~]# kubectl describe secrets happylau-sslkey Name: happylau-sslkey Namespace: default Labels: \u003cnone\u003e Annotations: \u003cnone\u003e Type: kubernetes.io/tls Data ==== tls.crt: 1428 bytes tls.key: 1708 bytes 3ã€é…ç½®ingressè°ƒç”¨Secretså®ç°SSLè¯ä¹¦åŠ å¯† apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-ingress-tls-demo labels: ingres-controller: nginx annotations: kubernets.io/ingress.class: nginx spec: tls: - hosts: - news.happylau.cn - sports.happylau.cn secretName: happylau-sslkey rules: - host: news.happylau.cn http: paths: - path: / backend: serviceName: service-1 servicePort: 80 - host: sports.happylau.cn http: paths: - path: / backend: serviceName: service-2 servicePort: 80 4ã€åˆ›å»ºingresså¹¶æŸ¥çœ‹ingressè¯¦æƒ… [root@node-1 nginx-ingress]# kubectl describe ingresses nginx-ingress-tls-demo Name: nginx-ingress-tls-demo Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) TLS: happylau-sslkey terminates news.happylau.cn,sports.happylau.cn Rules: Host Path Backends ---- ---- -------- news.happylau.cn / service-1:80 (10.244.2.163:80) sports.happylau.cn / service-2:80 (10.244.1.148:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernets.io/ingress.class\":\"nginx\"},\"labels\":{\"ingres-controller\":\"nginx\"},\"name\":\"nginx-ingress-tls-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"news.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"service-1\",\"servicePort\":80},\"path\":\"/\"}]}},{\"host\":\"sports.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"service-2\",\"servicePort\":80},\"path\":\"/\"}]}}],\"tls\":[{\"hosts\":[\"news.happylau.cn\",\"sports.happylau.cn\"],\"secretName\":\"happylau-sslkey\"}]}} kubernets.io/ingress.class: nginx Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal AddedOrUpdated 22s nginx-ingress-controller Configuration for default/nginx-ingress-tls-demo was added or updated Normal AddedOrUpdated 22s nginx-ingress-controller Configuration for default/nginx-ingress-tls-demo was added or updated Normal AddedOrUpdated 22s nginx-ingress-controller Configuration for default/nginx-ingress-tls-demo was added or updated 5ã€ å°†news.happylau.cnå’Œsports.happylau.cnå†™å…¥åˆ°hostsæ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡https://news.happylau.cn çš„æ–¹å¼è®¿é—®ï¼Œæµè§ˆå™¨è®¿é—®å†…å®¹æç¤ºè¯ä¹¦å¦‚ä¸‹ï¼Œä¿¡ä»»è¯ä¹¦å³å¯è®¿é—®åˆ°ç«™ç‚¹å†…å®¹ã€‚ æŸ¥çœ‹è¯ä¹¦è¯¦æƒ…ï¼Œæ­£æ˜¯æˆ‘ä»¬åˆ¶ä½œçš„è‡ªç­¾åè¯ä¹¦ï¼Œç”Ÿäº§å®é™…ä½¿ç”¨æ—¶ï¼Œæ¨èä½¿ç”¨CAæœºæ„é¢å‘ç­¾åè¯ä¹¦ã€‚ 6ã€æ¥ä¸‹æ¥æŸ¥çœ‹ä¸€ä¸‹tlsé…ç½®httpsçš„nginxé…ç½®æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨serverå—å¯ç”¨äº†https","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:7:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"4.1 å®šåˆ¶åŒ–å‚æ•° ingress controlleræä¾›äº†åŸºç¡€åå‘ä»£ç†çš„åŠŸèƒ½ï¼Œå¦‚æœéœ€è¦å®šåˆ¶åŒ–nginxçš„ç‰¹æ€§æˆ–å‚æ•°ï¼Œéœ€è¦é€šè¿‡ConfigMapå’ŒAnnotationsæ¥å®ç°ï¼Œä¸¤è€…å®ç°çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼ŒConfigMapç”¨äºæŒ‡å®šæ•´ä¸ªingressé›†ç¾¤èµ„æºçš„åŸºæœ¬å‚æ•°ï¼Œä¿®æ”¹åä¼šè¢«æ‰€æœ‰çš„ingresså¯¹è±¡æ‰€ç»§æ‰¿ï¼›Annotationsåˆ™è¢«æŸä¸ªå…·ä½“çš„ingresså¯¹è±¡æ‰€ä½¿ç”¨ï¼Œä¿®æ”¹åªä¼šå½±å“æŸä¸ªå…·ä½“çš„ingressèµ„æºï¼Œå†²çªæ—¶å…¶ä¼˜å…ˆçº§é«˜äºConfigMapã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:8:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"4.1.1 ConfigMapè‡ªå®šä¹‰å‚æ•° å®‰è£…nginx ingress controlleræ—¶é»˜è®¤ä¼šåŒ…å«ä¸€ä¸ªç©ºçš„ConfigMapï¼Œå¯ä»¥é€šè¿‡ConfigMapæ¥è‡ªå®šä¹‰nginx controllerçš„é»˜è®¤å‚æ•°ï¼Œå¦‚ä¸‹ä»¥ä¿®æ”¹ä¸€äº›å‚æ•°ä¸ºä¾‹ï¼š 1ã€ å®šä¹‰ConfigMapå‚æ•° kind: ConfigMap apiVersion: v1 metadata: name: nginx-config namespace: nginx-ingress data: proxy-connect-timeout: \"10s\" proxy-read-timeout: \"10s\" proxy-send-timeout: \"10\" client-max-body-size: \"3m\" 2ã€ åº”ç”¨é…ç½®å¹¶æŸ¥çœ‹ConfigMapé…ç½® [root@node-1 ~]# kubectl get configmaps -n nginx-ingress nginx-config -o yaml apiVersion: v1 data: client-max-body-size: 3m proxy-connect-timeout: 10s proxy-read-timeout: 10s proxy-send-timeout: 10s kind: ConfigMap metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\"apiVersion\":\"v1\",\"data\":{\"client-max-body-size\":\"3m\",\"proxy-connect-timeout\":\"10s\",\"proxy-read-timeout\":\"10s\",\"proxy-send-timeout\":\"10\"},\"kind\":\"ConfigMap\",\"metadata\":{\"annotations\":{},\"name\":\"nginx-config\",\"namespace\":\"nginx-ingress\"}} creationTimestamp: \"2019-12-24T04:39:23Z\" name: nginx-config namespace: nginx-ingress resourceVersion: \"13845543\" selfLink: /api/v1/namespaces/nginx-ingress/configmaps/nginx-config uid: 9313ae47-a0f0-463e-a25a-1658f1ca0d57 3 ã€æ­¤æ—¶ï¼ŒConfigMapå®šä¹‰çš„é…ç½®å‚æ•°ä¼šè¢«é›†ç¾¤ä¸­æ‰€æœ‰çš„Ingressèµ„æºç»§æ‰¿ï¼ˆé™¤äº†annotationså®šä¹‰ä¹‹å¤–ï¼‰ æœ‰å¾ˆå¤šå‚æ•°å¯ä»¥å®šä¹‰ï¼Œè¯¦æƒ…é…ç½®å¯å‚è€ƒæ–¹æ–‡æ¡£è¯´æ˜ï¼šhttps://github.com/nginxinc/kubernetes-ingress/blob/master/docs/configmap-and-annotations.md#Summary-of-ConfigMap-and-Annotations ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:8:1","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"4.1.2 Annotationsè‡ªå®šä¹‰å‚æ•° ConfigMapå®šä¹‰çš„æ˜¯å…¨å±€çš„é…ç½®å‚æ•°ï¼Œä¿®æ”¹åæ‰€æœ‰çš„é…ç½®éƒ½ä¼šå—å½±å“ï¼Œå¦‚æœæƒ³é’ˆå¯¹æŸä¸ªå…·ä½“çš„ingressèµ„æºè‡ªå®šä¹‰å‚æ•°ï¼Œåˆ™å¯ä»¥é€šè¿‡Annotationsæ¥å®ç°ï¼Œä¸‹é¢å¼€å§‹ä»¥å®é™…çš„ä¾‹å­æ¼”ç¤ºAnnotationsçš„ä½¿ç”¨ã€‚ 1ã€ä¿®æ”¹ingressèµ„æºï¼Œæ·»åŠ annotationsçš„å®šä¹‰,é€šè¿‡nginx.orgç»„ä¿®æ”¹äº†ä¸€äº›å‚æ•°ï¼Œå¦‚proxy-connect-timeoutï¼Œè°ƒåº¦ç®—æ³•ä¸ºround_robinï¼ˆé»˜è®¤ä¸ºleast _connï¼‰ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: nginx-ingress-demo labels: ingres-controller: nginx annotations: kubernets.io/ingress.class: nginx nginx.org/proxy-connect-timeout: \"30s\" nginx.org/proxy-send-timeout: \"20s\" nginx.org/proxy-read-timeout: \"20s\" nginx.org/client-max-body-size: \"2m\" nginx.org/fail-timeout: \"5s\" nginx.org/lb-method: \"round_robin\" spec: rules: - host: www.happylau.cn http: paths: - path: / backend: serviceName: ingress-demo servicePort: 80 2ã€ é‡æ–°åº”ç”¨ingresså¯¹è±¡å¹¶æŸ¥çœ‹å‚æ•°é…ç½®æƒ…å†µ ç”±ä¸Šé¢çš„æ¼”ç¤ºå¯å¾—çŸ¥ï¼ŒAnnotationsçš„ä¼˜å…ˆçº§é«˜äºConfigMapMapï¼ŒAnnotationsä¿®æ”¹å‚æ•°åªä¼šå½±å“åˆ°æŸä¸€ä¸ªå…·ä½“çš„ingressèµ„æºï¼Œå…¶å®šä¹‰çš„æ–¹æ³•å’ŒConfigMapç›¸ç›¸è¿‘ä¼¼ï¼Œä½†åˆæœ‰å·®åˆ«ï¼Œéƒ¨åˆ†ConfigMapçš„å‚æ•°Annotationsæ— æ³•æ”¯æŒï¼Œåè¿‡æ¥Annotationså®šä¹‰çš„å‚æ•°ConfigMapä¹Ÿä¸ä¸€å®šæ”¯æŒï¼Œä¸‹å›¾åˆ—ä¸¾ä¸€ä¸‹å¸¸è§„æ”¯æŒå‚æ•°æƒ…å†µï¼š ConfigMapå’ŒAnnotationsè¯¦ç»†æ”¯æŒè¯´æ˜ï¼šé“¾æ¥è¯´æ˜ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:8:2","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"4.2 è™šæ‹Ÿä¸»æœºå’Œè·¯ç”± å®‰è£…nginx ingressæ—¶æˆ‘ä»¬å®‰è£…äº†ä¸€ä¸ªcustomresourcedefinitionsè‡ªå®šä¹‰èµ„æºï¼Œå…¶èƒ½å¤Ÿæä¾›é™¤äº†é»˜è®¤ingressåŠŸèƒ½ä¹‹å¤–çš„ä¸€äº›é«˜çº§ç‰¹æ€§å¦‚ è™šæ‹Ÿä¸»æœºVirtualServer è™šæ‹Ÿè·¯ç”±VirtualServerRoute å¥åº·æ£€æŸ¥Healthcheck æµé‡åˆ‡å‰²Split ä¼šè¯ä¿æŒSessionCookie é‡å®šå‘Redirect è¿™äº›åŠŸèƒ½å¤§éƒ¨åˆ†ä¾èµ–äºNginx Plusé«˜çº§ç‰ˆæœ¬çš„æ”¯æŒï¼Œç¤¾åŒºç‰ˆæœ¬ä»…æ”¯æŒéƒ¨åˆ†ï¼Œå¯¹äºä¼ä¸šçº§å¼€å‘è€Œè¨€ï¼Œä¸°å¯Œæ›´å¤šçš„åŠŸèƒ½å¯ä»¥è´­ä¹°ä¼ä¸šçº§Nginx Plusç‰ˆæœ¬ã€‚å¦‚ä¸‹ä»¥é€šè¿‡VirtualServerå’ŒVirtualServerRouteå®šä¹‰upstreamé…ç½®ä¸ºä¾‹æ¼”ç¤ºåŠŸèƒ½ä½¿ç”¨ã€‚ 1ã€å®šä¹‰VirtualServerèµ„æº,å…¶é…ç½®å’Œingressèµ„æºå¯¹è±¡ç±»ä¼¼ï¼Œèƒ½æ”¯æŒçš„åŠŸèƒ½ä¼šæ›´ä¸°å¯Œä¸€ç‚¹ apiVersion: k8s.nginx.org/v1 kind: VirtualServer metadata: name: cafe spec: host: cafe.example.com tls: secret: cafe-secret upstreams: - name: tea service: tea-svc port: 80 name: tea service: ingress-demo subselector: version: canary lb-method: round_robin fail-timeout: 10s max-fails: 1 max-conns: 32 keepalive: 32 connect-timeout: 30s read-timeout: 30s send-timeout: 30s next-upstream: \"error timeout non_idempotent\" next-upstream-timeout: 5s next-upstream-tries: 10 client-max-body-size: 2m tls: enable: true routes: - path: /tea action: pass: tea 2ã€ åº”ç”¨èµ„æºå¹¶æŸ¥çœ‹VirtualServerèµ„æºåˆ—è¡¨ [root@node-1 ~]# kubectl apply -f vs.yaml virtualserver.k8s.nginx.org/cafe unchanged [root@node-1 ~]# kubectl get virtualserver NAME AGE cafe 2m52s 3ã€æ£€æŸ¥ingressæ§åˆ¶å™¨çš„é…ç½®æ–‡ä»¶æƒ…å†µ,ç”Ÿæˆçš„é…ç½®å’Œupstreamå®šä¹‰ä¸€è‡´ nginx@nginx-ingress-7mpfc:/etc/nginx/conf.d$ cat vs_default_cafe.conf upstream vs_default_cafe_tea { zone vs_default_cafe_tea 256k; server 10.244.0.51:80 max_fails=1 fail_timeout=10s max_conns=32; server 10.244.1.146:80 max_fails=1 fail_timeout=10s max_conns=32; server 10.244.1.147:80 max_fails=1 fail_timeout=10s max_conns=32; server 10.244.2.162:80 max_fails=1 fail_timeout=10s max_conns=32; keepalive 32; } server { listen 80; server_name cafe.example.com; listen 443 ssl; ssl_certificate /etc/nginx/secrets/default; ssl_certificate_key /etc/nginx/secrets/default; ssl_ciphers NULL; server_tokens \"on\"; location /tea { proxy_connect_timeout 30s; proxy_read_timeout 30s; proxy_send_timeout 30s; client_max_body_size 2m; proxy_max_temp_file_size 1024m; proxy_buffering on; proxy_http_version 1.1; set $default_connection_header \"\"; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $vs_connection_header; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header X-Forwarded-Proto $scheme; proxy_pass https://vs_default_cafe_tea; proxy_next_upstream error timeout non_idempotent; proxy_next_upstream_timeout 5s; proxy_next_upstream_tries 10; } } å†™åœ¨æœ€å æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†åŸºäºnginxçš„ingresså®ç°ï¼Œé€šè¿‡å®é™…çš„æ¡ˆä¾‹æ¼”ç¤ºingressçš„å®‰è£…éƒ¨ç½²ï¼ŒåŸºäºè™šæ‹Ÿä¸»æœºçš„é…ç½®ï¼ŒåŸºäºTLSåŠ å¯†å®ç°httpsï¼Œé«˜çº§ç« èŠ‚ä¸­ä»‹ç»äº†è´Ÿè½½å‡è¡¡å‚æ•°å®šåˆ¶ï¼Œè‡ªå®šä¹‰èµ„æºè™šæ‹Ÿä¸»æœºå’Œè™šæ‹Ÿè·¯ç”±çš„å®ç°ï¼Œé€šè¿‡è¯¥ç« èŠ‚ç›¸ä¿¡èƒ½åŠ æ·±å¯¹ingressæœåŠ¡æš´éœ²æœºåˆ¶çš„ç†è§£ã€‚å®ç°ingress controllerçš„æ–¹å¼æœ‰å¤šç§ï¼Œä¸‹ä¸€ä¸ªç« èŠ‚æˆ‘ä»¬å°†ä»‹ç»åŸºäºHAproxyå’ŒTKE Ingressæ§åˆ¶å™¨çš„å®ç°ã€‚ å‚è€ƒæ–‡çŒ® Ingressé…ç½®ï¼šhttps://kubernetes.io/docs/concepts/services-networking/ingress/ Ingressæ§åˆ¶å™¨ï¼šhttps://kubernetes.io/docs/concepts/services-networking/ingress-controllers/ Nginx ingresså®‰è£…æ–‡æ¡£ï¼šhttps://github.com/nginxinc/kubernetes-ingress/blob/master/docs/installation.md Nginx ingressæ–‡æ¡£è¯´æ˜ï¼šhttps://github.com/nginxinc/kubernetes-ingress/tree/master/docs è™šæ‹Ÿä¸»æœºå’Œè·¯ç”±ï¼šhttps://github.com/nginxinc/kubernetes-ingress/blob/master/docs/virtualserver-and-virtualserverroute.md ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:9:0","tags":["kubernetes"],"title":"14 åŸºäºnginx Ingresså®ç°æœåŠ¡æš´éœ²","uri":"/myBlog-2/post/14-%E5%9F%BA%E4%BA%8Enginx-ingress%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†åŸºäºNginxå®ç°Ingress Controllerçš„å®ç°ï¼Œä»‹ç»äº†Nginx Ingress Controllerå®‰è£…ã€ç›¸å…³åŠŸèƒ½ï¼ŒTLSï¼Œé«˜çº§ç‰¹æ€§ç­‰ä»‹ç»ï¼Œæœ¬ç« å¼€å§‹ä»‹ç»åŸºäºè…¾è®¯äº‘TKEå®ç°ingressæœåŠ¡æš´éœ²ã€‚ 1. TKE ingress ","date":"2019-08-04","objectID":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:0:0","tags":["kubernetes"],"title":"15 TKEä¸­å®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 TKE ingressæ¶æ„ TKEæ˜¯Tencent Kubernetes Engineå³è…¾è®¯äº‘åŸºäºkubernetesæä¾›çš„å…¬æœ‰äº‘ä¸Šå®¹å™¨äº‘æœåŠ¡ï¼ŒTKEæä¾›äº†ä¸¤ç§æš´éœ²æœåŠ¡çš„æ–¹å¼ï¼šserviceå’Œingressã€‚ å†…ç½‘CLBï¼Œå››å±‚è´Ÿè½½å‡è¡¡ï¼Œæä¾›VPCå†…è®¿é—®ï¼Œé€šè¿‡nodeèŠ‚ç‚¹çš„NodePortè½¬å‘è‡³serviceï¼› å¤–ç½‘CLBï¼Œå››å±‚è´Ÿè½½å‡è¡¡ï¼Œæä¾›å…¬ç½‘è®¿é—®ï¼Œéœ€è¦nodeèŠ‚ç‚¹å…·æœ‰è®¿é—®å…¬ç½‘çš„èƒ½åŠ›ï¼› ingressï¼Œ ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œæä¾›httpå’Œhttpsæ¥å…¥ï¼Œæä¾›ingressæ§åˆ¶å™¨çš„åŠŸèƒ½ï¼Œå€ŸåŠ©NodePortè½¬å‘ è¦ä½¿ç”¨TKEçš„ingressåŠŸèƒ½ï¼Œéœ€è¦äº†è§£ä¸€ä¸‹ç›¸å…³çš„ç»„ä»¶å†…å®¹ï¼š l7-lb-controller ingresså®¢æˆ·ç«¯ï¼Œå®‰è£…åœ¨kube-systemï¼Œç”¨äºè§£æingressé…ç½®å¹¶æ›´æ–°CLBçš„è§„åˆ™ CLB ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œæä¾›ingress controllerçš„åŠŸèƒ½ï¼Œæ ¹æ®ingressè§„åˆ™åˆ›å»ºhttp/httpsç›‘å¬å™¨ï¼Œé…ç½®è½¬å‘è§„åˆ™ï¼Œä»¥NodePortç«¯å£ç»‘å®šåç«¯RS Service ç”¨äºingressæœåŠ¡å‘ç°ï¼Œé€šè¿‡NodePortæ–¹å¼æ¥å…¥CLB è¯ä¹¦ ç”¨äºæä¾›httpsæ¥å…¥ï¼Œé…ç½®åœ¨CLBè´Ÿè½½å‡è¡¡ä¸Šï¼Œæä¾›CAç­¾åè¯ä¹¦ï¼Œé€šè¿‡Secretså°è£…ç»™CLBä½¿ç”¨ ç”±äºnginx ingress controlleræ˜¯ç›´æ¥ä»¥Podçš„å½¢åŠ¿éƒ¨ç½²åœ¨kubernetesé›†ç¾¤ä¸­ï¼Œå€ŸåŠ©äºserviceçš„æœåŠ¡å‘ç°å¯ç›´æ¥å®ç°å’Œpodé€šè®¯ï¼Œè€ŒTKEä¸­ingress controlleræœªç›´æ¥éƒ¨ç½²åœ¨k8sé›†ç¾¤ä¸­ï¼Œç½‘ç»œçš„æ¥å…¥éœ€å€ŸåŠ©äºserviceçš„NodePortå®ç°æ¥å…¥ï¼Œå…¶æ•°æ®æµå¦‚ä¸‹å›¾ï¼š ","date":"2019-08-04","objectID":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:1:0","tags":["kubernetes"],"title":"15 TKEä¸­å®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 ingressè™šæ‹Ÿä¸»æœº ç¯å¢ƒè¯´æ˜: åˆ›å»ºä¸¤ä¸ªDeploymentå¹¶ä»¥NodePortæ–¹å¼æš´éœ²æœåŠ¡ï¼Œwww1.happylau.cnå¯¹åº”tke-app-1æœåŠ¡ï¼ŒåŒç†www2.happylau.cnå¯¹åº”tke-app-2æœåŠ¡ï¼Œå¦‚ä¸‹æ¼”ç¤ºæ“ä½œè¿‡ç¨‹ï¼š 1ã€åˆ›å»ºä¸¤ä¸ªDeployments [root@VM_10_2_centos ingress]# kubectl create deployment tke-app-1 --image=nginx:1.7.9 [root@VM_10_2_centos ingress]# kubectl create deployment tke-app-2 --image=nginx:1.7.9 2ã€ å°†ä¸¤ä¸ªDeploymentä»¥NodePortçš„æ–¹å¼æš´éœ²æœåŠ¡ [root@VM_10_2_centos ~]# kubectl expose deployment tke-app-1 --port=80 --type=NodePort [root@VM_10_2_centos ~]# kubectl expose deployment tke-app-2 --port=80 --type=NodePort æŸ¥çœ‹æœåŠ¡åˆ—è¡¨ [root@VM_10_2_centos ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 172.16.255.1 \u003cnone\u003e 443/TCP 83d tke-app-1 NodePort 172.16.255.91 \u003cnone\u003e 80:30597/TCP 2s tke-app-2 NodePort 172.16.255.236 \u003cnone\u003e 80:31674/TCP 73s 3ã€å®šä¹‰ingressè§„åˆ™ï¼Œå®šä¹‰ä¸¤ä¸ªhostå°†ä¸åŒä¸»æœºè½¬å‘è‡³backendä¸åŒçš„service apiVersion: extensions/v1beta1 kind: Ingress metadata: name: tke-ingress-demo annotations: kubernetes.io/ingress.class: qcloud spec: rules: - host: www1.happylau.cn http: paths: - path: / backend: serviceName: tke-app-1 servicePort: 80 - host: www2.happylau.cn http: paths: - path: / backend: serviceName: tke-app-2 servicePort: 80 4ã€ åº”ç”¨ingressè§„åˆ™ï¼Œå¹¶æŸ¥çœ‹ingressè¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°ingressåˆ›å»ºäº†ä¸€ä¸ªå…¬ç½‘CLBå®ä¾‹ #åº”ç”¨ingressè§„åˆ™ [root@VM_10_2_centos ingress]# kubectl apply -f tke-ingress-demo.yaml ingress.extensions/tke-ingress-demo created #æŸ¥çœ‹ingressåˆ—è¡¨ [root@VM_10_2_centos ingress]# kubectl get ingresses NAME HOSTS ADDRESS PORTS AGE tke-ingress-demo www1.happylau.cn,www2.happylau.cn 140.143.84.xxx 80 67s #æŸ¥çœ‹ ingressè¯¦æƒ… [root@VM_10_2_centos ingress]# kubectl describe ingresses tke-ingress-demo Name: tke-ingress-demo Namespace: default Address: 140.143.84.xxx Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: Host Path Backends ---- ---- -------- www1.happylau.cn / tke-app-1:80 (172.16.1.15:80) www2.happylau.cn / tke-app-2:80 (172.16.2.17:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernetes.io/ingress.class\":\"qcloud\"},\"name\":\"tke-ingress-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"www1.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"tke-app-1\",\"servicePort\":80},\"path\":\"/\"}]}},{\"host\":\"www2.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"tke-app-2\",\"servicePort\":80},\"path\":\"/\"}]}}]}} kubernetes.io/ingress.class: qcloud kubernetes.io/ingress.qcloud-loadbalance-id: lb-a0xwhcx3 Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal EnsuringIngress 69s (x3 over 89s) loadbalancer-controller Ensuring ingress Normal CREATE 69s (x2 over 70s) loadbalancer-controller create loadbalancer succ Normal EnsuredIngress 68s (x3 over 70s) loadbalancer-controller Ensured ingress 5ã€æµ‹è¯•éªŒè¯ï¼Œå°†IPå’ŒåŸŸåå†™å…¥åˆ°hostsæ–‡ä»¶ä¸­ï¼Œè®¿é—®åŸŸåæµ‹è¯•éªŒè¯ï¼Œå¦‚ä¸‹é€šè¿‡curlè§£æçš„æ–¹å¼æµ‹è¯•éªŒè¯ 6ã€ingressä¼šåˆ›å»ºä¸€ä¸ªCLBï¼Œå¹¶åœ¨CLBä¸­åˆ›å»ºç›‘å¬å™¨ã€è®¾ç½®è½¬å‘è§„åˆ™ã€ç»‘å®šåç«¯RSï¼Œä¸‹å›¾æ˜¯CLBä¸Šè‡ªåŠ¨ç”Ÿæˆçš„è§„åˆ™ é€šè¿‡ä¸Šé¢æ¼”ç¤ºå¯çŸ¥ï¼š è‡ªåŠ¨åˆ›å»ºCLBå®ä¾‹ CLBå®ä¾‹ä¸Šé…ç½®ç›‘å¬å™¨ é…ç½®è½¬å‘è§„åˆ™ ç»‘å®šNodeèŠ‚ç‚¹ ç»‘å®šç«¯å£ä¸ºserviceåˆ›å»ºçš„NodePort ","date":"2019-08-04","objectID":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:2:0","tags":["kubernetes"],"title":"15 TKEä¸­å®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 ingressè¯ä¹¦åŠ å¯† TKEæ”¯æŒå°†åœ¨CLBä¸­åŠ è½½è¯ä¹¦å®ç°httpsåŠ å¯†ä¼ è¾“ï¼Œè¯ä¹¦æ˜¯ç»è¿‡ç¬¬ä¸‰æ–¹è®¤è¯çš„CAç­¾åè¿‡çš„è¯ä¹¦ï¼Œéœ€è¦å…ˆè´­ä¹°å¥½è¯ä¹¦ï¼Œé€šè¿‡Secretså¯¹è±¡åœ¨kubernetesé›†ç¾¤ä¸­å®šä¹‰ï¼Œå¦‚ä¸‹æ¼”ç¤ºhttpsçš„å®ç°ã€‚ 1ã€ é€šè¿‡Secretsåˆ›å»ºè¯ä¹¦ï¼Œå…ˆè·å–åˆ°è¯ä¹¦çš„idï¼Œå¦‚æœæ²¡æœ‰åˆ™å…ˆåˆ›å»ºè¯ä¹¦ï¼Œè¯ä¹¦ç®¡ç†ï¼Œæœ¬æ–‡ä»¥è¯ä¹¦id TKPmsWb3 ä¸ºä¾‹ï¼Œé€šè¿‡stringDataèƒ½å®ç°base64è‡ªåŠ¨åŠ å¯† apiVersion: v1 kind: Secret metadata: name: ingress-ssl-key stringData: qcloud_cert_id: TKPmsWb3 type: Opaque #ç”ŸæˆSecretså¯¹è±¡ [root@VM_10_2_centos ingress]# kubectl apply -f ingress-secret.yaml secret/ingress-ssl-key created [root@VM_10_2_centos ingress]# kubectl get secrets ingress-ssl-key NAME TYPE DATA AGE ingress-ssl-key Opaque 1 7s #æŸ¥çœ‹secretsè¯¦æƒ…ï¼Œå¯å¾—çŸ¥VEtQbXNXYjM= å·²è‡ªåŠ¨é€šè¿‡base64åŠ å¯† [root@VM_10_2_centos ingress]# kubectl get secrets ingress-ssl-key -o yaml apiVersion: v1 data: qcloud_cert_id: VEtQbXNXYjM= kind: Secret metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\"apiVersion\":\"v1\",\"kind\":\"Secret\",\"metadata\":{\"annotations\":{},\"name\":\"ingress-ssl-key\",\"namespace\":\"default\"},\"stringData\":{\"qcloud_cert_id\":\"TKPmsWb3\"},\"type\":\"Opaque\"} creationTimestamp: \"2020-01-03T11:53:33Z\" name: ingress-ssl-key namespace: default resourceVersion: \"7083702418\" selfLink: /api/v1/namespaces/default/secrets/ingress-ssl-key uid: aaea4a86-2e1f-11ea-a618-ae9224ffad1a type: Opaque #å¯ä»¥é€šè¿‡base64æŸ¥çœ‹è§£å¯†åçš„å†…å®¹ï¼Œå’Œé…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„idä¸€è‡´ [root@VM_10_2_centos ingress]# echo VEtQbXNXYjM= | base64 -d TKPmsWb3 2ã€å‡†å¤‡ç¯å¢ƒï¼Œåˆ›å»ºä¸€ä¸ªnginxçš„Deployment [root@VM_10_2_centos ~]# kubectl create deployment tke-ingress-ssl-demo --image=nginx:1.7.9 deployment.apps/tke-ingress-ssl-demo created [root@VM_10_2_centos ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE tke-ingress-ssl-demo 1/1 1 1 6s 3ã€å°†Deploymentæš´éœ²ä»¥NodePortç±»å‹æš´éœ²service [root@VM_10_2_centos ~]# kubectl expose deployment tke-ingress-ssl-demo --port=80 --type=NodePort service/tke-ingress-ssl-demo exposed [root@VM_10_2_centos ~]# kubectl get service tke-ingress-ssl-demo -o yaml apiVersion: v1 kind: Service metadata: creationTimestamp: \"2020-01-03T12:00:05Z\" labels: app: tke-ingress-ssl-demo name: tke-ingress-ssl-demo namespace: default resourceVersion: \"7083890283\" selfLink: /api/v1/namespaces/default/services/tke-ingress-ssl-demo uid: 94659f42-2e20-11ea-a618-ae9224ffad1a spec: clusterIP: 172.16.255.64 externalTrafficPolicy: Cluster ports: - nodePort: 30324 port: 80 protocol: TCP targetPort: 80 selector: app: tke-ingress-ssl-demo sessionAffinity: None type: NodePort #ç±»å‹ä¸ºNodePort status: loadBalancer: {} 4ã€å®šä¹‰ingressè§„åˆ™ï¼ŒåŠ è½½è¯ä¹¦å®ç°httpsè½¬å‘ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: tke-ingress-ssl annotations: kubernetes.io/ingress.class: qcloud qcloud_cert_id: TKPmsWb3 spec: rules: - host: www.happylauliu.cn http: paths: - path: / backend: serviceName: tke-ingress-ssl-demo servicePort: 80 tls: - hosts: - www.happylauliu.cn secretName: ingress-ssl-key 5ã€åº”ç”¨ingressè§„åˆ™ï¼Œå¹¶æŸ¥çœ‹è¯¦æƒ…ï¼Œæ­¤æ—¶å·²æ­£å¸¸åˆ›å»ºCLBå¹¶é…ç½®è§„åˆ™ [root@VM_10_2_centos ingress]# kubectl apply -f ingress-demo.yaml ingress.extensions/tke-ingress-ssl created #æŸ¥çœ‹ingressè¯¦æƒ… [root@VM_10_2_centos ingress]# kubectl describe ingresses tke-ingress-ssl Name: tke-ingress-ssl Namespace: default Address: 140.143.83.xxx #CLBçš„å¤–ç½‘IP Default backend: default-http-backend:80 (\u003cnone\u003e) TLS: ingress-ssl-key terminates www.happylauliu.cn Rules: Host Path Backends ---- ---- -------- www.happylauliu.cn / tke-ingress-ssl-demo:80 (172.16.0.25:80) Annotations: qcloud_cert_id: TKPmsWb3 kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernetes.io/ingress.class\":\"qcloud\",\"qcloud_cert_id\":\"TKPmsWb3\"},\"name\":\"tke-ingress-ssl\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"www.happylauliu.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"tke-ingress-ssl-demo\",\"servicePort\":80},\"path\":\"/\"}]}}],\"tls\":[{\"hosts\":[\"www.happylauliu.cn\"],\"secretName\":\"ingress-ssl-key\"}]}} kubernetes.io/ingress.class: qcloud kubernetes.io/ingress.qcloud-loadbalance-id: lb-2kcrtwbn #CLBçš„å®ä¾‹id Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal EnsuringIngress 51s (x3 over 73s) loadbalancer-controller Ensuring ingress Nor","date":"2019-08-04","objectID":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:3:0","tags":["kubernetes"],"title":"15 TKEä¸­å®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/15-tke%E4%B8%AD%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ å‰é¢æ–‡ç« ä»‹ç»äº†åŸºäºnginxå®ç°ingress controllerçš„åŠŸèƒ½ï¼Œæœ¬ç« èŠ‚æ¥ç»­ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹ä¸­å¦å¤–ä¸€ä¸ªå§å¦¹å¼€æºè´Ÿè½½å‡è¡¡çš„æ§åˆ¶å™¨ï¼šhaproxy ingress controllerã€‚ 1. HAproxy Ingressæ§åˆ¶å™¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:0:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 HAproxy Ingressç®€ä»‹ HAProxy Ingress watches in the k8s cluster and how it builds HAProxy configuration å’ŒNginxç›¸ç±»ä¼¼ï¼ŒHAproxyé€šè¿‡ç›‘è§†kubernetes apiè·å–åˆ°serviceåç«¯podçš„çŠ¶æ€ï¼ŒåŠ¨æ€æ›´æ–°haproxyé…ç½®æ–‡ä»¶ï¼Œä»¥å®ç°ä¸ƒå±‚çš„è´Ÿè½½å‡è¡¡ã€‚ HAproxy Ingressæ§åˆ¶å™¨å…·å¤‡çš„ç‰¹æ€§å¦‚ä¸‹ï¼š Fastï¼ŒCarefully built on top of the battle-tested HAProxy load balancer. åŸºäºhaproxyæ€§èƒ½æœ‰ä¿éšœ Reliableï¼ŒTrusted by sysadmins on clusters as big as 1,000 namespaces, 2,000 domains and 3,000 ingress objects. å¯é ï¼Œæ”¯æŒ1000æœ€å¤š1000ä¸ªå‘½åç©ºé—´å’Œ2000å¤šä¸ªåŸŸå Highly customizableï¼Œ100+ configuration options and growing. å¯å®šåˆ¶åŒ–å¼ºï¼Œæ”¯æŒ100å¤šä¸ªé…ç½®é€‰é¡¹ HAproxy ingressæ§åˆ¶å™¨ç‰ˆæœ¬ ç¤¾åŒºç‰ˆï¼ŒåŸºäºhaproxyç¤¾åŒºé«˜åº¦å®šåˆ¶ç¬¦åˆingressçš„æ§åˆ¶å™¨ï¼ŒåŠŸèƒ½ç›¸å¯¹æœ‰é™ ä¼ä¸šç‰ˆï¼Œhaproxyä¼ä¸šç‰ˆæœ¬ï¼Œæ”¯æŒå¾ˆå¤šé«˜çº§ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œå¤§éƒ¨åˆ†é«˜çº§åŠŸèƒ½åœ¨ä¼ä¸šç‰ˆæœ¬ä¸­å®ç° ","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:1:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 HAproxyæ§åˆ¶å™¨å®‰è£… haproxy ingresså®‰è£…ç›¸å¯¹ç®€å•ï¼Œå®˜æ–¹æä¾›äº†å®‰è£…çš„yamlæ–‡ä»¶ï¼Œå…ˆå°†æ–‡ä»¶ä¸‹è½½æŸ¥çœ‹ä¸€ä¸‹kubernetesèµ„æºé…ç½®ï¼ŒåŒ…å«çš„èµ„æºç±»å‹æœ‰ï¼š ServiceAccount å’ŒRBACè®¤è¯æˆæƒå…³è” RBACè®¤è¯ Roleã€ClusterRoleã€ ClusterRoleBinding Deployment é»˜è®¤åŒ…å«çš„ä¸€ä¸ªåç«¯backendåº”ç”¨æœåŠ¡å™¨ï¼Œä¸ä¹‹å…³è”ä¸€ä¸ªService Service åç«¯çš„ä¸€ä¸ªservice DaemonSet HAproxyæœ€æ ¸å¿ƒçš„ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå…³è”è®¤è¯ServiceAccountå’Œé…ç½®ConfigMapï¼Œå®šä¹‰äº†ä¸€ä¸ªnodeSelectorï¼Œlabelä¸ºrole: ingress-controllerï¼Œå°†è¿è¡Œåœ¨ç‰¹å®šçš„èŠ‚ç‚¹ä¸Š ConfigMap å®ç°haproxy ingressè‡ªå®šä¹‰é…ç½® å®‰è£…æ–‡ä»¶è·¯å¾„https://haproxy-ingress.github.io/resources/haproxy-ingress.yaml 1ã€åˆ›å»ºå‘½åç©ºé—´ï¼Œhaproxy ingresséƒ¨ç½²åœ¨ingress-controllerè¿™ä¸ªå‘½åç©ºé—´ï¼Œå…ˆåˆ›å»ºns [root@node-1 ~]# kubectl create namespace ingress-controller namespace/ingress-controller created [root@node-1 ~]# kubectl get namespaces ingress-controller -o yaml apiVersion: v1 kind: Namespace metadata: creationTimestamp: \"2019-12-27T09:56:04Z\" name: ingress-controller resourceVersion: \"13946553\" selfLink: /api/v1/namespaces/ingress-controller uid: ea70b2f7-efe4-43fd-8ce9-3b917b09b533 spec: finalizers: - kubernetes status: phase: Active 2ã€å®‰è£…haproxy ingressæ§åˆ¶å™¨ [root@node-1 ~]# wget https://haproxy-ingress.github.io/resources/haproxy-ingress.yaml [root@node-1 ~]# kubectl apply -f haproxy-ingress.yaml serviceaccount/ingress-controller created clusterrole.rbac.authorization.k8s.io/ingress-controller created role.rbac.authorization.k8s.io/ingress-controller created clusterrolebinding.rbac.authorization.k8s.io/ingress-controller created rolebinding.rbac.authorization.k8s.io/ingress-controller created deployment.apps/ingress-default-backend created service/ingress-default-backend created configmap/haproxy-ingress created daemonset.apps/haproxy-ingress created 3ã€ æ£€æŸ¥haproxy ingresså®‰è£…æƒ…å†µï¼Œæ£€æŸ¥haproxy ingressæ ¸å¿ƒçš„DaemonSetsï¼Œå‘ç°DSå¹¶æœªéƒ¨ç½²Podï¼ŒåŸå› æ˜¯é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†nodeSelectorèŠ‚ç‚¹æ ‡ç­¾é€‰æ‹©å™¨ï¼Œå› æ­¤éœ€è¦ç»™nodeè®¾ç½®åˆç†çš„æ ‡ç­¾ [root@node-1 ~]# kubectl get daemonsets -n ingress-controller NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE haproxy-ingress 0 0 0 0 0 role=ingress-controller 5m51s 4ã€ ç»™nodeè®¾ç½®æ ‡ç­¾ï¼Œè®©DaemonSetsç®¡ç†çš„Podèƒ½è°ƒåº¦åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®æƒ…å†µå®šä¹‰ï¼Œå°†å®ç°haproxy ingressåŠŸèƒ½çš„èŠ‚ç‚¹å®šä¹‰åˆ°ç‰¹å®šçš„èŠ‚ç‚¹ï¼Œå¯¹ä¸ªnodeèŠ‚ç‚¹çš„è®¿é—®ï¼Œéœ€è¦å€ŸåŠ©äºè´Ÿè½½å‡è¡¡å®ç°ç»Ÿä¸€æ¥å…¥ï¼Œæœ¬æ–‡ä¸»è¦ä»¥æ¢ç©¶haproxy ingressåŠŸèƒ½ï¼Œå› æ­¤æœªéƒ¨ç½²è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ï¼Œè¯»è€…å¯æ ¹æ®å®é™…çš„æƒ…å†µéƒ¨ç½²ã€‚ä»¥node-1å’Œnode-2ä¸ºä¾‹ï¼š [root@node-1 ~]# kubectl label node node-1 role=ingress-controller node/node-1 labeled [root@node-1 ~]# kubectl label node node-2 role=ingress-controller node/node-2 labeled #æŸ¥çœ‹labelsçš„æƒ…å†µ [root@node-1 ~]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS node-1 Ready master 104d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-1,kubernetes.io/os=linux,node-role.kubernetes.io/master=,role=ingress-controller node-2 Ready \u003cnone\u003e 104d v1.15.3 app=web,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-2,kubernetes.io/os=linux,label=test,role=ingress-controller node-3 Ready \u003cnone\u003e 104d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-3,kubernetes.io/os=linux 5ã€å†æ¬¡æŸ¥çœ‹ingresséƒ¨ç½²æƒ…å†µï¼Œå·²å®Œæˆéƒ¨ç½²ï¼Œå¹¶è°ƒåº¦è‡³node-1å’Œnode-2èŠ‚ç‚¹ä¸Š [root@node-1 ~]# kubectl get daemonsets -n ingress-controller NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE haproxy-ingress 2 2 2 2 2 role=ingress-controller 15m [root@node-1 ~]# kubectl get pods -n ingress-controller -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES haproxy-ingress-bdns8 1/1 Running 0 2m27s 10.254.100.102 node-2 \u003cnone\u003e \u003cnone\u003e haproxy-ingress-d5rnl 1/1 Running 0 2m31s 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e haproxy ingresséƒ¨ç½²æ—¶å€™ä¹Ÿé€šè¿‡deploymentséƒ¨ç½²äº†ä¸€ä¸ªåç«¯backendæœåŠ¡ï¼Œè¿™æ˜¯éƒ¨ç½²haproxy ingresså¿…é¡»éƒ¨ç½²æœåŠ¡ï¼Œå¦åˆ™ingress controlleræ— æ³•å¯åŠ¨ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹Deploymentsåˆ—è¡¨ç¡®è®¤ [root@node-1 ~]# kubectl get deployments -n ingress-controller NAME READY UP-TO-DATE AVAILABLE AGE ingress-default-backend 1/1 1 1 18m 6ã€ æŸ¥çœ‹haproxy ingressçš„æ—¥å¿—ï¼Œé€šè¿‡æŸ¥è¯¢æ—¥å¿—å¯çŸ¥ï¼Œå¤šä¸ªhaproxy ingressæ˜¯é€šè¿‡é€‰ä¸¾å®ç°é«˜å¯ç”¨HAæœºåˆ¶ã€‚ å…¶ä»–èµ„æºåŒ…æ‹¬ServiceAccountï¼ŒClusterRoleï¼ŒConfigMapsè¯·å•ç‹¬ç¡®è®¤ï¼Œè‡³æ­¤HAproxy ingress controlleréƒ¨ç½²å®Œæ¯•ã€‚å¦å¤–ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼š Deploymentéƒ¨ç½²æ–¹å¼ Helméƒ¨ç½²æ–¹å¼ 2. haproxy ingressä½¿ç”¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:2:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 haproxy ingressåŸºç¡€ Ingressæ§åˆ¶å™¨éƒ¨ç½²å®Œæ¯•åéœ€è¦å®šä¹‰Ingressè§„åˆ™ï¼Œä»¥æ–¹ä¾¿Ingressæ§åˆ¶å™¨èƒ½å¤Ÿè¯†åˆ«åˆ°serviceåç«¯Podçš„èµ„æºï¼Œè¿™ä¸ªç« èŠ‚æˆ‘ä»¬å°†æ¥ä»‹ç»åœ¨HAproxy Ingress Controllerç¯å¢ƒä¸‹Ingressçš„ä½¿ç”¨ã€‚ 1ã€ç¯å¢ƒå‡†å¤‡ï¼Œåˆ›å»ºä¸€ä¸ªdeploymentså¹¶æš´éœ²å…¶ç«¯å£ #åˆ›å»ºåº”ç”¨å¹¶æš´éœ²ç«¯å£ [root@node-1 haproxy-ingress]# kubectl run haproxy-ingress-demo --image=nginx:1.7.9 --port=80 --replicas=1 --expose kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead. service/haproxy-ingress-demo created deployment.apps/haproxy-ingress-demo created #æŸ¥çœ‹åº”ç”¨ [root@node-1 haproxy-ingress]# kubectl get deployments haproxy-ingress-demo NAME READY UP-TO-DATE AVAILABLE AGE haproxy-ingress-demo 1/1 1 1 10s #æŸ¥çœ‹serviceæƒ…å†µ [root@node-1 haproxy-ingress]# kubectl get services haproxy-ingress-demo NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE haproxy-ingress-demo ClusterIP 10.106.199.102 \u003cnone\u003e 80/TCP 17s 2ã€åˆ›å»ºingressè§„åˆ™,å¦‚æœæœ‰å¤šä¸ªingressæ§åˆ¶å™¨ï¼Œå¯ä»¥é€šè¿‡ingress.classæŒ‡å®šç±»å‹ä¸ºhaproxy apiVersion: extensions/v1beta1 kind: Ingress metadata: name: haproxy-ingress-demo labels: ingresscontroller: haproxy annotations: kubernetes.io/ingress.class: haproxy spec: rules: - host: www.happylau.cn http: paths: - path: / backend: serviceName: haproxy-ingress-demo servicePort: 80 3ã€åº”ç”¨ingressè§„åˆ™ï¼Œå¹¶æŸ¥çœ‹ingressè¯¦æƒ…ï¼ŒæŸ¥çœ‹Eventsæ—¥å¿—å‘ç°æ§åˆ¶å™¨å·²æ­£å¸¸æ›´æ–° [root@node-1 haproxy-ingress]# kubectl apply -f ingress-demo.yaml ingress.extensions/haproxy-ingress-demo created #æŸ¥çœ‹è¯¦æƒ… [root@node-1 haproxy-ingress]# kubectl describe ingresses haproxy-ingress-demo Name: haproxy-ingress-demo Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: Host Path Backends ---- ---- -------- www.happylau.cn / haproxy-ingress-demo:80 (10.244.2.166:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernetes.io/ingress.class\":\"haproxy\"},\"labels\":{\"ingresscontroller\":\"haproxy\"},\"name\":\"haproxy-ingress-demo\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"www.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"haproxy-ingress-demo\",\"servicePort\":80},\"path\":\"/\"}]}}]}} kubernetes.io/ingress.class: haproxy Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal CREATE 27s ingress-controller Ingress default/haproxy-ingress-demo Normal CREATE 27s ingress-controller Ingress default/haproxy-ingress-demo Normal UPDATE 20s ingress-controller Ingress default/haproxy-ingress-demo Normal UPDATE 20s ingress-controller Ingress default/haproxy-ingress-demo 4ã€æµ‹è¯•éªŒè¯ingressè§„åˆ™ï¼Œå¯ä»¥å°†åŸŸåå†™å…¥åˆ°hostsæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨gcurlæµ‹è¯•ï¼Œåœ°å€æŒ‡å‘node-1æˆ–node-2å‡å¯ [root@node-1 haproxy-ingress]# curl http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.101 \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eWelcome to nginx!\u003c/title\u003e \u003cstyle\u003e body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003eWelcome to nginx!\u003c/h1\u003e \u003cp\u003eIf you see this page, the nginx web server is successfully installed and working. Further configuration is required.\u003c/p\u003e \u003cp\u003eFor online documentation and support please refer to \u003ca href=\"http://nginx.org/\"\u003enginx.org\u003c/a\u003e.\u003cbr/\u003e Commercial support is available at \u003ca href=\"http://nginx.com/\"\u003enginx.com\u003c/a\u003e.\u003c/p\u003e \u003cp\u003e\u003cem\u003eThank you for using nginx.\u003c/em\u003e\u003c/p\u003e \u003c/body\u003e \u003c/html\u003e 5ã€æµ‹è¯•æ­£å¸¸ï¼Œæ¥ä¸‹æ¥åˆ°haproxy ingress controllerä¸­åˆšæŸ¥çœ‹å¯¹åº”ç”Ÿæˆè§„åˆ™é…ç½®æ–‡ä»¶ [root@node-1 ~]# kubectl exec -it haproxy-ingress-bdns8 -n ingress-controller /bin/sh #æŸ¥çœ‹é…ç½®æ–‡ä»¶ /etc/haproxy # cat /etc/haproxy/haproxy.cfg # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # HAProxy Ingress Controller # # -------------------------- # # This file is automatically updated, do not edit # # # å…¨å±€é…ç½®æ–‡ä»¶å†…å®¹ global daemon nbthread 2 cpu-map auto:1/1-2 0-1 stats socket /var/run/haproxy-stats.sock level admin expose-fd listeners maxconn 2000 hard-stop-after 10m lua-load /usr/local/etc/haproxy/lua/send-response.lua lua-load /usr/local/etc/haproxy/lua/auth-request.lua tu","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:3:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 åŠ¨æ€æ›´æ–°å’Œè´Ÿè½½å‡è¡¡ åç«¯Podæ˜¯å®æ—¶åŠ¨æ€å˜åŒ–çš„ï¼Œhaproxy ingressé€šè¿‡serviceçš„æœåŠ¡å‘ç°æœºåˆ¶ï¼ŒåŠ¨æ€è¯†åˆ«åˆ°åç«¯Podçš„å˜åŒ–æƒ…å†µï¼Œå¹¶åŠ¨æ€æ›´æ–°haproxy.cfgé…ç½®æ–‡ä»¶ï¼Œå¹¶é‡è½½é…ç½®ï¼ˆå®é™…ä¸éœ€è¦é‡å¯haproxyæœåŠ¡ï¼‰ï¼Œæœ¬ç« èŠ‚å°†æ¼”ç¤ºhaproxy ingressåŠ¨æ€æ›´æ–°å’Œè´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚ 1ã€åŠ¨æ€æ›´æ–°ï¼Œæˆ‘ä»¬ä»¥æ‰©å®¹podçš„å‰¯æœ¬ä¸ºä¾‹ï¼Œå°†å‰¯æœ¬æ•°ä»replicas=1æ‰©å®¹è‡³3ä¸ª [root@node-1 ~]# kubectl scale --replicas=3 deployment haproxy-ingress-demo deployment.extensions/haproxy-ingress-demo scaled [root@node-1 ~]# kubectl get deployments haproxy-ingress-demo NAME READY UP-TO-DATE AVAILABLE AGE haproxy-ingress-demo 3/3 3 3 43m #æŸ¥çœ‹æ‰©å®¹åPodçš„IPåœ°å€ [root@node-1 ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES haproxy-ingress-demo-5d487d4fc-5pgjt 1/1 Running 0 43m 10.244.2.166 node-3 \u003cnone\u003e \u003cnone\u003e haproxy-ingress-demo-5d487d4fc-pst2q 1/1 Running 0 18s 10.244.0.52 node-1 \u003cnone\u003e \u003cnone\u003e haproxy-ingress-demo-5d487d4fc-sr8tm 1/1 Running 0 18s 10.244.1.149 node-2 \u003cnone\u003e \u003cnone\u003e 2ã€æŸ¥çœ‹haproxyé…ç½®æ–‡ä»¶å†…å®¹,å¯ä»¥çœ‹åˆ°backendåç«¯ä¸»æœºåˆ—è¡¨å·²åŠ¨æ€å‘ç°æ–°å¢çš„podåœ°å€ backend default_haproxy-ingress-demo_80 mode http balance roundrobin acl https-request ssl_fc http-request set-header X-Original-Forwarded-For %[hdr(x-forwarded-for)] if { hdr(x-forwarded-for) -m found } http-request del-header x-forwarded-for option forwardfor http-response set-header Strict-Transport-Security \"max-age=15768000\" server srv001 10.244.2.166:80 weight 1 check inter 2s #æ–°å¢çš„podåœ°å€ server srv002 10.244.0.52:80 weight 1 check inter 2s server srv003 10.244.1.149:80 weight 1 check inter 2s server srv004 127.0.0.1:1023 disabled weight 1 check inter 2s server srv005 127.0.0.1:1023 disabled weight 1 check inter 2s server srv006 127.0.0.1:1023 disabled weight 1 check inter 2s server srv007 127.0.0.1:1023 disabled weight 1 check inter 2s 4ã€æŸ¥çœ‹haproxy ingressæ—¥å¿—ï¼Œæ—¥å¿—ä¸­æç¤ºHAProxy updated without needing to reloadï¼Œå³é…ç½®åŠ¨æ€è¯†åˆ«ï¼Œä¸éœ€è¦é‡å¯haproxyæœåŠ¡å°±èƒ½å¤Ÿè¯†åˆ«ï¼Œè‡ªä»1.8åhaproxyèƒ½æ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°çš„èƒ½åŠ›ï¼Œä»¥é€‚åº”å¾®æœåŠ¡çš„åœºæ™¯ï¼Œè¯¦æƒ…æŸ¥çœ‹æ–‡ç« è¯´æ˜ [root@node-1 ~]# kubectl logs haproxy-ingress-bdns8 -n ingress-controller -f I1227 12:21:11.523066 6 controller.go:274] Starting HAProxy update id=20 I1227 12:21:11.561001 6 instance.go:162] HAProxy updated without needing to reload. Commands sent: 3 I1227 12:21:11.561057 6 controller.go:325] Finish HAProxy update id=20: ingress=0.149764ms writeTmpl=37.738947ms total=37.888711ms 5ã€æ¥ä¸‹æ¥æµ‹è¯•è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œä¸ºäº†éªŒè¯æµ‹è¯•æ•ˆæœï¼Œå¾€podä¸­å†™å…¥ä¸åŒçš„å†…å®¹ï¼Œä»¥æµ‹è¯•è´Ÿè½½å‡è¡¡çš„æ•ˆæœ [root@node-1 ~]# kubectl exec -it haproxy-ingress-demo-5d487d4fc-5pgjt /bin/bash root@haproxy-ingress-demo-5d487d4fc-5pgjt:/# echo \"web-1\" \u003e /usr/share/nginx/html/index.html [root@node-1 ~]# kubectl exec -it haproxy-ingress-demo-5d487d4fc-pst2q /bin/bash root@haproxy-ingress-demo-5d487d4fc-pst2q:/# echo \"web-2\" \u003e /usr/share/nginx/html/index.html [root@node-1 ~]# kubectl exec -it haproxy-ingress-demo-5d487d4fc-sr8tm /bin/bash root@haproxy-ingress-demo-5d487d4fc-sr8tm:/# echo \"web-3\" \u003e /usr/share/nginx/html/index.html 6ã€æµ‹è¯•éªŒè¯è´Ÿè½½å‡è¡¡æ•ˆæœ,haproxyé‡‡ç”¨è½®è¯¢çš„è°ƒåº¦ç®—æ³•ï¼Œå› æ­¤å¯ä»¥æ˜æ˜¾çœ‹åˆ°è½®è¯¢æ•ˆæœ [root@node-1 ~]# curl http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.102 web-1 [root@node-1 ~]# curl http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.102 web-2 [root@node-1 ~]# curl http://www.happylau.cn --resolve www.happylau.cn:80:10.254.100.102 web-3 è¿™ä¸ªç« èŠ‚éªŒè¯äº†haproxy ingressæ§åˆ¶å™¨åŠ¨æ€é…ç½®æ›´æ–°çš„èƒ½åŠ›ï¼Œç›¸æ¯”äºnginx ingressæ§åˆ¶å™¨è€Œè¨€ï¼Œhaproxy ingressæ§åˆ¶å™¨ä¸éœ€è¦é‡è½½æœåŠ¡è¿›ç¨‹å°±èƒ½å¤ŸåŠ¨æ€è¯†åˆ«åˆ°é…ç½®ï¼Œåœ¨å¾®æœåŠ¡åœºæ™¯ä¸‹å°†å…·æœ‰éå¸¸å¤§çš„ä¼˜åŠ¿ï¼›å¹¶é€šè¿‡ä¸€ä¸ªå®ä¾‹éªŒè¯äº†ingressè´Ÿè½½å‡è¡¡è°ƒåº¦èƒ½åŠ›ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:4:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.3 åŸºäºåç§°è™šæ‹Ÿä¸»æœº è¿™ä¸ªå°èŠ‚å°†æ¼”ç¤ºhaproxy ingressåŸºäºè™šæ‹Ÿäº‘ä¸»æœºåŠŸèƒ½çš„å®ç°ï¼Œå®šä¹‰ä¸¤ä¸ªè™šæ‹Ÿä¸»æœºnews.happylau.cnå’Œsports.happylau.cnï¼Œå°†è¯·æ±‚å„è‡ªè½¬å‘è‡³haproxy-1å’Œhaproxy-2 1ã€ å‡†å¤‡ç¯å¢ƒæµ‹è¯•ç¯å¢ƒï¼Œåˆ›å»ºä¸¤ä¸ªåº”ç”¨haproxy-1å’Œhaproxyå¹¶æš´éœ²æœåŠ¡ç«¯å£ [root@node-1 ~]# kubectl run haproxy-1 --image=nginx:1.7.9 --port=80 --replicas=1 --expose=true [root@node-1 ~]# kubectl run haproxy-2 --image=nginx:1.7.9 --port=80 --replicas=1 --expose=true æŸ¥çœ‹åº”ç”¨ [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE haproxy-1 1/1 1 1 39s haproxy-2 1/1 1 1 36s æŸ¥çœ‹service [root@node-1 ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE haproxy-1 ClusterIP 10.100.239.114 \u003cnone\u003e 80/TCP 55s haproxy-2 ClusterIP 10.100.245.28 \u003cnone\u003e 80/TCP 52s 3ã€å®šä¹‰ingressè§„åˆ™ï¼Œå®šä¹‰ä¸åŒçš„ä¸»æœºå¹¶å°†è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„serviceä¸­ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: haproxy-ingress-virtualhost annotations: kubernetes.io/ingress.class: haproxy spec: rules: - host: news.happylau.cn http: paths: - path: / backend: serviceName: haproxy-1 servicePort: 80 - host: sports.happylau.cn http: paths: - path: / backend: serviceName: haproxy-2 servicePort: 80 #åº”ç”¨ingressè§„åˆ™å¹¶æŸ¥çœ‹åˆ—è¡¨ [root@node-1 haproxy-ingress]# kubectl apply -f ingress-virtualhost.yaml ingress.extensions/haproxy-ingress-virtualhost created [root@node-1 haproxy-ingress]# kubectl get ingresses haproxy-ingress-virtualhost NAME HOSTS ADDRESS PORTS AGE haproxy-ingress-virtualhost news.happylau.cn,sports.happylau.cn 80 8s æŸ¥çœ‹ingressè§„åˆ™è¯¦æƒ… [root@node-1 haproxy-ingress]# kubectl describe ingresses haproxy-ingress-virtualhost Name: haproxy-ingress-virtualhost Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) Rules: Host Path Backends ---- ---- -------- news.happylau.cn / haproxy-1:80 (10.244.2.168:80) sports.happylau.cn / haproxy-2:80 (10.244.2.169:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernetes.io/ingress.class\":\"haproxy\"},\"name\":\"haproxy-ingress-virtualhost\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"news.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"haproxy-1\",\"servicePort\":80},\"path\":\"/\"}]}},{\"host\":\"sports.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"haproxy-2\",\"servicePort\":80},\"path\":\"/\"}]}}]}} kubernetes.io/ingress.class: haproxy Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal CREATE 37s ingress-controller Ingress default/haproxy-ingress-virtualhost Normal CREATE 37s ingress-controller Ingress default/haproxy-ingress-virtualhost Normal UPDATE 20s ingress-controller Ingress default/haproxy-ingress-virtualhost Normal UPDATE 20s ingress-controller Ingress default/haproxy-ingress-virtualhost 4ã€æµ‹è¯•éªŒè¯è™šæ‹Ÿæœºä¸»æœºé…ç½®ï¼Œé€šè¿‡curlç›´æ¥è§£æçš„æ–¹å¼ï¼Œæˆ–è€…é€šè¿‡å†™hostsæ–‡ä»¶ 5ã€æŸ¥çœ‹é…ç½®é…ç½®æ–‡ä»¶å†…å®¹ï¼Œé…ç½®ä¸­æ›´æ–°äº†haproxy.cfgçš„frontæ®µå’Œbackendæ®µçš„å†…å®¹ /etc/haproxy/haproxy.cfg é…ç½®æ–‡ä»¶å†…å®¹ backend default_haproxy-1_80 #haproxy-1åç«¯ mode http balance roundrobin acl https-request ssl_fc http-request set-header X-Original-Forwarded-For %[hdr(x-forwarded-for)] if { hdr(x-forwarded-for) -m found } http-request del-header x-forwarded-for option forwardfor http-response set-header Strict-Transport-Security \"max-age=15768000\" server srv001 10.244.2.168:80 weight 1 check inter 2s server srv002 127.0.0.1:1023 disabled weight 1 check inter 2s server srv003 127.0.0.1:1023 disabled weight 1 check inter 2s server srv004 127.0.0.1:1023 disabled weight 1 check inter 2s server srv005 127.0.0.1:1023 disabled weight 1 check inter 2s server srv006 127.0.0.1:1023 disabled weight 1 check inter 2s server srv007 127.0.0.1:1023 disabled weight 1 check inter 2s #haproxy-2åç«¯ backend default_haproxy-2_80 mode http balance roundrobin acl https-request ssl_fc http-request set-header X-Original-Forwarded-For %[hdr(x-forwarded-for)] if { hdr(x-forwarded-for) -m found } http-request del-header x-forwarded-for option forwardfor http-response set-header Strict-Transport-Security \"max-age=15768000\" server srv001 10.244.2.169:80 weight 1 check inter 2s server srv002 127.0.0.1:1023 disabled weight 1 check int","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:5:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.4 URLè‡ªåŠ¨è·³è½¬ haproxy ingressæ”¯æŒè‡ªåŠ¨è·³è½¬çš„èƒ½åŠ›ï¼Œéœ€è¦é€šè¿‡annotationså®šä¹‰ï¼Œé€šè¿‡ingress.kubernetes.io/ssl-redirectè®¾ç½®å³å¯ï¼Œé»˜è®¤ä¸ºfalseï¼Œè®¾ç½®ä¸ºtrueå³å¯å®ç°httpå¾€httpsè·³è½¬çš„èƒ½åŠ›ï¼Œå½“ç„¶å¯ä»¥å°†é…ç½®å†™å…¥åˆ°ConfigMapä¸­å®ç°é»˜è®¤è·³è½¬çš„èƒ½åŠ›ï¼Œæœ¬æ–‡ä»¥ç¼–å†™annotationsä¸ºä¾‹ï¼Œå®ç°è®¿é—®httpè·³è½¬httpsçš„èƒ½åŠ›ã€‚ 1ã€å®šä¹‰ingressè§„åˆ™ï¼Œè®¾ç½®ingress.kubernetes.io/ssl-redirectå®ç°è·³è½¬åŠŸèƒ½ apiVersion: extensions/v1beta1 kind: Ingress metadata: name: haproxy-ingress-virtualhost annotations: kubernetes.io/ingress.class: haproxy ingress.kubernetes.io/ssl-redirect: true #å®ç°è·³è½¬åŠŸèƒ½ spec: rules: - host: news.happylau.cn http: paths: - path: / backend: serviceName: haproxy-1 servicePort: 80 - host: sports.happylau.cn http: paths: - path: / backend: serviceName: haproxy-2 servicePort: 80 æŒ‰ç…§ä¸Šå›¾æµ‹è¯•äº†ä¸€ä¸‹åŠŸèƒ½ï¼Œæœªèƒ½å®ç°è·³è½¬å®ç°è·³è½¬çš„åŠŸèƒ½ï¼Œå¼€æºç‰ˆæœ¬ä¸­æœªèƒ½æ‰¾åˆ°æ›´å¤šæ–‡æ¡£è¯´æ˜ï¼Œä¼ä¸šç‰ˆç”±äºé•œåƒéœ€è¦è®¤è¯æˆæƒä¸‹è½½ï¼Œæœªèƒ½è¿›ä¸€æ­¥åšæµ‹è¯•éªŒè¯ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:6:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.4 åŸºäºTLSåŠ å¯† haproxy ingressé»˜è®¤é›†æˆäº†ä¸€ä¸ª 1ã€ç”Ÿæˆè‡ªç­¾åè¯ä¹¦å’Œç§é’¥ [root@node-1 haproxy-ingress]# openssl req -x509 -newkey rsa:2048 -nodes -days 365 -keyout tls.key -out tls.crt Generating a 2048 bit RSA private key ...........+++ .......+++ writing new private key to 'tls.key' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Country Name (2 letter code) [XX]:CN State or Province Name (full name) []:GD Locality Name (eg, city) [Default City]:ShenZhen Organization Name (eg, company) [Default Company Ltd]:Tencent Organizational Unit Name (eg, section) []:HappyLau Common Name (eg, your name or your server's hostname) []:www.happylau.cn Email Address []:573302346@qq.com 2ã€åˆ›å»ºSecretsï¼Œå…³è”è¯ä¹¦å’Œç§é’¥ [root@node-1 haproxy-ingress]# kubectl create secret tls haproxy-tls --cert=tls.crt --key=tls.key secret/haproxy-tls created [root@node-1 haproxy-ingress]# kubectl describe secrets haproxy-tls Name: haproxy-tls Namespace: default Labels: \u003cnone\u003e Annotations: \u003cnone\u003e Type: kubernetes.io/tls Data ==== tls.crt: 1424 bytes tls.key: 1704 bytes 3ã€ç¼–å†™ingressè§„åˆ™ï¼Œé€šè¿‡tlså…³è”Secrets apiVersion: extensions/v1beta1 kind: Ingress metadata: name: haproxy-ingress-virtualhost annotations: kubernetes.io/ingress.class: haproxy spec: tls: - hosts: - news.happylau.cn - sports.happylau.cn secretName: haproxy-tls rules: - host: news.happylau.cn http: paths: - path: / backend: serviceName: haproxy-1 servicePort: 80 - host: sports.happylau.cn http: paths: - path: / backend: serviceName: haproxy-2 servicePort: 80 4ã€åº”ç”¨é…ç½®å¹¶æŸ¥çœ‹è¯¦æƒ…,åœ¨TLSä¸­å¯ä»¥çœ‹åˆ°TLSå…³è”çš„è¯ä¹¦ [root@node-1 haproxy-ingress]# kubectl apply -f ingress-virtualhost.yaml ingress.extensions/haproxy-ingress-virtualhost configured [root@node-1 haproxy-ingress]# kubectl describe ingresses haproxy-ingress-virtualhost Name: haproxy-ingress-virtualhost Namespace: default Address: Default backend: default-http-backend:80 (\u003cnone\u003e) TLS: haproxy-tls terminates news.happylau.cn,sports.happylau.cn Rules: Host Path Backends ---- ---- -------- news.happylau.cn / haproxy-1:80 (10.244.2.168:80) sports.happylau.cn / haproxy-2:80 (10.244.2.169:80) Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"extensions/v1beta1\",\"kind\":\"Ingress\",\"metadata\":{\"annotations\":{\"kubernetes.io/ingress.class\":\"haproxy\"},\"name\":\"haproxy-ingress-virtualhost\",\"namespace\":\"default\"},\"spec\":{\"rules\":[{\"host\":\"news.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"haproxy-1\",\"servicePort\":80},\"path\":\"/\"}]}},{\"host\":\"sports.happylau.cn\",\"http\":{\"paths\":[{\"backend\":{\"serviceName\":\"haproxy-2\",\"servicePort\":80},\"path\":\"/\"}]}}],\"tls\":[{\"hosts\":[\"news.happylau.cn\",\"sports.happylau.cn\"],\"secretName\":\"haproxy-tls\"}]}} kubernetes.io/ingress.class: haproxy Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal CREATE 37m ingress-controller Ingress default/haproxy-ingress-virtualhost Normal CREATE 37m ingress-controller Ingress default/haproxy-ingress-virtualhost Normal UPDATE 7s (x2 over 37m) ingress-controller Ingress default/haproxy-ingress-virtualhost Normal UPDATE 7s (x2 over 37m) ingress-controller Ingress default/haproxy-ingress-virtualhost 5ã€æµ‹è¯•httpsç«™ç‚¹è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°å®‰å…¨çš„httpsè®¿é—® å†™åœ¨æœ€å haproxyå®ç°ingresså®é™…æ˜¯é€šè¿‡é…ç½®æ›´æ–°haproxy.cfgé…ç½®ï¼Œç»“åˆserviceçš„æœåŠ¡å‘ç°æœºåˆ¶åŠ¨æ€å®Œæˆingressæ¥å…¥ï¼Œç›¸æ¯”äºnginxæ¥è¯´ï¼Œhaproxyä¸éœ€è¦é‡è½½å®ç°é…ç½®å˜æ›´ã€‚åœ¨æµ‹è¯•haproxy ingressè¿‡ç¨‹ä¸­ï¼Œæœ‰éƒ¨åˆ†åŠŸèƒ½é…ç½®éªŒè¯æ²¡æœ‰è¾¾åˆ°é¢„æœŸï¼Œæ›´ä¸°å¯Œçš„åŠŸèƒ½æ”¯æŒåœ¨haproxy ingressä¼ä¸šç‰ˆä¸­æ”¯æŒï¼Œç¤¾åŒºç‰ˆèƒ½æ”¯æŒè“ç»¿å‘å¸ƒå’ŒWAFå®‰å…¨æ‰«æåŠŸèƒ½ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒç¤¾åŒºæ–‡æ¡£haproxyè“ç»¿å‘å¸ƒå’ŒWAFå®‰å…¨æ”¯æŒã€‚ haproxy ingressæ§åˆ¶å™¨ç›®å‰åœ¨ç¤¾åŒºæ´»è·ƒåº¦ä¸€èˆ¬ï¼Œç›¸æ¯”äºnginxï¼Œtraefikï¼Œistioè¿˜æœ‰ä¸€å®šçš„å·®è·ï¼Œå®é™…ç¯å¢ƒä¸­ä¸å»ºè®®ä½¿ç”¨ç¤¾åŒºç‰ˆçš„haproxy ingressã€‚ å‚è€ƒæ–‡æ¡£ å®˜æ–¹å®‰è£…æ–‡æ¡£ï¼šhttps://haproxy-ingress.github.io/docs/getting-started/ haproxy ingresså®˜æ–¹é…ç½®ï¼šhttps://www.haproxy.com/documentation/hapee/1-7r2/traffic-management/k8s-image-controller/ å½“ä½ çš„æ‰åæ’‘ä¸èµ·ä½ çš„é‡å¿ƒæ—¶ï¼Œä½ å°±åº”è¯¥é™ä¸‹å¿ƒæ¥å­¦ä¹  è¿”å›kubernetesç³»åˆ—æ•™ç¨‹ç›®å½• å¦‚æœè§‰å¾—æ–‡ç« å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·è®¢é˜…ä¸“æ ï¼Œåˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹å§ğŸ˜Š å…³äºä½œè€… åˆ˜æµ·å¹³ï¼ˆHappyLau ï¼‰äº‘è®¡ç®—é«˜çº§é¡¾é—® ç›®å‰åœ¨è…¾è®¯","date":"2019-08-04","objectID":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/:7:0","tags":["kubernetes"],"title":"16 åŸºäºhaproxyå®ç°ingressæœåŠ¡æš´éœ²","uri":"/myBlog-2/post/16-%E5%9F%BA%E4%BA%8Ehaproxy%E5%AE%9E%E7%8E%B0ingress%E6%9C%8D%E5%8A%A1%E6%9A%B4%E9%9C%B2/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1. ç›‘æ§æ¶æ„æ¦‚è¿° kubernetesç›‘æ§æŒ‡æ ‡å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šæ ¸å¿ƒç›‘æ§æŒ‡æ ‡å’Œè‡ªå®šä¹‰æŒ‡æ ‡ï¼Œæ ¸å¿ƒç›‘æ§æŒ‡æ ‡æ˜¯kuberneteså†…ç½®ç¨³å®šå¯é ç›‘æ§æŒ‡æ ‡ï¼Œæ—©æœŸç”±heapsterå®Œæˆï¼Œç°ç”±metric-serverå®ç°ï¼›è‡ªå®šä¹‰æŒ‡æ ‡ç”¨äºå®ç°æ ¸å¿ƒæŒ‡æ ‡çš„æ‰©å±•ï¼Œèƒ½å¤Ÿæä¾›æ›´ä¸°å¯Œçš„æŒ‡æ ‡æ”¯æŒï¼Œå¦‚åº”ç”¨çŠ¶æ€æŒ‡æ ‡ï¼Œè‡ªå®šä¹‰æŒ‡æ ‡éœ€è¦é€šè¿‡Aggregatorå’Œk8s apié›†æˆï¼Œå½“å‰ä¸»æµé€šè¿‡promethueså®ç°ã€‚ ç›‘æ§æŒ‡æ ‡ç”¨é€”ï¼š kubectl top æŸ¥çœ‹nodeå’Œpodçš„cpu+å†…å­˜ä½¿ç”¨æƒ…å†µ kubernetes-dashbaord æ§åˆ¶å°æŸ¥çœ‹èŠ‚ç‚¹å’Œpodèµ„æºç›‘æ§ Horizontal Pod Autoscaler æ°´å¹³æ¨ªå‘åŠ¨æ€æ‰©å±• Scheduler è°ƒåº¦å™¨è°ƒåº¦é€‰æ‹©æ¡ä»¶ 2. metric-serveræ¶æ„å’Œå®‰è£… ","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:0:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2. 1 metric-serverç®€ä»‹ Metrics Server is a cluster-wide aggregator of resource usage data. Resource metrics are used by components like kubectl top and the Horizontal Pod Autoscaler to scale workloads. To autoscale based upon a custom metric, you need to use the Prometheus Adapter Metric-serveræ˜¯ä¸€ä¸ªé›†ç¾¤çº§åˆ«çš„èµ„æºæŒ‡æ ‡æ”¶é›†å™¨ï¼Œç”¨äºæ”¶é›†èµ„æºæŒ‡æ ‡æ•°æ® æä¾›åŸºç¡€èµ„æºå¦‚CPUã€å†…å­˜ç›‘æ§æ¥å£æŸ¥è¯¢ï¼› æ¥å£é€šè¿‡ Kubernetes aggregatoræ³¨å†Œåˆ°kube-apiserverä¸­ï¼› å¯¹å¤–é€šè¿‡Metric APIæš´éœ²ç»™å¤–éƒ¨è®¿é—®ï¼› è‡ªå®šä¹‰æŒ‡æ ‡ä½¿ç”¨éœ€è¦å€ŸåŠ©Prometheuså®ç°ã€‚ The Metrics API /node è·å–æ‰€æœ‰èŠ‚ç‚¹çš„æŒ‡æ ‡ï¼ŒæŒ‡æ ‡åç§°ä¸ºNodeMetrics /node/\u003cnode_name\u003e ç‰¹å®šèŠ‚ç‚¹æŒ‡æ ‡ /namespaces/{namespace}/pods è·å–å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰podæŒ‡æ ‡ /namespaces/{namespace}/pods/{pod} ç‰¹å®špodçš„æŒ‡æ ‡ï¼ŒæŒ‡æ ‡åç§°ä¸ºPodMetrics æœªæ¥å°†èƒ½å¤Ÿæ”¯æŒæŒ‡æ ‡èšåˆï¼Œå¦‚maxæœ€å¤§å€¼ï¼Œminæœ€å°å€¼ï¼Œ95thå³°å€¼ï¼Œä»¥åŠè‡ªå®šä¹‰æ—¶é—´çª—å£ï¼Œå¦‚1hï¼Œ1dï¼Œ1wç­‰ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:1:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 metric-serveræ¶æ„ ç›‘æ§æ¶æ„åˆ†ä¸¤éƒ¨åˆ†å†…å®¹ï¼šæ ¸å¿ƒç›‘æ§(å›¾ç™½è‰²éƒ¨åˆ†)å’Œè‡ªå®šä¹‰ç›‘æ§ï¼ˆå›¾è“è‰²éƒ¨åˆ†ï¼‰ 1ã€ æ ¸å¿ƒç›‘æ§å®ç° é€šè¿‡kubeletæ”¶é›†èµ„æºä¼°ç®—+ä½¿ç”¨ä¼°ç®— metric-serverè´Ÿè´£æ•°æ®æ”¶é›†ï¼Œä¸è´Ÿè´£æ•°æ®å­˜å‚¨ metric-serverå¯¹å¤–æš´éœ²Metric APIæ¥å£ æ ¸å¿ƒç›‘æ§æŒ‡æ ‡å®¢ç”¨æˆ·HPAï¼Œkubectl topï¼Œschedulerå’Œdashboard 2ã€ è‡ªå®šä¹‰ç›‘æ§å®ç° è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡åŒ…æ‹¬ç›‘æ§æŒ‡æ ‡å’ŒæœåŠ¡æŒ‡æ ‡ éœ€è¦åœ¨æ¯ä¸ªnodeä¸Šéƒ¨ç½²ä¸€ä¸ªagentä¸ŠæŠ¥è‡³é›†ç¾¤ç›‘æ§agentï¼Œå¦‚prometheus é›†ç¾¤ç›‘æ§agentæ”¶é›†æ•°æ®åéœ€è¦å°†ç›‘æ§æŒ‡æ ‡+æœåŠ¡æŒ‡æ ‡é€šè¿‡API adaptorè½¬æ¢ä¸ºapiserverèƒ½å¤Ÿå¤„ç†çš„æ¥å£ HPAé€šè¿‡è‡ªå®šä¹‰æŒ‡æ ‡å®ç°æ›´ä¸°å¯Œçš„å¼¹æ€§æ‰©å±•èƒ½åŠ›ï¼Œéœ€è¦é€šè¿‡HPA adaptor APIåšæ¬¡è½¬æ¢ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:2:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.3 metric-serveréƒ¨ç½² 1ã€è·å–metric-serverå®‰è£…æ–‡ä»¶ï¼Œå½“å‰å…·æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š1.7å’Œ1.8+ï¼Œkubernetes1.7ç‰ˆæœ¬å®‰è£…1.7çš„metric-serverç‰ˆæœ¬ï¼Œkubernetes 1.8åç‰ˆæœ¬å®‰è£…metric server 1.8+ç‰ˆæœ¬ [root@node-1 ~]# git clone https://github.com/kubernetes-sigs/metrics-server.git 2ã€éƒ¨ç½²metric-serverï¼Œéƒ¨ç½²1.8+ç‰ˆæœ¬ [root@node-1 metrics-server]# kubectl apply -f deploy/1.8+/ clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created clusterrolebinding.rbac.authorization.k8s.io/metrics-server:system:auth-delegator created rolebinding.rbac.authorization.k8s.io/metrics-server-auth-reader created apiservice.apiregistration.k8s.io/v1beta1.metrics.k8s.io created serviceaccount/metrics-server created deployment.apps/metrics-server created service/metrics-server created clusterrole.rbac.authorization.k8s.io/system:metrics-server created clusterrolebinding.rbac.authorization.k8s.io/system:metrics-server created æ ¸å¿ƒçš„é…ç½®æ–‡ä»¶æ˜¯metrics-server-deployment.yamlï¼Œmetric-serverä»¥Deploymentçš„æ–¹å¼éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼Œjé•œåƒk8s.gcr.io/metrics-server-amd64:v0.3.6éœ€è¦æå‰ä¸‹è½½å¥½ï¼Œå…¶å¯¹åº”çš„å®‰è£…æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š --- apiVersion: v1 kind: ServiceAccount metadata: name: metrics-server namespace: kube-system --- apiVersion: apps/v1 kind: Deployment metadata: name: metrics-server namespace: kube-system labels: k8s-app: metrics-server spec: selector: matchLabels: k8s-app: metrics-server template: metadata: name: metrics-server labels: k8s-app: metrics-server spec: serviceAccountName: metrics-server volumes: # mount in tmp so we can safely use from-scratch images and/or read-only containers - name: tmp-dir emptyDir: {} containers: - name: metrics-server image: k8s.gcr.io/metrics-server-amd64:v0.3.6 args: - --cert-dir=/tmp - --secure-port=4443 ExternalIP ports: - name: main-port containerPort: 4443 protocol: TCP securityContext: readOnlyRootFilesystem: true runAsNonRoot: true runAsUser: 1000 imagePullPolicy: Always volumeMounts: - name: tmp-dir mountPath: /tmp nodeSelector: beta.kubernetes.io/os: linux 3ã€æ£€æŸ¥metric-serveréƒ¨ç½²çš„æƒ…å†µ,æŸ¥çœ‹metric-serverçš„Podå·²éƒ¨ç½²æˆåŠŸ [root@node-1 1.8+]# kubectl get deployments metrics-server -n kube-system NAME READY UP-TO-DATE AVAILABLE AGE metrics-server 1/1 1 1 2m49s [root@node-1 1.8+]# kubectl get pods -n kube-system metrics-server-67db467b7b-5xf8x NAME READY STATUS RESTARTS AGE metrics-server-67db467b7b-5xf8x 1/1 Running 0 3m å®é™…æ­¤æ—¶metric-serverå¹¶ä¸èƒ½ä½¿ç”¨ï¼Œä½¿ç”¨kubectl top node æŸ¥çœ‹ä¼šæç¤ºError from server (NotFound): nodemetrics.metrics.k8s.io â€œnode-1â€ not foundç±»ä¼¼çš„æŠ¥é”™ï¼ŒæŸ¥çœ‹metric-serverçš„podçš„æ—¥å¿—ä¿¡æ¯ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š [root@node-1 1.8+]# kubectl logs metrics-server-67db467b7b-5xf8x -n kube-system -f I1230 11:34:10.905500 1 serving.go:312] Generated self-signed cert (/tmp/apiserver.crt, /tmp/apiserver.key) I1230 11:34:11.527346 1 secure_serving.go:116] Serving securely on [::]:4443 E1230 11:35:11.552067 1 manager.go:111] unable to fully collect metrics: [unable to fully scrape metrics from source kubelet_summary:node-1: unable to fetch metrics from Kubelet node-1 (node-1): Get https://node-1:10250/stats/summary?only_cpu_and_memory=true: dial tcp: lookup node-1 on 10.96.0.10:53: no such host, unable to fully scrape metrics from source kubelet_summary:node-3: unable to fetch metrics from Kubelet node-3 (node-3): Get https://node-3:10250/stats/summary?only_cpu_and_memory=true: dial tcp: lookup node-3 on 10.96.0.10:53: no such host, unable to fully scrape metrics from source kubelet_summary:node-2: unable to fetch metrics from Kubelet node-2 (node-2): Get https://node-2:10250/stats/summary?only_cpu_and_memory=true: dial tcp: lookup node-2 on 10.96.0.10:53: no such host] 4ã€ä¸Šè¿°çš„æŠ¥é”™ä¿¡æ¯æç¤ºpodä¸­é€šè¿‡DNSæ— æ³•è§£æä¸»æœºåï¼Œå¯ä»¥é€šè¿‡åœ¨podä¸­å®šä¹‰hostsæ–‡ä»¶æˆ–å‘ŠçŸ¥metric-serverä¼˜å…ˆä½¿ç”¨IPçš„æ–¹å¼é€šè®¯ï¼Œä¿®æ”¹metric-serverçš„deploymenté…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹å¹¶é‡æ–°åº”ç”¨é…ç½® 5ã€åº”ç”¨metric-serveréƒ¨ç½²æ–‡ä»¶åé‡æ–°ç”Ÿæˆä¸€ä¸ªpodï¼Œæ—¥å¿—ä¸­å†æ¬¡æŸ¥çœ‹æç¤ºå¦å¤–ä¸€ä¸ªæŠ¥é”™ä¿¡æ¯ [root@node-1 1.8+]# kubectl logs metrics-server-f54f5d6bf-s42rc -n kube-system -f I1230 11:45:26.615547 1 serving.go:312] Generated self-signed cert (/tmp/apiserver.crt, /tmp/apiserver.key) I1230 11:45:27.043723 1 secure_serving.go:116] Serving securely on [::]:4443 E1230 11:46:27.065274 1 manager.go:111] unable to fully collect metrics: [unable to fully","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:3:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.4 metric-server apiæµ‹è¯• 1ã€å®‰è£…å®Œmetric-serveråä¼šå¢åŠ ä¸€ä¸ªmetrics.k8s.io/v1beta1çš„APIç»„ï¼Œè¯¥APIç»„é€šè¿‡Aggregatoræ¥å…¥apiserverä¸­ 2ã€ä½¿ç”¨å‘½ä»¤è¡ŒæŸ¥çœ‹kubectl top nodeçš„ç›‘æ§ä¿¡æ¯,å¯ä»¥çœ‹åˆ°CPUå’Œå†…å­˜çš„åˆ©ç”¨ç‡ [root@node-1 1.8+]# kubectl top node NAME CPU(cores) CPU% MEMORY(bytes) MEMORY% node-1 110m 5% 4127Mi 53% node-2 53m 5% 1066Mi 61% node-3 34m 3% 1002Mi 57% 3ã€æŸ¥çœ‹podç›‘æ§ä¿¡æ¯,å¯ä»¥çœ‹åˆ°podä¸­CPUå’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µ [root@node-1 1.8+]# kubectl top pods NAME CPU(cores) MEMORY(bytes) haproxy-1-686c67b997-kw8pp 0m 1Mi haproxy-2-689b4f897-7cwmf 0m 1Mi haproxy-ingress-demo-5d487d4fc-5pgjt 0m 1Mi haproxy-ingress-demo-5d487d4fc-pst2q 0m 1Mi haproxy-ingress-demo-5d487d4fc-sr8tm 0m 1Mi ingress-demo-d77bdf4df-7kwbj 0m 1Mi ingress-demo-d77bdf4df-7x6jn 0m 1Mi ingress-demo-d77bdf4df-hr88b 0m 1Mi ingress-demo-d77bdf4df-wc22k 0m 1Mi service-1-7b66bf758f-xj9jh 0m 2Mi service-2-7c7444684d-w9cv9 1m 3Mi 4ã€é™¤äº†ç”¨å‘½ä»¤è¡Œè¿æ¥metricc-serverè·å–ç›‘æ§èµ„æºï¼Œè¿˜å¯ä»¥é€šè¿‡APIæ–¹å¼é“¾æ¥æ–¹å¼è·å–ï¼Œå¯ç”¨APIæœ‰ http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/nodes http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/nodes/ http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/pods http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/namespace//pods/\u003cpod-name å¦‚ä¸‹æµ‹è¯•APIæ¥å£çš„ä½¿ç”¨ï¼š aã€åˆ›å»ºä¸€ä¸ªkube proxyä»£ç†ï¼Œç”¨äºé“¾æ¥apiserverï¼Œé»˜è®¤å°†ç›‘å¬åœ¨127çš„8001ç«¯å£ [root@node-1 ~]# kubectl proxy Starting to serve on 127.0.0.1:8001 bã€æŸ¥çœ‹nodeåˆ—è¡¨çš„ç›‘æ§æ•°æ®ï¼Œå¯ä»¥è·å–åˆ°æ‰€æœ‰nodeçš„èµ„æºç›‘æ§æ•°æ®ï¼Œusageä¸­åŒ…å«cpuå’Œmemory [root@node-1 ~]# curl http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/nodes % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 1167 100 1167 0 0 393k 0 --:--:-- --:--:-- --:--:-- 569k { \"kind\": \"NodeMetricsList\", \"apiVersion\": \"metrics.k8s.io/v1beta1\", \"metadata\": { \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes\" }, \"items\": [ { \"metadata\": { \"name\": \"node-3\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes/node-3\", \"creationTimestamp\": \"2019-12-30T14:23:00Z\" }, \"timestamp\": \"2019-12-30T14:22:07Z\", \"window\": \"30s\", \"usage\": { \"cpu\": \"32868032n\", \"memory\": \"1027108Ki\" } }, { \"metadata\": { \"name\": \"node-1\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes/node-1\", \"creationTimestamp\": \"2019-12-30T14:23:00Z\" }, \"timestamp\": \"2019-12-30T14:22:07Z\", \"window\": \"30s\", \"usage\": { \"cpu\": \"108639556n\", \"memory\": \"4305356Ki\" } }, { \"metadata\": { \"name\": \"node-2\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes/node-2\", \"creationTimestamp\": \"2019-12-30T14:23:00Z\" }, \"timestamp\": \"2019-12-30T14:22:12Z\", \"window\": \"30s\", \"usage\": { \"cpu\": \"47607386n\", \"memory\": \"1119960Ki\" } } ] } cã€æŒ‡å®šæŸä¸ªå…·ä½“çš„nodeè®¿é—®åˆ°å…·ä½“nodeçš„èµ„æºç›‘æ§æ•°æ® [root@node-1 ~]# curl http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/nodes/node-2 { \"kind\": \"NodeMetrics\", \"apiVersion\": \"metrics.k8s.io/v1beta1\", \"metadata\": { \"name\": \"node-2\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes/node-2\", \"creationTimestamp\": \"2019-12-30T14:24:39Z\" }, \"timestamp\": \"2019-12-30T14:24:12Z\", \"window\": \"30s\", \"usage\": { \"cpu\": \"43027609n\", \"memory\": \"1120168Ki\" } } dã€æŸ¥çœ‹æ‰€æœ‰podçš„åˆ—è¡¨ä¿¡æ¯ curl http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/pods eã€æŸ¥çœ‹æŸä¸ªå…·ä½“podçš„ç›‘æ§æ•°æ® [root@node-1 ~]# curl http://127.0.0.1:8001/apis/metrics.k8s.io/v1beta1/namespaces/default/pods/haproxy-ingress-demo-5d487d4fc-sr8tm { \"kind\": \"PodMetrics\", \"apiVersion\": \"metrics.k8s.io/v1beta1\", \"metadata\": { \"name\": \"haproxy-ingress-demo-5d487d4fc-sr8tm\", \"namespace\": \"default\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/namespaces/default/pods/haproxy-ingress-demo-5d487d4fc-sr8tm\", \"creationTimestamp\": \"2019-12-30T14:36:30Z\" }, \"timestamp\": \"2019-12-30T14:36:13Z\", \"window\": \"30s\", \"containers\": [ { \"name\": \"haproxy-ingress-demo\", \"usage\": { \"cpu\": \"0\", \"memory\": \"1428Ki\" } } ] } 5ã€å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡kubectl -rawçš„æ–¹å¼è®¿é—®æ¥å£,å¦‚è°ƒç”¨node-3çš„æ•°æ® [root@node-1 ~]# kubectl get --raw /apis/metrics.k8s.io/v1beta1/nodes/node-3 | jq . { \"kind\": \"NodeMetrics\", \"apiVersion\": \"metrics.k8s.io/v1beta1\", \"metadata\": { \"name\": \"node-3\", \"selfLink\": \"/apis/metrics.k8s.io/v1beta1/nodes/node-3\", \"creationTimestamp\": \"2019-12-30T14:44:46Z\" }, \"timestamp\": \"2019-12-30T14:44:09Z\", \"window\": \"30s\", \"usage\": { \"cpu\": \"35650151n\", \"memory\": \"1026820Ki\" } } å…¶ä»–è¿‘ä¼¼çš„æ¥å£æœ‰ï¼š kub","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:4:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.1 HPAæ¦‚è¿° The Horizontal Pod Autoscaler automatically scales the number of pods in a replication controller, deployment, replica set or stateful set based on observed CPU utilization (or, with custom metrics support, on some other application-provided metrics). Note that Horizontal Pod Autoscaling does not apply to objects that canâ€™t be scaled, for example, DaemonSets. HPAå³Horizontal Pod Autoscaler,Podæ°´å¹³æ¨ªå‘åŠ¨æ€æ‰©å±•ï¼Œå³æ ¹æ®åº”ç”¨åˆ†é…èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€å¢åŠ æˆ–è€…å‡å°‘Podå‰¯æœ¬æ•°é‡ï¼Œä»¥å®ç°é›†ç¾¤èµ„æºçš„æ‰©å®¹ï¼Œå…¶å®ç°æœºåˆ¶ä¸ºï¼š HPAéœ€è¦ä¾èµ–äºç›‘æ§ç»„ä»¶ï¼Œè°ƒç”¨ç›‘æ§æ•°æ®å®ç°åŠ¨æ€ä¼¸ç¼©ï¼Œå¦‚è°ƒç”¨Metrics APIæ¥å£ HPAæ˜¯äºŒçº§çš„å‰¯æœ¬æ§åˆ¶å™¨ï¼Œå»ºç«‹åœ¨Deploymentsï¼ŒReplicaSetï¼ŒStatefulSetsç­‰å‰¯æœ¬æ§åˆ¶å™¨åŸºç¡€ä¹‹ä¸Š HPAæ ¹æ®è·å–èµ„æºæŒ‡æ ‡ä¸åŒæ”¯æŒä¸¤ä¸ªç‰ˆæœ¬ï¼šv1å’Œv2alpha1 HPA V1è·å–æ ¸å¿ƒèµ„æºæŒ‡æ ‡ï¼Œå¦‚CPUå’Œå†…å­˜åˆ©ç”¨ç‡ï¼Œé€šè¿‡è°ƒç”¨Metric-server APIæ¥å£å®ç° HPA V2è·å–è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡ï¼Œé€šè¿‡Prometheusè·å–ç›‘æ§æ•°æ®å®ç° HPAæ ¹æ®èµ„æºAPIå‘¨æœŸæ€§è°ƒæ•´å‰¯æœ¬æ•°ï¼Œæ£€æµ‹å‘¨æœŸhorizontal-pod-autoscaler-sync-periodå®šä¹‰çš„å€¼ï¼Œé»˜è®¤15s ","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:5:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.2 HPAå®ç° å¦‚ä¸‹å¼€å§‹å»¶æ—¶HPAåŠŸèƒ½çš„å®ç°ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªDeploymentå‰¯æœ¬æ§åˆ¶å™¨ï¼Œç„¶åå†é€šè¿‡HPAå®šä¹‰èµ„æºåº¦é‡ç­–ç•¥ï¼Œå½“CPUåˆ©ç”¨ç‡è¶…è¿‡requestsåˆ†é…çš„80%æ—¶å³æ‰©å®¹ã€‚ 1ã€åˆ›å»ºDeploymentå‰¯æœ¬æ§åˆ¶å™¨ [root@node-1 ~]# kubectl run hpa-demo --image=nginx:1.7.9 --port=80 --replicas=1 --expose=true --requests=\"'cpu=200m,memory=64Mi\" [root@node-1 ~]# kubectl get deployments hpa-demo -o yaml apiVersion: extensions/v1beta1 kind: Deployment metadata: annotations: deployment.kubernetes.io/revision: \"1\" creationTimestamp: \"2019-12-31T01:43:24Z\" generation: 1 labels: run: hpa-demo name: hpa-demo namespace: default resourceVersion: \"14451208\" selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/hpa-demo uid: 3b0f29e8-8606-4e52-8f5b-6c960d396136 spec: progressDeadlineSeconds: 600 replicas: 1 revisionHistoryLimit: 10 selector: matchLabels: run: hpa-demo strategy: rollingUpdate: maxSurge: 25% maxUnavailable: 25% type: RollingUpdate template: metadata: creationTimestamp: null labels: run: hpa-demo spec: containers: - image: nginx:1.7.9 imagePullPolicy: IfNotPresent name: hpa-demo ports: - containerPort: 80 protocol: TCP resources: requests: cpu: 200m memory: 64Mi terminationMessagePath: /dev/termination-log terminationMessagePolicy: File dnsPolicy: ClusterFirst restartPolicy: Always schedulerName: default-scheduler securityContext: {} terminationGracePeriodSeconds: 30 status: availableReplicas: 1 conditions: - lastTransitionTime: \"2019-12-31T01:43:25Z\" lastUpdateTime: \"2019-12-31T01:43:25Z\" message: Deployment has minimum availability. reason: MinimumReplicasAvailable status: \"True\" type: Available - lastTransitionTime: \"2019-12-31T01:43:24Z\" lastUpdateTime: \"2019-12-31T01:43:25Z\" message: ReplicaSet \"hpa-demo-755bdd875c\" has successfully progressed. reason: NewReplicaSetAvailable status: \"True\" type: Progressing observedGeneration: 1 readyReplicas: 1 replicas: 1 updatedReplicas: 1 2ã€åˆ›å»ºHPAæ§åˆ¶å™¨ï¼ŒåŸºäºCPUå®ç°æ¨ªå‘æ‰©å±•,ç­–ç•¥ä¸ºè‡³å°‘2ä¸ªPodï¼Œæœ€å¤§5ä¸ªï¼ŒtargetCPUUtilizationPercentageè¡¨ç¤ºCPUå®é™…ä½¿ç”¨ç‡å requestsç™¾åˆ†æ¯” apiVersion: autoscaling/v1 kind: HorizontalPodAutoscaler metadata: name: hpa-demo spec: maxReplicas: 5 minReplicas: 2 scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: hpa-demo targetCPUUtilizationPercentage: 80 3ã€åº”ç”¨HPAè§„åˆ™å¹¶æŸ¥çœ‹è¯¦æƒ…ï¼Œç”±äºç­–ç•¥éœ€ç¡®ä¿æœ€å°2ä¸ªå‰¯æœ¬ï¼ŒDeploymenté»˜è®¤ä¸æ˜¯2ä¸ªå‰¯æœ¬ï¼Œå› æ­¤éœ€è¦æ‰©å®¹ï¼Œåœ¨è¯¦æƒ…æ—¥å¿—ä¸­çœ‹åˆ°å‰¯æœ¬æ‰©å±•è‡³2ä¸ª [root@node-1 ~]# kubectl apply -f hpa-demo.yaml horizontalpodautoscaler.autoscaling/hpa-demo created #æŸ¥çœ‹HPAåˆ—è¡¨ [root@node-1 ~]# kubectl get horizontalpodautoscalers.autoscaling NAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGE hpa-demo Deployment/hpa-demo \u003cunknown\u003e/80% 2 5 0 7s #æŸ¥çœ‹HPAè¯¦æƒ… [root@node-1 ~]# kubectl describe horizontalpodautoscalers.autoscaling hpa-demo Name: hpa-demo Namespace: default Labels: \u003cnone\u003e Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"autoscaling/v1\",\"kind\":\"HorizontalPodAutoscaler\",\"metadata\":{\"annotations\":{},\"name\":\"hpa-demo\",\"namespace\":\"default\"},\"spe... CreationTimestamp: Tue, 31 Dec 2019 09:52:51 +0800 Reference: Deployment/hpa-demo Metrics: ( current / target ) resource cpu on pods (as a percentage of request): \u003cunknown\u003e / 80% Min replicas: 2 Max replicas: 5 Deployment pods: 1 current / 2 desired Conditions: Type Status Reason Message ---- ------ ------ ------- AbleToScale True SucceededRescale the HPA controller was able to update the target scale to 2 Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal SuccessfulRescale 1s horizontal-pod-autoscaler New size: 2; reason: Current number of replicas below Spec.MinReplicas #å‰¯æœ¬æ‰©å®¹è‡³2ä¸ªï¼Œæ ¹æ®MinReplicaçš„ç­–ç•¥ 4ã€æŸ¥çœ‹Deploymentåˆ—è¡¨æ ¡éªŒç¡®è®¤æ‰©å®¹æƒ…å†µï¼Œå·²è¾¾åˆ°HPAåŸºç¡€æœ€å°åŒ–ç­–ç•¥ [root@node-1 ~]# kubectl get deployments hpa-demo --show-labels NAME READY UP-TO-DATE AVAILABLE AGE LABELS hpa-demo 2/2 2 2 94m run=hpa-demo [root@node-1 ~]# kubectl get pods -l run=hpa-demo NAME READY STATUS RESTARTS AGE hpa-demo-5fcd9c757d-7q4td 1/1 Running 0 5m10s hpa-demo-5fcd9c757d-cq6k6 1/1 Running 0 10m 5ã€å‡å¦‚ä¸šåŠ¡å¢é•¿æœŸé—´ï¼ŒCPUåˆ©ç”¨ç‡å¢é«˜ï¼Œä¼šè‡ªåŠ¨æ¨ªå‘å¢åŠ Podæ¥å®ç°ï¼Œä¸‹é¢å¼€å§‹é€šè¿‡CPUå‹æµ‹æ¥æ¼”ç¤ºDeploymentçš„æ‰©å±• [root@node-1 ~]# kubectl exec -it hpa-demo-5fcd9c757d-cq6k6 /bin/bash root@hpa-demo-5fcd9c757d-cq6k6:/# dd if=/dev/zero of=/dev/nu","date":"2019-08-04","objectID":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/:6:0","tags":["kubernetes"],"title":"17 ä½¿ç”¨metric Serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œ","uri":"/myBlog-2/post/17-%E4%BD%BF%E7%94%A8metric-server%E8%AE%A9hpa%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9%E6%84%89%E5%BF%AB%E8%BF%90%E8%A1%8C/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ä¸ªç« èŠ‚ä¸­kubernetesç³»åˆ—æ•™ç¨‹(åä¹)ä½¿ç”¨metric-serverè®©HPAå¼¹æ€§ä¼¸ç¼©æ„‰å¿«è¿è¡Œä»‹ç»äº†åœ¨kubernetesä¸­çš„ç›‘æ§æ¶æ„ï¼Œé€šè¿‡å®‰è£…å’Œä½¿ç”¨metric-serveræä¾›kubernetesä¸­çš„æ ¸å¿ƒç›‘æ§æŒ‡æ ‡ï¼šæä¾›nodeèŠ‚ç‚¹å’Œpodå®¹å™¨CPUå’Œå†…å­˜çš„ç›‘æ§èƒ½åŠ›ï¼Œæ ¸å¿ƒç›‘æ§æŒ‡æ ‡æä¾›çš„ç›‘æ§ç»´åº¦å’ŒæŒ‡æ ‡ç›¸å¯¹æœ‰é™ï¼Œéœ€è¦æ›´å¥½çš„æ‰©å±•ç›‘æ§èƒ½åŠ›ï¼Œéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ç›‘æ§æ¥å®ç°ï¼Œæœ¬æ–‡ä»‹ç»prometheusæä¾›æ›´æ›´åŠ ä¸°å¯Œçš„è‡ªå®šä¹‰ç›‘æ§èƒ½åŠ›ã€‚ 1. åˆè¯†prometheus ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:0:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 prometheusç®€ä»‹ Prometheus is an open-source systems monitoring and alerting toolkit originally built at SoundCloud. It is now a standalone open source project and maintained independently of any company. To emphasize this, and to clarify the projectâ€™s governance structure, Prometheus joined theCloud Native Computing Foundationin 2016 as the second hosted project, afterKubernetes. Prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§ç³»ç»Ÿ+å‘Šè­¦ç³»ç»Ÿå·¥å…·é›†ï¼Œæœ€æ—©ç”±SoudCloudå¼€å‘ï¼Œç›®å‰å·²è¢«å¾ˆå¤šå…¬å¸å¹¿æ³›ä½¿ç”¨ï¼Œäº2016å¹´åŠ å…¥CNCFç»„ç»‡ï¼Œæˆä¸ºç»§kubernetesä¹‹åç¬¬äºŒä¸ªç®¡ç†çš„é¡¹ç›®ã€‚å¾—ç›Šäºkubernetesçš„ç«çƒ­ï¼Œprometheusè¢«è¶Šæ¥è¶Šå¤šçš„ä¼ä¸šåº”ç”¨ï¼Œå·²æˆä¸ºæ–°ä¸€ä»£çš„ç›‘æ§ç³»ç»Ÿï¼Œæˆä¸ºCNCFç¬¬äºŒä¸ªæ¯•ä¸šçš„é¡¹ç›®ã€‚ prometheusç‰¹ç‚¹ï¼š ä¸€ä¸ªæŒ‡æ ‡å’Œé”®å€¼å¯¹æ ‡è¯†çš„æ—¶é—´åºåˆ—åŒ–å¤šç»´åº¦æ•°æ®æ¨¡å‹ PromQLæä¾›ä¸€ä¸ªä¾¿æ·æŸ¥è¯¢è¯­è¨€å®ç°å¤šç»´åº¦æ•°æ®æŸ¥è¯¢ ä¸ä¾èµ–äºåˆ†å¸ƒå¼å­˜å‚¨ï¼Œå•ä¸ªèŠ‚ç‚¹èƒ½æä¾›è‡ªæ²»åŠŸèƒ½ é€šè¿‡HTTPåè®®æ‹‰å–æ—¶é—´ç³»åˆ—æ•°æ®æ¨¡å‹ æ”¯æŒé€šè¿‡gatewayä¸»åŠ¨æ¨é€æ—¶é—´åºåˆ— æ”¯æŒæœåŠ¡å‘ç°æˆ–è€…é™æ€é…ç½®å‘ç°èŠ‚ç‚¹ å†…ç½®æœ‰å¤šç»´åº¦æ•°æ®ç”»å›¾å’Œé›†æˆgrafanaæ•°æ®å±•ç¤º ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:1:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 prometheusæ¶æ„ prometheusæ¶æ„ï¼š prometheus-serverï¼Œprometheusä¸»æœåŠ¡ç«¯ï¼Œä»exportersç«¯é‡‡é›†å’Œå­˜å‚¨æ•°æ®ï¼Œå¹¶æä¾›PromQLæ•°æ®æŸ¥è¯¢è¯­è¨€ Retrieval é‡‡é›†æ¨¡å—ï¼Œä»exporterså’Œpushgatewayä¸­é‡‡é›†æ•°æ®ï¼Œé‡‡é›†æ•°æ®ç»è¿‡ä¸€å®šè§„åˆ™å¤„ç† TSDB æ•°æ®å­˜å‚¨ï¼ŒTSDBæ˜¯æ—¶åºåŒ–æ•°æ®åº“ï¼Œå°†Retrievalé‡‡é›†æ•°æ®å­˜å‚¨ï¼Œé»˜è®¤å­˜å‚¨åœ¨æœ¬åœ° http server æä¾›httpæ¥å£æŸ¥è¯¢å’Œæ•°æ®å±•æ¿ï¼Œé»˜è®¤ç«¯å£æ˜¯9090ï¼Œå¯ä»¥ç™»é™†æŸ¥è¯¢ç›‘æ§æŒ‡æ ‡å’Œç»˜å›¾ PromQL æä¾›è¾¹ç•Œçš„PromQLè¯­è¨€ï¼Œç”¨äºæ•°æ®ç»Ÿè®¡ï¼Œæ•°æ®è¾“å‡ºå’Œæ•°æ®å±•ç¤ºæ¥å£é›†æˆ æ•°æ®é‡‡é›†ï¼Œæ•°æ®é‡‡é›†æ¨¡å—ï¼ŒåŒ…å«ä¸¤ç§æ•°æ®é‡‡é›†æ–¹å¼ï¼šæ‹‰å»pullå’Œæ¨é€push Jobs exporters é‡‡é›†å®¿ä¸»æœºå’Œcontainerçš„æ€§èƒ½æŒ‡æ ‡ï¼Œé€šè¿‡httpæ–¹å¼æ‹‰å–ï¼Œæ”¯æŒå¤šç§ä¸åŒæ•°æ®ç±»å‹é‡‡é›† Short-lived jobs ç¬æ—¶åœ¨çº¿ä»»åŠ¡ï¼Œé€‚ç”¨äºå®æ—¶ç›‘æ§æŒ‡æ ‡ï¼Œserverç«¯æ‹‰å»æ—¶å¯èƒ½æ¶ˆå¤±äº†ï¼Œé‡‡ç”¨ä¸»åŠ¨ä¸ŠæŠ¥æœºåˆ¶ Pushgateway æ¨åŠ¨ç½‘å…³ï¼ŒShort-lived jobså°†æ•°æ®ä¸»åŠ¨pushåˆ°è¿‡gatewayï¼Œserverå†ä»gatewayæ‹‰å– æ•°æ®å±•ç¤ºï¼Œå€ŸåŠ©äºPromQLè¯­è¨€å®ç°å®ç°æ•°æ®çš„å±•ç¤ºï¼ŒåŒ…å«è¿˜æœ‰prometheus UIï¼ŒGafanaå’ŒAPI clients Prometheus Web UIï¼Œprometheusé»˜è®¤æä¸€ä¸ªæ•°æ®æŸ¥è¯¢å’Œç”»å›¾å±•ç¤ºçš„UIï¼Œé€šè¿‡http 9090ç«¯å£ Grafanaï¼Œä¸€ä¸ªå¼€æºéå¸¸ä¼˜ç§€ç»šçƒ‚çš„æ•°æ®å±•ç¤ºæ¡†æ¶ï¼Œä»Prometheusä¸­è·å–æ•°æ®ï¼Œé‡‡ç”¨æ¨¡ç‰ˆç»˜å›¾ API Clientsï¼Œæ”¯æŒå¤šç§ä¸åŒçš„å®¢æˆ·ç«¯SDKè¯­è¨€ï¼ŒåŒ…æ‹¬Goï¼Œpythonï¼ŒJavaç­‰ï¼Œä¾¿äºç¼–å†™å¼€å‘ç›‘æ§ç³»ç»Ÿ å‘Šè­¦ç³»ç»Ÿï¼Œä»serveræ¥å—å‘Šè­¦ï¼Œæ¨é€ç»™AlertManagerå‘Šè­¦ç³»ç»Ÿï¼Œå‘Šè­¦ç³»ç»Ÿæ¥å—å‘Šè­¦ä¿¡æ¯å»é‡ï¼Œåˆ†ç»„ã€‚é€šçŸ¥åŒ…å« pageduty Emailï¼Œé‚®ä»¶å‘Šè­¦ï¼Œç»“åˆsmtp å…¶ä»–ï¼Œå¦‚webhookç­‰ æœåŠ¡å‘ç°ï¼Œå€ŸåŠ©äºç¬¬ä¸‰æ–¹æ¥å£å®ç°æœåŠ¡æœºåˆ¶ï¼Œå¦‚DNSï¼ŒConsulï¼ŒKubernetesç­‰ï¼Œå¦‚å’Œkubernetes apiserverç»“åˆï¼Œè·å–ç›®æ ‡targetçš„æ˜¯åˆ—è¡¨ï¼Œå¹¶å®šæœŸè½®è®­è·å–åˆ°ç›‘æ§æ•°æ®ã€‚ 2. prometheuså’Œkubernetesç»“åˆ ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:2:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 prometheuså®‰è£…ç®€ä»‹ prometheuså®‰è£…æ¶‰åŠè¾ƒå¤šçš„ç»„ä»¶ï¼Œå› æ­¤ç»™å®‰è£…å¸¦æ¥è¾ƒå¤§çš„å›°éš¾ï¼Œkube-prometheusæ˜¯coreoså…¬å¸æä¾›åœ¨kubernetsä¸­è‡ªåŠ¨å®‰è£…prometheusçš„ç»„ä»¶ï¼Œä¸ºé›†æˆkuberntesæä¾›çš„å®‰è£…ï¼ŒåŒ…å«å¦‚ä¸‹ç»„ä»¶ï¼š The Prometheus Operator prometheusæ ¸å¿ƒç»„ä»¶ Highly available Prometheus æä¾›é«˜å¯ç”¨èƒ½åŠ› Highly available Alertmanager å‘Šè­¦ç®¡ç†å™¨ Prometheus node-exporter æ•°æ®é‡‡é›†ç»„ä»¶ Prometheus Adapter for Kubernetes Metrics APIs å’Œkubernetesé›†æˆçš„é€‚é…å™¨ kube-state-metrics æŒ‡æ ‡ç›‘æ§è½¬æ¢ï¼Œä½¿ä¹‹é€‚é…kubernetesé£æ ¼çš„æ¥å£ Grafana æ•°æ®å±•ç¤º å®‰è£…ç¯å¢ƒï¼š 1ã€kubernetesç‰ˆæœ¬,1.15.3 [root@node-1 ~]# kubectl version Client Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.3\", GitCommit:\"2d3c76f9091b6bec110a5e63777c332469e0cba2\", GitTreeState:\"clean\", BuildDate:\"2019-08-19T11:13:54Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"} Server Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.3\", GitCommit:\"2d3c76f9091b6bec110a5e63777c332469e0cba2\", GitTreeState:\"clean\", BuildDate:\"2019-08-19T11:05:50Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"} 2ã€prometheusç‰ˆæœ¬ prometheus v2.12.0 prometheus-operator v0.34.0 node-exporter v0.18.1 alertmanager v0.20.0 grafana 6.4.3 ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:3:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 prometheuså®‰è£… 1ã€è·å–kube-prometheuså®‰è£…æº [root@node-1 ~]# git clone https://github.com/coreos/kube-prometheus.git 2ã€å¿«é€Ÿå®‰è£…prometheusç»„ä»¶ï¼Œç›¸å…³çš„setupåŒ…çš„yamlæ–‡ä»¶åœ¨setupç›®å½•ä¸‹,åŒ…å«æœ‰å¾ˆå¤šè‡ªå®šä¹‰çš„CRDèµ„æº [root@node-1 ~]# kubectl apply -f kube-prometheus/manifests/setup/ namespace/monitoring created customresourcedefinition.apiextensions.k8s.io/alertmanagers.monitoring.coreos.com unchanged customresourcedefinition.apiextensions.k8s.io/podmonitors.monitoring.coreos.com unchanged customresourcedefinition.apiextensions.k8s.io/prometheuses.monitoring.coreos.com unchanged customresourcedefinition.apiextensions.k8s.io/prometheusrules.monitoring.coreos.com created customresourcedefinition.apiextensions.k8s.io/servicemonitors.monitoring.coreos.com created clusterrole.rbac.authorization.k8s.io/prometheus-operator created clusterrolebinding.rbac.authorization.k8s.io/prometheus-operator created deployment.apps/prometheus-operator created service/prometheus-operator created serviceaccount/prometheus-operator created æ ¡éªŒCRDèµ„æºå®‰è£…æƒ…å†µ,prometheus,alertmanagers,rules,servicemonitorå‡ä»¥CRMèµ„æºçš„æ–¹å¼éƒ¨ç½² [root@node-1 ~]# kubectl get customresourcedefinitions.apiextensions.k8s.io |grep monitoring alertmanagers.monitoring.coreos.com 2020-01-30T05:36:58Z podmonitors.monitoring.coreos.com 2020-01-30T05:37:06Z prometheuses.monitoring.coreos.com 2020-01-30T05:37:18Z prometheusrules.monitoring.coreos.com 2020-01-30T05:44:05Z servicemonitors.monitoring.coreos.com 2020-01-30T05:44:06Z éƒ¨ç½²äº†ä¸€ä¸ªprometheus-operatorçš„deploymentså’Œservices [root@node-1 ~]# kubectl get deployments -n monitoring NAME READY UP-TO-DATE AVAILABLE AGE prometheus-operator 1/1 1 1 3m5s [root@node-1 ~]# kubectl get services -n monitoring NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE prometheus-operator ClusterIP None \u003cnone\u003e 8080/TCP 3m13s 3ã€éƒ¨ç½²prometheuså…¶ä»–ç»„ä»¶ï¼ŒåŒ…å«kube-state-metricï¼Œgrafanaï¼Œnode-exporterï¼Œalertmanagerï¼Œprometheus-adapterï¼Œprometheusï¼Œç»„ä»¶åŒ…å«åœ¨manifestæ‰€åœ¨ç›®å½•ï¼Œå®‰è£…ç»„ä»¶çš„è§’è‰²å¦‚ä¸‹ï¼š prometheus prometheusæ ¸å¿ƒç»„ä»¶ prometheus-adapter prometheusé€‚é…å™¨ï¼Œåšæ•°æ®è½¬æ¢ kube-state-metrics kubernetesæŒ‡æ ‡è½¬æ¢å™¨ï¼Œè½¬æ¢ä¸ºapiserverèƒ½è¯†åˆ«çš„æŒ‡æ ‡ alertmanager å‘Šè­¦ç®¡ç†å™¨ï¼Œç”¨äºæŒ‡æ ‡é˜€å€¼å‘Šè­¦å®ç° node-exporter exportersï¼Œå®¢æˆ·ç«¯ç›‘æ§ä¸ŠæŠ¥agentï¼Œç”¨äºå®ç°æ•°æ®ä¸ŠæŠ¥ grafana æ•°æ®æ˜¾ç¤ºå±•æ¿ configmaps grafanaæ•°æ®å±•æ¿é…ç½®æ¨¡ç‰ˆï¼Œå°è£…åœ¨configmapä¸­ clusterroleï¼Œclusterrolebinding prometheusè®¿é—®kubernetesçš„RBACæˆæƒ [root@node-1 ~]# kubectl apply -f kube-prometheus/manifests/ alertmanager.monitoring.coreos.com/main created secret/alertmanager-main created service/alertmanager-main created serviceaccount/alertmanager-main created servicemonitor.monitoring.coreos.com/alertmanager created secret/grafana-datasources created configmap/grafana-dashboard-apiserver created configmap/grafana-dashboard-cluster-total created configmap/grafana-dashboard-controller-manager created configmap/grafana-dashboard-k8s-resources-cluster created configmap/grafana-dashboard-k8s-resources-namespace created configmap/grafana-dashboard-k8s-resources-node created configmap/grafana-dashboard-k8s-resources-pod created configmap/grafana-dashboard-k8s-resources-workload created configmap/grafana-dashboard-k8s-resources-workloads-namespace created configmap/grafana-dashboard-kubelet created configmap/grafana-dashboard-namespace-by-pod created configmap/grafana-dashboard-namespace-by-workload created configmap/grafana-dashboard-node-cluster-rsrc-use created configmap/grafana-dashboard-node-rsrc-use created configmap/grafana-dashboard-nodes created configmap/grafana-dashboard-persistentvolumesusage created configmap/grafana-dashboard-pod-total created configmap/grafana-dashboard-pods created configmap/grafana-dashboard-prometheus-remote-write created configmap/grafana-dashboard-prometheus created configmap/grafana-dashboard-proxy created configmap/grafana-dashboard-scheduler created configmap/grafana-dashboard-statefulset created configmap/grafana-dashboard-workload-total created configmap/grafana-dashboards created deployment.apps/grafana created service/grafana created serviceaccount/grafana created servicemonitor.monitoring.coreos.com/grafana created clusterrole.rbac.authorization.k8s.io/kube-state-metric","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:4:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.1 prometheusåŸç”ŸæŒ‡æ ‡ prometheus-k8sé»˜è®¤æä¾›ClusterIPå¼€æ”¾9090ç«¯å£ç”¨äºé›†ç¾¤å†…éƒ¨ï¼Œä¿®æ”¹ä¸ºNodePortä¾›é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œå¦‚ä¸‹ä¿®æ”¹å°†prometheus-k8sçš„ç±»å‹ä¿®æ”¹ä¸ºNodePortç±»å‹ [root@node-1 ~]# kubectl patch -p '{\"spec\":{\"type\": \"NodePort\"}}' services -n monitoring prometheus-k8s service/prometheus-k8s patched [root@node-1 ~]# kubectl get services -n monitoring prometheus-k8s -o yaml apiVersion: v1 kind: Service metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{},\"labels\":{\"prometheus\":\"k8s\"},\"name\":\"prometheus-k8s\",\"namespace\":\"monitoring\"},\"spec\":{\"ports\":[{\"name\":\"web\",\"port\":9090,\"targetPort\":\"web\"}],\"selector\":{\"app\":\"prometheus\",\"prometheus\":\"k8s\"},\"sessionAffinity\":\"ClientIP\"}} creationTimestamp: \"2020-01-30T09:04:03Z\" labels: prometheus: k8s name: prometheus-k8s namespace: monitoring resourceVersion: \"18773330\" selfLink: /api/v1/namespaces/monitoring/services/prometheus-k8s uid: 272e8f9a-d412-4f42-9553-da5f7e71cf2f spec: clusterIP: 10.108.126.97 externalTrafficPolicy: Cluster ports: - name: web nodePort: 31924 #NodePortç«¯å£ port: 9090 protocol: TCP targetPort: web selector: app: prometheus prometheus: k8s sessionAffinity: ClientIP sessionAffinityConfig: clientIP: timeoutSeconds: 10800 type: NodePort status: loadBalancer: {} 1ã€æŸ¥è¯¢prometheusç›‘æ§æŒ‡æ ‡ï¼ŒprometheusåŒ…å«æœ‰ä¸°å¯Œçš„æŒ‡æ ‡ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç›‘æ§æŒ‡æ ‡ é€‰æ‹©container_cpu_usage_seconds_totalæŸ¥è¯¢å®¹å™¨çš„cpuä½¿ç”¨ç‡ä¸ºä¾‹ï¼Œæ‰§è¡ŒExcuteæ‰§è¡ŒæŸ¥è¯¢ï¼Œå¯ä»¥è·å–åˆ°æ‰€æœ‰å®¹å™¨çš„cpuä½¿ç”¨æ•°æ®ï¼Œåˆ‡æ¢è‡³Graphå¯ä»¥ç»˜åˆ¶ç®€å•çš„å›¾åƒï¼Œå›¾åƒæ˜¾ç¤ºç›¸å¯¹ç®€å•ï¼ŒæŒ‡æ ‡é€šè¿‡grafanaæ˜¾ç¤ºä¼šæ›´ç»šçƒ‚ï¼Œä¸€èˆ¬è¾ƒå°‘ä½¿ç”¨prometheusçš„ç»˜å›¾åŠŸèƒ½ 2ã€æœåŠ¡å‘ç°ï¼Œç”¨äºåŠ¨æ€å‘ç°prometheusæœåŠ¡ç›¸å…³çš„ç»„ä»¶ï¼Œå¹¶å®šæœŸå‘æœåŠ¡ç»„ä»¶æ‹‰å–æ•°æ® 3ã€å†…ç½®å‘Šè­¦è§„åˆ™ï¼Œé»˜è®¤å†…ç½®å®šä¹‰æœ‰alertå‘Šè­¦è§„åˆ™ï¼Œç”¨æˆ·å®ç°ç›‘æ§å‘Šè­¦åˆ‡æ¢åˆ°alertsä¸ºå‘Šè­¦çš„å†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°å‘Šè­¦çš„æŒ‡æ ‡ã€‚ prometheusæä¾›äº†ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡metricï¼Œå¹¶é€šè¿‡9090çš„httpç«¯å£æä¾›äº†å¤–éƒ¨è®¿é—®ç›‘æ§æŒ‡æ ‡å’Œç®€å•ç»˜å›¾çš„åŠŸèƒ½ï¼Œç›¸æ¯”grafanaè€Œè¨€ï¼Œå›¾å½¢ç•Œé¢çš„åŠŸèƒ½ç›¸å¯¹ç®€å•ï¼Œä¸»è¦ç”¨äºæŸ¥è¯¢prometheusæ•°æ®ï¼Œå€ŸåŠ©äºPromQLè¯­è¨€æŸ¥è¯¢ç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:5:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.2 grafanaæ•°æ®å±•ç¤º ç›¸æ¯”äºprometheus web UIï¼Œgrafanaèƒ½å¤Ÿæä¾›æ›´ä¸°å¯Œçš„æ•°æ®å±•ç¤ºåŠŸèƒ½ï¼Œèµ·å€ŸåŠ©äºPromQLè¯­è¨€å®ç°ä¸°å¯Œçš„æ•°æ®æŸ¥è¯¢å¹¶é€šè¿‡æ¨¡ç‰ˆå±•ç¤ºæ§åˆ¶å°ï¼Œgrafanaé»˜è®¤çš„3000ç«¯å£å¹¶æœªå¯¹å¤–éƒ¨å¼€æ”¾ï¼Œä¸ºäº†ä»é›†ç¾¤å¤–éƒ¨è®¿é—®grafanaï¼Œéœ€è¦å°†grafanaçš„servcieç±»å‹ä¿®æ”¹ä¸ºNodePort,å¼€æ”¾NodePortç«¯å£ä¸º30923 [root@node-1 ~]# kubectl patch -p '{\"spec\": {\"type\": \"NodePort\"}}' services grafana -n monitoring service/grafana patched [root@node-1 ~]# kubectl get services grafana -n monitoring NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE grafana NodePort 10.105.229.156 \u003cnone\u003e 3000:30923/TCP 114m å¤–éƒ¨é€šè¿‡30923ç«¯å£è®¿é—®grafanaï¼Œåˆå§‹é»˜è®¤ç™»é™†çš„ç”¨æˆ·åå’Œå¯†ç å‡ä¸ºadminï¼Œé¦–æ¬¡ç™»é™†grafanaä¼šæç¤ºä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œå¯†ç ç¬¦åˆå¤æ‚æ€§è¦æ±‚ï¼Œå¦‚ä¸‹ä¸ºç™»é™†åçš„grafanaçš„å±•æ¿æ˜¾ç¤º 1ã€kubernetesé›†ç¾¤ç›‘æ§ï¼ŒåŒ…å«æœ‰æ•´ä¸ªé›†ç¾¤CPUèµ„æºä½¿ç”¨+åˆ†é…ï¼Œå†…å­˜èµ„æºä½¿ç”¨+åˆ†é…ï¼ŒCPUé…é¢ï¼Œç½‘ç»œèµ„æºç­‰ï¼Œå¯ä»¥å…¨å±€çœ‹åˆ°é›†ç¾¤èµ„æºçš„ä½¿ç”¨æƒ…å†µ 2ã€NodeèŠ‚ç‚¹ç›‘æ§ï¼Œå¯ä»¥çœ‹åˆ°kubernetesé›†ç¾¤ä¸­ç‰¹å®šæŸä¸ªèŠ‚ç‚¹çš„èµ„æºæƒ…å†µå•Šï¼šCPUä½¿ç”¨ç‡ï¼ŒCPUè´Ÿè½½ï¼Œå†…å­˜ä½¿ç”¨ç‡ï¼Œç£ç›˜IOï¼Œç£ç›˜ç©ºé—´ï¼Œç½‘ç»œå¸¦å®½ï¼Œç½‘ç»œä¼ è¾“ç­‰æŒ‡æ ‡ 3ã€Podç›‘æ§ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å‘½åç©ºé—´ä¸‹podçš„èµ„æºæƒ…å†µï¼šå®¹å™¨CPUä½¿ç”¨ç‡ï¼Œå†…å­˜ä½¿ç”¨ï¼Œç£ç›˜IOï¼Œç£ç›˜ç©ºé—´ç­‰ 4ã€kuberneteså·¥ä½œè´Ÿè½½ç›‘æ§ï¼Œå¯ä»¥å’ŒæŸ¥çœ‹åˆ°Deploymentï¼ŒStatefulSetsï¼ŒDaemonSets 5ã€ç½‘ç»œç›‘æ§ï¼Œå¯ä»¥çœ‹åˆ°é›†ç¾¤Clusterçº§åˆ«ç½‘ç»œç›‘æ§ã€å·¥ä½œè´Ÿè½½Workloadçº§åˆ«ç½‘ç»œç›‘æ§å’ŒPodçº§åˆ«ç½‘ç»œç›‘æ§ï¼ŒåŒ…æ‹¬ç½‘ç»œçš„å‘é€æ•°æ®ï¼Œæ¥å—æ•°æ®ï¼Œå‡ºå¸¦å®½å’Œå…¥å¸¦å®½æŒ‡æ ‡ã€‚ 6ã€grafanaé»˜è®¤è¿˜æä¾›äº†å…¶ä»–å¾ˆå¤šçš„ç›‘æ§æŒ‡æ ‡ï¼Œæ¯”å¦‚apiserverï¼Œkubeletï¼Œpvç­‰ å†™åœ¨æœ€å æœ¬æ–‡æ€»ç»“äº†åœ¨kubernetesä¸­ä½¿ç”¨prometheusæä¾›å®Œå¤‡çš„è‡ªå®šä¹‰ç›‘æ§ç³»ç»Ÿï¼Œé€šè¿‡grafanaå±•ç¤ºæ›´ä¸°å¯Œç»šçƒ‚çš„å›¾æ ‡å†…å®¹ï¼Œç›¸æ¯”äºæ ¸å¿ƒç›‘æ§æŒ‡æ ‡metric-serverè€Œè¨€ï¼Œprometheusèƒ½å¤Ÿæä¾›æ›´åŠ ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡ï¼Œä¸”è¿™äº›è‡ªå®šä¹‰ç›‘æ§æŒ‡æ ‡èƒ½ç”¨äºHPA V2ï¼ˆå‚è€ƒå®˜æ–¹è¯´æ˜ï¼‰ä¸­å®ç°æ›´ä¸°å¯Œçš„å¼¹æ€§æ‰©å±•ä¼¸ç¼©èƒ½åŠ›ï¼Œæ¯«æ— ç–‘é—®ï¼Œprometheusçš„å‡ºç°è®©kubernetesçš„ç›‘æ§å˜å¾—æ›´ç®€å•è€ŒåŠŸèƒ½ä¸°å¯Œã€‚ å‚è€ƒæ–‡çŒ® prometheuså®˜ç½‘ï¼šhttps://prometheus.io kube-prometheuså®‰è£…å®˜æ¡£ï¼šhttps://github.com/coreos/kube-prometheus TKEè‡ªåŠ¨å¼¹æ€§ä¼¸ç¼©æŒ‡æ ‡è¯´æ˜ï¼šhttps://cloud.tencent.com/document/product/457/38929 HPAä½¿ç”¨è¯´æ˜ï¼šhttps://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/:6:0","tags":["kubernetes"],"title":"18 Prometheusæä¾›å®Œå¤‡ç›‘æ§ç³»ç»Ÿ","uri":"/myBlog-2/post/18-prometheus%E6%8F%90%E4%BE%9B%E5%AE%8C%E5%A4%87%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1. kubernetesç®€ä»‹ ","date":"2019-08-04","objectID":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/:0:0","tags":["kubernetes"],"title":"01 åˆæ¢kubernetesåŠŸèƒ½ä¸ç»„ä»¶","uri":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 dockerå®¹å™¨æŠ€æœ¯ Docker provides a way to run applications securely isolated in a container, packaged with all its dependencies and libraries.Build once, Run anywhwere. Dockeræä¾›äº†ä¸€ç§å°†åº”ç”¨ç¨‹åºå®‰å…¨ï¼Œéš”ç¦»è¿è¡Œçš„ä¸€ç§æ–¹å¼ï¼Œèƒ½å¤Ÿå°†åº”ç”¨ç¨‹åºä¾èµ–å’Œåº“æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€ä¸ªå®¹å™¨ä¸­ï¼Œåç»­å†ä»»ä½•åœ°æ–¹è¿è¡Œèµ·æ¥å³å¯ï¼Œå…¶åŒ…å«äº†åº”ç”¨ç¨‹åºæ‰€ä¾èµ–ç›¸å…³ç¯å¢ƒï¼Œä¸€æ¬¡æ„å»ºï¼Œä»»æ„è¿è¡Œï¼ˆbuild onceï¼Œrun anywhereï¼‰ Dockerç»„æˆï¼š Docker Daemon å®¹å™¨ç®¡ç†ç»„ä»¶ï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè½½å®¹å™¨ï¼Œé•œåƒï¼Œå­˜å‚¨ï¼Œç½‘ç»œç­‰ç®¡ç† Docker Client å®¹å™¨å®¢æˆ·ç«¯ï¼Œè´Ÿè´£å’ŒDocker Daemonäº¤äº’ï¼Œå®Œæˆå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† Docker Registry å®¹å™¨é•œåƒä»“åº“ï¼Œè´Ÿè´£å­˜å‚¨ï¼Œåˆ†å‘ï¼Œæ‰“åŒ… Docker Object å®¹å™¨å¯¹è±¡ï¼Œä¸»è¦åŒ…å«containerå’Œimages å®¹å™¨ç»™åº”ç”¨ç¨‹åºå¼€å‘ç¯å¢ƒå¸¦æ¥å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†å®¹å™¨çš„ç¯å¢ƒä¾èµ–ï¼Œæ‰“åŒ…ç­‰é—®é¢˜ï¼Œç„¶è€Œï¼ŒDockerå¸¦æ¥çš„å®¹å™¨æ‰“åŒ…çš„ä¾¿åˆ©ï¼ŒåŒæ—¶ä¹Ÿå¸¦æ¥äº†ä»¥ä¸‹çš„æŒ‘æˆ˜ï¼š å®¹å™¨å¦‚ä½•è°ƒåº¦ï¼Œåˆ†å‘ å¤šå°æœºå™¨å¦‚ä½•ååŒå·¥ä½œ Dockerä¸»æœºæ•…éšœæ—¶åº”ç”¨å¦‚ä½•æ¢å¤ å¦‚ä½•ä¿éšœåº”ç”¨é«˜å¯ç”¨ï¼Œæ¨ªå‘æ‰©å±•ï¼ŒåŠ¨æ€ä¼¸ç¼© ","date":"2019-08-04","objectID":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/:1:0","tags":["kubernetes"],"title":"01 åˆæ¢kubernetesåŠŸèƒ½ä¸ç»„ä»¶","uri":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 kubernetesç®€ä»‹ä¸åŠŸèƒ½ Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications.It groups containers that make up an application into logical units for easy management and discovery. Kubernetes builds upon15 years of experience of running production workloads at Google, combined with best-of-breed ideas and practices from the community. Kubernetesæ˜¯googleå¼€æºçš„ä¸€å¥—å¾®æœåŠ¡ï¼Œå®¹å™¨åŒ–çš„ç¼–æ’å¼•æ“ï¼Œæä¾›å®¹å™¨è¯åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ¨ªå‘æ‰©å±•å’Œç®¡ç†ï¼Œæ˜¯googleå†…éƒ¨å®¹å™¨åå¤šå¹´å®æˆ˜æ²‰æ·€çš„ç»“æ™¶ï¼Œå·²æˆ˜èƒœSwarmï¼ŒMesosæˆä¸ºå®¹å™¨ç¼–æ’çš„è¡Œä¸šæ ‡å‡†ã€‚ ä¸‰å¤§å®¹å™¨ç¼–æ’å¼•æ“ï¼š Swarm DockeråŸç”Ÿæä¾›çš„å®¹å™¨åŒ–ç¼–æ’å¼•æ“ï¼Œéšç€dockeræ”¯æŒkubernetesé€æ¸åºŸå¼ƒ Mesos ç»“åˆMarathonæä¾›å®¹å™¨è°ƒåº¦ç¼–æ’çš„èƒ½åŠ›ï¼Œè¿˜èƒ½æä¾›å…¶ä»–framworkçš„è°ƒåº¦ Kubernetes å·²æˆä¸ºå®¹å™¨ç¼–æ’å¼•æ“çš„å”¯ä¸€æ ‡å‡†ï¼Œè¶Šæ¥è¶Šå¤šç¨‹åºæ”¯æŒkubernetesã€‚ kubernteså†…ç½®æœ‰å¾ˆå¤šéå¸¸ä¼˜ç§€çš„ç‰¹æ€§ä½¿å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡æœ¬èº«ï¼Œå…¶åŒ…å«çš„åŠŸèƒ½å¦‚ä¸‹ï¼š Service discovery and load balancingï¼ŒæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡DNSå®ç°å†…éƒ¨è§£æï¼Œserviceå®ç°è´Ÿè½½å‡è¡¡ Storage orchestrationï¼Œå­˜å‚¨ç¼–æ’ï¼Œé€šè¿‡plunginçš„å½¢å¼æ”¯æŒå¤šç§å­˜å‚¨ï¼Œå¦‚æœ¬åœ°ï¼Œnfsï¼Œcephï¼Œå…¬æœ‰äº‘å¿«å­˜å‚¨ç­‰ Automated rollouts and rollbacksï¼Œè‡ªåŠ¨å‘å¸ƒä¸å›æ»šï¼Œé€šè¿‡åŒ¹é…å½“å‰çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€ä¸€è‡´ï¼Œæ›´æ–°å¤±è´¥æ—¶å¯å›æ»š Automatic bin packingï¼Œè‡ªåŠ¨èµ„æºè°ƒåº¦ï¼Œå¯ä»¥è®¾ç½®podè°ƒåº¦çš„æ‰€éœ€ï¼ˆrequestsï¼‰èµ„æºå’Œé™åˆ¶èµ„æºï¼ˆlimitsï¼‰ Self-healingï¼Œå†…ç½®çš„å¥åº·æ£€æŸ¥ç­–ç•¥ï¼Œè‡ªåŠ¨å‘ç°å’Œå¤„ç†é›†ç¾¤å†…çš„å¼‚å¸¸ï¼Œæ›´æ¢ï¼Œéœ€é‡å¯çš„podèŠ‚ç‚¹ Secret and configuration managementï¼Œå¯†é’¥å’Œé…ç½®ç®¡ç†ï¼Œå¯¹äºæ•æ„Ÿä¿¡æ¯å¦‚å¯†ç ï¼Œè´¦å·çš„é‚£ä¸ªé€šè¿‡secretå­˜å‚¨ï¼Œåº”ç”¨çš„é…ç½®æ–‡ä»¶é€šè¿‡configmapå­˜å‚¨ï¼Œé¿å…å°†é…ç½®æ–‡ä»¶å›ºå®šåœ¨é•œåƒä¸­ï¼Œå¢åŠ å®¹å™¨ç¼–æ’çš„çµæ´»æ€§ Batch executionï¼Œæ‰¹å¤„ç†æ‰§è¡Œï¼Œé€šè¿‡jobå’Œcronjobæä¾›å•æ¬¡æ‰¹å¤„ç†ä»»åŠ¡å’Œå¾ªç¯è®¡åˆ’ä»»åŠ¡åŠŸèƒ½çš„å®ç° Horizontal scaling,æ¨ªå‘æ‰©å±•åŠŸèƒ½ï¼ŒåŒ…å«æœ‰HPAå’ŒASï¼Œå³åº”ç”¨çš„åŸºäºCPUåˆ©ç”¨ç‡çš„å¼¹æ€§ä¼¸ç¼©å’ŒåŸºäºå¹³å°çº§çš„å¼¹æ€§ä¼¸ç¼©ï¼Œå¦‚è‡ªåŠ¨å¢åŠ nodeå’Œåˆ é™¤nodesèŠ‚ç‚¹ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/:2:0","tags":["kubernetes"],"title":"01 åˆæ¢kubernetesåŠŸèƒ½ä¸ç»„ä»¶","uri":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 kubernetesæ¶æ„è§£æ kubernetesåŒ…å«ä¸¤ç§è§’è‰²ï¼šmasterèŠ‚ç‚¹å’ŒnodeèŠ‚ç‚¹ï¼ŒmasterèŠ‚ç‚¹æ˜¯é›†ç¾¤çš„æ§åˆ¶ç®¡ç†èŠ‚ç‚¹ï¼Œä½œä¸ºæ•´ä¸ªk8sé›†ç¾¤çš„å¤§è„‘ã€‚ è´Ÿè´£é›†ç¾¤æ‰€æœ‰æ¥å…¥è¯·æ±‚(kube-apiserver)ï¼Œåœ¨æ•´ä¸ªé›†ç¾¤çš„å…¥å£ï¼› é›†ç¾¤èµ„æºè°ƒåº¦(kube-controller-scheduler)ï¼Œé€šè¿‡watchç›‘è§†podçš„åˆ›å»ºï¼Œè´Ÿè´£å°†podè°ƒåº¦åˆ°åˆé€‚çš„nodeèŠ‚ç‚¹ï¼› é›†ç¾¤çŠ¶æ€çš„ä¸€è‡´æ€§(kube-controller-manager)ï¼Œé€šè¿‡å¤šç§æ§åˆ¶å™¨ç¡®ä¿é›†ç¾¤çš„ä¸€è‡´æ€§ï¼ŒåŒ…å«æœ‰Node Controllerï¼ŒReplication Controllerï¼ŒEndpoints Controllerç­‰ï¼› å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨(etcd)ï¼Œæ•°æ®æŒä¹…å­˜å‚¨åŒ–ï¼Œå­˜å‚¨é›†ç¾¤ä¸­åŒ…æ‹¬nodeï¼Œpodï¼Œrcï¼Œserviceç­‰æ•°æ®ï¼› nodeèŠ‚ç‚¹æ˜¯å®é™…çš„å·¥ä½œèŠ‚ç‚¹ï¼Œè´Ÿè´£é›†ç¾¤è´Ÿè½½çš„å®é™…è¿è¡Œï¼Œå³podè¿è¡Œçš„è½½ä½“ï¼Œå…¶é€šå¸¸åŒ…å«ä¸‰ä¸ªç»„ä»¶ï¼šContainer Runtimeï¼Œkubeletå’Œkube-proxy Container Runtimeæ˜¯å®¹å™¨è¿è¡Œæ—¶ï¼Œè´Ÿè´£å®ç°containerç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå¦‚dockerï¼Œcontainerdï¼Œrktletï¼› kubeletè´Ÿè´£é•œåƒå’Œpodçš„ç®¡ç†ï¼Œ kube-proxyæ˜¯serviceæœåŠ¡å®ç°çš„æŠ½è±¡ï¼Œè´Ÿè´£ç»´æŠ¤å’Œè½¬å‘podçš„è·¯ç”±ï¼Œå®ç°é›†ç¾¤å†…éƒ¨å’Œå¤–éƒ¨ç½‘ç»œçš„è®¿é—®ã€‚ å…¶ä»–ç»„ä»¶è¿˜åŒ…æ‹¬ï¼š cloud-controller-managerï¼Œç”¨äºå…¬æœ‰äº‘çš„æ¥å…¥å®ç°ï¼Œæä¾›èŠ‚ç‚¹ç®¡ç†(node)ï¼Œè·¯ç”±ç®¡ç†ï¼ŒæœåŠ¡ç®¡ç†(LoadBalancerå’ŒIngress)ï¼Œå­˜å‚¨ç®¡ç†(Volumeï¼Œå¦‚äº‘ç›˜ï¼ŒNASæ¥å…¥)ï¼Œéœ€è¦ç”±å…¬æœ‰äº‘å‚å•†å®ç°å…·ä½“çš„ç»†èŠ‚ï¼Œkubernetesæä¾›å®ç°æ¥å£çš„æ¥å…¥ï¼Œå¦‚è…¾è®¯äº‘ç›®å‰æä¾›CVMçš„nodeç®¡ç†ï¼ŒèŠ‚ç‚¹çš„å¼¹æ€§ä¼¸ç¼©(AS),è´Ÿè½½å‡è¡¡çš„æ¥å…¥(CLB),å­˜å‚¨çš„ç®¡ç†(CBSå’ŒCFS)ç­‰äº§å“çš„é›†æˆï¼› DNSç»„ä»¶ç”±kube-dnsæˆ–corednså®ç°é›†ç¾¤å†…çš„åç§°è§£æï¼› kubernetes-dashboardç”¨äºå›¾å½¢ç•Œé¢ç®¡ç†ï¼› kubectlå‘½ä»¤è¡Œå·¥å…·è¿›è¡ŒAPIäº¤äº’ï¼› æœåŠ¡å¤–éƒ¨æ¥å…¥ï¼Œé€šè¿‡ingresså®ç°ä¸ƒå±‚æ¥å…¥ï¼Œç”±å¤šç§controlleræ§åˆ¶å™¨ç»„æˆ traefik nginx ingress controller haproxy ingress controller å…¬æœ‰äº‘å‚å•†ingress controller ç›‘æ§ç³»ç»Ÿç”¨äºé‡‡é›†nodeå’Œpodçš„ç›‘æ§æ•°æ® metric-server æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§ prometheus è‡ªå®šä¹‰æŒ‡æ ‡ç›‘æ§ï¼Œæä¾›ä¸°å¯ŒåŠŸèƒ½ heapster+influxdb+grafana æ—§æ ¸å¿ƒæŒ‡æ ‡ç›‘æ§æ–¹æ¡ˆï¼Œç°å·²åºŸå¼ƒ æ—¥å¿—é‡‡é›†ç³»ç»Ÿï¼Œç”¨äºæ”¶é›†å®¹å™¨çš„ä¸šåŠ¡æ•°æ®,å®ç°æ—¥å¿—çš„é‡‡é›†ï¼Œå­˜å‚¨å’Œå±•ç¤ºï¼Œç”±EFKå®ç° Fluentd æ—¥å¿—é‡‡é›† ElasticSearch æ—¥å¿—å­˜å‚¨+æ£€ç´¢ Kiabana æ•°æ®å±•ç¤º ","date":"2019-08-04","objectID":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/:3:0","tags":["kubernetes"],"title":"01 åˆæ¢kubernetesåŠŸèƒ½ä¸ç»„ä»¶","uri":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 kubernetesé«˜å¯ç”¨æ¶æ„ kubernetesé«˜å¯ç”¨é›†ç¾¤é€šå¸¸ç”±3æˆ–5ä¸ªèŠ‚ç‚¹ç»„æˆé«˜å¯ç”¨é›†ç¾¤ï¼Œéœ€è¦ä¿éšœå„ä¸ªèŠ‚ç‚¹çš„é«˜å¯ç”¨æ€§ etcd å†…ç½®é›†ç¾¤æœºåˆ¶ï¼Œä¿éšœæ•°æ®æŒä¹…å­˜å‚¨ kube-apiserver æ— çŠ¶æ€apiæœåŠ¡ï¼Œæœ‰è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨åšè´Ÿè½½åˆ†å‘ï¼Œå¦‚haproxyæˆ–nginx kube-scheduler å†…ç½®é€‰ä¸¾æœºåˆ¶ï¼Œä¿éšœè°ƒåº¦å™¨é«˜å¯ç”¨ï¼Œç¡®ä¿åŒä¸ªæ—¶åˆ»ä¸€ä¸ªleaderèŠ‚ç‚¹å·¥ä½œï¼Œå…¶ä»–å¤„äºé˜»å¡ï¼Œé˜²æ­¢è„‘è£‚ kube-controller-manager å†…ç½®çš„é€‰ä¸¾æœºåˆ¶ä¿éšœæ§åˆ¶å™¨é«˜å¯ç”¨ï¼Œæœºåˆ¶å’Œkube-schedulerä¸€è‡´ã€‚ å‚è€ƒæ–‡æ¡£ \\1. kubernetesåŠŸèƒ½ä»‹ç»ï¼Œhttps://kubernetes.io/docs/concepts/overview/what-is-kubernetes/ \\2. kubernetesç»„ä»¶ä»‹ç»https://kubernetes.io/docs/concepts/overview/components/ è¯¥ç³»åˆ—æ–‡ç« å£°æ˜ {% cq %} è¯¥kubernetesç³»åˆ—æ•™ç¨‹å‡æ¥æºäº @happylau ï¼Œä»…åšç•¥å¾®ä¿®æ”¹ï¼Œä»…é™äºä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚ {% endcq %} ä¸ºé˜²æ­¢åŸç³»åˆ—æ•™ç¨‹å¤±æ•ˆï¼Œæ•…ä½œæ­¤å¤‡ä»½. ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/:4:0","tags":["kubernetes"],"title":"01 åˆæ¢kubernetesåŠŸèƒ½ä¸ç»„ä»¶","uri":"/myBlog-2/post/01-%E5%88%9D%E6%8E%A2kubernetes%E5%8A%9F%E8%83%BD%E4%B8%8E%E7%BB%84%E4%BB%B6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ æœ¬ç« æ˜¯kubernetesç³»åˆ—æ•™ç¨‹ç¬¬äºŒç¯‡ï¼Œè¦æ·±å…¥å­¦ä¹ kubernetesï¼Œé¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªk8sç¯å¢ƒï¼Œç„¶è€Œï¼Œå—åˆ¶ç¡¬ä»¶ç¯å¢ƒï¼Œç½‘ç»œç¯å¢ƒç­‰å› ç´ ï¼Œè¦æ­å»ºä¸€ä¸ªç¯å¢ƒæœ‰ä¸€å®šçš„å›°éš¾ï¼Œè®©å¾ˆå¤šåˆå­¦è€…æœ›è€Œå´æ­¥ï¼Œæœ¬ç« ä¸»è¦ä»‹ç»é€šè¿‡kubeadmå®‰è£…å·¥å…·éƒ¨ç½²kubernetesé›†ç¾¤ï¼Œè€ƒè™‘åˆ°å›½å†…ç½‘ç»œé™åˆ¶ï¼Œå·²å°†å®‰è£…é•œåƒé€šè¿‡è·³æ¿æœºä¸‹è½½åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿å¤§å®¶ç¦»çº¿å®‰è£…ã€‚ 1. MiniKubeå¿«é€Ÿéƒ¨ç½²ç¯å¢ƒ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:0:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 å®‰è£…æ¦‚è¿° è¦å­¦ä¹ kubernetesï¼Œé¦–å…ˆéœ€è¦æœ‰ä¸€ä¸ªkubernetesé›†ç¾¤ï¼Œç¤¾åŒºä¸ºäº†æ»¡è¶³ä¸åŒåœºæ™¯ä¸‹ï¼Œæä¾›äº†ä¸åŒçš„å®‰è£…æ–¹æ³•ä»¥é€‚åº”å„ç§åœºæ™¯éœ€æ±‚ï¼Œå¸¸è§æ–¹æ³•æœ‰ï¼š MiniKubeï¼Œæ˜¯ä¸€ä¸ªå°†kuberneteså•èŠ‚ç‚¹å®‰è£…åœ¨æœ¬åœ°è™šæ‹ŸåŒ–å·¥å…·ï¼ŒMiniKubeå®‰è£…æ–‡æ¡£ äºŒè¿›åˆ¶å®‰è£…ï¼Œé€šè¿‡å·²ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å®‰è£…ï¼Œéœ€è®¾ç½®å‚æ•°ï¼Œå¯å®šåˆ¶åŒ–å¼ºï¼Œå®‰è£…éš¾åº¦å¤§ Kubeadmï¼Œä¸€ä¸ªè‡ªåŠ¨åŒ–å®‰è£…å·¥å…·ï¼Œä»¥é•œåƒçš„æ–¹å¼éƒ¨ç½²ï¼Œä½¿ç”¨ç®€å•ï¼Œé•œåƒåœ¨è°·æ­Œä»“åº“ï¼Œä¸‹è½½æ˜“å¤±è´¥ å¯¹äºå­¦ä¹ ç¯å¢ƒï¼ŒKatacodaæä¾›äº†ä¸€ä¸ªåœ¨çº¿çš„MiniKubeç¯å¢ƒï¼Œåªéœ€åœ¨æ§åˆ¶å°å¯ç”¨å³å¯ä½¿ç”¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†MiniKubeä¸‹è½½åˆ°æœ¬åœ°ä½¿ç”¨ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ¨èä½¿ç”¨äºŒè¿›åˆ¶å®‰è£…æˆ–è€…Kubeadmï¼Œæ–°ç‰ˆkubeadmç›®å‰å·²å°†kubernetesç®¡ç†ç»„ä»¶ä»¥podçš„å½¢å¼éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼Œä¸ç®¡ç”¨å“ªç§æ–¹å¼ï¼Œå—é™äºGFWï¼Œå¤§éƒ¨åˆ†é•œåƒä¸‹è½½ï¼Œå¤§å®¶è‡ªè¡Œè¡¥è„‘å’Œè§£å†³ï¼Œæœ¬æ–‡ä»¥ç¦»çº¿çš„æ–¹å¼å®‰è£…éƒ¨ç½²ï¼Œæ ¹æ®å®‰è£…ç‰ˆæœ¬ä¸‹è½½å¯¹åº”çš„å®‰è£…é•œåƒå€’å…¥ç³»ç»Ÿå³å¯ã€‚ 1.14.1å®‰è£…é•œåƒä¸‹è½½é“¾æ¥ v1.17.0å®‰è£…é•œåƒä¸‹è½½é“¾æ¥ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:1:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 MiniKubeåœ¨çº¿ç¯å¢ƒ Katacodaä½¿ç”¨MiniKubeæä¾›äº†ä¸€ä¸ªåœ¨çº¿éƒ¨ç½²kubernetresç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŸºäºMiniKubeæœ¬åœ°å®‰è£…ï¼Œå¦‚æœæ˜¯åˆå­¦è€…æƒ³åˆæ¢ä¸€ä¸‹kubernetesçš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨Katacodaæä¾›çš„çº¿ä¸Šç¯å¢ƒï¼Œè¾¾åˆ°å¿«é€Ÿå…¥é—¨å­¦ä¹ çš„ç›®çš„ã€‚å‚è€ƒæ–‡æ¡£ï¼Œç›´æ¥åœ¨Hello MiniKubeæ–‡æ¡£ä¸­ç‚¹å‡»Open terminalå³å¯è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªkubernetesç¯å¢ƒï¼Œå…¶ä¼šè‡ªåŠ¨æ‹‰å–é•œåƒå¹¶éƒ¨ç½²æ‰€éœ€ç¯å¢ƒã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒMiniKubeçš„æä¾›çš„ä¼˜ç‚¹å¦‚ä¸‹ï¼š å¿«æ·ï¼Œè‡ªåŠ¨éƒ¨ç½²ç¯å¢ƒ æ— éœ€å ç”¨æœ¬åœ°èµ„æº é€‚ç”¨äºå­¦ä¹ ç¯å¢ƒ 2 kubeadméƒ¨ç½²k8sé›†ç¾¤ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:2:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 ç¯å¢ƒè¯´æ˜å’Œå‡†å¤‡ ã€è½¯ä»¶ç‰ˆæœ¬ã€‘ è½¯ä»¶å è½¯ä»¶ç‰ˆæœ¬ OS CentOS Linux release 7.6.1810 (Core) Docker docker-ce-18.03.1.ce-1.el7 Kubernetes 1.14.1 Kubeadm kubeadm-1.14.1-0.x86_64 etcd 3.3.10 flannel v0.11.0 ã€ç¯å¢ƒè¯´æ˜ã€‘ ä¸‰å°æœºå™¨å‡ä¸ºè…¾è®¯äº‘ä¸Šè´­ä¹°çš„CVMï¼ˆCloud Virtual Machineï¼‰ï¼Œæœºå™¨é…ç½®æ˜¯2vcpu+4G memory+50G disk ä¸»æœºå è§’è‰² IPåœ°å€ è½¯ä»¶ node-1 master 10.254.100.101 docker,kubelet,etcd,kube-apiserver,kube-controller-manager,kube-scheduler node-2 worker 10.254.100.102 docker,kubelet,kube-proxy,flannel node-3 worker 10.254.100.103 docker,kubelet,kube-proxy,flannel ã€ç¯å¢ƒå‡†å¤‡ã€‘ 1ã€è®¾ç½®ä¸»æœºåï¼Œå…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ç±»ä¼¼è®¾ç½® root@VM_100_101_centos ~# hostnamectl set-hostname node-1 root@VM_100_101_centos ~# hostname node-1 2ã€è®¾ç½®hostsæ–‡ä»¶ï¼Œå…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹è®¾ç½®ç›¸åŒå†…å®¹ root@node-1 ~# vim /etc/hosts 127.0.0.1 localhost localhost.localdomain 10.254.100.101 node-1 10.254.100.102 node-2 10.254.100.103 node-3 3ã€è®¾ç½®SSHæ— å¯†ç ç™»å½•ï¼Œå¹¶é€šè¿‡ssh-copy-idå°†å…¬é’¥æ‹·è´åˆ°å¯¹ç«¯ #ç”Ÿæˆå¯†é’¥å¯¹ root@node-1 .ssh# ssh-keygen -P '' Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Your identification has been saved in /root/.ssh/id_rsa. Your public key has been saved in /root/.ssh/id_rsa.pub. The key fingerprint is: SHA256:zultDMEL8bZmpbUjQahVjthVAcEkN929w5EkUmPkOrU root@node-1 The key's randomart image is: +---RSA 2048----+ | .=O=+=o.. | | o+o..+.o+ | | .oo=. o. o | | . . * oo .+ | | oSOo.E . | | oO.o. | | o++ . | | . .o | | ... | +----SHA256-----+ #æ‹·è´å…¬é’¥åˆ°node-2å’Œnode-3èŠ‚ç‚¹ root@node-1 .ssh# ssh-copy-id -i /root/.ssh/id_rsa.pub node-2: /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/root/.ssh/id_rsa.pub\" The authenticity of host 'node-1 (10.254.100.101)' can't be established. ECDSA key fingerprint is SHA256:jLUH0exgyJdsy0frw9R+FiWy+0o54LgB6dgVdfc6SEE. ECDSA key fingerprint is MD5:f4:86:a8:0e:a6:03:fc:a6:04:df:91:d8:7a:a7:0d:9e. Are you sure you want to continue connecting (yes/no)? yes /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys root@node-1's password: Number of key(s) added: 1 Now try logging into the machine, with: \"ssh 'node-2'\" and check to make sure that only the key(s) you wanted were added. 4ã€å…³é—­é˜²ç«å¢™å’ŒSElinux [root@node-1 ~]# systemctl stop firewalld [root@node-1 ~]# systemctl disable firewalld [root@node-1 ~]# sed -i '/^SELINUX=/ s/enforcing/disabled/g' /etc/selinux/config [root@node-1 ~]# setenforce 0 ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:3:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 å®‰è£…Dockerç¯å¢ƒ 1ã€ä¸‹è½½dockerçš„yumæº [root@node-1 ~]# cd /etc/yum.repos.d/ [root@node-1 ~]# wget https://download.docker.com/linux/centos/docker-ce.repo 2ã€è®¾ç½®cgroup driverç±»å‹ä¸ºsystemd [root@node-1 ~]# cat \u003e /etc/docker/daemon.json \u003c\u003cEOF \u003e { \u003e \"exec-opts\": [\"native.cgroupdriver=systemd\"], \u003e \"log-driver\": \"json-file\", \u003e \"log-opts\": { \u003e \"max-size\": \"100m\" \u003e }, \u003e \"storage-driver\": \"overlay2\", \u003e \"storage-opts\": [ \u003e \"overlay2.override_kernel_check=true\" \u003e ] \u003e } \u003e EOF 3ã€å¯åŠ¨dockeræœåŠ¡å¹¶éªŒè¯ï¼Œå¯ä»¥é€šè¿‡docker infoæŸ¥çœ‹dockerå®‰è£…çš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ [root@node-1 ~]# systemctl restart docker [root@node-1 ~]# systemctl enable docker å¤‡æ³¨ï¼šå¦‚æœæœºå™¨ä¸å…·å¤‡ä¸Šç½‘æ¡ä»¶ï¼Œæˆ–è€…è®¿é—®dockerçš„yumæºä»“åº“å¾ˆæ…¢ï¼Œæˆ‘å·²å°†dockerç›¸å…³rpmåŒ…ä¾èµ–åŒ…ä¸‹è½½åˆ°è…¾è®¯äº‘cosä¸­ï¼Œä¸‹è½½é“¾æ¥ï¼Œå¯ä»¥ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åè§£å‹ç¼©ç„¶åè¿è¡Œyum localinstallè¿›è¡Œå®‰è£…ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:4:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.3 å®‰è£…kubeadmç»„ä»¶ 1ã€å®‰è£…kubernetesæºï¼Œå›½å†…å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„kubernetesæºï¼Œé€Ÿåº¦ä¼šå¿«ä¸€ç‚¹ [root@node-1 ~]#cat \u003c\u003cEOF \u003e /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg EOF 2ã€å®‰è£…kubeadmï¼Œkubeletï¼Œkubectlï¼Œä¼šè‡ªåŠ¨å®‰è£…å‡ ä¸ªé‡è¦ä¾èµ–åŒ…ï¼šsocatï¼Œcri-toolsï¼Œcniç­‰åŒ… [root@node-1 ~]# yum install kubeadm-1.14.1-0 kubectl-1.14.1-0 kubelet-1.14.1-0 --disableexcludes=kubernetes -y 3ã€è®¾ç½®iptablesç½‘æ¡¥å‚æ•° [root@node-1 ~]# cat \u003c\u003cEOF \u003e /etc/sysctl.d/k8s.conf \u003e net.bridge.bridge-nf-call-ip6tables = 1 \u003e net.bridge.bridge-nf-call-iptables = 1 \u003e EOF [root@node-1 ~]# sysctl --system,ç„¶åä½¿ç”¨sysctl -a|grep å‚æ•°çš„æ–¹å¼éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ 4ã€é‡æ–°å¯åŠ¨kubeletæœåŠ¡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ [root@node-1 ~]# systemctl restart kubelet [root@node-1 ~]# systemctl enable kubelet å¤‡æ³¨ï¼šå¦‚æœæœ¬åœ°ä¸‹è½½å¾ˆæ…¢æˆ–è€…æ— æ³•ä¸‹è½½kubernetesä¸­yumæºrpmåŒ…ï¼Œå¯ä»¥é€šè¿‡ç¦»çº¿æ–¹å¼ä¸‹è½½ï¼Œä¸‹è½½è·¯å¾„ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:5:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.4 å¯¼å…¥kubernetesé•œåƒ 1ã€ä»cosä¸­ä¸‹è½½kuberneteså®‰è£…é•œåƒï¼Œå¹¶é€šè¿‡docker loadå‘½ä»¤å°†é•œåƒå¯¼å…¥åˆ°ç¯å¢ƒä¸­ [root@node-1 v1.14.1]# docker image load -i etcd:3.3.10.tar [root@node-1 v1.14.1]# docker image load -i pause:3.1.tar [root@node-1 v1.14.1]# docker image load -i coredns:1.3.1.tar [root@node-1 v1.14.1]# docker image load -i flannel:v0.11.0-amd64.tar [root@node-1 v1.14.1]# docker image load -i kube-apiserver:v1.14.1.tar [root@node-1 v1.14.1]# docker image load -i kube-controller-manager:v1.14.1.tar [root@node-1 v1.14.1]# docker image load -i kube-scheduler:v1.14.1.tar [root@node-1 v1.14.1]# docker image load -i kube-proxy:v1.14.1.tar 2ã€æ£€æŸ¥é•œåƒåˆ—è¡¨ [root@node-1 v1.14.1]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZE k8s.gcr.io/kube-proxy v1.14.1 20a2d7035165 3 months ago 82.1MB k8s.gcr.io/kube-apiserver v1.14.1 cfaa4ad74c37 3 months ago 210MB k8s.gcr.io/kube-scheduler v1.14.1 8931473d5bdb 3 months ago 81.6MB k8s.gcr.io/kube-controller-manager v1.14.1 efb3887b411d 3 months ago 158MB quay.io/coreos/flannel v0.11.0-amd64 ff281650a721 6 months ago 52.6MB k8s.gcr.io/coredns 1.3.1 eb516548c180 6 months ago 40.3MB k8s.gcr.io/etcd 3.3.10 2c4adeb21b4f 8 months ago 258MB k8s.gcr.io/pause 3.1 da86e6ba6ca1 19 months ago 742kB ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:6:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.5 kubeadmåˆå§‹åŒ–é›†ç¾¤ 1ã€ kubeadmåˆå§‹åŒ–é›†ç¾¤ï¼Œéœ€è¦è®¾ç½®åˆå§‹å‚æ•° â€“pod-network-cidræŒ‡å®špodä½¿ç”¨çš„ç½‘æ®µï¼Œè®¾ç½®å€¼æ ¹æ®ä¸åŒçš„ç½‘ç»œpluginé€‰æ‹©ï¼Œæœ¬æ–‡ä»¥flannelä¸ºä¾‹è®¾ç½®å€¼ä¸º10.244.0.0/16 container runtimeå¯ä»¥é€šè¿‡â€“cri-socketæŒ‡å®šsocketæ–‡ä»¶æ‰€å±è·¯å¾„ å¦‚æœæœ‰å¤šä¸ªç½‘å¡å¯ä»¥é€šè¿‡â€“apiserver-advertise-addressæŒ‡å®šmasteråœ°å€ï¼Œé»˜è®¤ä¼šé€‰æ‹©è®¿é—®å¤–ç½‘çš„ip [root@node-1 ~]# kubeadm init --apiserver-advertise-address 10.254.100.101 --apiserver-bind-port 6443 --kubernetes-version 1.14.1 --pod-network-cidr 10.244.0.0/16 [init] Using Kubernetes version: v1.14.1 [preflight] Running pre-flight checks [WARNING SystemVerification]: this Docker version is not on the list of validated versions: 18.03.1-ce. Latest validated version: 18.09 [preflight] Pulling images required for setting up a Kubernetes cluster [preflight] This might take a minute or two, depending on the speed of your internet connection [preflight] You can also perform this action in beforehand using 'kubeadm config images pull'#ä¸‹è½½é•œåƒ [kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\" [kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\" [kubelet-start] Activating the kubelet service [certs] Using certificateDir folder \"/etc/kubernetes/pki\"#ç”ŸæˆCAç­‰è¯ä¹¦ [certs] Generating \"ca\" certificate and key [certs] Generating \"apiserver\" certificate and key [certs] apiserver serving cert is signed for DNS names [node-1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 10.254.100.101] [certs] Generating \"apiserver-kubelet-client\" certificate and key [certs] Generating \"etcd/ca\" certificate and key [certs] Generating \"etcd/server\" certificate and key [certs] etcd/server serving cert is signed for DNS names [node-1 localhost] and IPs [10.254.100.101 127.0.0.1 ::1] [certs] Generating \"apiserver-etcd-client\" certificate and key [certs] Generating \"etcd/peer\" certificate and key [certs] etcd/peer serving cert is signed for DNS names [node-1 localhost] and IPs [10.254.100.101 127.0.0.1 ::1] [certs] Generating \"etcd/healthcheck-client\" certificate and key [certs] Generating \"front-proxy-ca\" certificate and key [certs] Generating \"front-proxy-client\" certificate and key [certs] Generating \"sa\" key and public key [kubeconfig] Using kubeconfig folder \"/etc/kubernetes\" [kubeconfig] Writing \"admin.conf\" kubeconfig file [kubeconfig] Writing \"kubelet.conf\" kubeconfig file [kubeconfig] Writing \"controller-manager.conf\" kubeconfig file [kubeconfig] Writing \"scheduler.conf\" kubeconfig file [control-plane] Using manifest folder \"/etc/kubernetes/manifests\"#ç”ŸæˆmasterèŠ‚ç‚¹é™æ€podé…ç½®æ–‡ä»¶ [control-plane] Creating static Pod manifest for \"kube-apiserver\" [control-plane] Creating static Pod manifest for \"kube-controller-manager\" [control-plane] Creating static Pod manifest for \"kube-scheduler\" [etcd] Creating static Pod manifest for local etcd in \"/etc/kubernetes/manifests\" [wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory \"/etc/kubernetes/manifests\". This can take up to 4m0s [apiclient] All control plane components are healthy after 18.012370 seconds [upload-config] storing the configuration used in ConfigMap \"kubeadm-config\" in the \"kube-system\" Namespace [kubelet] Creating a ConfigMap \"kubelet-config-1.14\" in namespace kube-system with the configuration for the kubelets in the cluster [upload-certs] Skipping phase. Please see --experimental-upload-certs [mark-control-plane] Marking the node node-1 as control-plane by adding the label \"node-role.kubernetes.io/master=''\" [mark-control-plane] Marking the node node-1 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule] [bootstrap-token] Using token: r8n5f2.9mic7opmrwjakled [bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles#é…ç½®RBACæˆæƒ [bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials [bootstrap-token] configured RBAC rules to allow the csrapprover controlle","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:7:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.6 éªŒè¯kubernetesç»„ä»¶ 1ã€éªŒè¯nodeçŠ¶æ€ï¼Œè·å–å½“å‰å®‰è£…èŠ‚ç‚¹ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°çŠ¶æ€ï¼Œ è§’è‰²ï¼Œå¯åŠ¨å¸‚åœºï¼Œç‰ˆæœ¬ï¼Œ [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 46m v1.14.1 node-2 Ready \u003cnone\u003e 34m v1.14.1 node-3 Ready \u003cnone\u003e 32m v1.14.1 2ã€æŸ¥çœ‹kubernetseæœåŠ¡ç»„ä»¶çŠ¶æ€,åŒ…æ‹¬schedulerï¼Œcontroller-managerï¼Œetcd [root@node-1 ~]# kubectl get componentstatuses NAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-0 Healthy {\"health\":\"true\"} 3ã€æŸ¥çœ‹podçš„æƒ…å†µ,masterä¸­çš„è§’è‰²åŒ…æ‹¬kube-apiserverï¼Œkube-schedulerï¼Œkube-controller-managerï¼Œetcdï¼Œcorednsä»¥podså½¢å¼éƒ¨ç½²åœ¨é›†ç¾¤ä¸­ï¼ŒworkerèŠ‚ç‚¹çš„kube-proxyä¹Ÿä»¥podçš„å½¢å¼éƒ¨ç½²ã€‚å®é™…ä¸Špodæ˜¯ä»¥å…¶ä»–æ§åˆ¶å™¨å¦‚daemonsetçš„å½¢å¼æ§åˆ¶çš„ã€‚ [root@node-1 ~]# kubectl get pods -n kube-system NAME READY STATUS RESTARTS AGE coredns-fb8b8dccf-hrqm8 1/1 Running 0 50m coredns-fb8b8dccf-qwwks 1/1 Running 0 50m etcd-node-1 1/1 Running 0 48m kube-apiserver-node-1 1/1 Running 0 49m kube-controller-manager-node-1 1/1 Running 0 49m kube-proxy-lfckv 1/1 Running 0 38m kube-proxy-x5t6r 1/1 Running 0 50m kube-proxy-x8zqh 1/1 Running 0 36m kube-scheduler-node-1 1/1 Running 0 49m ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:8:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.7 é…ç½®kubectlå‘½ä»¤è¡¥å…¨ ä½¿ç”¨kubectlå’Œkubernetesäº¤äº’æ—¶å€™å¯ä»¥ä½¿ç”¨ç¼©å†™æ¨¡å¼ä¹Ÿå¯ä»¥ä½¿ç”¨å®Œæ•´æ¨¡å¼ï¼Œå¦‚kubectl get nodeså’Œkubectl get noèƒ½å®ç°ä¸€æ ·çš„æ•ˆæœï¼Œä¸ºäº†æé«˜å·¥ä½œæ•ˆç‡ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡¥å…¨çš„æ–¹å¼åŠ å¿«å·¥ä½œæ•ˆç‡ã€‚ 1ã€ç”Ÿæˆkubectl bashå‘½ä»¤è¡Œè¡¥å…¨shell [root@node-1 ~]# kubectl completion bash \u003e/etc/kubernetes/kubectl.sh [root@node-1 ~]# echo \"source /etc/kubernetes/kubectl.sh\" \u003e\u003e/root/.bashrc [root@node-1 ~]# cat /root/.bashrc # .bashrc # User specific aliases and functions alias rm='rm -i' alias cp='cp -i' alias mv='mv -i' # Source global definitions if [ -f /etc/bashrc ]; then . /etc/bashrc fi source /etc/kubernetes/kubectl.sh #æ·»åŠ ç¯å¢ƒå˜é‡é…ç½® 2ã€åŠ è½½shellç¯å¢ƒå˜é‡ï¼Œä½¿é…ç½®ç”Ÿæ•ˆ [root@node-1 ~]# source /etc/kubernetes/kubectl.sh 3ã€æ ¡éªŒå‘½ä»¤è¡Œè¡¥å…¨ï¼Œå‘½ä»¤è¡Œä¸­è¾“å…¥kubectl get coå†æŒ‰TABé”®å°±èƒ½è‡ªåŠ¨è¡¥å…¨äº† [root@node-1~]# kubectl get co componentstatuses configmaps controllerrevisions.apps [root@node-1~]# kubectl get componentstatuses é™¤äº†æ”¯æŒå‘½ä»¤è¡Œè¡¥å…¨ä¹‹å¤–ï¼Œkubectlè¿˜æ”¯æŒå‘½ä»¤ç®€å†™ï¼Œå¦‚ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å‘½ä»¤è¡Œæ£€æµ‹æ“ä½œ,æ›´å¤šé€šè¿‡kubectl api-resourceså‘½ä»¤è·å–ï¼ŒSHORTNAMESæ˜¾ç¤ºçš„æ˜¯å­å‘½ä»¤ä¸­çš„ç®€çŸ­ç”¨æ³•ã€‚ kubectl get componentstatusesï¼Œç®€å†™kubectl get csè·å–ç»„ä»¶çŠ¶æ€ kubectl get nodesï¼Œç®€å†™kubectl get noè·å–nodeèŠ‚ç‚¹åˆ—è¡¨ kubectl get servicesï¼Œç®€å†™kubectl get svcè·å–æœåŠ¡åˆ—è¡¨ kubectl get deployments,ç®€å†™kubectl get deployè·å–deploymentåˆ—è¡¨ kubectl get statefulsets,ç®€å†™kubectl get stsè·å–æœ‰çŠ¶æ€æœåŠ¡åˆ—è¡¨ å‚è€ƒæ–‡æ¡£ Container Runtimeå®‰è£…æ–‡æ¡£ï¼šhttps://kubernetes.io/docs/setup/production-environment/container-runtimes/ kubeadmå®‰è£…ï¼šhttps://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/ åˆå§‹åŒ–kubeadmé›†ç¾¤ï¼šhttps://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/:9:0","tags":["kubernetes"],"title":"02 Kubeadmç¦»çº¿éƒ¨ç½²1.14","uri":"/myBlog-2/post/02-kubeadm%E7%A6%BB%E7%BA%BF%E9%83%A8%E7%BD%B21.14.1%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ kubernetesä¸­æ¶‰åŠå¾ˆå¤šæ¦‚å¿µï¼ŒåŒ…å«äº‘ç”Ÿæ€ç¤¾åŒºä¸­å„ç±»æŠ€æœ¯ï¼Œå­¦ä¹ æˆæœ¬æ¯”è¾ƒé«˜ï¼Œk8sä¸­é€šå¸¸ä»¥ç¼–å†™yamlæ–‡ä»¶å®Œæˆèµ„æºçš„éƒ¨ç½²ï¼Œå¯¹äºè¾ƒå¤šå…¥é—¨çš„äººæ¥è¯´æ˜¯ä¸ªè¾ƒé«˜çš„é—¨åï¼Œæœ¬æ–‡ä»¥å‘½ä»¤è¡Œçš„å½¢å¼å¸¦é¢†å¤§å®¶å¿«é€Ÿå…¥é—¨ï¼Œä¿¯ç°kubernetesæ ¸å¿ƒæ¦‚å¿µï¼Œå¿«é€Ÿå…¥é—¨ã€‚ 1. åŸºç¡€æ¦‚å¿µ ","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:0:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 é›†ç¾¤ä¸èŠ‚ç‚¹ kubernetesæ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨å¼•æ“ç®¡ç†å¹³å°ï¼Œå®ç°å®¹å™¨åŒ–åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œä»»åŠ¡è°ƒåº¦ï¼Œå¼¹æ€§ä¼¸ç¼©ï¼Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ï¼Œclusteræ˜¯ç”±masterå’Œnodeä¸¤ç§è§’è‰²ç»„æˆ masterè´Ÿè´£ç®¡ç†é›†ç¾¤ï¼ŒmasteråŒ…å«kube-apiserverï¼Œkube-controller-managerï¼Œkube-schedulerï¼Œetcdç»„ä»¶ nodeèŠ‚ç‚¹è¿è¡Œå®¹å™¨åº”ç”¨ï¼Œç”±Container Runtimeï¼Œkubeletå’Œkube-proxyç»„æˆï¼Œå…¶ä¸­Container Runtimeå¯èƒ½æ˜¯Dockerï¼Œrkeï¼Œcontainerdï¼ŒnodeèŠ‚ç‚¹å¯ç”±ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºç»„æˆã€‚ kubernetesé›†ç¾¤æ¦‚å¿µ 1ã€æŸ¥çœ‹masterç»„ä»¶è§’è‰² [root@node-1 ~]# kubectl get componentstatuses NAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-0 Healthy {\"health\":\"true\"} 2ã€ æŸ¥çœ‹nodeèŠ‚ç‚¹åˆ—è¡¨ [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 26h v1.14.1 node-2 Ready \u003cnone\u003e 26h v1.14.1 node-3 Ready \u003cnone\u003e 26h v1.14.1 3ã€æŸ¥çœ‹nodeèŠ‚ç‚¹è¯¦æƒ… [root@node-1 ~]# kubectl describe node node-3 Name: node-3 Roles: \u003cnone\u003e Labels: beta.kubernetes.io/arch=amd64ã€‚#æ ‡ç­¾å’ŒAnnotations beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=node-3 kubernetes.io/os=linux Annotations: flannel.alpha.coreos.com/backend-data: {\"VtepMAC\":\"22:f8:75:bb:da:4e\"} flannel.alpha.coreos.com/backend-type: vxlan flannel.alpha.coreos.com/kube-subnet-manager: true flannel.alpha.coreos.com/public-ip: 10.254.100.103 kubeadm.alpha.kubernetes.io/cri-socket: /var/run/dockershim.sock node.alpha.kubernetes.io/ttl: 0 volumes.kubernetes.io/controller-managed-attach-detach: true CreationTimestamp: Sat, 10 Aug 2019 17:50:00 +0800 Taints: \u003cnone\u003e Unschedulable: falseã€‚#æ˜¯å¦ç¦ç”¨è°ƒåº¦ï¼Œcordonå‘½ä»¤æ§åˆ¶çš„æ ‡è¯†ä½ã€‚ Conditions: #èµ„æºè°ƒåº¦èƒ½åŠ›ï¼ŒMemoryPressureå†…å­˜æ˜¯å¦æœ‰å‹åŠ›ï¼ˆå³å†…å­˜ä¸è¶³ï¼‰ #DiskPressureç£ç›˜å‹åŠ› #PIDPressureç£ç›˜å‹åŠ› #Readyï¼Œæ˜¯å¦å°±ç»ªï¼Œè¡¨æ˜èŠ‚ç‚¹æ˜¯å¦å¤„äºæ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œè¡¨ç¤ºèµ„æºå……è¶³+ç›¸å…³è¿›ç¨‹çŠ¶æ€æ­£å¸¸ Type Status LastHeartbeatTime LastTransitionTime Reason Message ---- ------ ----------------- ------------------ ------ ------- MemoryPressure False Sun, 11 Aug 2019 20:32:07 +0800 Sat, 10 Aug 2019 17:50:00 +0800 KubeletHasSufficientMemory kubelet has sufficient memory available DiskPressure False Sun, 11 Aug 2019 20:32:07 +0800 Sat, 10 Aug 2019 17:50:00 +0800 KubeletHasNoDiskPressure kubelet has no disk pressure PIDPressure False Sun, 11 Aug 2019 20:32:07 +0800 Sat, 10 Aug 2019 17:50:00 +0800 KubeletHasSufficientPID kubelet has sufficient PID available Ready True Sun, 11 Aug 2019 20:32:07 +0800 Sat, 10 Aug 2019 18:04:20 +0800 KubeletReady kubelet is posting ready status Addresses: #åœ°å€å’Œä¸»æœºå InternalIP: 10.254.100.103 Hostname: node-3 Capacity: #å®¹å™¨çš„èµ„æºå®¹é‡ cpu: 2 ephemeral-storage: 51473868Ki hugepages-2Mi: 0 memory: 3880524Ki pods: 110 Allocatable: #å·²åˆ†é…èµ„æºæƒ…å†µ cpu: 2 ephemeral-storage: 47438316671 hugepages-2Mi: 0 memory: 3778124Ki pods: 110 System Info: #ç³»ç»Ÿä¿¡æ¯ï¼Œå¦‚å†…æ ¸ç‰ˆæœ¬ï¼Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ï¼Œcpuæ¶æ„ï¼ŒnodeèŠ‚ç‚¹è½¯ä»¶ç‰ˆæœ¬ Machine ID: 0ea734564f9a4e2881b866b82d679dfc System UUID: D98ECAB1-2D9E-41CC-9A5E-51A44DC5BB97 Boot ID: 6ec81f5b-cb05-4322-b47a-a8e046d9bf79 Kernel Version: 3.10.0-957.el7.x86_64 OS Image: CentOS Linux 7 (Core) Operating System: linux Architecture: amd64 Container Runtime Version: docker://18.3.1 . #Container Runtimeä¸ºdockerï¼Œç‰ˆæœ¬ä¸º18.3.1 Kubelet Version: v1.14.1 #kubeletç‰ˆæœ¬ Kube-Proxy Version: v1.14.1 #kube-proxyç‰ˆæœ¬ PodCIDR: 10.244.2.0/24 #podä½¿ç”¨çš„ç½‘ç»œ Non-terminated Pods: (4 in total)ã€‚ #ä¸‹é¢æ˜¯æ¯ä¸ªpodèµ„æºå ç”¨æƒ…å†µ Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits AGE --------- ---- ------------ ---------- --------------- ------------- --- kube-system coredns-fb8b8dccf-hrqm8 100m (5%) 0 (0%) 70Mi (1%) 170Mi (4%) 26h kube-system coredns-fb8b8dccf-qwwks 100m (5%) 0 (0%) 70Mi (1%) 170Mi (4%) 26h kube-system kube-flannel-ds-amd64-zzm2g 100m (5%) 100m (5%) 50Mi (1%) 50Mi (1%) 26h kube-system kube-proxy-x8zqh 0 (0%) 0 (0%) 0 (0%) 0 (0%) 26h Allocated resources: #å·²åˆ†é…èµ„æºæƒ…å†µ (Total limits may be over 100 percent, i.e., overcommitted.) Resource Requests Limits -------- -------- ------ cpu 300m (15%) 100m (5%) memory 190Mi (5%) 390Mi (10%) ephemeral-storage 0 (0%) 0 (0%) Events: \u003cnone\u003e ","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:1:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 å®¹å™¨ä¸åº”ç”¨ kubernetesæ˜¯å®¹å™¨ç¼–æ’å¼•æ“ï¼Œå…¶è´Ÿè´£å®¹å™¨çš„è°ƒåº¦ï¼Œç®¡ç†å’Œå®¹å™¨çš„è¿è¡Œï¼Œä½†kubernetesè°ƒåº¦æœ€å°å•ä½å¹¶éæ˜¯containerï¼Œè€Œæ˜¯podï¼Œpodä¸­å¯åŒ…å«å¤šä¸ªcontainerï¼Œé€šå¸¸é›†ç¾¤ä¸­ä¸ä¼šç›´æ¥è¿è¡Œpodï¼Œè€Œæ˜¯é€šè¿‡å„ç§å·¥ä½œè´Ÿè½½çš„æ§åˆ¶å™¨å¦‚Deploymentsï¼ŒReplicaSetsï¼ŒDaemonSetsçš„æ–¹å¼è¿è¡Œï¼Œä¸ºå•¥ï¼Ÿå› ä¸ºæ§åˆ¶å™¨èƒ½å¤Ÿä¿è¯podçŠ¶æ€çš„ä¸€è‡´æ€§ï¼Œæ­£å¦‚å®˜æ–¹æ‰€æè¿°çš„ä¸€æ ·â€œmake sure the current state match to the desire stateâ€ï¼Œç¡®ä¿å½“å‰çŠ¶æ€å’Œé¢„æœŸçš„ä¸€è‡´ï¼Œç®€å•æ¥è¯´å°±æ˜¯podå¼‚å¸¸äº†ï¼Œæ§åˆ¶å™¨ä¼šåœ¨å…¶ä»–èŠ‚ç‚¹é‡å»ºï¼Œç¡®ä¿é›†ç¾¤å½“å‰è¿è¡Œçš„podå’Œé¢„æœŸè®¾å®šçš„ä¸€è‡´ã€‚ podæ˜¯kubernetesä¸­è¿è¡Œçš„æœ€å°å•å…ƒ podä¸­åŒ…å«ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªå®¹å™¨ podä¸ä¼šå•ç‹¬ä½¿ç”¨ï¼Œéœ€è¦æœ‰å·¥ä½œè´Ÿè½½æ¥æ§åˆ¶ï¼Œå¦‚Deploymentsï¼ŒStatefulSetsï¼ŒDaemonSetsï¼ŒCronJobsç­‰ containerä¸pod Containerï¼Œå®¹å™¨æ˜¯ä¸€ç§è½»é‡åŒ–çš„è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°†åº”ç”¨å°è£…åœ¨é•œåƒä¸­ï¼Œå®ç°ä¾¿æ·éƒ¨ç½²ï¼Œåº”ç”¨åˆ†å‘ã€‚ Podï¼Œkubernetesä¸­æœ€å°çš„è°ƒåº¦å•ä½ï¼Œå°è£…å®¹å™¨ï¼ŒåŒ…å«ä¸€ä¸ªpauseå®¹å™¨å’Œåº”ç”¨å®¹å™¨ï¼Œå®¹å™¨ä¹‹é—´å…±äº«ç›¸åŒçš„å‘½åç©ºé—´ï¼Œç½‘ç»œï¼Œå­˜å‚¨ï¼Œå…±äº«è¿›ç¨‹ã€‚ Deploymentsï¼Œéƒ¨ç½²ç»„ä¹Ÿç§°åº”ç”¨ï¼Œä¸¥æ ¼ä¸Šæ¥è¯´æ˜¯æ— çŠ¶æ€åŒ–å·¥ä½œè´Ÿè½½ï¼Œå¦å¤–ä¸€ç§ç”±çŠ¶æ€åŒ–å·¥ç»„è´Ÿè½½æ˜¯StatefulSetsï¼ŒDeploymentsæ˜¯ä¸€ç§æ§åˆ¶å™¨ï¼Œå¯ä»¥æ§åˆ¶å·¥ä½œè´Ÿè½½çš„å‰¯æœ¬æ•°replicasï¼Œé€šè¿‡kube-controller-managerä¸­çš„Deployments Controllerå®ç°å‰¯æœ¬æ•°çŠ¶æ€çš„æ§åˆ¶ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:2:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 æœåŠ¡è®¿é—® kubernetesä¸­podæ˜¯å®é™…è¿è¡Œçš„è½½ä½“ï¼Œpodä¾é™„äºnodeä¸­ï¼Œnodeå¯èƒ½ä¼šå‡ºç°æ•…éšœï¼Œkubernetesçš„æ§åˆ¶å™¨å¦‚replicasetsä¼šåœ¨å…¶ä»–nodeä¸Šé‡æ–°æ‹‰èµ·ä¸€ä¸ªpodï¼Œæ–°çš„podä¼šåˆ†é…ä¸€ä¸ªæ–°çš„IPï¼›å†è€…ï¼Œåº”ç”¨éƒ¨ç½²æ—¶ä¼šåŒ…å«å¤šä¸ªå‰¯æœ¬replicasï¼Œå¦‚åŒä¸ªåº”ç”¨deploymentséƒ¨ç½²äº†3ä¸ªpodå‰¯æœ¬ï¼Œpodç›¸å½“äºåç«¯çš„Real Serverï¼Œå¦‚ä½•å®ç°è¿™ä¸‰ä¸ªåº”ç”¨è®¿é—®å‘¢ï¼Ÿå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨Real Serverå‰é¢åŠ ä¸€ä¸ªè´Ÿè½½å‡è¡¡Load Balancerï¼Œserviceå°±æ˜¯podçš„è´Ÿè½½å‡è¡¡è°ƒåº¦å™¨ï¼Œserviceå°†åŠ¨æ€çš„podæŠ½è±¡ä¸ºä¸€ä¸ªæœåŠ¡ï¼Œåº”ç”¨ç¨‹åºç›´æ¥è®¿é—®serviceå³å¯ï¼Œserviceä¼šè‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„podã€‚è´Ÿè´£serviceè½¬å‘è§„åˆ™æœ‰ä¸¤ç§æœºåˆ¶ï¼šiptableså’Œipvsï¼Œiptablesé€šè¿‡è®¾ç½®DNATç­‰è§„åˆ™å®ç°è´Ÿè½½å‡è¡¡ï¼Œipvsé€šè¿‡ipvsadmè®¾ç½®è½¬å‘è§„ã€‚ serviceæ¦‚å¿µ æ ¹æ®æœåŠ¡ä¸åŒçš„è®¿é—®æ–¹å¼ï¼Œserviceåˆ†ä¸ºå¦‚ä¸‹å‡ ç§ç±»å‹ï¼šClusterIPï¼ŒNodePortï¼ŒLoadBalancerå’Œ_ExternalNameï¼Œå¯é€šè¿‡typeè®¾ç½®ã€‚ ClusterIPï¼Œé›†ç¾¤å†…éƒ¨äº’è®¿ï¼Œä¸DNSç»“åˆå®ç°é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°ï¼› NodePortï¼Œé€šè¿‡NATå°†æ¯ä¸ªnodeèŠ‚ç‚¹æš´éœ²ä¸€ä¸ªç«¯å£å®ç°å¤–éƒ¨è®¿é—®ï¼› LoadBalancerï¼Œå®ç°äº‘å‚å•†å¤–éƒ¨æ¥å…¥æ–¹å¼çš„æ¥å£ï¼Œéœ€è¦ä¾èµ–äº‘æœåŠ¡æä¾›å•†å®ç°å…·ä½“æŠ€æœ¯ç»†èŠ‚ï¼Œå¦‚è…¾è®¯äº‘å®ç°ä¸CLBé›†æˆï¼› ExternalNameï¼Œé€šè¿‡æœåŠ¡åå­—æš´éœ²æœåŠ¡åï¼Œå½“å‰å¯ç”±ingresså®ç°ï¼Œå°†å¤–éƒ¨çš„è¯·æ±‚ä»¥åŸŸåè½¬å‘çš„å½¢å¼è½¬å‘åˆ°é›†ç¾¤ï¼Œéœ€è¦ä¾é™„å…·ä½“çš„å¤–éƒ¨å®ç°ï¼Œå¦‚nginxï¼Œtraefik,å„å¤§äº‘è®¡ç®—å‚å•†å®ç°æ¥å…¥ç»†èŠ‚ã€‚ podæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œipåœ°å€å¯èƒ½ä¼šå˜åŒ–ï¼ˆå¦‚nodeæ•…éšœï¼‰ï¼Œå‰¯æœ¬æ•°å¯èƒ½ä¼šå˜åŒ–ï¼Œå¦‚åº”ç”¨æ‰©å±•scale upï¼Œåº”ç”¨é”å®¹scale downç­‰ï¼Œserviceå¦‚ä½•è¯†åˆ«åˆ°podçš„åŠ¨æ€å˜åŒ–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯labelsï¼Œé€šè¿‡labelsè‡ªåŠ¨ä¼šè¿‡æ»¤å‡ºæŸä¸ªåº”ç”¨çš„Endpointsï¼Œå½“podå˜åŒ–æ—¶ä¼šè‡ªåŠ¨æ›´æ–°Endpointsï¼Œä¸åŒçš„åº”ç”¨ä¼šæœ‰ç”±ä¸åŒçš„labelç»„æˆã€‚labelsç›¸å…³å¯ä»¥å‚è€ƒä¸‹https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/ serviceä¸labels 2. åˆ›å»ºåº”ç”¨ æˆ‘ä»¬å¼€å§‹éƒ¨ç½²ä¸€ä¸ªåº”ç”¨å³deploymentsï¼Œkubernetesä¸­åŒ…å«å„ç§workloadå¦‚æ— çŠ¶æ€è¯çš„Deploymentsï¼Œæœ‰çŠ¶æ€åŒ–çš„StatefulSetsï¼Œå®ˆæŠ¤è¿›ç¨‹çš„DaemonSetsï¼Œæ¯ç§workloadå¯¹åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å…ˆä»¥Deploymentsä¸ºä¾‹å…¥é—¨ï¼Œå…¶ä»–workloadå‡ä»¥æ­¤ç±»ä¼¼ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œåœ¨kubernetesä¸­éƒ¨ç½²åº”ç”¨å‡ä»¥yamlæ–‡ä»¶æ–¹å¼éƒ¨ç½²ï¼Œå¯¹äºåˆå­¦è€…è€Œè¨€ï¼Œç¼–å†™yamlæ–‡ä»¶å¤ªå†—é•¿ï¼Œä¸é€‚åˆåˆå­¦ï¼Œæˆ‘ä»¬å…ˆkubectlå‘½ä»¤è¡Œæ–¹å¼å®ç°APIçš„æ¥å…¥ã€‚ 1ã€éƒ¨ç½²nginxåº”ç”¨ï¼Œéƒ¨ç½²ä¸‰ä¸ªå‰¯æœ¬ [root@node-1 ~]# kubectl run nginx-app-demo --image=nginx:1.7.9 --port=80 --replicas=3 kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead. deployment.apps/nginx-app-demo created 2ã€æŸ¥çœ‹åº”ç”¨åˆ—è¡¨,å¯ä»¥çœ‹åˆ°å½“å‰podçš„çŠ¶æ€å‡å·²æ­£å¸¸ï¼ŒReadyæ˜¯å½“å‰çŠ¶æ€ï¼ŒAVAILABLEæ˜¯ç›®æ ‡çŠ¶æ€ [root@node-1 ~]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE nginx-app-demo 3/3 3 3 72s 3ã€æŸ¥çœ‹åº”ç”¨çš„è¯¦ç»†ä¿¡æ¯,å¦‚ä¸‹æˆ‘ä»¬å¯ä»¥çŸ¥é“Deploymentsæ˜¯é€šè¿‡ReplicaSetsæ§åˆ¶å‰¯æœ¬æ•°çš„ï¼Œç”±Replicasetæ§åˆ¶podæ•° [root@node-1 ~]# kubectl describe deployments nginx-app-demo Name: nginx-app-demo #åº”ç”¨åç§° Namespace: default #å‘½åç©ºé—´ CreationTimestamp: Sun, 11 Aug 2019 21:52:32 +0800 Labels: run=nginx-app-demo #labelsï¼Œå¾ˆé‡è¦ï¼Œåç»­serviceé€šè¿‡labelså®ç°è®¿é—® Annotations: deployment.kubernetes.io/revision: 1 #æ»šåŠ¨å‡çº§ç‰ˆæœ¬å· Selector: run=nginx-app-demo #labelsçš„é€‰æ‹©å™¨selector Replicas: 3 desired | 3 updated | 3 total | 3 available | 0 unavailable #å‰¯æœ¬æ§åˆ¶å™¨ StrategyType: RollingUpdate #å‡çº§ç­–ç•¥ä¸ºRollingUpdate MinReadySeconds: 0 RollingUpdateStrategy: 25% max unavailable, 25% max surge #RollingUpdateå‡çº§ç­–ç•¥ï¼Œå³æœ€å¤§ä¸è¶…è¿‡25%çš„pod Pod Template: #å®¹å™¨åº”ç”¨æ¨¡ç‰ˆï¼ŒåŒ…å«é•œåƒï¼Œportï¼Œå­˜å‚¨ç­‰ Labels: run=nginx-app-demo Containers: nginx-app-demo: Image: nginx:1.7.9 Port: 80/TCP Host Port: 0/TCP Environment: \u003cnone\u003e Mounts: \u003cnone\u003e Volumes: \u003cnone\u003e Conditions: #å½“å‰çŠ¶æ€ Type Status Reason ---- ------ ------ Available True MinimumReplicasAvailable Progressing True NewReplicaSetAvailable OldReplicaSets: \u003cnone\u003e NewReplicaSet: nginx-app-demo-7bdfd97dcd (3/3 replicas created) #ReplicaSetsæ§åˆ¶å™¨åç§° Events: #è¿è¡Œäº‹ä»¶ Type Reason Age From Message ---- ------ ---- ---- ------- Normal ScalingReplicaSet 3m24s deployment-controller Scaled up replica set nginx-app-demo-7bdfd97dcd to 3 4ã€æŸ¥çœ‹replicasetsæƒ…å†µï¼Œé€šè¿‡æŸ¥çœ‹å¯çŸ¥replicasetså‰¯æœ¬æ§åˆ¶å™¨ç”Ÿæˆäº†ä¸‰ä¸ªpod 1. æŸ¥çœ‹replicasetsåˆ—è¡¨ [root@node-1 ~]# kubectl get replicasets NAME DESIRED CURRENT READY AGE nginx-app-demo-7bdfd97dcd 3 3 3 9m9s 2. æŸ¥çœ‹replicasetsè¯¦æƒ… [root@node-1 ~]# kubectl describe replicasets nginx-app-demo-7bdfd97dcd Name: nginx-app-demo-7bdfd97dcd Namespace: default Selector: pod-template-hash=7bdfd97dcd,run=nginx-app-demo Labels: pod-template-hash=7bdfd97dcd #labelsï¼Œå¢åŠ äº†ä¸€ä¸ªhashçš„labelè¯†åˆ«replicasets run=nginx-app-demo Annotations: deployment.kubernetes.io/desired-replicas: 3 #æ»šåŠ¨å‡çº§çš„ä¿¡æ¯ï¼Œå‰¯æœ¬æ ‘ï¼Œæœ€å¤§æ•°ï¼Œåº”ç”¨ç‰ˆæœ¬ deployment.kubernetes.io/max-replicas: 4 deployment.kubernetes.io/revision: 1 Controlled By: Deployment/nginx-app-demo #å‰¯æœ¬çš„çˆ¶æ§åˆ¶ï¼Œä¸ºnginx-app-demoè¿™ä¸ªDeployments Replicas: 3 current / 3 desired Pods Status: 3 Running / 0 Waiting / 0 Succeeded / 0 Failed Pod Template: #å®¹å™¨æ¨¡æ¿ï¼Œç»§æ‰¿äºdeployments Labels: pod-template-hash=7bdfd97dcd run=nginx-app-demo Containers: nginx-app-demo: Image: nginx:1.7.9 Port: 80/TCP Host Port: 0/TCP Environment: \u003cnone\u003e Mounts: \u003cnone\u003e Volumes: \u003cnone\u003e Events:","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:3:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.1 ClusterIPè®¿é—® é€šè¿‡podçš„ipç›´æ¥è®¿é—®åº”ç”¨ï¼Œå¯¹äºå•ä¸ªpodçš„åº”ç”¨å¯ä»¥å®ç°ï¼Œå¯¹äºå¤šä¸ªå‰¯æœ¬replicasçš„åº”ç”¨åˆ™ä¸ç¬¦åˆè¦æ±‚ï¼Œéœ€è¦é€šè¿‡serviceæ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œserviceéœ€è¦è®¾ç½®ä¸åŒçš„typeï¼Œé»˜è®¤ä¸ºClusterIPå³é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œå¦‚ä¸‹é€šè¿‡exposeå­å‘½ä»¤å°†æœåŠ¡æš´éœ²åˆ°serviceã€‚ 1ã€æš´éœ²service,å…¶ä¸­portè¡¨ç¤ºä»£ç†ç›‘å¬ç«¯å£ï¼Œtarget-portä»£è¡¨æ˜¯å®¹å™¨çš„ç«¯å£ï¼Œtypeè®¾ç½®çš„æ˜¯serviceçš„ç±»å‹ [root@node-1 ~]# kubectl expose deployment nginx-app-demo --name nginx-service-demo \\ --port=80 \\ --protocol=TCP \\ --target-port=80 \\ --type ClusterIP service/nginx-service-demo exposed 2ã€æŸ¥çœ‹serviceçš„è¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°serviceé€šè¿‡labelsé€‰æ‹©å™¨selectorè‡ªåŠ¨å°†podçš„ipç”Ÿæˆendpoints æŸ¥çœ‹serviceåˆ—è¡¨ï¼Œæ˜¾ç¤ºæœ‰ä¸¤ä¸ªï¼Œkubernetesä¸ºé»˜è®¤é›†ç¾¤åˆ›å»ºçš„service [root@node-1 ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 \u003cnone\u003e 443/TCP 29h nginx-service-demo ClusterIP 10.102.1.1 \u003cnone\u003e 80/TCP 2m54s æŸ¥çœ‹serviceè¯¦æƒ…ï¼Œå¯ä»¥çœ‹åˆ°Labelsçš„Seletorå’Œå‰é¢Deploymentsè®¾ç½®ä¸€è‡´ï¼ŒEndpointså°†podç»„æˆä¸€ä¸ªåˆ—è¡¨ [root@node-1 ~]# kubectl describe services nginx-service-demo Name: nginx-service-demo #åç§° Namespace: default #å‘½åç©ºé—´ Labels: run=nginx-app-demo #æ ‡ç­¾åç§° Annotations: \u003cnone\u003e Selector: run=nginx-app-demo #æ ‡ç­¾é€‰æ‹©å™¨ Type: ClusterIP #serviceç±»å‹ä¸ºClusterIP IP: 10.102.1.1 #æœåŠ¡çš„ipï¼Œå³vipï¼Œé›†ç¾¤å†…éƒ¨ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ª Port: \u003cunset\u003e 80/TCP #æœåŠ¡ç«¯å£ï¼Œå³ClusterIPå¯¹å¤–è®¿é—®çš„ç«¯å£ TargetPort: 80/TCP #å®¹å™¨ç«¯å£ Endpoints: 10.244.1.2:80,10.244.1.3:80,10.244.2.4:80 #è®¿é—®åœ°å€åˆ—è¡¨ Session Affinity: None #è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³• Events: \u003cnone\u003e 3ã€è®¿é—®serviceçš„åœ°å€ï¼Œå¯ä»¥è®¿é—®çš„å†…å®¹å¯çŸ¥ï¼Œserviceè‡ªåŠ¨å®ç°äº†podsçš„è´Ÿè½½å‡è¡¡ï¼Œè°ƒåº¦ç­–ç•¥ä¸ºè½®è¯¢ï¼Œä¸ºä½•ï¼Ÿå› ä¸ºserviceé»˜è®¤çš„è°ƒåº¦ç­–ç•¥Session Affinityä¸ºNoneï¼Œå³æ˜¯è½®è®­ï¼Œå¯ä»¥è®¾ç½®ä¸ºClientIPï¼Œå®ç°ä¼šè¯ä¿æŒï¼Œç›¸åŒå®¢æˆ·ç«¯IPçš„è¯·æ±‚ä¼šè°ƒåº¦åˆ°ç›¸åŒçš„podä¸Šã€‚ [root@node-1 ~]# curl http://10.102.1.1 web3 [root@node-1 ~]# curl http://10.102.1.1 web1 [root@node-1 ~]# curl http://10.102.1.1 web2 [root@node-1 ~]# curl http://10.102.1.1 4ã€ClusterIPåŸç†æ·±å…¥å‰–æï¼Œserviceåç«¯å®ç°æœ‰ä¸¤ç§æœºåˆ¶ï¼šiptableså’Œipvsï¼Œç¯å¢ƒå®‰è£…é‡‡ç”¨iptablesï¼Œiptablesé€šè¿‡natçš„é“¾ç”Ÿæˆè®¿é—®è§„åˆ™ï¼ŒKUBE-SVC-R5Y5DZHD7Q6DDTFZä¸ºå…¥ç«™DNATè½¬å‘è§„åˆ™ï¼ŒKUBE-MARK-MASQä¸ºå‡ºç«™è½¬å‘ [root@node-1 ~]# iptables -t nat -L -n Chain KUBE-SERVICES (2 references) target prot opt source destination KUBE-MARK-MASQ tcp -- !10.244.0.0/16 10.102.1.1 /* default/nginx-service-demo: cluster IP */ tcp dpt:80 KUBE-SVC-R5Y5DZHD7Q6DDTFZ tcp -- 0.0.0.0/0 10.102.1.1 /* default/nginx-service-demo: cluster IP */ tcp dpt:80 å‡ºç«™ï¼šKUBE-MARK-MASQæºåœ°å€æ®µä¸æ˜¯10.244.0.0/16è®¿é—®10.102.1.1çš„ç›®æ ‡ç«¯å£80æ—¶ï¼Œå°†è¯·æ±‚è½¬å‘ç»™KUBE-MARK-MASQé“¾ å…¥ç«™ï¼šKUBE-SVC-R5Y5DZHD7Q6DDTFZä»»æ„åŸåœ°å€è®¿é—®ç›®æ ‡10.102.1.1çš„ç›®æ ‡ç«¯å£80æ—¶å°†è¯·æ±‚è½¬å‘ç»™KUBE-SVC-R5Y5DZHD7Q6DDTFZé“¾ 5ã€æŸ¥çœ‹å…¥ç«™è¯·æ±‚è§„åˆ™ï¼Œå…¥ç«™è¯·æ±‚è§„åˆ™å°†ä¼šæ˜ å°„åˆ°ä¸åŒçš„é“¾ï¼Œä¸åŒé“¾å°†ä¼šè½¬å‘åˆ°ä¸åŒpodçš„ipä¸Šã€‚ 1. æŸ¥çœ‹å…¥ç«™è§„åˆ™KUBE-SVC-R5Y5DZHD7Q6DDTFZï¼Œè¯·æ±‚å°†è½¬å‘è‡³ä¸‰æ¡é“¾ [root@node-1 ~]# iptables -t nat -L KUBE-SVC-R5Y5DZHD7Q6DDTFZ -n Chain KUBE-SVC-R5Y5DZHD7Q6DDTFZ (1 references) target prot opt source destination KUBE-SEP-DSWLUQNR4UPH24AX all -- 0.0.0.0/0 0.0.0.0/0 statistic mode random probability 0.33332999982 KUBE-SEP-56SLMGHHOILJT36K all -- 0.0.0.0/0 0.0.0.0/0 statistic mode random probability 0.50000000000 KUBE-SEP-K6G4Z74HQYF6X7SI all -- 0.0.0.0/0 0.0.0.0/0 2. æŸ¥çœ‹å®é™…è½¬å‘çš„ä¸‰æ¡é“¾çš„è§„åˆ™,å®é™…æ˜ å°„åˆ°ä¸åŒçš„podçš„ipåœ°å€ä¸Š [root@node-1 ~]# iptables -t nat -L KUBE-SEP-DSWLUQNR4UPH24AX -n Chain KUBE-SEP-DSWLUQNR4UPH24AX (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.1.2 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.1.2:80 [root@node-1 ~]# iptables -t nat -L KUBE-SEP-56SLMGHHOILJT36K -n Chain KUBE-SEP-56SLMGHHOILJT36K (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.1.3 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.1.3:80 [root@node-1 ~]# iptables -t nat -L KUBE-SEP-K6G4Z74HQYF6X7SI -n Chain KUBE-SEP-K6G4Z74HQYF6X7SI (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.2.4 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.2.4:80 ","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:4:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"3.2 NodePortè®¿é—® Serviceé€šè¿‡ClusterIPåªèƒ½æä¾›é›†ç¾¤å†…éƒ¨çš„åº”ç”¨è®¿é—®ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®åº”ç”¨ï¼Œå¦‚æœéœ€è¦å¤–éƒ¨è®¿é—®æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼šNodePortï¼ŒLoadBalancerå’ŒIngressï¼Œå…¶ä¸­LoadBalanceréœ€è¦ç”±äº‘æœåŠ¡æä¾›å•†å®ç°ï¼ŒIngresséœ€è¦å®‰è£…å•ç‹¬çš„Ingress Controllerï¼Œæ—¥å¸¸æµ‹è¯•å¯ä»¥é€šè¿‡NodePortçš„æ–¹å¼å®ç°ï¼ŒNodePortå¯ä»¥å°†nodeçš„æŸä¸ªç«¯å£æš´éœ²ç»™å¤–éƒ¨ç½‘ç»œè®¿é—®ã€‚ 1ã€ä¿®æ”¹typeçš„ç±»å‹ç”±ClusterIPä¿®æ”¹ä¸ºNodePortç±»å‹ï¼ˆæˆ–è€…é‡æ–°åˆ›å»ºï¼ŒæŒ‡å®štypeçš„ç±»å‹ä¸ºNodePortï¼‰ 1. é€šè¿‡patchä¿®æ”¹typeçš„ç±»å‹ [root@node-1 ~]# kubectl patch services nginx-service-demo -p '{\"spec\":{\"type\": \"NodePort\"}}' service/nginx-service-demo patched 2. ç¡®è®¤yamlæ–‡ä»¶é…ç½®ï¼Œåˆ†é…äº†ä¸€ä¸ªNodePortç«¯å£ï¼Œå³æ¯ä¸ªnodeä¸Šéƒ½ä¼šç›‘å¬è¯¥ç«¯å£ [root@node-1 ~]# kubectl get services nginx-service-demo -o yaml apiVersion: v1 kind: Service metadata: creationTimestamp: \"2019-08-11T14:35:59Z\" labels: run: nginx-app-demo name: nginx-service-demo namespace: default resourceVersion: \"157676\" selfLink: /api/v1/namespaces/default/services/nginx-service-demo uid: 55e29b78-bc45-11e9-b073-525400490421 spec: clusterIP: 10.102.1.1 externalTrafficPolicy: Cluster ports: - nodePort: 32416 #è‡ªåŠ¨åˆ†é…äº†ä¸€ä¸ªNodePortç«¯å£ port: 80 protocol: TCP targetPort: 80 selector: run: nginx-app-demo sessionAffinity: None type: NodePort #ç±»å‹ä¿®æ”¹ä¸ºNodePort status: loadBalancer: {} 3. æŸ¥çœ‹serviceåˆ—è¡¨ï¼Œå¯ä»¥çŸ¥é“serviceçš„typeå·²ç»ä¿®æ”¹ä¸ºNodePort,åŒæ—¶è¿˜ä¿ç•™ClusterIPçš„è®¿é—®IP [root@node-1 ~]# kubectl get services NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 \u003cnone\u003e 443/TCP 30h nginx-service-demo NodePort 10.102.1.1 \u003cnone\u003e 80:32416/TCP 68m 2ã€é€šè¿‡NodePortè®¿é—®åº”ç”¨ç¨‹åº,æ¯ä¸ªnodeçš„åœ°å€ç›¸å½“äºvipï¼Œå¯ä»¥å®ç°ç›¸åŒçš„è´Ÿè½½å‡è¡¡æ•ˆæœï¼ŒåŒæ—¶CluserIPåŠŸèƒ½ä¾å¯ç”¨ 1. NodePortçš„è´Ÿè½½å‡è¡¡ [root@node-1 ~]# curl http://node-1:32416 web1 [root@node-1 ~]# curl http://node-2:32416 web1 [root@node-1 ~]# curl http://node-3:32416 web1 [root@node-1 ~]# curl http://node-3:32416 web3 [root@node-1 ~]# curl http://node-3:32416 web2 2. ClusterIPçš„è´Ÿè½½å‡è¡¡ [root@node-1 ~]# curl http://10.102.1.1 web2 [root@node-1 ~]# curl http://10.102.1.1 web1 [root@node-1 ~]# curl http://10.102.1.1 web1 [root@node-1 ~]# curl http://10.102.1.1 web3 3ã€NodePortè½¬å‘åŸç†ï¼Œæ¯ä¸ªnodeä¸Šé€šè¿‡kube-proxyç›‘å¬NodePortçš„ç«¯å£ï¼Œç”±åç«¯çš„iptableså®ç°ç«¯å£çš„è½¬å‘ 1. NodePortç›‘å¬ç«¯å£ [root@node-1 ~]# netstat -antupl |grep 32416 tcp6 0 0 :::32416 :::* LISTEN 32052/kube-proxy 2. æŸ¥çœ‹natè¡¨çš„è½¬å‘è§„åˆ™ï¼Œæœ‰ä¸¤æ¡è§„åˆ™KUBE-MARK-MASQå‡ºå£å’ŒKUBE-SVC-R5Y5DZHD7Q6DDTFZå…¥ç«™æ–¹å‘ã€‚ Chain KUBE-NODEPORTS (1 references) target prot opt source destination KUBE-MARK-MASQ tcp -- 0.0.0.0/0 0.0.0.0/0 /* default/nginx-service-demo: */ tcp dpt:32416 KUBE-SVC-R5Y5DZHD7Q6DDTFZ tcp -- 0.0.0.0/0 0.0.0.0/0 /* default/nginx-service-demo: */ tcp dpt:32416 3. æŸ¥çœ‹å…¥ç«™çš„è¯·æ±‚è§„åˆ™é“¾KUBE-SVC-R5Y5DZHD7Q6DDTFZ [root@node-1 ~]# iptables -t nat -L KUBE-SVC-R5Y5DZHD7Q6DDTFZ -n Chain KUBE-SVC-R5Y5DZHD7Q6DDTFZ (2 references) target prot opt source destination KUBE-SEP-DSWLUQNR4UPH24AX all -- 0.0.0.0/0 0.0.0.0/0 statistic mode random probability 0.33332999982 KUBE-SEP-56SLMGHHOILJT36K all -- 0.0.0.0/0 0.0.0.0/0 statistic mode random probability 0.50000000000 KUBE-SEP-K6G4Z74HQYF6X7SI all -- 0.0.0.0/0 0.0.0.0/0 4. ç»§ç»­æŸ¥çœ‹è½¬å‘é“¾ï¼ŒåŒ…å«æœ‰DNATè½¬å‘å’ŒKUBE-MARK-MASQå’Œå‡ºç«™è¿”å›çš„è§„åˆ™ [root@node-1 ~]# iptables -t nat -L KUBE-SEP-DSWLUQNR4UPH24AX -n Chain KUBE-SEP-DSWLUQNR4UPH24AX (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.1.2 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.1.2:80 [root@node-1 ~]# iptables -t nat -L KUBE-SEP-56SLMGHHOILJT36K -n Chain KUBE-SEP-56SLMGHHOILJT36K (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.1.3 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.1.3:80 [root@node-1 ~]# iptables -t nat -L KUBE-SEP-K6G4Z74HQYF6X7SI -n Chain KUBE-SEP-K6G4Z74HQYF6X7SI (1 references) target prot opt source destination KUBE-MARK-MASQ all -- 10.244.2.4 0.0.0.0/0 DNAT tcp -- 0.0.0.0/0 0.0.0.0/0 tcp to:10.244.2.4:80 4. æ‰©å±•åº”ç”¨ å½“åº”ç”¨ç¨‹åºçš„è´Ÿè½½æ¯”è¾ƒé«˜æ— æ³•æ»¡è¶³åº”ç”¨è¯·æ±‚æ—¶ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šé€šè¿‡æ‰©å±•RSçš„æ•°é‡æ¥å®ç°ï¼Œåœ¨kubernetesä¸­ï¼Œæ‰©å±•RSå®é™…ä¸Šé€šè¿‡æ‰©å±•å‰¯æœ¬æ•°replicasæ¥å®ç°ï¼Œæ‰©å±•RSéå¸¸ä¾¿åˆ©ï¼Œå¿«é€Ÿå®ç°å¼¹æ€§ä¼¸ç¼©ã€‚kubernetsèƒ½æä¾›ä¸¤ç§æ–¹å¼çš„ä¼¸ç¼©èƒ½åŠ›ï¼š1. æ‰‹åŠ¨ä¼¸ç¼©èƒ½åŠ›scale upå’Œscale downï¼Œ2. åŠ¨æ€çš„å¼¹æ€§ä¼¸ç¼©horizontalpodautoscalers,åŸºäºCPUçš„åˆ©ç”¨ç‡å®ç°è‡ªåŠ¨çš„å¼¹æ€§ä¼¸ç¼©ï¼Œéœ€è¦ä¾èµ–ä¸ç›‘æ§ç»„ä»¶å¦‚metrics serverï¼Œå½“å‰æœªå®ç°ï¼Œåç»­å†åšæ·±å…¥æ¢è®¨ï¼Œæœ¬æ–‡ä»¥æ‰‹åŠ¨çš„scaleçš„æ–¹å¼æ‰©å±•åº”ç”¨çš„å‰¯æœ¬æ•°ã€‚ Deploymentså‰¯æœ¬æ‰©å±• 1ã€æ‰‹åŠ¨æ‰©å±•å‰¯æœ¬æ•° [root@node-1 ~]# kubectl scale --replicas=4 deployment nginx-app-demo deployment.extensions/nginx-app-demo scaled 2ã€æŸ¥çœ‹å‰¯æœ¬æ‰©å±•æƒ…å†µ,deployme","date":"2019-08-04","objectID":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/:5:0","tags":["kubernetes"],"title":"03 Kuberneteså¿«é€Ÿå…¥é—¨","uri":"/myBlog-2/post/03-kubernetes%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1. kubernetesé›†ç¾¤å‡çº§ ","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:0:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 kuberneteså‡çº§æ¦‚è¿° kubernetesç‰ˆæœ¬å‡çº§è¿­ä»£éå¸¸å¿«ï¼Œæ¯ä¸‰ä¸ªæœˆæ›´æ–°ä¸€ä¸ªç‰ˆæœ¬,å¾ˆå¤šæ–°çš„åŠŸèƒ½åœ¨æ–°ç‰ˆæœ¬ä¸­å¿«é€Ÿè¿­ä»£ï¼Œä¸ºäº†ä¸ç¤¾åŒºç‰ˆæœ¬åŠŸèƒ½ä¿æŒä¸€è‡´ï¼Œå‡çº§kubernetesé›†ç¾¤ï¼Œç¤¾åŒºå·²é€šè¿‡kubeadmå·¥å…·ç»Ÿä¸€å‡çº§é›†ç¾¤ï¼Œå‡çº§æ­¥éª¤ç®€å•æ˜“è¡Œã€‚é¦–å…ˆæ¥çœ‹ä¸‹å‡çº§kubernetesé›†ç¾¤éœ€è¦å‡çº§é‚£äº›ç»„ä»¶ï¼š å‡çº§ç®¡ç†èŠ‚ç‚¹ï¼Œç®¡ç†èŠ‚ç‚¹ä¸Šçš„kube-apiserverï¼Œkuber-controller-managerï¼Œkube-schedulerï¼Œetcdç­‰ï¼› å…¶ä»–ç®¡ç†èŠ‚ç‚¹ï¼Œç®¡ç†èŠ‚ç‚¹å¦‚æœä»¥é«˜å¯ç”¨çš„æ–¹å¼éƒ¨ç½²ï¼Œå¤šä¸ªé«˜å¯ç”¨èŠ‚ç‚¹éœ€è¦ä¸€å¹¶å‡çº§ï¼› workerå·¥ä½œèŠ‚ç‚¹ï¼Œå‡çº§å·¥ä½œèŠ‚ç‚¹ä¸Šçš„Container Runtimeå¦‚dockerï¼Œkubeletå’Œkube-proxyã€‚ ç‰ˆæœ¬å‡çº§é€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼šå°ç‰ˆæœ¬å‡çº§å’Œè·¨ç‰ˆæœ¬å‡çº§ï¼Œå°ç‰ˆæœ¬å‡çº§å¦‚1.14.1å‡çº§åª1.14.2ï¼Œå°ç‰ˆæœ¬ä¹‹é—´å¯ä»¥è·¨ç‰ˆæœ¬å‡çº§å¦‚1.14.1ç›´æ¥å‡çº§è‡³1.14.3ï¼›è·¨ç‰ˆæœ¬å‡çº§æŒ‡å¤§ç‰ˆæœ¬å‡çº§ï¼Œå¦‚1.14.xå‡çº§è‡³1.15.xã€‚æœ¬æ–‡ä»¥ç¦»çº¿çš„æ–¹å¼å°†1.14.1å‡çº§è‡³1.1.5.1ç‰ˆæœ¬ï¼Œå‡çº§å‰éœ€è¦æ»¡è¶³æ¡ä»¶å¦‚ä¸‹ï¼š å½“å‰é›†ç¾¤ç‰ˆæœ¬éœ€è¦å¤§äº1.14.xï¼Œå¯å‡çº§è‡³1.14.xå’Œ1.15.xç‰ˆæœ¬ï¼Œå°ç‰ˆæœ¬å’Œè·¨ç‰ˆæœ¬ä¹‹é—´å‡çº§ï¼› å…³é—­swapç©ºé—´ï¼› å¤‡ä»½æ•°æ®ï¼Œå°†etcdæ•°æ®å¤‡ä»½ï¼Œä»¥åŠä¸€äº›é‡è¦ç›®å½•å¦‚/etc/kubernetes,/var/lib/kubeletï¼› å‡çº§è¿‡ç¨‹ä¸­podéœ€è¦é‡å¯ï¼Œç¡®ä¿åº”ç”¨ä½¿ç”¨RollingUpdateæ»šåŠ¨å‡çº§ç­–ç•¥ï¼Œé¿å…ä¸šåŠ¡æœ‰å½±å“ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:1:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 å‡çº§å‰å‡†å¤‡å·¥ä½œ 1ã€æŸ¥çœ‹å½“å‰ç‰ˆæœ¬,ç³»ç»Ÿä¸Šéƒ¨ç½²çš„ç‰ˆæœ¬æ˜¯1.1.4.1 [root@node-1 ~]# kubectl version Client Version: version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.1\", GitCommit:\"b7394102d6ef778017f2ca4046abbaa23b88c290\", GitTreeState:\"clean\", BuildDate:\"2019-04-08T17:11:31Z\", GoVersion:\"go1.12.1\", Compiler:\"gc\", Platform:\"linux/amd64\"} Server Version: version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.1\", GitCommit:\"b7394102d6ef778017f2ca4046abbaa23b88c290\", GitTreeState:\"clean\", BuildDate:\"2019-04-08T17:02:58Z\", GoVersion:\"go1.12.1\", Compiler:\"gc\", Platform:\"linux/amd64\"} [root@node-1 ~]# kubeadm version kubeadm version: \u0026version.Info{Major:\"1\", Minor:\"14\", GitVersion:\"v1.14.1\", GitCommit:\"b7394102d6ef778017f2ca4046abbaa23b88c290\", GitTreeState:\"clean\", BuildDate:\"2019-04-08T17:08:49Z\", GoVersion:\"go1.12.1\", Compiler:\"gc\", Platform:\"linux/amd64\"} 2ã€æŸ¥çœ‹nodeèŠ‚ç‚¹çš„ç‰ˆæœ¬,nodeä¸Šçš„kubeletå’Œkube-proxyä½¿ç”¨1.1.4.1ç‰ˆæœ¬ [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 25h v1.14.1 node-2 Ready \u003cnone\u003e 25h v1.14.1 node-3 Ready \u003cnone\u003e 25h v1.14.1 3ã€å…¶ä»–ç»„ä»¶çŠ¶æ€ï¼Œç¡®ä¿å½“å‰ç»„ä»¶ï¼Œåº”ç”¨çŠ¶æ€æ­£å¸¸ [root@node-1 ~]# kubectl get componentstatuses NAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-0 Healthy {\"health\":\"true\"} [root@node-1 ~]# [root@node-1 ~]# kubectl get deployments --all-namespaces NAMESPACE NAME READY UP-TO-DATE AVAILABLE AGE default demo 3/3 3 3 37m kube-system coredns 2/2 2 2 25h 4ã€æŸ¥çœ‹kubernetesæœ€æ–°ç‰ˆæœ¬ï¼ˆé…ç½®kubernetesçš„yumæºï¼Œéœ€è¦åˆç†ä¸Šç½‘æ‰å¯ä»¥è®¿é—®ï¼‰ï¼Œä½¿ç”¨yum list â€“showduplicates kubeadm â€“disableexcludes=kubernetesæŸ¥çœ‹å½“å‰èƒ½å‡çº§ç‰ˆæœ¬ï¼Œç»¿è‰²ä¸ºå½“å‰ç‰ˆæœ¬ï¼Œè“è‰²ä¸ºå¯ä»¥å‡çº§çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹å›¾ï¼š kuberneteså¯å‡çº§ç‰ˆæœ¬åˆ—è¡¨ ","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:2:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 å‡çº§masterèŠ‚ç‚¹ 1ã€å€’å…¥å®‰è£…é•œåƒï¼Œå…ˆä»cosä¸­ä¸‹è½½å®‰è£…é•œåƒå¹¶é€šè¿‡docker loadå¯¼å…¥åˆ°ç³»ç»Ÿä¸­ï¼Œä¸‹è½½åœ°å€ï¼Œè§£å‹å¹¶è¿›å…¥åˆ°v1.15.1ç›®å½•ä¸‹ï¼Œå°†é•œåƒå€’å…¥åˆ°ä¸‰ä¸ªèŠ‚ç‚¹ä¸­,ä»¥node-2ä¸ºä¾‹å€’å…¥é•œåƒï¼š 1.15.1ä¸‹è½½åœ°å€ 1.17.2ä¸‹è½½åœ°å€ å€’å…¥é•œåƒï¼š [root@node-2 v1.15.1]# docker image load -i kube-apiserver\\:v1.15.1.tar [root@node-2 v1.15.1]# docker image load -i kube-scheduler\\:v1.15.1.tar [root@node-2 v1.15.1]# docker image load -i kube-controller-manager\\:v1.15.1.tar [root@node-2 v1.15.1]# docker image load -i kube-proxy\\:v1.15.1.tar æŸ¥çœ‹å½“å‰ç³»ç»Ÿå¯¼å…¥é•œåƒåˆ—è¡¨ï¼š [root@node-1 ~]# docker image list REPOSITORY TAG IMAGE ID CREATED SIZE k8s.gcr.io/kube-proxy v1.15.1 89a062da739d 8 weeks ago 82.4MB k8s.gcr.io/kube-controller-manager v1.15.1 d75082f1d121 8 weeks ago 159MB k8s.gcr.io/kube-scheduler v1.15.1 b0b3c4c404da 8 weeks ago 81.1MB k8s.gcr.io/kube-apiserver v1.15.1 68c3eb07bfc3 8 weeks ago 207MB k8s.gcr.io/kube-proxy v1.14.1 20a2d7035165 5 months ago 82.1MB k8s.gcr.io/kube-apiserver v1.14.1 cfaa4ad74c37 5 months ago 210MB k8s.gcr.io/kube-scheduler v1.14.1 8931473d5bdb 5 months ago 81.6MB k8s.gcr.io/kube-controller-manager v1.14.1 efb3887b411d 5 months ago 158MB quay.io/coreos/flannel v0.11.0-amd64 ff281650a721 7 months ago 52.6MB k8s.gcr.io/coredns 1.3.1 eb516548c180 8 months ago 40.3MB k8s.gcr.io/etcd 3.3.10 2c4adeb21b4f 9 months ago 258MB k8s.gcr.io/pause 3.1 da86e6ba6ca1 21 months ago 742kB 2ã€æ›´æ–°kubeadmç‰ˆæœ¬è‡³1.15.1ï¼Œå›½å†…å¯ä»¥å‚è€ƒhttps://blog.51cto.com/2157217/1983992è®¾ç½®kubernetesæº æ›´æ–°kubeadmç‰ˆæœ¬è‡³1.15.1 3ã€æ ¡éªŒkubeadmç‰ˆæœ¬,å·²å‡çº§è‡³1.1.5.1ç‰ˆæœ¬ [root@node-1 ~]# kubeadm version kubeadm version: \u0026version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.1\", GitCommit:\"4485c6f18cee9a5d3c3b4e523bd27972b1b53892\", GitTreeState:\"clean\", BuildDate:\"2019-07-18T09:15:32Z\", GoVersion:\"go1.12.5\", Compiler:\"gc\", Platform:\"linux/amd64\"} 4ã€æŸ¥çœ‹å‡çº§è®¡åˆ’ï¼Œé€šè¿‡kubeadmå¯ä»¥æŸ¥çœ‹å½“å‰é›†ç¾¤çš„å‡çº§è®¡åˆ’ï¼Œä¼šæ˜¾ç¤ºå½“å‰å°ç‰ˆæœ¬æœ€æ–°çš„ç‰ˆæœ¬ä»¥åŠç¤¾åŒºæœ€æ–°çš„ç‰ˆæœ¬ [root@node-1 ~]# kubeadm upgrade plan [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster... [upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml' [preflight] Running pre-flight checks. [upgrade] Making sure the cluster is healthy: [upgrade] Fetching available versions to upgrade to [upgrade/versions] Cluster version: v1.14.1 #å½“å‰é›†ç¾¤ç‰ˆæœ¬ [upgrade/versions] kubeadm version: v1.15.1 #å½“å‰kubeadmç‰ˆæœ¬ [upgrade/versions] Latest stable version: v1.15.3 #ç¤¾åŒºæœ€æ–°ç‰ˆæœ¬ [upgrade/versions] Latest version in the v1.14 series: v1.14.6 #1.14.xä¸­æœ€æ–°çš„ç‰ˆæœ¬ Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply': COMPONENT CURRENT AVAILABLE Kubelet 3 x v1.14.1 v1.14.6 Upgrade to the latest version in the v1.14 series: COMPONENT CURRENT AVAILABLE #å¯å‡çº§çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œå½“å‰å¯ä»1.14.1å‡çº§è‡³1.14.6ç‰ˆæœ¬ API Server v1.14.1 v1.14.6 Controller Manager v1.14.1 v1.14.6 Scheduler v1.14.1 v1.14.6 Kube Proxy v1.14.1 v1.14.6 CoreDNS 1.3.1 1.3.1 Etcd 3.3.10 3.3.10 You can now apply the upgrade by executing the following command: kubeadm upgrade apply v1.14.6 #å‡çº§è‡³1.14.6æ‰§è¡Œçš„æ“ä½œå‘½ä»¤ _____________________________________________________________________ Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply': COMPONENT CURRENT AVAILABLE Kubelet 3 x v1.14.1 v1.15.3 Upgrade to the latest stable version: COMPONENT CURRENT AVAILABLE #è·¨ç‰ˆæœ¬å‡çº§çš„ç‰ˆæœ¬ï¼Œå½“å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯1.15.3 API Server v1.14.1 v1.15.3 Controller Manager v1.14.1 v1.15.3 Scheduler v1.14.1 v1.15.3 Kube Proxy v1.14.1 v1.15.3 CoreDNS 1.3.1 1.3.1 Etcd 3.3.10 3.3.10 You can now apply the upgrade by executing the following command: kubeadm upgrade apply v1.15.3 #å‡çº§è‡³ç¤¾åŒºæœ€æ–°çš„ç‰ˆæœ¬æ‰§è¡Œçš„æ“ä½œ Note: Before you can perform this upgrade, you have to update kubeadm to v1.15.3. _____________________________________________________________________ 5ã€å½“å‰é•œåƒæ²¡æœ‰ä¸‹è½½æœ€æ–°é•œåƒï¼Œæœ¬æ–‡ä»¥å‡çº§1.1.5.1ç‰ˆæœ¬ä¸ºä¾‹ï¼Œå‡çº§å…¶ä»–ç‰ˆæœ¬ç›¸ç±»ä¼¼ï¼Œéœ€è¦ç¡®ä¿å½“å‰é›†ç¾¤å·²è·å–åˆ°ç›¸å…³é•œåƒï¼Œå‡çº§è¿‡ç¨‹ä¸­ä¹Ÿä¼šæ›´æ–°è¯ä¹¦ï¼Œå¯é€šè¿‡--certificate-renewal=falseå…³é—­è¯ä¹¦å‡çº§ï¼Œå‡çº§è‡³1.15.1ç‰ˆæœ¬æ“ä½œå¦‚ä¸‹ï¼š [root@node-1 ~]# kubeadm upgrade apply v1.15.1 [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster... [upgrade/co","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:3:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 å‡çº§workerèŠ‚ç‚¹ 1ã€å‡çº§kubeadmå’Œkubeletè½¯ä»¶åŒ… [root@node-2 ~]# yum install -y kubelet-1.15.1-0 --disableexcludes=kubernetes [root@node-2 ~]# yum install -y kubeadm-1.15.1-0 --disableexcludes=kubernetes [root@node-2 ~]# yum install -y kubectl-1.15.1-0 --disableexcludes=kubernetes 2ã€è®¾ç½®èŠ‚ç‚¹è¿›å…¥ç»´æŠ¤æ¨¡å¼å¹¶é©±é€workerèŠ‚ç‚¹ä¸Šçš„åº”ç”¨ï¼Œä¼šå°†å‡ºäº†DaemonSetsä¹‹å¤–çš„å…¶ä»–åº”ç”¨è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Š è®¾ç½®ç»´æŠ¤å’Œé©±é€ï¼š [root@node-1 ~]# kubectl drain node-2 --ignore-daemonsets node/node-2 cordoned WARNING: ignoring DaemonSet-managed Pods: kube-system/kube-flannel-ds-amd64-tm6wj, kube-system/kube-proxy-2wqhj evicting pod \"coredns-5c98db65d4-86gg7\" evicting pod \"demo-7b86696648-djvgb\" pod/demo-7b86696648-djvgb evicted pod/coredns-5c98db65d4-86gg7 evicted node/node-2 evicted æŸ¥çœ‹nodeçš„æƒ…å†µï¼Œæ­¤æ—¶node-2å¤šäº†SchedulingDisabledæ ‡è¯†ä½ï¼Œå³æ–°çš„nodeéƒ½ä¸ä¼šè°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Š [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 26h v1.15.1 node-2 Ready,SchedulingDisabled \u003cnone\u003e 26h v1.14.1 node-3 Ready \u003cnone\u003e 26h v1.14.1 æŸ¥çœ‹node-2ä¸Šçš„podsï¼Œpodéƒ½å·²ç»è¿ç§»åˆ°å…¶ä»–nodeèŠ‚ç‚¹ä¸Š [root@node-1 ~]# kubectl get pods --all-namespaces -o wide NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default demo-7b86696648-6f22r 1/1 Running 0 30s 10.244.2.5 node-3 \u003cnone\u003e \u003cnone\u003e default demo-7b86696648-fjmxn 1/1 Running 0 116m 10.244.2.2 node-3 \u003cnone\u003e \u003cnone\u003e default demo-7b86696648-nwwxf 1/1 Running 0 116m 10.244.2.3 node-3 \u003cnone\u003e \u003cnone\u003e kube-system coredns-5c98db65d4-cqbbl 1/1 Running 0 30s 10.244.0.6 node-1 \u003cnone\u003e \u003cnone\u003e kube-system coredns-5c98db65d4-g59qt 1/1 Running 2 28m 10.244.2.4 node-3 \u003cnone\u003e \u003cnone\u003e kube-system etcd-node-1 1/1 Running 0 13m 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e kube-system kube-apiserver-node-1 1/1 Running 0 13m 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e kube-system kube-controller-manager-node-1 1/1 Running 0 13m 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e kube-system kube-flannel-ds-amd64-99tjl 1/1 Running 1 26h 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e kube-system kube-flannel-ds-amd64-jp594 1/1 Running 0 26h 10.254.100.103 node-3 \u003cnone\u003e \u003cnone\u003e kube-system kube-flannel-ds-amd64-tm6wj 1/1 Running 0 26h 10.254.100.102 node-2 \u003cnone\u003e \u003cnone\u003e kube-system kube-proxy-2wqhj 1/1 Running 0 28m 10.254.100.102 node-2 \u003cnone\u003e \u003cnone\u003e kube-system kube-proxy-k7c4f 1/1 Running 1 27m 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e kube-system kube-proxy-zffgq 1/1 Running 0 28m 10.254.100.103 node-3 \u003cnone\u003e \u003cnone\u003e kube-system kube-scheduler-node-1 1/1 Running 0 13m 10.254.100.101 node-1 \u003cnone\u003e \u003cnone\u003e 3ã€å‡çº§workerèŠ‚ç‚¹ [root@node-2 ~]# kubeadm upgrade node [upgrade] Reading configuration from the cluster... [upgrade] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml' [upgrade] Skipping phase. Not a control plane node[kubelet-start] Downloading configuration for the kubelet from the \"kubelet-config-1.15\" ConfigMap in the kube-system namespace [kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\" [upgrade] The configuration for this node was successfully updated! [upgrade] Now you should go ahead and upgrade the kubelet package using your package manager. 4ã€é‡å¯kubeletæœåŠ¡ [root@node-2 ~]# systemctl daemon-reload [root@node-2 ~]# systemctl restart kubelet 5ã€å–æ¶ˆèŠ‚ç‚¹è°ƒåº¦æ ‡å¿—ï¼Œç¡®ä¿workerèŠ‚ç‚¹å¯æ­£å¸¸è°ƒåº¦ [root@node-1 ~]# kubectl uncordon node-2 node/node-2 uncordoned [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 27h v1.15.1 node-2 Ready \u003cnone\u003e 27h v1.15.1 #å·²å‡çº§æˆåŠŸ node-3 Ready \u003cnone\u003e 27h v1.14.1 æŒ‰ç…§ä¸Šè¿°æ­¥éª¤å‡çº§node-3èŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ˜¯å‡çº§å®Œæˆåæ‰€æœ‰èŠ‚ç‚¹ç‰ˆæœ¬çŠ¶æ€ï¼š [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 27h v1.15.1 node-2 Ready \u003cnone\u003e 27h v1.15.1 node-3 Ready \u003cnone\u003e 27h v1.15.1 ","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:4:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.5 å‡çº§åŸç† 1ã€kubeadm upgrade applyæ‰§è¡ŒåŠ¨ä½œ æ£€æŸ¥é›†ç¾¤æ˜¯å¦å…·å¤‡æ›´æ–°æ¡ä»¶ï¼Œæ£€æŸ¥apiserverå¤„äºå¯ç”¨çŠ¶æ€ï¼Œæ‰€æœ‰nodeå¤„äºreadyçŠ¶æ€ï¼Œç¡®ä¿csç»„ä»¶æ­£å¸¸ å¼ºåˆ¶ç‰ˆæœ¬æ›´æ–°ç­–ç•¥ æ£€æŸ¥æ›´æ–°æ‰€éœ€é•œåƒæ˜¯å¦ä¸‹è½½æˆ–è€…å¯æ‹‰å– æ›´æ–°æ‰€æœ‰æ§åˆ¶èŠ‚ç‚¹ç»„ä»¶ï¼Œç¡®ä¿å¼‚å¸¸æ—¶èƒ½å›æ»šåˆ°åŸæœ‰çŠ¶æ€ æ›´æ–°kube-dnså’Œkube-proxyçš„é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿æ‰€éœ€çš„çš„RBACæˆæƒé…ç½®æ­£å¸¸ ç”Ÿæˆæ–°çš„è¯ä¹¦æ–‡ä»¶å¹¶å¤‡ä»½è¯ä¹¦ï¼ˆå½“è¯ä¹¦è¶…æ—¶è¶…è¿‡180å¤©ï¼‰ 2ã€kubeadm upgrade nodeæ‰§è¡ŒåŠ¨ä½œ ä»kubeadmä¸­è·å–ClusterConfigurationï¼Œå³ä»é›†ç¾¤ä¸­è·å–åˆ°æ›´æ–°é›†ç¾¤çš„é…ç½®æ–‡ä»¶å¹¶åº”ç”¨ æ›´æ–°nodeèŠ‚ç‚¹ä¸Šçš„kubeleté…ç½®ä¿¡æ¯å’Œè½¯ä»¶ 2. æ›´æ–°é›†ç¾¤è‡³1.15.3 æˆªæ­¢è‡³2019.9.15ï¼Œå½“å‰kubernetesç¤¾åŒºæœ€æ–°ç‰ˆæœ¬æ˜¯1.15.3ï¼Œæœ¬æ–‡æ¼”ç¤ºä»¥åœ¨çº¿çš„æ–¹å¼å‡çº§kubernetesé›†ç¾¤è‡³1.15.3ç‰ˆæœ¬ï¼Œæ­¥éª¤å’Œå‰æ–‡æ“ä½œç±»ä¼¼ã€‚ 1ã€å®‰è£…æœ€æ–°è½¯ä»¶åŒ…ï¼Œkubeadmï¼Œkubeletï¼Œkubectl,ä¸‰ä¸ªèŠ‚ç‚¹å‡éœ€è¦å®‰è£… [root@node-1 ~]# yum install kubeadm kubectl kubelet å·²åŠ è½½æ’ä»¶ï¼šfastestmirror, langpacks Loading mirror speeds from cached hostfile æ­£åœ¨è§£å†³ä¾èµ–å…³ç³» --\u003e æ­£åœ¨æ£€æŸ¥äº‹åŠ¡ ---\u003e è½¯ä»¶åŒ… kubeadm.x86_64.0.1.15.1-0 å°†è¢« å‡çº§ ---\u003e è½¯ä»¶åŒ… kubeadm.x86_64.0.1.15.3-0 å°†è¢« æ›´æ–° ---\u003e è½¯ä»¶åŒ… kubectl.x86_64.0.1.15.1-0 å°†è¢« å‡çº§ ---\u003e è½¯ä»¶åŒ… kubectl.x86_64.0.1.15.3-0 å°†è¢« æ›´æ–° ---\u003e è½¯ä»¶åŒ… kubelet.x86_64.0.1.15.1-0 å°†è¢« å‡çº§ ---\u003e è½¯ä»¶åŒ… kubelet.x86_64.0.1.15.3-0 å°†è¢« æ›´æ–° --\u003e è§£å†³ä¾èµ–å…³ç³»å®Œæˆ ä¾èµ–å…³ç³»è§£å†³ ======================================================================================================================================================================== Package æ¶æ„ ç‰ˆæœ¬ æº å¤§å° ======================================================================================================================================================================== æ­£åœ¨æ›´æ–°: kubeadm x86_64 1.15.3-0 kubernetes 8.9 M kubectl x86_64 1.15.3-0 kubernetes 9.5 M kubelet x86_64 1.15.3-0 kubernetes 22 M äº‹åŠ¡æ¦‚è¦ ======================================================================================================================================================================== å‡çº§ 3 è½¯ä»¶åŒ… 2ã€å‡çº§masterèŠ‚ç‚¹ æŸ¥çœ‹å‡çº§è®¡åˆ’ [root@node-1 ~]# kubeadm upgrade plan [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster... [upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -oyaml' [preflight] Running pre-flight checks. [upgrade] Making sure the cluster is healthy: [upgrade] Fetching available versions to upgrade to [upgrade/versions] Cluster version: v1.15.1 [upgrade/versions] kubeadm version: v1.15.3 [upgrade/versions] Latest stable version: v1.15.3 [upgrade/versions] Latest version in the v1.15 series: v1.15.3 Components that must be upgraded manually after you have upgraded the control plane with 'kubeadm upgrade apply': COMPONENT CURRENT AVAILABLE Kubelet 3 x v1.15.1 v1.15.3 Upgrade to the latest version in the v1.15 series: COMPONENT CURRENT AVAILABLE API Server v1.15.1 v1.15.3 Controller Manager v1.15.1 v1.15.3 Scheduler v1.15.1 v1.15.3 Kube Proxy v1.15.1 v1.15.3 CoreDNS 1.3.1 1.3.1 Etcd 3.3.10 3.3.10 You can now apply the upgrade by executing the following command: kubeadm upgrade apply v1.15.3 _____________________________________________________________________ å‡çº§masterèŠ‚ç‚¹ [root@node-1 ~]# kubeadm upgrade apply v1.15.3 3ã€å‡çº§workerèŠ‚ç‚¹,ä»¥æ­¤å‡çº§node-2å’Œnode-3èŠ‚ç‚¹ è®¾ç½®äº”æ±¡ç‚¹å»é©±é€ [root@node-1 ~]# kubectl drain node-2 --ignore-daemonsets æ‰§è¡Œå‡çº§æ“ä½œ [root@node-2 ~]# kubeadm upgrade node [root@node-2 ~]# systemctl daemon-reload [root@node-2 ~]# systemctl restart kubelet å–æ¶ˆè°ƒåº¦æ ‡å¿—ä½ [root@node-1 ~]# kubectl uncordon node-2 node/node-2 uncordoned ç¡®è®¤ç‰ˆæœ¬å‡çº§ [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 27h v1.15.3 node-2 Ready \u003cnone\u003e 27h v1.15.3 node-3 Ready \u003cnone\u003e 27h v1.15.1 4ã€æ‰€æœ‰èŠ‚ç‚¹å‡çº§åçš„çŠ¶æ€ æ‰€æœ‰nodeçŠ¶æ€ [root@node-1 ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION node-1 Ready master 27h v1.15.3 node-2 Ready \u003cnone\u003e 27h v1.15.3 node-3 Ready \u003cnone\u003e 27h v1.15.3 æŸ¥çœ‹ç»„ä»¶çŠ¶æ€ [root@node-1 ~]# kubectl get componentstatuses NAME STATUS MESSAGE ERROR scheduler Healthy ok controller-manager Healthy ok etcd-0 Healthy {\"health\":\"true\"} æŸ¥çœ‹åº”ç”¨çŠ¶æ€ [root@node-1 ~]# kubectl get deployments --all-namespaces NAMESPACE NAME READY UP-TO-DATE AVAILABLE AGE default demo 3/3 3 3 160m kube-system coredns 2/2 2 2 27h æŸ¥çœ‹DaemonSetsçŠ¶æ€ [root@node-1 ~]# kubectl get daemonsets --all-namespaces NAMESPACE NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE kube-system kube-flannel-ds-amd64 3 3 3 3 3 beta.kubernetes.io/arch","date":"2019-08-04","objectID":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/:5:0","tags":["kubernetes"],"title":"04 ç¦»çº¿å‡çº§kubernetesé›†ç¾¤","uri":"/myBlog-2/post/04-%E7%A6%BB%E7%BA%BF%E5%8D%87%E7%BA%A7kubernetes%E9%9B%86%E7%BE%A4/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ å‰é¢çš„ç³»åˆ—æ–‡ç« å·²ä»‹ç»kubernetesæ¶æ„ï¼Œå®‰è£…ï¼Œå‡çº§å’Œå¿«é€Ÿå…¥é—¨ï¼Œè¯»è€…é€šè¿‡æ–‡ç« çš„å®æ“å·²å¯¹kuberneteså·²æœ‰åˆæ­¥çš„è®¤è¯†å’Œç†è§£ï¼Œä»æœ¬ç« å¼€å§‹é€æ­¥ä»‹ç»kubernetesä¸­çš„åŸºç¡€æ¦‚å¿µæ¦‚å¿µå’Œæ ¸å¿ƒæ¦‚å¿µï¼ŒåŸºç¡€æ¦‚å¿µåŒ…æ‹¬ï¼šnamespaceï¼Œlabelsï¼Œannotationsï¼Œpodsï¼Œvolumesç­‰ï¼›æ ¸å¿ƒæ¦‚å¿µåŒ…å«kubernetesä¸­å„ç§controllerï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç§ï¼š åº”ç”¨å‰¯æœ¬æ§åˆ¶å™¨æœ‰ï¼šDeploymentsï¼ŒReplicaSetsï¼ŒDaemonSetsï¼ŒStatefulSetsï¼› æ‰¹å¤„ç†ä»»åŠ¡æ§åˆ¶å™¨Jobså’ŒCronJob å­˜å‚¨æ§åˆ¶å™¨PersistentVoloumeï¼ŒPersistentVolumeClaimï¼ŒStorageClassï¼› æœåŠ¡è´Ÿè½½å‡è¡¡Serviceï¼ŒIngressï¼ŒNetworkPolicyå’ŒDNSåç§°è§£æï¼› é…ç½®å’Œå¯†é’¥ConfigMapså’ŒSecrets æœ¬æ–‡ä»æœ€åŸºç¡€çš„æ¦‚å¿µpodå¼€å§‹è®²è§£ï¼Œåç»­é€æ­¥ä»‹ç»åº”ç”¨éƒ¨ç½²ï¼Œå­˜å‚¨ï¼Œè´Ÿè½½å‡è¡¡ç­‰ç›¸å…³çš„æ§åˆ¶å™¨ï¼Œkuberneteså†…éƒ¨ç”±å¤šä¸ªä¸åŒçš„æ§åˆ¶å™¨ç»„æˆï¼Œæ¯ä¸ªæ§åˆ¶å™¨å®Œæˆä¸åŒçš„åŠŸèƒ½ã€‚ 1. æ·±å…¥å­¦ä¹ pod ","date":"2019-08-04","objectID":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/:0:0","tags":["kubernetes"],"title":"05 åˆè¯†æ ¸å¿ƒæ¦‚å¿µpod","uri":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 Containerå’ŒPodæ¦‚å¿µ å®¹å™¨æ˜¯ä¸€ç§ä¾¿æºå¼ï¼Œè½»é‡çº§åˆ«çš„å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä½¿ç”¨linux cggroupæŠ€æœ¯å®ç°å„ç§èµ„æºçš„éš”ç¦»ï¼Œå¦‚cpuï¼Œmemoryï¼Œpidï¼Œmountï¼ŒIPCç­‰ï¼Œç›¸æ¯”äºè™šæ‹ŸåŒ–æŠ€æœ¯å¦‚KVMï¼Œå®¹å™¨æŠ€æœ¯æ›´åŠ è½»é‡çº§ï¼Œå®ƒçš„äº§ç”Ÿä¸»è¦è§£å†³ç¯å¢ƒçš„ç¯å¢ƒå‘å¸ƒçš„é—®é¢˜ï¼Œç›®å‰ä¸»æµçš„å®¹å™¨æŠ€æœ¯æ˜¯dockerï¼Œè¯´åˆ°å®¹å™¨ï¼Œä¸€èˆ¬éƒ½ç­‰åŒäºdockerã€‚ è¦è¿è¡Œå®¹å™¨é¦–å…ˆéœ€è¦æœ‰é•œåƒï¼Œåº”ç”¨å’Œåº”ç”¨ä¾èµ–çš„ç¯å¢ƒè¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œåœ¨kubernetesä¸­ä¸ä¼šç›´æ¥è¿è¡Œcontainerï¼Œè€Œæ˜¯è¿è¡Œpodï¼Œä¸€ä¸ªpodé‡Œé¢åŒ…å«å¤šä¸ªcontainerï¼Œcontainerä¹‹é—´å…±äº«ç›¸åŒçš„namespaceï¼Œnetworkï¼Œstorageç­‰ã€‚é•œåƒå­˜å‚¨åœ¨ç§æœ‰é•œåƒæˆ–è€…å…¬æœ‰é•œåƒä¸­ï¼Œè¿è¡Œæ—¶é€šè¿‡docker image pullçš„æ–¹å¼æ‹‰å–åˆ°æœ¬åœ°è¿è¡Œï¼Œimagesçš„æ‹‰å–ç­–ç•¥åŒ…å«æœ‰ä¸¤ç§ï¼š ImagePullPolicyä¸ºAlwaysï¼Œä¸ç®¡æœ¬åœ°æ˜¯å¦æœ‰ç›´æ¥ä¸‹è½½ ImagePullPolicyä¸ºIfNotPresentï¼Œé»˜è®¤é•œåƒæ‹‰å–å¾—ç­–ç•¥ï¼Œæœ¬åœ°ä¸å­˜åœ¨å†æ‹‰å– Podsæ˜¯kubernetesä¸­æœ€å°çš„è°ƒåº¦å•ä½ï¼ŒPodså†…è¿è¡Œä¸€ä¸ªæˆ–è€…å¤šä¸ªcontainerï¼Œcontainerä¹‹é—´å…±äº«podçš„ç½‘ç»œipèµ„æºï¼Œå­˜å‚¨volumeèµ„æºï¼Œè®¡ç®—ç­‰èµ„æºï¼Œæ–¹ä¾¿podå†…éƒ¨çš„containerä¹‹é—´èƒ½å¤Ÿå®ç°å¿«é€Ÿçš„è®¿é—®å’Œäº¤äº’ã€‚ Podæ¦‚å¿µä»‹ç» å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒPodçš„ä½¿ç”¨æ–¹å¼é€šå¸¸åŒ…å«ä¸¤ç§ï¼š Podä¸­è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œæœ€ç»å¸¸ä½¿ç”¨çš„æ¨¡å¼ï¼Œcontainerå°è£…åœ¨podä¸­è°ƒåº¦ï¼Œä¸¤è€…å‡ ä¹ç­‰åŒï¼Œä½†k8sä¸ç›´æ¥ç®¡ç†å®¹å™¨ Podä¸­è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œå¤šä¸ªå®¹å™¨å°è£…åœ¨podä¸­ä¸€èµ·è°ƒåº¦ï¼Œé€‚ç”¨äºå®¹å™¨ä¹‹é—´æœ‰æ•°æ®äº¤äº’å’Œè°ƒç”¨çš„åœºæ™¯ï¼Œå¦‚app+redisï¼Œpodå†…éƒ¨å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå­˜å‚¨å‘½åç©ºé—´ï¼Œè¿›ç¨‹å‘½åç©ºé—´ç­‰ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/:1:0","tags":["kubernetes"],"title":"05 åˆè¯†æ ¸å¿ƒæ¦‚å¿µpod","uri":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 å¦‚ä½•åˆ›å»ºpod kubernetesäº¤äº’çš„æ–¹å¼é€šå¸¸åˆ†ä¸ºå››ç§ï¼š å‘½ä»¤è¡Œï¼Œkubectlå’Œkubernetesäº¤äº’ï¼Œå®Œæˆèµ„æºçš„ç®¡ç†ï¼Œå‘½ä»¤è¡Œå…¥é—¨ç®€å•ï¼Œä½†åªèƒ½æ”¯æŒéƒ¨åˆ†èµ„æºåˆ›å»º APIï¼Œé€šè¿‡resfulAPIä»¥httpçš„æ–¹å¼å’Œkubernetesäº¤äº’ï¼Œé€‚ç”¨äºåŸºäºAPIåšäºŒæ¬¡å¼€å‘ SDKï¼Œæä¾›å„ç§è¯­è¨€åŸç”Ÿçš„SDKï¼Œå®ç°å„ç§è¯­è¨€ç¼–ç¨‹æ¥å…¥ YAMLï¼Œé€šè¿‡æ˜“äºç†è§£çš„YAMLæ–‡ä»¶æ ¼å¼ï¼Œæè¿°èµ„æºçš„å®šä¹‰ï¼ŒåŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€ç»ˆè½¬æ¢ä¸ºjsonæ ¼å¼ kubernetesä¸­é€šè¿‡å®šä¹‰ç”Ÿç”³æ˜å¼çš„æ–¹å¼å®šä¹‰èµ„æºï¼Œå³é€šè¿‡åœ¨yamlæ–‡ä»¶ä¸­å®šä¹‰æ‰€éœ€çš„èµ„æºï¼Œkubernetesé€šè¿‡controller-manageræŒ‰ç…§yamlæ–‡ä»¶ä¸­å®šä¹‰çš„èµ„æºå»ç”Ÿæˆæ‰€éœ€çš„èµ„æºï¼ˆmatch the current state to desired stateï¼‰ã€‚é€šå¸¸åœ¨kubernetesä¸­é€šè¿‡yamlæ–‡ä»¶çš„æ–¹å¼å®šä¹‰èµ„æºï¼Œç„¶åé€šè¿‡kubectl create -f æ–‡ä»¶.yamlçš„æ–¹å¼åº”ç”¨é…ç½®ï¼Œå¦‚ä¸‹æ¼”ç¤ºåˆ›å»ºä¸€ä¸ªnginxåº”ç”¨çš„æ“ä½œã€‚ 1ã€ç¼–å†™yamlæ–‡ä»¶ï¼Œå®šä¹‰ä¸€ä¸ªpodèµ„æº [root@node-1 demo]# cat nginx.yaml apiVersion: v1 kind: Pod metadata: name: nginx-demo labels: name: nginx-demo spec: containers: - name: nginx-demo image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: nginx-port-80 protocol: TCP containerPort: 80 å…³äºé…ç½®æ–‡ä»¶ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š apiVersion apiä½¿ç”¨çš„ç‰ˆæœ¬,kubectl api-versionså¯æŸ¥çœ‹åˆ°å½“å‰ç³»ç»Ÿèƒ½æ”¯æŒçš„ç‰ˆæœ¬åˆ—è¡¨ kind æŒ‡å®šèµ„æºç±»å‹ï¼Œè¡¨ç¤ºä¸ºPodçš„èµ„æºç±»å‹ metadata æŒ‡å®šPodçš„å…ƒæ•°æ®ï¼Œmetadata.nameæŒ‡å®šåç§°ï¼Œmetadata.labelsæŒ‡å®šPodçš„æ‰€å±çš„æ ‡ç­¾ spec æŒ‡å®šPodçš„æ¨¡ç‰ˆå±æ€§ï¼Œspec.containersé…ç½®å®¹å™¨çš„ä¿¡æ¯ï¼Œspec.containers.nameæŒ‡å®šåå­—ï¼Œspec.containers.imageæŒ‡å®šå®¹å™¨é•œåƒçš„åç§°ï¼Œspec.containers.imagePullPolicyæ˜¯é•œåƒçš„ä¸‹è½½æ–¹å¼ï¼ŒIfNotPresentè¡¨ç¤ºå½“é•œåƒä¸å­˜åœ¨æ—¶ä¸‹è½½ï¼Œspec.containers.ports.nameæŒ‡å®športçš„åç§°ï¼Œspec.containers.ports.protocolåè®®ç±»å‹ä¸ºTCPï¼Œspec.containers.ports.containerPortä¸ºå®¹å™¨ç«¯å£ã€‚ 2ã€åˆ›å»ºpodåº”ç”¨ [root@node-1 demo]# kubectl apply -f nginx.yaml pod/nginx-demo created 3ã€è®¿é—®åº”ç”¨ è·å–å®¹å™¨çš„IPåœ°å€ [root@node-1 demo]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES demo-7b86696648-8bq7h 1/1 Running 0 8h 10.244.1.11 node-2 \u003cnone\u003e \u003cnone\u003e demo-7b86696648-8qp46 1/1 Running 0 8h 10.244.1.10 node-2 \u003cnone\u003e \u003cnone\u003e demo-7b86696648-d6hfw 1/1 Running 0 8h 10.244.1.12 node-2 \u003cnone\u003e \u003cnone\u003e nginx-demo 1/1 Running 0 50s 10.244.2.11 node-3 \u003cnone\u003e \u003cnone\u003e è®¿é—®ç«™ç‚¹å†…å®¹ï¼š [root@node-1 demo]# curl http://10.244.2.11 \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eWelcome to nginx!\u003c/title\u003e \u003cstyle\u003e body { width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003eWelcome to nginx!\u003c/h1\u003e \u003cp\u003eIf you see this page, the nginx web server is successfully installed and working. Further configuration is required.\u003c/p\u003e \u003cp\u003eFor online documentation and support please refer to \u003ca href=\"http://nginx.org/\"\u003enginx.org\u003c/a\u003e.\u003cbr/\u003e Commercial support is available at \u003ca href=\"http://nginx.com/\"\u003enginx.com\u003c/a\u003e.\u003c/p\u003e \u003cp\u003e\u003cem\u003eThank you for using nginx.\u003c/em\u003e\u003c/p\u003e \u003c/body\u003e \u003c/html\u003e å‰é¢æˆ‘ä»¬æˆ‘ä»¬å­¦ä¹ è¿‡kubernetesæ”¯æŒæ»šåŠ¨å‡çº§RollingUpdateï¼Œå¼¹æ€§æ‰©å®¹replicasç­‰ç‰¹æ€§ï¼Œå¦‚ä½•ç»™Podåšæ»šåŠ¨å‡çº§ä¿éšœä¸šåŠ¡ä¸ä¸­æ–­ï¼Œå¦‚ä½•æé«˜Podçš„å‰¯æœ¬ä¸ªæ•°ä¿éšœé«˜å¯ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¸æ”¯æŒã€‚Podæ˜¯å•ä¸ªï¼Œæ— æ³•æ”¯æŒä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œé«˜çº§ç‰¹æ€§éœ€è¦é€šè¿‡é«˜çº§çš„å‰¯æœ¬æ§åˆ¶å™¨å¦‚ReplicaSetsï¼ŒDeploymentsï¼ŒStatefulSetsï¼ŒDaemonSetsç­‰æ‰èƒ½æ”¯æŒã€‚Podåœ¨å®é™…åº”ç”¨ä¸­å¾ˆå°‘ç”¨ï¼Œé™¤äº†æµ‹è¯•å’Œè¿è¡Œä¸€äº›ç®€å•çš„åŠŸèƒ½å¤–ï¼Œå®é™…ä½¿ç”¨å»ºè®®ä½¿ç”¨Deploymentsä»£æ›¿ï¼ŒPodçš„å®šä¹‰ä»¥Templateçš„æ–¹å¼åµŒå…¥åœ¨å‰¯æœ¬æ§åˆ¶å™¨ä¸­ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/:2:0","tags":["kubernetes"],"title":"05 åˆè¯†æ ¸å¿ƒæ¦‚å¿µpod","uri":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3. å¦‚ä½•ç¼–å†™yamlæ–‡ä»¶ å‰é¢æˆ‘ä»¬æåˆ°è¿‡kubernetseæ˜¯ç”³æ˜å¼çš„æ–¹å¼éƒ¨ç½²åº”ç”¨ï¼Œåº”ç”¨çš„éƒ¨ç½²éƒ½å®šä¹‰åœ¨yamlæ–‡ä»¶ä¸­æ¥å®ç°ï¼Œå¦‚ä½•æ¥ç¼–å†™åº”ç”¨çš„yamlæ–‡ä»¶å‘¢ï¼Œä¸‹é¢æˆ‘æ¥åˆ†äº«ä¸¤ä¸ªå®é™…ä½¿ç”¨çš„æŠ€å·§ï¼š 1ã€é€šè¿‡å®šä¹‰æ¨¡ç‰ˆå¿«é€Ÿç”Ÿæˆï¼Œkubectl create apps -o yaml â€“dry-runçš„æ–¹å¼ç”Ÿæˆï¼Œâ€“dry-runä»…ä»…æ˜¯è¯•è¿è¡Œï¼Œå¹¶ä¸å®é™…åœ¨k8sé›†ç¾¤ä¸­è¿è¡Œï¼Œé€šè¿‡æŒ‡å®š-o yamlè¾“å‡ºyamlæ ¼å¼æ–‡ä»¶ï¼Œç”Ÿæˆåç»™åŸºäºæ¨¡ç‰ˆä¿®æ”¹å³å¯ï¼Œå¦‚ä¸‹ï¼š [root@node-1 demo]# kubectl create deployment demo --image=nginx:latest --dry-run -o yaml apiVersion: apps/v1 kind: Deployment metadata: creationTimestamp: null labels: app: demo name: demo spec: replicas: 1 selector: matchLabels: app: demo strategy: {} template: metadata: creationTimestamp: null labels: app: demo spec: containers: - image: nginx:latest name: nginx resources: {} status: {} 2ã€explainå‘½ä»¤ï¼Œexplainå‘½ä»¤å ªç§°æ˜¯è¯­æ³•æŸ¥è¯¢å™¨ï¼Œå¯ä»¥æŸ¥åˆ°æ¯ä¸ªå­—æ®µçš„å«ä¹‰ï¼Œä½¿ç”¨è¯´æ˜å’Œä½¿ç”¨æ–¹å¼ï¼Œå¦‚æƒ³è¦æŸ¥çœ‹Podçš„specä¸­containerså…¶ä»–æ”¯æŒçš„å­—æ®µï¼Œå¯ä»¥é€šè¿‡kubectl explain Pod.spec.containersçš„æ–¹å¼æŸ¥è¯¢ï¼Œå¦‚ä¸‹ï¼š [root@node-1 demo]# kubectl explain Pods.spec.containers KIND: Pod VERSION: v1 RESOURCE: containers \u003c[]Object\u003e DESCRIPTION: List of containers belonging to the pod. Containers cannot currently be added or removed. There must be at least one container in a Pod. Cannot be updated. A single application container that you want to run within a pod. FIELDS: args \u003c[]string\u003e #å‘½ä»¤å‚æ•° Arguments to the entrypoint. The docker image's CMD is used if this is not provided. Variable references $(VAR_NAME) are expanded using the container's environment. If a variable cannot be resolved, the reference in the input string will be unchanged. The $(VAR_NAME) syntax can be escaped with a double $$, ie: $$(VAR_NAME). Escaped references will never be expanded, regardless of whether the variable exists or not. Cannot be updated. More info: https://kubernetes.io/docs/tasks/inject-data-application/define-command-argument-container/#running-a-command-in-a-shell image \u003cstring\u003e #é•œåƒå®šä¹‰ Docker image name. More info: https://kubernetes.io/docs/concepts/containers/images This field is optional to allow higher level config management to default or override container images in workload controllers like Deployments and StatefulSets. ports \u003c[]Object\u003e #ç«¯å£å®šä¹‰ List of ports to expose from the container. Exposing a port here gives the system additional information about the network connections a container uses, but is primarily informational. Not specifying a port here DOES NOT prevent that port from being exposed. Any port which is listening on the default \"0.0.0.0\" address inside a container will be accessible from the network. Cannot be updated. readinessProbe \u003cObject\u003e #å¯ç”¨å¥åº·æ£€æŸ¥ Periodic probe of container service readiness. Container will be removed from service endpoints if the probe fails. Cannot be updated. More info: https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#container-probes resources \u003cObject\u003e #èµ„æºè®¾ç½® Compute Resources required by this container. Cannot be updated. More info: https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/ ...çœç•¥éƒ¨åˆ†è¾“å‡º... volumeMounts \u003c[]Object\u003e #æŒ‚è½½å­˜å‚¨ Pod volumes to mount into the container's filesystem. Cannot be updated. workingDir \u003cstring\u003e Container's working directory. If not specified, the container runtime's default will be used, which might be configured in the container image. Cannot be updated. å…³äºexplainå†…å®¹è§£é‡Šè¯´æ˜ è¡¨ç¤ºåé¢æ¥ä¸€ä¸ªå­—ç¬¦ä¸² \u003c[]Object\u003e è¡¨ç¤ºåé¢æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„å¯¹è±¡ï¼Œåˆ—è¡¨éœ€è¦ä»¥-å¼€å§‹ï¼Œä¸”å¯ä»¥å†™å¤šä¸ª è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å†…éƒ¨åŒ…å«å¤šä¸ªå±æ€§ å¦‚ç»§ç»­ä¸Šé¢çš„å†…å®¹ï¼Œå¦‚æœéœ€è¦æŸ¥çœ‹resourceèµ„æºå®šä¹‰ï¼Œå¯ä»¥é€šè¿‡explain pods.spec.containers.resourceæ¥æŸ¥çœ‹å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚ é€šè¿‡ä¸Šé¢ä¸¤ä¸ªå·¥å…·çš„ä»‹ç»ï¼Œå¹³æ—¶åœ¨æ—¥å¸¸å·¥ä½œä¸­æ‰¾åˆ°ç¼–å†™yamlæ–‡ä»¶éƒ¨ç½²åº”ç”¨çš„åœ°å›¾ï¼Œå»ºè®®æ‰‹å·¥å¤šå†™å‡ æ¬¡ï¼Œæ³¨æ„è¯­æ³•é”è¿›ï¼Œå¤šå†™å‡ æ¬¡å°±ç†Ÿæ‚‰äº†ã€‚Podä¸­è®¾è®¡åˆ°æœ‰å¾ˆå¤šçš„ç‰¹æ€§ï¼Œå¦‚èµ„æºåˆ†é…ï¼Œå¥åº·æ£€æŸ¥ï¼Œå­˜å‚¨æŒ‚è½½ç­‰ï¼ˆå‚è€ƒé™„å½•æ–‡ç« ï¼‰ï¼Œåç»­æˆ‘ä»¬åšè¯¦ç»†ä»‹ç»ï¼ŒPodå°†ä»¥Templateçš„æ–¹å¼åµŒå…¥åˆ°å‰¯æœ¬æ§åˆ¶å™¨å¦‚Deploymentsä¸­ã€‚ é™„å½• å®¹å™¨é•œåƒä»‹ç»ï¼šhttps://kubernetes.io/docs/concepts/containers/images/ Podä»‹ç»ï¼šhttps://kubernetes.io/docs/concepts/workloads/pods/pod-overview/ Resourceé™å®šå†…å­˜èµ„æºï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/ Resourceé™å®šCPUèµ„æºï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/ PodæŒ‚è½½å­˜å‚¨ï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/configure-volume-storage/ Podé…ç½®å¥åº·æ£€æŸ¥ï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/:3:0","tags":["kubernetes"],"title":"05 åˆè¯†æ ¸å¿ƒæ¦‚å¿µpod","uri":"/myBlog-2/post/05-%E5%88%9D%E8%AF%86%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5pod/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆäº”ï¼‰æ·±å…¥æŒæ¡æ ¸å¿ƒæ¦‚å¿µpodåˆæ­¥ä»‹ç»äº†yamlå­¦ä¹ kubernetesä¸­é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µpodï¼Œæ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹podçš„resourceèµ„æºç®¡ç†å’Œpodçš„Quality of serviceæœåŠ¡è´¨é‡ã€‚ 1. Podèµ„æºç®¡ç† ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:0:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 resourceå®šä¹‰ å®¹å™¨è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…æ‰€éœ€çš„èµ„æºï¼Œå¦‚ä½•ä¸cggroupè”åŠ¨é…åˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡å®šä¹‰resourceæ¥å®ç°èµ„æºçš„åˆ†é…ï¼Œèµ„æºçš„åˆ†é…å•ä½ä¸»è¦æ˜¯cpuå’Œmemoryï¼Œèµ„æºçš„å®šä¹‰åˆ†ä¸¤ç§ï¼šrequestså’Œlimitsï¼Œrequestsè¡¨ç¤ºè¯·æ±‚èµ„æºï¼Œä¸»è¦ç”¨äºåˆå§‹kubernetesè°ƒåº¦podæ—¶çš„ä¾æ®ï¼Œè¡¨ç¤ºå¿…é¡»æ»¡è¶³çš„åˆ†é…èµ„æº;limitsè¡¨ç¤ºèµ„æºçš„é™åˆ¶ï¼Œå³podä¸èƒ½è¶…è¿‡limitså®šä¹‰çš„é™åˆ¶å¤§å°ï¼Œè¶…è¿‡åˆ™é€šè¿‡cggroupé™åˆ¶ï¼Œpodä¸­å®šä¹‰èµ„æºå¯ä»¥é€šè¿‡ä¸‹é¢å››ä¸ªå­—æ®µå®šä¹‰ï¼š spec.container[].resources.requests.cpu è¯·æ±‚cpuèµ„æºçš„å¤§å°ï¼Œå¦‚0.1ä¸ªcpuå’Œ100mè¡¨ç¤ºåˆ†é…1/10ä¸ªcpuï¼› spec.container[].resources.requests.memory è¯·æ±‚å†…å­˜å¤§å°ï¼Œå•ä½å¯ç”¨Mï¼ŒMiï¼ŒGï¼ŒGiè¡¨ç¤ºï¼› spec.container[].resources.limits.cpu é™åˆ¶cpuçš„å¤§å°ï¼Œä¸èƒ½è¶…è¿‡é˜€å€¼ï¼Œcggroupä¸­é™åˆ¶çš„å€¼ï¼› spec.container[].resources.limits.memory é™åˆ¶å†…å­˜çš„å¤§å°ï¼Œä¸èƒ½è¶…è¿‡é˜€å€¼ï¼Œè¶…è¿‡ä¼šå‘ç”ŸOOMï¼› 1ã€å¼€å§‹å­¦ä¹ å¦‚ä½•å®šä¹‰podçš„resourceèµ„æº,å¦‚ä¸‹ä»¥å®šä¹‰nginx-demoä¸ºä¾‹ï¼Œå®¹å™¨è¯·æ±‚cpuèµ„æºä¸º250mï¼Œé™åˆ¶ä¸º500mï¼Œè¯·æ±‚å†…å­˜èµ„æºä¸º128Miï¼Œé™åˆ¶å†…å­˜èµ„æºä¸º256Miï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å®šä¹‰å¤šä¸ªå®¹å™¨çš„èµ„æºï¼Œå¤šä¸ªå®¹å™¨ç›¸åŠ å°±æ˜¯podçš„èµ„æºæ€»èµ„æºï¼Œå¦‚ä¸‹ï¼š [root@node-1 demo]#cat nginx-resource.yaml apiVersion: v1 kind: Pod metadata: name: nginx-demo labels: name: nginx-demo spec: containers: - name: nginx-demo image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: nginx-port-80 protocol: TCP containerPort: 80 resources: requests: cpu: 0.25 memory: 128Mi limits: cpu: 500m memory: 256Mi 2ã€åº”ç”¨podçš„é…ç½®å®šä¹‰(å¦‚ä¹‹å‰çš„podè¿˜å­˜åœ¨ï¼Œå…ˆå°†å…¶åˆ é™¤kubectl delete pod ),æˆ–podå‘½åä¸ºå¦å¤–ä¸€ä¸ªå [root@node-1 demo]# kubectl apply -f nginx-resource.yaml pod/nginx-demo created 3ã€æŸ¥çœ‹podèµ„æºçš„åˆ†é…è¯¦æƒ… [root@node-1 demo]# kubectl get pods NAME READY STATUS RESTARTS AGE demo-7b86696648-8bq7h 1/1 Running 0 12d demo-7b86696648-8qp46 1/1 Running 0 12d demo-7b86696648-d6hfw 1/1 Running 0 12d nginx-demo 1/1 Running 0 94s [root@node-1 demo]# kubectl describe pods nginx-demo Name: nginx-demo Namespace: default Priority: 0 Node: node-3/10.254.100.103 Start Time: Sat, 28 Sep 2019 12:10:49 +0800 Labels: name=nginx-demo Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"labels\":{\"name\":\"nginx-demo\"},\"name\":\"nginx-demo\",\"namespace\":\"default\"},\"sp... Status: Running IP: 10.244.2.13 Containers: nginx-demo: Container ID: docker://55d28fdc992331c5c58a51154cd072cd6ae37e03e05ae829a97129f85eb5ed79 Image: nginx:1.7.9 Image ID: docker-pullable://nginx@sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451 Port: 80/TCP Host Port: 0/TCP State: Running Started: Sat, 28 Sep 2019 12:10:51 +0800 Ready: True Restart Count: 0 Limits: #é™åˆ¶èµ„æº cpu: 500m memory: 256Mi Requests: #è¯·æ±‚èµ„æº cpu: 250m memory: 128Mi Environment: \u003cnone\u003e ...çœç•¥... 4ã€Podçš„èµ„æºå¦‚ä½•åˆ†é…å‘¢ï¼Ÿæ¯«æ— ç–‘é—®æ˜¯ä»nodeä¸Šåˆ†é…çš„ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªpodçš„æ—¶å€™å¦‚æœè®¾ç½®äº†requestsï¼Œkubernetesçš„è°ƒåº¦å™¨kube-schedulerä¼šæ‰§è¡Œä¸¤ä¸ªè°ƒåº¦è¿‡ç¨‹ï¼šfilterè¿‡æ»¤å’Œweightç§°é‡ï¼Œkube-schedulerä¼šæ ¹æ®è¯·æ±‚çš„èµ„æºè¿‡æ»¤ï¼ŒæŠŠç¬¦åˆæ¡ä»¶çš„nodeç­›é€‰å‡ºæ¥ï¼Œç„¶åå†è¿›è¡Œæ’åºï¼ŒæŠŠæœ€æ»¡è¶³è¿è¡Œpodçš„nodeç­›é€‰å‡ºæ¥ï¼Œç„¶åå†ç‰¹å®šçš„nodeä¸Šè¿è¡Œpodã€‚è°ƒåº¦ç®—æ³•å’Œç»†èŠ‚å¯ä»¥å‚è€ƒä¸‹kubernetesè°ƒåº¦ç®—æ³•ä»‹ç»ã€‚å¦‚ä¸‹æ˜¯node-3èŠ‚ç‚¹èµ„æºçš„åˆ†é…è¯¦æƒ…ï¼š [root@node-1 ~]# kubectl describe node node-3 ...çœç•¥... Capacity: #èŠ‚ç‚¹ä¸Šèµ„æºçš„æ€»èµ„æºæƒ…å†µï¼Œ1ä¸ªcpuï¼Œ2gå†…å­˜ï¼Œ110ä¸ªpod cpu: 1 ephemeral-storage: 51473888Ki hugepages-2Mi: 0 memory: 1882352Ki pods: 110 Allocatable: #èŠ‚ç‚¹å®¹è®¸åˆ†é…çš„èµ„æºæƒ…å†µï¼Œéƒ¨åˆ†é¢„ç•™çš„èµ„æºä¼šæ’å‡ºåœ¨AllocatableèŒƒç•´ cpu: 1 ephemeral-storage: 47438335103 hugepages-2Mi: 0 memory: 1779952Ki pods: 110 System Info: Machine ID: 0ea734564f9a4e2881b866b82d679dfc System UUID: FFCD2939-1BF2-4200-B4FD-8822EBFFF904 Boot ID: 293f49fd-8a7c-49e2-8945-7a4addbd88ca Kernel Version: 3.10.0-957.21.3.el7.x86_64 OS Image: CentOS Linux 7 (Core) Operating System: linux Architecture: amd64 Container Runtime Version: docker://18.6.3 Kubelet Version: v1.15.3 Kube-Proxy Version: v1.15.3 PodCIDR: 10.244.2.0/24 Non-terminated Pods: (3 in total) #èŠ‚ç‚¹ä¸Šè¿è¡Œpodçš„èµ„æºçš„æƒ…å†µï¼Œé™¤äº†nginx-demoä¹‹å¤–è¿˜æœ‰å¤šä¸ªpod Namespace Name CPU Requests CPU Limits Memory Requests Memory Limits AGE --------- ---- ------------ ---------- --------------- ------------- --- default nginx-demo 250m (25%) 500m (50%) 128Mi (7%) 256Mi (14%) 63m kube-system kube-flannel-ds-amd64-jp594 100m (10%) 100m (10%) 50Mi (2%) 50Mi (2%) 14d kube-system kube-proxy-mh2gq 0 (0%) 0 (0%) 0 (0%) 0 (0%) 12d Allocated resources: #å·²ç»åˆ†é…çš„cpuå’Œmemoryçš„èµ„æºæƒ…å†µ (Total limits may be over 100 percent, i.e., overcommitted.) Resource Requests Limits -------- -------- ------ cpu 350m (35%) 600m (60%) memory 178Mi (10%) 306Mi (17%) ephemeral-storage 0 (0%) 0 (0%) Events: \u003cnone\u003e ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:1:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2 èµ„æºåˆ†é…åŸç† Podçš„å®šä¹‰çš„èµ„æºrequestså’Œlimitsä½œç”¨äºkubernetesçš„è°ƒåº¦å™¨kube-shedulerä¸Šï¼Œå®é™…ä¸Šcpuå’Œå†…å­˜å®šä¹‰çš„èµ„æºä¼šåº”ç”¨åœ¨containerä¸Šï¼Œé€šè¿‡å®¹å™¨ä¸Šçš„cggroupå®ç°èµ„æºçš„éš”ç¦»ä½œç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸‹èµ„æºåˆ†é…çš„åŸç†ã€‚ spec.containers[].resources.requests.cpu ä½œç”¨åœ¨CpuSharesï¼Œè¡¨ç¤ºåˆ†é…cpu çš„æƒé‡ï¼Œäº‰æŠ¢æ—¶çš„åˆ†é…æ¯”ä¾‹ spec.containers[].resources.requests.memory ä¸»è¦ç”¨äºkube-schedulerè°ƒåº¦å™¨ï¼Œå¯¹å®¹å™¨æ²¡æœ‰è®¾ç½®æ„ä¹‰ spec.containers[].resources.limits.cpu ä½œç”¨CpuQuotaå’ŒCpuPeriodï¼Œå•ä½ä¸ºå¾®ç§’ï¼Œè®¡ç®—æ–¹æ³•ä¸ºï¼šCpuQuota/CpuPeriodï¼Œè¡¨ç¤ºæœ€å¤§cpuæœ€å¤§å¯ä½¿ç”¨çš„ç™¾åˆ†æ¯”ï¼Œå¦‚500mè¡¨ç¤ºå…è®¸ä½¿ç”¨1ä¸ªcpuä¸­çš„50%èµ„æº spec.containers[].resources.limits.memory ä½œç”¨åœ¨Memoryï¼Œè¡¨ç¤ºå®¹å™¨æœ€å¤§å¯ç”¨å†…å­˜å¤§å°ï¼Œè¶…è¿‡åˆ™ä¼šOOM ä»¥ä¸Šé¢å®šä¹‰çš„nginx-demoä¸ºä¾‹ï¼Œç ”ç©¶ä¸‹podä¸­å®šä¹‰çš„requestså’Œlimitsåº”ç”¨åœ¨dockerç”Ÿæ•ˆçš„å‚æ•°ï¼š 1ã€æŸ¥çœ‹podæ‰€åœ¨çš„nodeèŠ‚ç‚¹ï¼Œnginx-demoè°ƒåº¦åˆ°node-3èŠ‚ç‚¹ä¸Š [root@node-1 ~]# kubectl get pods -o wide nginx-demo NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-demo 1/1 Running 0 96m 10.244.2.13 node-3 \u003cnone\u003e \u003cnone\u003e 2ã€è·å–å®¹å™¨çš„idå·ï¼Œå¯ä»¥é€šè¿‡kubectl describe pods nginx-demoçš„containerIDè·å–åˆ°å®¹å™¨çš„idï¼Œæˆ–è€…ç™»é™†åˆ°node-3èŠ‚ç‚¹é€šè¿‡åç§°è¿‡æ»¤è·å–åˆ°å®¹å™¨çš„idå·ï¼Œé»˜è®¤ä¼šæœ‰ä¸¤ä¸ªpodï¼šä¸€ä¸ªé€šè¿‡pauseé•œåƒåˆ›å»ºï¼Œå¦å¤–ä¸€ä¸ªé€šè¿‡åº”ç”¨é•œåƒåˆ›å»º [root@node-3 ~]# docker container list |grep nginx 55d28fdc9923 84581e99d807 \"nginx -g 'daemon ofâ€¦\" 2 hours ago Up 2 hours k8s_nginx-demonginx-demo_default_66958ef7-507a-41cd-a688-7a4976c6a71e_0 2fe0498ea9b5 k8s.gcr.io/pause:3.1 \"/pause\" 2 hours ago Up 2 hours k8s_POD_nginx-demo_default_66958ef7-507a-41cd-a688-7a4976c6a71e_0 3ã€æŸ¥çœ‹dockerå®¹å™¨è¯¦æƒ…ä¿¡æ¯ [root@node-3 ~]# docker container inspect 55d28fdc9923 [ ...éƒ¨åˆ†è¾“å‡ºçœç•¥... { \"Image\": \"sha256:84581e99d807a703c9c03bd1a31cd9621815155ac72a7365fd02311264512656\", \"ResolvConfPath\": \"/var/lib/docker/containers/2fe0498ea9b5dfe1eb63eba09b1598a8dfd60ef046562525da4dcf7903a25250/resolv.conf\", \"HostConfig\": { \"Binds\": [ \"/var/lib/kubelet/pods/66958ef7-507a-41cd-a688-7a4976c6a71e/volumes/kubernetes.io~secret/default-token-5qwmc:/var/run/secrets/kubernetes.io/serviceaccount:ro\", \"/var/lib/kubelet/pods/66958ef7-507a-41cd-a688-7a4976c6a71e/etc-hosts:/etc/hosts\", \"/var/lib/kubelet/pods/66958ef7-507a-41cd-a688-7a4976c6a71e/containers/nginx-demo/1cc072ca:/dev/termination-log\" ], \"ContainerIDFile\": \"\", \"LogConfig\": { \"Type\": \"json-file\", \"Config\": { \"max-size\": \"100m\" } }, \"UTSMode\": \"\", \"UsernsMode\": \"\", \"ShmSize\": 67108864, \"Runtime\": \"runc\", \"ConsoleSize\": [ 0, 0 ], \"Isolation\": \"\", \"CpuShares\": 256, CPUåˆ†é…çš„æƒé‡ï¼Œä½œç”¨åœ¨requests.cpuä¸Š \"Memory\": 268435456, å†…å­˜åˆ†é…çš„å¤§å°ï¼Œä½œç”¨åœ¨limits.memoryä¸Š \"NanoCpus\": 0, \"CgroupParent\": \"kubepods-burstable-pod66958ef7_507a_41cd_a688_7a4976c6a71e.slice\", \"BlkioWeight\": 0, \"BlkioWeightDevice\": null, \"BlkioDeviceReadBps\": null, \"BlkioDeviceWriteBps\": null, \"BlkioDeviceReadIOps\": null, \"BlkioDeviceWriteIOps\": null, \"CpuPeriod\": 100000, CPUåˆ†é…çš„ä½¿ç”¨æ¯”ä¾‹ï¼Œå’ŒCpuQuotaä¸€èµ·ä½œç”¨åœ¨limits.cpuä¸Š \"CpuQuota\": 50000, \"CpuRealtimePeriod\": 0, \"CpuRealtimeRuntime\": 0, \"CpusetCpus\": \"\", \"CpusetMems\": \"\", \"Devices\": [], \"DeviceCgroupRules\": null, \"DiskQuota\": 0, \"KernelMemory\": 0, \"MemoryReservation\": 0, \"MemorySwap\": 268435456, \"MemorySwappiness\": null, \"OomKillDisable\": false, \"PidsLimit\": 0, \"Ulimits\": null, \"CpuCount\": 0, \"CpuPercent\": 0, \"IOMaximumIOps\": 0, \"IOMaximumBandwidth\": 0, }, } ] ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:2:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3. cpuèµ„æºæµ‹è¯• podä¸­cpuçš„é™åˆ¶ä¸»è¦é€šè¿‡requests.cpuå’Œlimits.cpuæ¥å®šä¹‰ï¼Œlimitsæ˜¯ä¸èƒ½è¶…è¿‡çš„cpuå¤§å°ï¼Œæˆ‘ä»¬é€šè¿‡stressé•œåƒæ¥éªŒè¯ï¼Œstressæ˜¯ä¸€ä¸ªcpuå’Œå†…å­˜çš„å‹ä¾§å·¥å…·ï¼Œé€šè¿‡æŒ‡å®šargså‚æ•°çš„å®šä¹‰å‹ä¾§cpuçš„å¤§å°ã€‚ç›‘æ§podçš„cpuå’Œå†…å­˜å¯é€šè¿‡kubectl topçš„æ–¹å¼æ¥æŸ¥çœ‹ï¼Œä¾èµ–äºç›‘æ§ç»„ä»¶å¦‚metric-serveræˆ–promethusï¼Œå½“å‰æ²¡æœ‰å®‰è£…ï¼Œæˆ‘ä»¬é€šè¿‡docker statsçš„æ–¹å¼æ¥æŸ¥çœ‹ã€‚ 1ã€é€šè¿‡stressé•œåƒå®šä¹‰ä¸€ä¸ªpodï¼Œåˆ†é…0.25ä¸ªcoreså’Œæœ€å¤§é™åˆ¶0.5ä¸ªcoreä½¿ç”¨æ¯”ä¾‹ [root@node-1 demo]# cat cpu-demo.yaml apiVersion: v1 kind: Pod metadata: name: cpu-demo namespace: default annotations: kubernetes.io/description: \"demo for cpu requests and\" spec: containers: - name: stress-cpu image: vish/stress resources: requests: cpu: 250m limits: cpu: 500m args: - -cpus - \"1\" 2ã€åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpod [root@node-1 demo]# kubectl apply -f cpu-demo.yaml pod/cpu-demo created 3ã€æŸ¥çœ‹podèµ„æºåˆ†é…è¯¦æƒ… [root@node-1 demo]# kubectl describe pods cpu-demo Name: cpu-demo Namespace: default Priority: 0 Node: node-2/10.254.100.102 Start Time: Sat, 28 Sep 2019 14:33:12 +0800 Labels: \u003cnone\u003e Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{\"kubernetes.io/description\":\"demo for cpu requests and\"},\"name\":\"cpu-demo\",\"nam... kubernetes.io/description: demo for cpu requests and Status: Running IP: 10.244.1.14 Containers: stress-cpu: Container ID: docker://14f93767ad37b92beb91e3792678f60c9987bbad3290ae8c29c35a2a80101836 Image: progrium/stress Image ID: docker-pullable://progrium/stress@sha256:e34d56d60f5caae79333cee395aae93b74791d50e3841986420d23c2ee4697bf Port: \u003cnone\u003e Host Port: \u003cnone\u003e Args: -cpus 1 State: Waiting Reason: CrashLoopBackOff Last State: Terminated Reason: Error Exit Code: 1 Started: Sat, 28 Sep 2019 14:34:28 +0800 Finished: Sat, 28 Sep 2019 14:34:28 +0800 Ready: False Restart Count: 3 Limits: #cpué™åˆ¶ä½¿ç”¨çš„æ¯”ä¾‹ cpu: 500m Requests: #cpuè¯·æ±‚çš„å¤§å° cpu: 250m 4ã€ç™»é™†åˆ°ç‰¹å®šçš„nodeèŠ‚ç‚¹ï¼Œé€šè¿‡docker container statsæŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨è¯¦æƒ… åœ¨podæ‰€å±çš„nodeä¸Šé€šè¿‡topæŸ¥çœ‹ï¼Œcpuçš„ä½¿ç”¨ç‡é™åˆ¶ç™¾åˆ†æ¯”ä¸º50%ã€‚ é€šè¿‡ä¸Šé¢çš„éªŒè¯å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæˆ‘ä»¬åœ¨stresså®¹å™¨ä¸­å®šä¹‰ä½¿ç”¨1ä¸ªcoreï¼Œé€šè¿‡limits.cpué™å®šå¯ä½¿ç”¨çš„cpuå¤§å°æ˜¯500mï¼Œæµ‹è¯•éªŒè¯podçš„èµ„æºå·²åœ¨å®¹å™¨å†…éƒ¨æˆ–å®¿ä¸»æœºä¸Šéƒ½ä¸¥æ ¼é™åˆ¶åœ¨50%ï¼ˆnodeæœºå™¨ä¸Šåªæœ‰ä¸€ä¸ªcpuï¼Œå¦‚æœæœ‰2ä¸ªcpuåˆ™ä¼šåˆ†æ‘Šä¸º25%ï¼‰ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:3:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.4 memoryèµ„æºæµ‹è¯• 1ã€é€šè¿‡stressé•œåƒæµ‹è¯•éªŒè¯requests.memoryå’Œlimits.memoryçš„ç”Ÿæ•ˆèŒƒå›´ï¼Œlimits.memoryå®šä¹‰å®¹å™¨å¯ä½¿ç”¨çš„å†…å­˜èµ„æºå¤§å°ï¼Œå½“è¶…è¿‡å†…å­˜è®¾å®šçš„å¤§å°åå®¹å™¨ä¼šå‘ç”ŸOOMï¼Œå¦‚ä¸‹å®šä¹‰ä¸€ä¸ªæµ‹è¯•çš„å®¹å™¨ï¼Œæœ€å¤§å†…å­˜ä¸èƒ½è¶…è¿‡512M,ä½¿ç”¨stressé•œåƒâ€“vm-byteså®šä¹‰å‹ä¾§å†…å­˜å¤§å°ä¸º256Mi [root@node-1 demo]# cat memory-demo.yaml apiVersion: v1 kind: Pod metadata: name: memory-stress-demo annotations: kubernetes.io/description: \"stress demo for memory limits\" spec: containers: - name: memory-stress-limits image: polinux/stress resources: requests: memory: 128Mi limits: memory: 512Mi command: [\"stress\"] args: [\"--vm\", \"1\", \"--vm-bytes\", \"256M\", \"--vm-hang\", \"1\"] 2ã€åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpod [root@node-1 demo]# kubectl apply -f memory-demo.yaml pod/memory-stress-demo created [root@node-1 demo]# kubectl get pods memory-stress-demo -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES memory-stress-demo 1/1 Running 0 41s 10.244.1.19 node-2 \u003cnone\u003e \u003cnone\u003e 3ã€æŸ¥çœ‹èµ„æºçš„åˆ†é…æƒ…å†µ [root@node-1 demo]# kubectl describe pods memory-stress-demo Name: memory-stress-demo Namespace: default Priority: 0 Node: node-2/10.254.100.102 Start Time: Sat, 28 Sep 2019 15:13:06 +0800 Labels: \u003cnone\u003e Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{\"kubernetes.io/description\":\"stress demo for memory limits\"},\"name\":\"memory-str... kubernetes.io/description: stress demo for memory limits Status: Running IP: 10.244.1.16 Containers: memory-stress-limits: Container ID: docker://c7408329cffab2f10dd860e50df87bd8671e65a0f8abb4dae96d059c0cb6bb2d Image: polinux/stress Image ID: docker-pullable://polinux/stress@sha256:6d1825288ddb6b3cec8d3ac8a488c8ec2449334512ecb938483fc2b25cbbdb9a Port: \u003cnone\u003e Host Port: \u003cnone\u003e Command: stress Args: --vm 1 --vm-bytes 256Mi --vm-hang 1 State: Waiting Reason: CrashLoopBackOff Last State: Terminated Reason: Error Exit Code: 1 Started: Sat, 28 Sep 2019 15:14:08 +0800 Finished: Sat, 28 Sep 2019 15:14:08 +0800 Ready: False Restart Count: 3 Limits: #å†…å­˜é™åˆ¶å¤§å° memory: 512Mi Requests: #å†…å­˜è¯·æ±‚å¤§å° memory: 128Mi Environment: \u003cnone\u003e Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-5qwmc (ro) 4ã€æŸ¥çœ‹å®¹å™¨å†…å­˜èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œåˆ†é…256Må†…å­˜ï¼Œæœ€å¤§å¯ä½¿ç”¨ä¸º512Miï¼Œåˆ©ç”¨ç‡ä¸º50%ï¼Œæ­¤æ—¶æ²¡æœ‰è¶…è¿‡limitsé™åˆ¶çš„å¤§å°ï¼Œå®¹å™¨è¿è¡Œæ­£å¸¸ 5ã€å½“å®¹å™¨å†…éƒ¨è¶…è¿‡å†…å­˜çš„å¤§å°ä¼šæ€ä¹ˆæ ·å‘¢ï¼Œæˆ‘ä»¬å°†â€“vm-byteè®¾ç½®ä¸º513Mï¼Œå®¹å™¨ä¼šå°è¯•è¿è¡Œï¼Œè¶…è¿‡å†…å­˜åä¼šOOMï¼Œkube-controller-managerä¼šä¸åœçš„å°è¯•é‡å¯å®¹å™¨,RESTARTSçš„æ¬¡æ•°ä¼šä¸åœçš„å¢åŠ ã€‚ [root@node-1 demo]# cat memory-demo.yaml apiVersion: v1 kind: Pod metadata: name: memory-stress-demo annotations: kubernetes.io/description: \"stress demo for memory limits\" spec: containers: - name: memory-stress-limits image: polinux/stress resources: requests: memory: 128Mi limits: memory: 512Mi command: [\"stress\"] args: [\"--vm\", \"1\", \"--vm-bytes\", \"520M\", \"--vm-hang\", \"1\"] . #å®¹å™¨ä¸­ä½¿ç”¨å†…å­˜ä¸º520M æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ä¸ºOOMKilledï¼ŒRESTARTSçš„æ¬¡æ•°ä¸æ–­çš„å¢åŠ ï¼Œä¸åœçš„å°è¯•é‡å¯ [root@node-1 demo]# kubectl get pods memory-stress-demo NAME READY STATUS RESTARTS AGE memory-stress-demo 0/1 OOMKilled 3 60s 2. PodæœåŠ¡è´¨é‡ æœåŠ¡è´¨é‡QOSï¼ˆQuality of Serviceï¼‰ä¸»è¦ç”¨äºpodè°ƒåº¦å’Œé©±é€æ—¶å‚è€ƒçš„é‡è¦å› ç´ ï¼Œä¸åŒçš„QOSå…¶æœåŠ¡è´¨é‡ä¸åŒï¼Œå¯¹åº”ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»å‹çš„Qosï¼š BestEffort å°½æœ€å¤§åŠªåŠ›åˆ†é…èµ„æºï¼Œé»˜è®¤æ²¡æœ‰æŒ‡å®šresourceåˆ†é…çš„Qosï¼Œä¼˜å…ˆçº§æœ€ä½ï¼› Burstable å¯æ³¢åŠ¨çš„èµ„æºï¼Œè‡³å°‘éœ€è¦åˆ†é…åˆ°requestsä¸­çš„èµ„æºï¼Œå¸¸è§çš„QOSï¼› Guaranteed å®Œå…¨å¯ä¿éšœèµ„æºï¼Œrequestså’Œlimitså®šä¹‰çš„èµ„æºç›¸åŒï¼Œä¼˜å…ˆçº§æœ€é«˜ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:4:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.1 BestEffortæœ€å¤§åŠªåŠ› 1ã€Podä¸­æ²¡æœ‰å®šä¹‰resourceï¼Œé»˜è®¤çš„Qosç­–ç•¥ä¸ºBestEffort,ä¼˜å…ˆçº§åˆ«æœ€ä½ï¼Œå½“èµ„æºæ¯”è¾ƒè¿›å±•æ˜¯éœ€è¦é©±é€eviceæ—¶ï¼Œä¼˜å…ˆé©±é€BestEffortå®šä¹‰çš„Podï¼Œå¦‚ä¸‹å®šä¹‰ä¸€ä¸ªBestEffortçš„Pod [root@node-1 demo]# cat nginx-qos-besteffort.yaml apiVersion: v1 kind: Pod metadata: name: nginx-qos-besteffort labels: name: nginx-qos-besteffort spec: containers: - name: nginx-qos-besteffort image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: nginx-port-80 protocol: TCP containerPort: 80 resources: {} 2ã€åˆ›å»ºpodå¹¶æŸ¥çœ‹Qosç­–ç•¥ï¼ŒqosClassä¸ºBestEffort [root@node-1 demo]# kubectl apply -f nginx-qos-besteffort.yaml pod/nginx-qos-besteffort created æŸ¥çœ‹Qosç­–ç•¥ [root@node-1 demo]# kubectl get pods nginx-qos-besteffort -o yaml apiVersion: v1 kind: Pod metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"labels\":{\"name\":\"nginx-qos-besteffort\"},\"name\":\"nginx-qos-besteffort\",\"namespace\":\"default\"},\"spec\":{\"containers\":[{\"image\":\"nginx:1.7.9\",\"imagePullPolicy\":\"IfNotPresent\",\"name\":\"nginx-qos-besteffort\",\"ports\":[{\"containerPort\":80,\"name\":\"nginx-port-80\",\"protocol\":\"TCP\"}],\"resources\":{}}]}} creationTimestamp: \"2019-09-28T11:12:03Z\" labels: name: nginx-qos-besteffort name: nginx-qos-besteffort namespace: default resourceVersion: \"1802411\" selfLink: /api/v1/namespaces/default/pods/nginx-qos-besteffort uid: 56e4a2d5-8645-485d-9362-fe76aad76e74 spec: containers: - image: nginx:1.7.9 imagePullPolicy: IfNotPresent name: nginx-qos-besteffort ports: - containerPort: 80 name: nginx-port-80 protocol: TCP resources: {} terminationMessagePath: /dev/termination-log ...çœç•¥... status: hostIP: 10.254.100.102 phase: Running podIP: 10.244.1.21 qosClass: BestEffort #Qosç­–ç•¥ startTime: \"2019-09-28T11:12:03Z\" 3ã€åˆ é™¤æµ‹è¯•Pod [root@node-1 demo]# kubectl delete pods nginx-qos-besteffort pod \"nginx-qos-besteffort\" deleted ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:5:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.2 Burstableå¯æ³¢åŠ¨ 1ã€Podçš„æœåŠ¡è´¨é‡ä¸ºBurstableï¼Œä»…æ¬¡äºGuaranteedçš„æœåŠ¡è´¨é‡ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªcontainerå®šä¹‰äº†requestsï¼Œä¸”requestså®šä¹‰çš„èµ„æºå°äºlimitsèµ„æº [root@node-1 demo]# cat nginx-qos-burstable.yaml apiVersion: v1 kind: Pod metadata: name: nginx-qos-burstable labels: name: nginx-qos-burstable spec: containers: - name: nginx-qos-burstable image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: nginx-port-80 protocol: TCP containerPort: 80 resources: requests: cpu: 100m memory: 128Mi limits: cpu: 200m memory: 256Mi 2ã€åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpodå¹¶æŸ¥çœ‹Qosç±»å‹ [root@node-1 demo]# kubectl apply -f nginx-qos-burstable.yaml pod/nginx-qos-burstable created æŸ¥çœ‹Qosç±»å‹ [root@node-1 demo]# kubectl describe pods nginx-qos-burstable Name: nginx-qos-burstable Namespace: default Priority: 0 Node: node-2/10.254.100.102 Start Time: Sat, 28 Sep 2019 19:27:37 +0800 Labels: name=nginx-qos-burstable Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"labels\":{\"name\":\"nginx-qos-burstable\"},\"name\":\"nginx-qos-burstable\",\"namespa... Status: Running IP: 10.244.1.22 Containers: nginx-qos-burstable: Container ID: docker://d1324b3953ba6e572bfc63244d4040fee047ed70138b5a4bad033899e818562f Image: nginx:1.7.9 Image ID: docker-pullable://nginx@sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451 Port: 80/TCP Host Port: 0/TCP State: Running Started: Sat, 28 Sep 2019 19:27:39 +0800 Ready: True Restart Count: 0 Limits: cpu: 200m memory: 256Mi Requests: cpu: 100m memory: 128Mi Environment: \u003cnone\u003e Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-5qwmc (ro) Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled True Volumes: default-token-5qwmc: Type: Secret (a volume populated by a Secret) SecretName: default-token-5qwmc Optional: false QoS Class: Burstable #æœåŠ¡è´¨é‡æ˜¯å¯æ³¢åŠ¨çš„Burstable Node-Selectors: \u003cnone\u003e Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 95s default-scheduler Successfully assigned default/nginx-qos-burstable to node-2 Normal Pulled 94s kubelet, node-2 Container image \"nginx:1.7.9\" already present on machine Normal Created 94s kubelet, node-2 Created container nginx-qos-burstable Normal Started 93s kubelet, node-2 Started container nginx-qos-burstable ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:6:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"2.3 Guaranteedå®Œå…¨ä¿éšœ 1ã€resourceä¸­å®šä¹‰çš„cpuå’Œmemoryå¿…é¡»åŒ…å«æœ‰requestså’Œlimitsï¼Œåˆ‡requestså’Œlimitsçš„å€¼å¿…é¡»ç›¸åŒï¼Œå…¶ä¼˜å…ˆçº§åˆ«æœ€é«˜ï¼Œå½“å‡ºç°è°ƒåº¦å’Œé©±é€æ—¶ä¼˜å…ˆä¿éšœè¯¥ç±»å‹çš„Qos,å¦‚ä¸‹å®šä¹‰ä¸€ä¸ªnginx-qos-guaranteedçš„å®¹å™¨ï¼Œrequests.cpuå’Œlimits.cpuç›¸åŒï¼ŒåŒç†requests.memoryå’Œlimits.memory. [root@node-1 demo]# cat nginx-qos-guaranteed.yaml apiVersion: v1 kind: Pod metadata: name: nginx-qos-guaranteed labels: name: nginx-qos-guaranteed spec: containers: - name: nginx-qos-guaranteed image: nginx:1.7.9 imagePullPolicy: IfNotPresent ports: - name: nginx-port-80 protocol: TCP containerPort: 80 resources: requests: cpu: 200m memory: 256Mi limits: cpu: 200m memory: 256Mi 2ã€åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpodå¹¶æŸ¥çœ‹podçš„Qosç±»å‹ä¸ºå¯å®Œå…¨ä¿éšœGuaranteed [root@node-1 demo]# kubectl apply -f nginx-qos-guaranteed.yaml pod/nginx-qos-guaranteed created [root@node-1 demo]# kubectl describe pods nginx-qos-guaranteed Name: nginx-qos-guaranteed Namespace: default Priority: 0 Node: node-2/10.254.100.102 Start Time: Sat, 28 Sep 2019 19:37:15 +0800 Labels: name=nginx-qos-guaranteed Annotations: kubectl.kubernetes.io/last-applied-configuration: {\"apiVersion\":\"v1\",\"kind\":\"Pod\",\"metadata\":{\"annotations\":{},\"labels\":{\"name\":\"nginx-qos-guaranteed\"},\"name\":\"nginx-qos-guaranteed\",\"names... Status: Running IP: 10.244.1.23 Containers: nginx-qos-guaranteed: Container ID: docker://cf533e0e331f49db4e9effb0fbb9249834721f8dba369d281c8047542b9f032c Image: nginx:1.7.9 Image ID: docker-pullable://nginx@sha256:e3456c851a152494c3e4ff5fcc26f240206abac0c9d794affb40e0714846c451 Port: 80/TCP Host Port: 0/TCP State: Running Started: Sat, 28 Sep 2019 19:37:16 +0800 Ready: True Restart Count: 0 Limits: cpu: 200m memory: 256Mi Requests: cpu: 200m memory: 256Mi Environment: \u003cnone\u003e Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-5qwmc (ro) Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled True Volumes: default-token-5qwmc: Type: Secret (a volume populated by a Secret) SecretName: default-token-5qwmc Optional: false QoS Class: Guaranteed #æœåŠ¡è´¨é‡ä¸ºå¯å®Œå…¨ä¿éšœGuaranteed Node-Selectors: \u003cnone\u003e Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300s Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 25s default-scheduler Successfully assigned default/nginx-qos-guaranteed to node-2 Normal Pulled 24s kubelet, node-2 Container image \"nginx:1.7.9\" already present on machine Normal Created 24s kubelet, node-2 Created container nginx-qos-guaranteed Normal Started 24s kubelet, node-2 Started container nginx-qos-guaranteed å†™åœ¨æœ€å æœ¬ç« æ˜¯kubernetesç³»åˆ—æ•™ç¨‹ç¬¬å…­ç¯‡æ–‡ç« ï¼Œé€šè¿‡ä»‹ç»resourceèµ„æºçš„åˆ†é…å’ŒæœåŠ¡è´¨é‡Qosï¼Œå…³äºresourceæœ‰èŠ‚ç‚¹ä½¿ç”¨å»ºè®®ï¼š requestså’Œlimitsèµ„æºå®šä¹‰æ¨èä¸è¶…è¿‡1:2ï¼Œé¿å…åˆ†é…è¿‡å¤šèµ„æºè€Œå‡ºç°èµ„æºäº‰æŠ¢ï¼Œå‘ç”ŸOOMï¼› podä¸­é»˜è®¤æ²¡æœ‰å®šä¹‰resourceï¼Œæ¨èç»™namespaceå®šä¹‰ä¸€ä¸ªlimitrangeï¼Œç¡®ä¿podèƒ½åˆ†åˆ°èµ„æºï¼› é˜²æ­¢nodeä¸Šèµ„æºè¿‡åº¦è€Œå‡ºç°æœºå™¨hangä½æˆ–è€…OOMï¼Œå»ºè®®nodeä¸Šè®¾ç½®ä¿ç•™å’Œé©±é€èµ„æºï¼Œå¦‚ä¿ç•™èµ„æºâ€“system-reserved=cpu=200m,memory=1Gï¼Œé©±é€æ¡ä»¶â€“eviction hard=memory.available\u003c500Miã€‚ é™„å½• å®¹å™¨è®¡ç®—èµ„æºç®¡ç†ï¼šhttps://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/ podå†…å­˜èµ„æºç®¡ç†ï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/ pod cpuèµ„æºç®¡ç†ï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/ æœåŠ¡è´¨é‡QOSï¼šhttps://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/ Dockerå…³äºCPUçš„é™åˆ¶ï¼šhttps://www.cnblogs.com/sparkdev/p/8052522.html ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/:7:0","tags":["kubernetes"],"title":"06 Kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡","uri":"/myBlog-2/post/06-kubernetes%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"å†™åœ¨å‰é¢ ä¸Šä¸€ç¯‡æ–‡ç« ä¸­kubernetesç³»åˆ—æ•™ç¨‹ï¼ˆå…­ï¼‰kubernetesèµ„æºç®¡ç†å’ŒæœåŠ¡è´¨é‡åˆæ­¥ä»‹ç»äº†kubernetesä¸­çš„resourceèµ„æºè°ƒåº¦å’ŒæœåŠ¡è´¨é‡Qosï¼Œä»‹ç»äº†kubernetesä¸­å¦‚ä½•å®šä¹‰podçš„èµ„æºå’Œèµ„æºè°ƒåº¦ï¼Œä»¥åŠè®¾ç½®resourceä¹‹åçš„ä¼˜å…ˆçº§åˆ«Qosï¼Œæ¥ä¸‹æ¥ä»‹ç»kubernetesç³»åˆ—æ•™ç¨‹podçš„è°ƒåº¦æœºåˆ¶ã€‚ 1. Podè°ƒåº¦ ","date":"2019-08-04","objectID":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/:0:0","tags":["kubernetes"],"title":"07 æ·±å…¥ç©è½¬podè°ƒåº¦","uri":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.1 podè°ƒåº¦æ¦‚è¿° kubernetsæ˜¯å®¹å™¨ç¼–æ’å¼•æ“ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å®¹å™¨çš„è°ƒåº¦ï¼Œé€šè¿‡kube-schedulerå®ç°å®¹å™¨çš„å®Œå…¨è‡ªåŠ¨åŒ–è°ƒåº¦ï¼Œè°ƒåº¦å‘¨æœŸåˆ†ä¸ºï¼šè°ƒåº¦å‘¨æœŸScheduling Cycleå’Œç»‘å®šå‘¨æœŸBinding Cycleï¼Œå…¶ä¸­è°ƒåº¦å‘¨æœŸç»†åˆ†ä¸ºè¿‡æ»¤filterå’Œweightç§°é‡ï¼ŒæŒ‰ç…§æŒ‡å®šçš„è°ƒåº¦ç­–ç•¥å°†æ»¡è¶³è¿è¡ŒpodèŠ‚ç‚¹çš„nodeèµ›é€‰å‡ºæ¥ï¼Œç„¶åè¿›è¡Œæ’åºï¼›ç»‘å®šå‘¨æœŸæ˜¯ç»è¿‡kube-schedulerè°ƒåº¦ä¼˜é€‰çš„podåï¼Œç”±ç‰¹å®šçš„nodeèŠ‚ç‚¹watchç„¶åé€šè¿‡kubeletè¿è¡Œã€‚ è¿‡æ»¤é˜¶æ®µåŒ…å«é¢„é€‰Predicateå’Œscoringæ’åºï¼Œé¢„é€‰æ˜¯ç­›é€‰æ»¡è¶³æ¡ä»¶çš„nodeï¼Œæ’åºæ˜¯æœ€æ»¡è¶³æ¡ä»¶çš„nodeæ‰“åˆ†å¹¶æ’åºï¼Œé¢„é€‰çš„ç®—æ³•åŒ…å«æœ‰ï¼š CheckNodeConditionPred èŠ‚ç‚¹æ˜¯å¦ready MemoryPressure èŠ‚ç‚¹å†…å­˜æ˜¯å¦å‹åŠ›å¤§ï¼ˆå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼‰ DiskPressure èŠ‚ç‚¹ç£ç›˜å‹åŠ›æ˜¯å¦å¤§ï¼ˆç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼‰ PIDPressure èŠ‚ç‚¹Pidæ˜¯å¦æœ‰å‹åŠ›ï¼ˆPidè¿›ç¨‹æ˜¯å¦è¶³å¤Ÿï¼‰ GeneralPred åŒ¹é…pod.spec.hostnameå­—æ®µ MatchNodeSelector åŒ¹é…pod.spec.nodeSelectoræ ‡ç­¾ PodFitsResources åˆ¤æ–­resourceå®šä¹‰çš„èµ„æºæ˜¯å¦æ»¡è¶³ PodToleratesNodeTaints èƒ½å®¹å¿çš„æ±¡ç‚¹pod.spec.tolerations CheckNodeLabelPresence CheckServiceAffinity CheckVolumeBinding NoVolumeZoneConflict è¿‡æ»¤æ¡ä»¶éœ€è¦æ£€æŸ¥nodeä¸Šæ»¡è¶³çš„æ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡kubectl describe node node-idæ–¹å¼æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¼˜é€‰è°ƒåº¦ç®—æ³•æœ‰ï¼š least_requested èµ„æºæ¶ˆè€—æœ€å°çš„èŠ‚ç‚¹ balanced_resource_allocation å„é¡¹èµ„æºæ¶ˆè€—æœ€å‡åŒ€çš„èŠ‚ç‚¹ node_prefer_avoid_pods èŠ‚ç‚¹å€¾å‘ taint_toleration æ±¡ç‚¹æ£€æµ‹ï¼Œæ£€æµ‹æœ‰æ±¡ç‚¹æ¡ä»¶çš„nodeï¼Œå¾—åˆ†è¶Šä½ selector_spreading èŠ‚ç‚¹selector interpod_affinity podäº²å’ŒåŠ›éå† most_requested èµ„æºæ¶ˆè€—æœ€å¤§çš„èŠ‚ç‚¹ node_label nodeæ ‡ç­¾ ","date":"2019-08-04","objectID":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/:1:0","tags":["kubernetes"],"title":"07 æ·±å…¥ç©è½¬podè°ƒåº¦","uri":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1. 2 æŒ‡å®šnodeNameè°ƒåº¦ nodeNameæ˜¯PodSpecä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå¯ä»¥é€šè¿‡pod.spec.nodeNameæŒ‡å®šå°†podè°ƒåº¦åˆ°æŸä¸ªå…·ä½“çš„nodeèŠ‚ç‚¹ä¸Šï¼Œè¯¥å­—æ®µæ¯”è¾ƒç‰¹æ®Šä¸€èˆ¬éƒ½ä¸ºç©ºï¼Œå¦‚æœæœ‰è®¾ç½®nodeNameå­—æ®µï¼Œkube-schedulerä¼šç›´æ¥è·³è¿‡è°ƒåº¦ï¼Œåœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šé€šè¿‡kubeletå¯åŠ¨podã€‚é€šè¿‡nodeNameè°ƒåº¦å¹¶éæ˜¯é›†ç¾¤çš„æ™ºèƒ½è°ƒåº¦ï¼Œé€šè¿‡æŒ‡å®šè°ƒåº¦çš„æ–¹å¼å¯èƒ½ä¼šå­˜åœ¨èµ„æºä¸å‡åŒ€çš„æƒ…å†µï¼Œå»ºè®®è®¾ç½®Guaranteedçš„Qosï¼Œé˜²æ­¢èµ„æºä¸å‡æ—¶å€™Podè¢«é©±é€evinceã€‚å¦‚ä¸‹ä»¥åˆ›å»ºä¸€ä¸ªpodè¿è¡Œåœ¨node-3ä¸Šä¸ºä¾‹ï¼š ç¼–å†™yamlå°†podæŒ‡å®šåœ¨node-3èŠ‚ç‚¹ä¸Šè¿è¡Œ [root@node-1 demo]# cat nginx-nodeName.yaml apiVersion: v1 kind: Pod metadata: name: nginx-run-on-nodename annotations: kubernetes.io/description: \"Running the Pod on specific nodeName\" spec: containers: - name: nginx-run-on-nodename image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 nodeName: node-3 #é€šè¿‡nodeNameæŒ‡å®šå°†nginx-run-on-nodenameè¿è¡Œåœ¨ç‰¹å®šèŠ‚ç‚¹node-3ä¸Š è¿è¡Œyamlé…ç½®ä½¿ä¹‹ç”Ÿæ•ˆ [root@node-1 demo]# kubectl apply -f nginx-nodeName.yaml pod/nginx-run-on-nodename created æŸ¥çœ‹ç¡®è®¤podçš„è¿è¡Œæƒ…å†µï¼Œå·²è¿è¡Œåœ¨node-3èŠ‚ç‚¹ [root@node-1 demo]# kubectl get pods nginx-run-on-nodename -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-run-on-nodename 1/1 Running 0 6m52s 10.244.2.15 node-3 \u003cnone\u003e \u003cnone\u003e ","date":"2019-08-04","objectID":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/:2:0","tags":["kubernetes"],"title":"07 æ·±å…¥ç©è½¬podè°ƒåº¦","uri":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.2. é€šè¿‡nodeSelectorè°ƒåº¦ nodeSelectoræ˜¯PodSpecä¸­çš„ä¸€ä¸ªå­—æ®µï¼ŒnodeSelectoræ˜¯æœ€ç®€å•å®ç°å°†podè¿è¡Œåœ¨ç‰¹å®šnodeèŠ‚ç‚¹çš„å®ç°æ–¹å¼ï¼Œå…¶é€šè¿‡æŒ‡å®škeyå’Œvalueé”®å€¼å¯¹çš„æ–¹å¼å®ç°ï¼Œéœ€è¦nodeè®¾ç½®ä¸ŠåŒ¹é…çš„Labelsï¼ŒèŠ‚ç‚¹è°ƒåº¦çš„æ—¶å€™æŒ‡å®šä¸Šç‰¹å®šçš„labelså³å¯ã€‚å¦‚ä¸‹ä»¥node-2æ·»åŠ ä¸€ä¸ªapp:webçš„labelsï¼Œè°ƒåº¦podçš„æ—¶å€™é€šè¿‡nodeSelectoré€‰æ‹©è¯¥labelsï¼š ç»™node-2æ·»åŠ labels [root@node-1 demo]# kubectl label node node-2 app=web node/node-2 labeled æŸ¥çœ‹æ ¡éªŒlabelsè®¾ç½®æƒ…å†µï¼Œnode-2å¢åŠ å¤šäº†ä¸€ä¸ªapp=webçš„labels [root@node-1 demo]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS node-1 Ready master 15d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-1,kubernetes.io/os=linux,node-role.kubernetes.io/master= node-2 Ready \u003cnone\u003e 15d v1.15.3 app=web,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-2,kubernetes.io/os=linux node-3 Ready \u003cnone\u003e 15d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-3,kubernetes.io/os=linux é€šè¿‡nodeSelectorå°†podè°ƒåº¦åˆ°app=webæ‰€å±çš„labels [root@node-1 demo]# cat nginx-nodeselector.yaml apiVersion: v1 kind: Pod metadata: name: nginx-run-on-nodeselector annotations: kubernetes.io/description: \"Running the Pod on specific node by nodeSelector\" spec: containers: - name: nginx-run-on-nodeselector image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 nodeSelector: #é€šè¿‡nodeSelectorå°†podè°ƒåº¦åˆ°ç‰¹å®šçš„labels app: web åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpod [root@node-1 demo]# kubectl apply -f nginx-nodeselector.yaml pod/nginx-run-on-nodeselector created æ£€æŸ¥éªŒè¯podçš„è¿è¡Œæƒ…å†µï¼Œå·²ç»è¿è¡Œåœ¨node-2èŠ‚ç‚¹ [root@node-1 demo]# kubectl get pods nginx-run-on-nodeselector -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-run-on-nodeselector 1/1 Running 0 51s 10.244.1.24 node-2 \u003cnone\u003e \u003cnone\u003e ç³»ç»Ÿé»˜è®¤é¢„å…ˆå®šä¹‰æœ‰å¤šç§å†…ç½®çš„labelsï¼Œè¿™äº›labelså¯ä»¥æ ‡è¯†nodeçš„å±æ€§ï¼Œå¦‚archæ¶æ„ï¼Œæ“ä½œç³»ç»Ÿç±»å‹ï¼Œä¸»æœºåç­‰ beta.kubernetes.io/arch=amd64 beta.kubernetes.io/os=linux kubernetes.io/arch=amd64 kubernetes.io/hostname=node-3 kubernetes.io/os=linux ","date":"2019-08-04","objectID":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/:3:0","tags":["kubernetes"],"title":"07 æ·±å…¥ç©è½¬podè°ƒåº¦","uri":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/"},{"categories":["è½¬è½½","kubernetes","åŸºç¡€æ•™ç¨‹"],"content":"1.3 node Affinity and anti-affinity affinity/anti-affinityå’ŒnodeSelectoråŠŸèƒ½ç›¸ç±»ä¼¼ï¼Œç›¸æ¯”äºnodeSelectorï¼Œaffinityçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œæœªæ¥ä¼šå–ä»£nodeSelectorï¼Œaffinityå¢åŠ äº†å¦‚ä¸‹çš„ä¸€äº›åŠŸèƒ½å¢å¼ºï¼š è¡¨è¾¾å¼æ›´åŠ ä¸°å¯Œï¼ŒåŒ¹é…æ–¹å¼æ”¯æŒå¤šæ ·ï¼Œå¦‚In,NotIn, Exists, DoesNotExist. Gt, and Ltï¼› å¯æŒ‡å®šsoftå’Œpreferenceè§„åˆ™ï¼Œsoftè¡¨ç¤ºéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼Œé€šè¿‡requiredDuringSchedulingIgnoredDuringExecutionæ¥è®¾ç½®ï¼Œpreferenceåˆ™æ˜¯ä¼˜é€‰é€‰æ‹©æ¡ä»¶ï¼Œé€šè¿‡preferredDuringSchedulingIgnoredDuringExecutionæŒ‡å®š affinityæä¾›ä¸¤ç§çº§åˆ«çš„äº²å’Œå’Œåäº²å’Œï¼šåŸºäºnodeçš„node affinityå’ŒåŸºäºpodçš„inter-pod affinity/anti-affinityï¼Œnode affinityæ˜¯é€šè¿‡nodeä¸Šçš„labelsæ¥å®ç°äº²å’ŒåŠ›çš„è°ƒåº¦ï¼Œè€Œpod affinityåˆ™æ˜¯é€šè¿‡podä¸Šçš„labelså®ç°äº²å’ŒåŠ›çš„è°ƒåº¦ï¼Œä¸¤è€…ä½œç”¨çš„èŒƒå›´æœ‰æ‰€ä¸åŒã€‚ ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºnode affinityçš„ä½¿ç”¨ï¼ŒrequiredDuringSchedulingIgnoredDuringExecutionæŒ‡å®šéœ€è¦æ»¡è¶³çš„æ¡ä»¶ï¼ŒpreferredDuringSchedulingIgnoredDuringExecutionæŒ‡å®šä¼˜é€‰çš„æ¡ä»¶ï¼Œä¸¤è€…ä¹‹é—´å–ä¸å…³ç³»ã€‚ æŸ¥è¯¢nodeèŠ‚ç‚¹çš„labelsï¼Œé»˜è®¤åŒ…å«æœ‰å¤šä¸ªlabelsï¼Œå¦‚kubernetes.io/hostname [root@node-1 ~]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS node-1 Ready master 15d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-1,kubernetes.io/os=linux,node-role.kubernetes.io/master= node-2 Ready \u003cnone\u003e 15d v1.15.3 app=web,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-2,kubernetes.io/os=linux node-3 Ready \u003cnone\u003e 15d v1.15.3 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node-3,kubernetes.io/os=linux é€šè¿‡node affiinityå®ç°è°ƒåº¦ï¼Œé€šè¿‡requiredDuringSchedulingIgnoredDuringExecutionæŒ‡å®šæ»¡è¶³æ¡ä»¶kubernetes.io/hostnameä¸ºnode-2å’Œnode-3ï¼Œé€šè¿‡preferredDuringSchedulingIgnoredDuringExecutionä¼˜é€‰æ¡ä»¶éœ€æ»¡è¶³app=webçš„labels [root@node-1 demo]# cat nginx-node-affinity.yaml apiVersion: v1 kind: Pod metadata: name: nginx-run-node-affinity annotations: kubernetes.io/description: \"Running the Pod on specific node by node affinity\" spec: containers: - name: nginx-run-node-affinity image: nginx:latest ports: - name: http-80-port protocol: TCP containerPort: 80 affinity: nodeAffinity: requiredDuringSchedulingIgnoredDuringExecution: nodeSelectorTerms: - matchExpressions: - key: kubernetes.io/hostname operator: In values: - node-1 - node-2 - node-3 preferredDuringSchedulingIgnoredDuringExecution: - weight: 1 preference: matchExpressions: - key: app operator: In values: [\"web\"] åº”ç”¨yamlæ–‡ä»¶ç”Ÿæˆpod [root@node-1 demo]# kubectl apply -f nginx-node-affinity.yaml pod/nginx-run-node-affinity created ç¡®è®¤podæ‰€å±çš„nodeèŠ‚ç‚¹ï¼Œæ»¡è¶³requireå’Œ preferreæ¡ä»¶çš„èŠ‚ç‚¹æ˜¯node-2 [root@node-1 demo]# kubectl get pods --show-labels nginx-run-node-affinity -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES LABELS nginx-run-node-affinity 1/1 Running 0 106s 10.244.1.25 node-2 \u003cnone\u003e \u003cnone\u003e \u003cnone\u003e å†™åœ¨æœ€å æœ¬æ–‡ä»‹ç»äº†kubernetesä¸­çš„è°ƒåº¦æœºåˆ¶ï¼Œé»˜è®¤åˆ›å»ºpodæ˜¯å…¨è‡ªåŠ¨è°ƒåº¦æœºåˆ¶ï¼Œè°ƒåº¦ç”±kube-schedulerå®ç°ï¼Œè°ƒåº¦è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µè°ƒåº¦é˜¶æ®µï¼ˆè¿‡æ»¤å’Œæ²‰é‡æ’åºï¼‰å’Œç»‘å®šé˜¶æ®µï¼ˆåœ¨nodeä¸Šè¿è¡Œpodï¼‰ã€‚é€šè¿‡å¹²é¢„æœ‰å››ç§æ–¹å¼ï¼š æŒ‡å®šnodeName é€šè¿‡nodeSelector é€šè¿‡node affinityå’Œanti-affinity é€šè¿‡pod affinityå’Œanti-affinity é™„å½• è°ƒåº¦æ¡†æ¶ä»‹ç»ï¼šhttps://kubernetes.io/docs/concepts/configuration/scheduling-framework/ Podè°ƒåº¦æ–¹æ³•ï¼šhttps://kubernetes.io/docs/concepts/configuration/assign-pod-node/ ã€ è½¬è½½ ã€è¯¥æ–‡ç« æ¥æºäºç½‘ç»œï¼Œä¾µåˆ ã€‚ ","date":"2019-08-04","objectID":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/:4:0","tags":["kubernetes"],"title":"07 æ·±å…¥ç©è½¬podè°ƒåº¦","uri":"/myBlog-2/post/07-%E6%B7%B1%E5%85%A5%E7%8E%A9%E8%BD%ACpod%E8%B0%83%E5%BA%A6/"},{"categories":null,"content":"å²‚èƒ½å°½å¦‚äººæ„ï¼Œä½†æ±‚æ— æ„§æˆ‘å¿ƒã€‚ æœ¬ç«™åœ°å€ï¼šhttp://x.agou-ops.top ä¸»ç«™åœ°å€ï¼šhttps://agou-ops.top my Docsï¼šhttps://agou-ops.top/beforeWork Docs å¤‡ç”¨ç«™ç‚¹1ï¼š http://bak.agou-ops.top/mydocs Docs å¤‡ç”¨ç«™ç‚¹2ï¼šhttps://d.agou-ops.top myStudyNoteï¼šhttps://agou-ops.top/myStudyNote å‘å¸ƒç«™ç‚¹ï¼šhttp://fabu.agou-ops.top/ ","date":"2019-08-02","objectID":"/myBlog-2/about/:0:0","tags":null,"title":"å…³äºåšä¸»","uri":"/myBlog-2/about/"},{"categories":["hugo","shortcode"],"content":"What a Shortcode is Hugo loves Markdown because of its simple content format, but there are times when Markdown falls short. Often, content authors are forced to add raw HTML (e.g., video \u003ciframes\u003e) to Markdown content. We think this contradicts the beautiful simplicity of Markdownâ€™s syntax. Hugo created shortcodes to circumvent these limitations. A shortcode is a simple snippet inside a content file that Hugo will render using a predefined template. Note that shortcodes will not work in template files. If you need the type of drop-in functionality that shortcodes provide but in a template, you most likely want a [partial template][partials] instead. In addition to cleaner Markdown, shortcodes can be updated any time to reflect new classes, techniques, or standards. At the point of site generation, Hugo shortcodes will easily merge in your changes. You avoid a possibly complicated search and replace operation. More details: https://gohugo.io/content-management/shortcodes/ ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:1:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"blockquotes Normal quote: This is a simple quote. Quote with author: This is a quote with only an Author named Author2. Author2 Quote with author and source: This is a quote from Author3 and source â€œsource.â€ Author3 Source Quote with author and link: This is a quote from Author4 and links to https://www.google.com. Author4 google.com Quote with author, link and title: This is a quote from Author5 and links to https://www.google.com with title â€œGoogle.â€ Author5 Google Quote with author and a link longer than 32 characters, string is first cut at 32 characters then everything after the last forward slash is removed This is a quote from Author5 and links to https://twitter.com/CryptoGangsta/status/716427930126196737 which is longer than 32 characters. And this is a new line in the quote with the HTML br tag. Author6 twitter.com/CryptoGangsta/... Test from the Octopress blockquote page at: http://octopress.org/docs/plugins/blockquote/ Over the past 24 hours Iâ€™ve been reflecting on my life \u0026 Iâ€™ve realized only one thing. I need a medieval battle axe. @allanbranch twitter.com/allanbranch/status/... ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:2:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"music ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:3:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"gist(+1) We can embed the gist in our content via username and gist ID pulled from the URL: {{\u003c gist AGou-ops 5e0b2df2f0d23c65742a633ed0225cf6 \u003e}} Display: ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:4:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"expand The Expand shortcode displays an expandable/collapsible section of text on your page. Here is an example Is this learn theme rocks ? Yes !. ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:5:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"Usage this shortcode takes exactly one optional parameter to define the text that appears next to the expand/collapse icon. (default is â€œClick to expandâ€) {{\u003c expand \"Is this learn theme rocks ?\" \u003e}} Yes !. {{\u003c /expand \u003e}} ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:5:1","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"youtube ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:6:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"vimeo ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:7:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":["hugo","shortcode"],"content":"youku ","date":"2019-03-04","objectID":"/myBlog-2/post/shortcodes-preview/:8:0","tags":[],"title":"Shortcodes Preview","uri":"/myBlog-2/post/shortcodes-preview/"},{"categories":[],"content":"Thanks for liwenyip/hugo-easy-gallery \u0026 Zebradil Â· Pull Request #48 . Now, we could use {{\u003c gallery \u003e}} shortcode in hugo-theme-jane. ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:0:0","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"Normal Image This is an image in static/image folder. ![This is an image in `static/image` folder.](https://agou-images.oss-cn-qingdao.aliyuncs.com/violet-evergarden/Screenshot_2020-03-29-21-40-19.png) ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:1:0","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"{{\u003c figure \u003e}} shortcode ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:2:0","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"figure image with title {{\u003c figure src=\"/image/test.png\" title=\"figure image with title\" \u003e}} ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:2:1","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"figure image with caption {{\u003c figure src=\"/image/example.jpg\" caption=\"figure image with caption figure image with caption figure image with caption figure image with caption figure image with caption\" \u003e}} ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:2:2","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"more {{\u003c figure \u003e}} shortcode usage Specifying your image files: {{\u003c figure src=\"thumb.jpg\" link=\"image.jpg\" \u003e}} will use thumb.jpg for thumbnail and image.jpg for lightbox {{\u003c figure src=\"image.jpg\" \u003e}} or {{\u003c figure link=\"image.jpg\" \u003e}} will use image.jpg for both thumbnail and lightbox {{\u003c figure link=\"image.jpg\" thumb=\"-small\" \u003e}} will use image-small.jpg for thumbnail and image.jpg for lightbox Optional parameters: All the features/parameters of Hugoâ€™s built-in figure shortcode work as normal, i.e. src, link, title, caption, class, attr (attribution), attrlink, alt size (e.g. size=\"1024x768\") pre-defines the image size for PhotoSwipe. Use this option if you donâ€™t want to pre-load the linked image to determine its size. class allows you to set any custom classes you want on the \u003cfigure\u003e tag. Optional parameters for standalone {{\u003c figure \u003e}} shortcodes only (i.e. donâ€™t use on {{\u003c figure \u003e}} inside {{\u003c gallery \u003e}} - strange things may happen if you do): caption-position and caption-effect work the same as for the {{\u003c gallery \u003e}} shortcode (see below). width defines the max-width of the image displayed on the page. If using a thumbnail for a standalone figure, set this equal to your thumbnailâ€™s native width to make the captions behave properly (or feel free to come up with a better solution and submit a pull request :-)). Also use this option if you donâ€™t have a thumbnail and you donâ€™t want the hi-res image to take up the entire width of the screen/container. class=\"no-photoswipe\" prevents a \u003cfigure\u003e from being loaded into PhotoSwipe. If you click on the figure youâ€™ll instead a good ol' fashioned hyperlink to a bigger image (or - if you havenâ€™t specified a bigger image - the same one). ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:2:3","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"{{\u003c gallery \u003e}} shortcode ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:3:0","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"simple gallery To specify a directory of image files: {{\u003c gallery dir=\"/img/your-directory-of-images/\" \u003e}} The images are automatically captioned with the file name. [image].jpg is used for the hi-res image, and [image]-thumb.jpg is used for the thumbnails. If [image]-thumb.jpg doesnâ€™t exist, then [image].jpg will be used for both hi-res and thumbnail images. The default thumbnail suffix is -thumb, but you can specify a different one e.g. thumb=\"-small\" or thumb=\"_150x150\". ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:3:1","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"},{"categories":[],"content":"To specify individual image files {{\u003c gallery \u003e}} {{\u003c figure src=\"image1.jpg\" \u003e}} {{\u003c figure src=\"image2.jpg\" \u003e}} {{\u003c figure src=\"image3.jpg\" \u003e}} {{\u003c /gallery \u003e}} Optional parameters: caption-position - determines the captions' position over the image. Options: bottom (default) center none hides captions on the page (they will only show in PhotoSwipe) caption-effect - determines if/how captions appear upon hover. Options: slide (default) fade none (captions always visible) hover-effect - determines if/how images change upon hover. Options: zoom (default) grow shrink slideup slidedown none hover-transition - determines if/how images change upon hover. Options: not set - smooth transition (default) none - hard transition ","date":"2019-03-03","objectID":"/myBlog-2/post/image-preview/:3:2","tags":[],"title":"Image Preview","uri":"/myBlog-2/post/image-preview/"}]